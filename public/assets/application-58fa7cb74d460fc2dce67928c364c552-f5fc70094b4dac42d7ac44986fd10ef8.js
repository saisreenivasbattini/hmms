function EdgeDetector(t,e,i,n,r){var s=t.naturalWidth,o=t.naturalHeight;if(r&&(o=r+i),i=parseInt(i||0,10),!t||!e||"img"!=t.tagName.toLowerCase()||"canvas"!=e.tagName.toLowerCase()||isNaN(s)||isNaN(o)||isNaN(i))throw"Invalid argument";o-=i,this.width=s,this.height=o,this.image=t,this.offset=i,this.canvas=e,this.min_size=n,this.initialized=!1,this.canvas.width=s,this.canvas.height=o}!function(t,e){function i(t){var e=t.length,i=se.type(t);return se.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===i||"function"!==i&&(0===e||"number"==typeof e&&e>0&&e-1 in t)}function n(t){var e=fe[t]={};return se.each(t.match(ae)||[],function(t,i){e[i]=!0}),e}function r(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=se.expando+Math.random()}function s(t,i,n){var r;if(n===e&&1===t.nodeType)if(r="data-"+i.replace(ye,"-$1").toLowerCase(),n=t.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:ve.test(n)?JSON.parse(n):n}catch(s){}ge.set(t,i,n)}else n=e;return n}function o(){return!0}function a(){return!1}function l(){try{return G.activeElement}catch(t){}}function h(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function u(t,e,i){if(se.isFunction(e))return se.grep(t,function(t,n){return!!e.call(t,n,t)!==i});if(e.nodeType)return se.grep(t,function(t){return t===e!==i});if("string"==typeof e){if(Ie.test(e))return se.filter(e,t,i);e=se.filter(e,t)}return se.grep(t,function(t){return ee.call(e,t)>=0!==i})}function c(t,e){return se.nodeName(t,"table")&&se.nodeName(1===e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function d(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function p(t){var e=Be.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function f(t,e){for(var i=t.length,n=0;i>n;n++)me.set(t[n],"globalEval",!e||me.get(e[n],"globalEval"))}function g(t,e){var i,n,r,s,o,a,l,h;if(1===e.nodeType){if(me.hasData(t)&&(s=me.access(t),o=me.set(e,s),h=s.events)){delete o.handle,o.events={};for(r in h)for(i=0,n=h[r].length;n>i;i++)se.event.add(e,r,h[r][i])}ge.hasData(t)&&(a=ge.access(t),l=se.extend({},a),ge.set(e,l))}}function m(t,i){var n=t.getElementsByTagName?t.getElementsByTagName(i||"*"):t.querySelectorAll?t.querySelectorAll(i||"*"):[];return i===e||i&&se.nodeName(t,i)?se.merge([t],n):n}function v(t,e){var i=e.nodeName.toLowerCase();"input"===i&&Oe.test(t.type)?e.checked=t.checked:("input"===i||"textarea"===i)&&(e.defaultValue=t.defaultValue)}function y(t,e){if(e in t)return e;for(var i=e.charAt(0).toUpperCase()+e.slice(1),n=e,r=Ze.length;r--;)if(e=Ze[r]+i,e in t)return e;return n}function w(t,e){return t=e||t,"none"===se.css(t,"display")||!se.contains(t.ownerDocument,t)}function b(e){return t.getComputedStyle(e,null)}function _(t,e){for(var i,n,r,s=[],o=0,a=t.length;a>o;o++)n=t[o],n.style&&(s[o]=me.get(n,"olddisplay"),i=n.style.display,e?(s[o]||"none"!==i||(n.style.display=""),""===n.style.display&&w(n)&&(s[o]=me.access(n,"olddisplay",C(n.nodeName)))):s[o]||(r=w(n),(i&&"none"!==i||!r)&&me.set(n,"olddisplay",r?i:se.css(n,"display"))));for(o=0;a>o;o++)n=t[o],n.style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?s[o]||"":"none"));return t}function k(t,e,i){var n=qe.exec(e);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):e}function S(t,e,i,n,r){for(var s=i===(n?"border":"content")?4:"width"===e?1:0,o=0;4>s;s+=2)"margin"===i&&(o+=se.css(t,i+Ye[s],!0,r)),n?("content"===i&&(o-=se.css(t,"padding"+Ye[s],!0,r)),"margin"!==i&&(o-=se.css(t,"border"+Ye[s]+"Width",!0,r))):(o+=se.css(t,"padding"+Ye[s],!0,r),"padding"!==i&&(o+=se.css(t,"border"+Ye[s]+"Width",!0,r)));return o}function x(t,e,i){var n=!0,r="width"===e?t.offsetWidth:t.offsetHeight,s=b(t),o=se.support.boxSizing&&"border-box"===se.css(t,"boxSizing",!1,s);if(0>=r||null==r){if(r=He(t,e,s),(0>r||null==r)&&(r=t.style[e]),Ue.test(r))return r;n=o&&(se.support.boxSizingReliable||r===t.style[e]),r=parseFloat(r)||0}return r+S(t,e,i||(o?"border":"content"),n,s)+"px"}function C(t){var e=G,i=Ke[t];return i||(i=T(t,e),"none"!==i&&i||(Ve=(Ve||se("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(e.documentElement),e=(Ve[0].contentWindow||Ve[0].contentDocument).document,e.write("<!doctype html><html><body>"),e.close(),i=T(t,e),Ve.detach()),Ke[t]=i),i}function T(t,e){var i=se(e.createElement(t)).appendTo(e.body),n=se.css(i[0],"display");return i.remove(),n}function $(t,e,i,n){var r;if(se.isArray(e))se.each(e,function(e,r){i||ei.test(t)?n(t,r):$(t+"["+("object"==typeof r?e:"")+"]",r,i,n)});else if(i||"object"!==se.type(e))n(t,e);else for(r in e)$(t+"["+r+"]",e[r],i,n)}function I(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,r=0,s=e.toLowerCase().match(ae)||[];if(se.isFunction(i))for(;n=s[r++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function L(t,e,i,n){function r(a){var l;return s[a]=!0,se.each(t[a]||[],function(t,a){var h=a(e,i,n);return"string"!=typeof h||o||s[h]?o?!(l=h):void 0:(e.dataTypes.unshift(h),r(h),!1)}),l}var s={},o=t===yi;return r(e.dataTypes[0])||!s["*"]&&r("*")}function D(t,i){var n,r,s=se.ajaxSettings.flatOptions||{};for(n in i)i[n]!==e&&((s[n]?t:r||(r={}))[n]=i[n]);return r&&se.extend(!0,t,r),t}function E(t,i,n){for(var r,s,o,a,l=t.contents,h=t.dataTypes;"*"===h[0];)h.shift(),r===e&&(r=t.mimeType||i.getResponseHeader("Content-Type"));if(r)for(s in l)if(l[s]&&l[s].test(r)){h.unshift(s);break}if(h[0]in n)o=h[0];else{for(s in n){if(!h[0]||t.converters[s+" "+h[0]]){o=s;break}a||(a=s)}o=o||a}return o?(o!==h[0]&&h.unshift(o),n[o]):void 0}function P(t,e,i,n){var r,s,o,a,l,h={},u=t.dataTypes.slice();if(u[1])for(o in t.converters)h[o.toLowerCase()]=t.converters[o];for(s=u.shift();s;)if(t.responseFields[s]&&(i[t.responseFields[s]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=s,s=u.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(o=h[l+" "+s]||h["* "+s],!o)for(r in h)if(a=r.split(" "),a[1]===s&&(o=h[l+" "+a[0]]||h["* "+a[0]])){o===!0?o=h[r]:h[r]!==!0&&(s=a[0],u.unshift(a[1]));break}if(o!==!0)if(o&&t["throws"])e=o(e);else try{e=o(e)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+l+" to "+s}}}return{state:"success",data:e}}function A(){return setTimeout(function(){$i=e}),$i=se.now()}function M(t,e,i){for(var n,r=(Ai[e]||[]).concat(Ai["*"]),s=0,o=r.length;o>s;s++)if(n=r[s].call(i,e,t))return n}function z(t,e,i){var n,r,s=0,o=Pi.length,a=se.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var e=$i||A(),i=Math.max(0,h.startTime+h.duration-e),n=i/h.duration||0,s=1-n,o=0,l=h.tweens.length;l>o;o++)h.tweens[o].run(s);return a.notifyWith(t,[h,s,i]),1>s&&l?i:(a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:se.extend({},e),opts:se.extend(!0,{specialEasing:{}},i),originalProperties:e,originalOptions:i,startTime:$i||A(),duration:i.duration,tweens:[],createTween:function(e,i){var n=se.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(n),n},stop:function(e){var i=0,n=e?h.tweens.length:0;if(r)return this;for(r=!0;n>i;i++)h.tweens[i].run(1);return e?a.resolveWith(t,[h,e]):a.rejectWith(t,[h,e]),this}}),u=h.props;for(O(u,h.opts.specialEasing);o>s;s++)if(n=Pi[s].call(h,t,u,h.opts))return n;return se.map(u,M,h),se.isFunction(h.opts.start)&&h.opts.start.call(t,h),se.fx.timer(se.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function O(t,e){var i,n,r,s,o;for(i in t)if(n=se.camelCase(i),r=e[n],s=t[i],se.isArray(s)&&(r=s[1],s=t[i]=s[0]),i!==n&&(t[n]=s,delete t[i]),o=se.cssHooks[n],o&&"expand"in o){s=o.expand(s),delete t[n];for(i in s)i in t||(t[i]=s[i],e[i]=r)}else e[n]=r}function R(t,i,n){var r,s,o,a,l,h,u=this,c={},d=t.style,p=t.nodeType&&w(t),f=me.get(t,"fxshow");n.queue||(l=se._queueHooks(t,"fx"),null==l.unqueued&&(l.unqueued=0,h=l.empty.fire,l.empty.fire=function(){l.unqueued||h()}),l.unqueued++,u.always(function(){u.always(function(){l.unqueued--,se.queue(t,"fx").length||l.empty.fire()})})),1===t.nodeType&&("height"in i||"width"in i)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===se.css(t,"display")&&"none"===se.css(t,"float")&&(d.display="inline-block")),n.overflow&&(d.overflow="hidden",u.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(r in i)if(s=i[r],Li.exec(s)){if(delete i[r],o=o||"toggle"===s,s===(p?"hide":"show")){if("show"!==s||!f||f[r]===e)continue;p=!0}c[r]=f&&f[r]||se.style(t,r)}if(!se.isEmptyObject(c)){f?"hidden"in f&&(p=f.hidden):f=me.access(t,"fxshow",{}),o&&(f.hidden=!p),p?se(t).show():u.done(function(){se(t).hide()}),u.done(function(){var e;me.remove(t,"fxshow");for(e in c)se.style(t,e,c[e])});for(r in c)a=M(p?f[r]:0,r,u),r in f||(f[r]=a.start,p&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}}function N(t,e,i,n,r){return new N.prototype.init(t,e,i,n,r)}function B(t,e){var i,n={height:t},r=0;for(e=e?1:0;4>r;r+=2-e)i=Ye[r],n["margin"+i]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function F(t){return se.isWindow(t)?t:9===t.nodeType&&t.defaultView}var j,H,V=typeof e,W=t.location,G=t.document,q=G.documentElement,U=t.jQuery,X=t.$,K={},J=[],Q="2.0.3",Y=J.concat,Z=J.push,te=J.slice,ee=J.indexOf,ie=K.toString,ne=K.hasOwnProperty,re=Q.trim,se=function(t,e){return new se.fn.init(t,e,j)},oe=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ae=/\S+/g,le=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,he=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ue=/^-ms-/,ce=/-([\da-z])/gi,de=function(t,e){return e.toUpperCase()},pe=function(){G.removeEventListener("DOMContentLoaded",pe,!1),t.removeEventListener("load",pe,!1),se.ready()};se.fn=se.prototype={jquery:Q,constructor:se,init:function(t,i,n){var r,s;if(!t)return this;if("string"==typeof t){if(r="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:le.exec(t),!r||!r[1]&&i)return!i||i.jquery?(i||n).find(t):this.constructor(i).find(t);if(r[1]){if(i=i instanceof se?i[0]:i,se.merge(this,se.parseHTML(r[1],i&&i.nodeType?i.ownerDocument||i:G,!0)),he.test(r[1])&&se.isPlainObject(i))for(r in i)se.isFunction(this[r])?this[r](i[r]):this.attr(r,i[r]);return this}return s=G.getElementById(r[2]),s&&s.parentNode&&(this.length=1,this[0]=s),this.context=G,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):se.isFunction(t)?n.ready(t):(t.selector!==e&&(this.selector=t.selector,this.context=t.context),se.makeArray(t,this))},selector:"",length:0,toArray:function(){return te.call(this)},get:function(t){return null==t?this.toArray():0>t?this[this.length+t]:this[t]},pushStack:function(t){var e=se.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return se.each(this,t,e)},ready:function(t){return se.ready.promise().done(t),this},slice:function(){return this.pushStack(te.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(0>t?e:0);return this.pushStack(i>=0&&e>i?[this[i]]:[])},map:function(t){return this.pushStack(se.map(this,function(e,i){return t.call(e,i,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:Z,sort:[].sort,splice:[].splice},se.fn.init.prototype=se.fn,se.extend=se.fn.extend=function(){var t,i,n,r,s,o,a=arguments[0]||{},l=1,h=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[1]||{},l=2),"object"==typeof a||se.isFunction(a)||(a={}),h===l&&(a=this,--l);h>l;l++)if(null!=(t=arguments[l]))for(i in t)n=a[i],r=t[i],a!==r&&(u&&r&&(se.isPlainObject(r)||(s=se.isArray(r)))?(s?(s=!1,o=n&&se.isArray(n)?n:[]):o=n&&se.isPlainObject(n)?n:{},a[i]=se.extend(u,o,r)):r!==e&&(a[i]=r));return a},se.extend({expando:"jQuery"+(Q+Math.random()).replace(/\D/g,""),noConflict:function(e){return t.$===se&&(t.$=X),e&&t.jQuery===se&&(t.jQuery=U),se},isReady:!1,readyWait:1,holdReady:function(t){t?se.readyWait++:se.ready(!0)},ready:function(t){(t===!0?--se.readyWait:se.isReady)||(se.isReady=!0,t!==!0&&--se.readyWait>0||(H.resolveWith(G,[se]),se.fn.trigger&&se(G).trigger("ready").off("ready")))},isFunction:function(t){return"function"===se.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?K[ie.call(t)]||"object":typeof t},isPlainObject:function(t){if("object"!==se.type(t)||t.nodeType||se.isWindow(t))return!1;try{if(t.constructor&&!ne.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},error:function(t){throw new Error(t)},parseHTML:function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||G;var n=he.exec(t),r=!i&&[];return n?[e.createElement(n[1])]:(n=se.buildFragment([t],e,r),r&&se(r).remove(),se.merge([],n.childNodes))},parseJSON:JSON.parse,parseXML:function(t){var i,n;if(!t||"string"!=typeof t)return null;try{n=new DOMParser,i=n.parseFromString(t,"text/xml")}catch(r){i=e}return(!i||i.getElementsByTagName("parsererror").length)&&se.error("Invalid XML: "+t),i},noop:function(){},globalEval:function(t){var e,i=eval;t=se.trim(t),t&&(1===t.indexOf("use strict")?(e=G.createElement("script"),e.text=t,G.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(ue,"ms-").replace(ce,de)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,n){var r,s=0,o=t.length,a=i(t);if(n){if(a)for(;o>s&&(r=e.apply(t[s],n),r!==!1);s++);else for(s in t)if(r=e.apply(t[s],n),r===!1)break}else if(a)for(;o>s&&(r=e.call(t[s],s,t[s]),r!==!1);s++);else for(s in t)if(r=e.call(t[s],s,t[s]),r===!1)break;return t},trim:function(t){return null==t?"":re.call(t)},makeArray:function(t,e){var n=e||[];return null!=t&&(i(Object(t))?se.merge(n,"string"==typeof t?[t]:t):Z.call(n,t)),n},inArray:function(t,e,i){return null==e?-1:ee.call(e,t,i)},merge:function(t,i){var n=i.length,r=t.length,s=0;if("number"==typeof n)for(;n>s;s++)t[r++]=i[s];else for(;i[s]!==e;)t[r++]=i[s++];return t.length=r,t},grep:function(t,e,i){var n,r=[],s=0,o=t.length;for(i=!!i;o>s;s++)n=!!e(t[s],s),i!==n&&r.push(t[s]);return r},map:function(t,e,n){var r,s=0,o=t.length,a=i(t),l=[];if(a)for(;o>s;s++)r=e(t[s],s,n),null!=r&&(l[l.length]=r);else for(s in t)r=e(t[s],s,n),null!=r&&(l[l.length]=r);return Y.apply([],l)},guid:1,proxy:function(t,i){var n,r,s;return"string"==typeof i&&(n=t[i],i=t,t=n),se.isFunction(t)?(r=te.call(arguments,2),s=function(){return t.apply(i||this,r.concat(te.call(arguments)))},s.guid=t.guid=t.guid||se.guid++,s):e},access:function(t,i,n,r,s,o,a){var l=0,h=t.length,u=null==n;if("object"===se.type(n)){s=!0;for(l in n)se.access(t,i,l,n[l],!0,o,a)}else if(r!==e&&(s=!0,se.isFunction(r)||(a=!0),u&&(a?(i.call(t,r),i=null):(u=i,i=function(t,e,i){return u.call(se(t),i)})),i))for(;h>l;l++)i(t[l],n,a?r:r.call(t[l],l,i(t[l],n)));return s?t:u?i.call(t):h?i(t[0],n):o},now:Date.now,swap:function(t,e,i,n){var r,s,o={};for(s in e)o[s]=t.style[s],t.style[s]=e[s];r=i.apply(t,n||[]);for(s in e)t.style[s]=o[s];return r}}),se.ready.promise=function(e){return H||(H=se.Deferred(),"complete"===G.readyState?setTimeout(se.ready):(G.addEventListener("DOMContentLoaded",pe,!1),t.addEventListener("load",pe,!1))),H.promise(e)},se.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){K["[object "+e+"]"]=e.toLowerCase()}),j=se(G),function(t,e){function i(t,e,i,n){var r,s,o,a,l,h,u,c,f,g;if((e?e.ownerDocument||e:F)!==P&&E(e),e=e||P,i=i||[],!t||"string"!=typeof t)return i;if(1!==(a=e.nodeType)&&9!==a)return[];if(M&&!n){if(r=we.exec(t))if(o=r[1]){if(9===a){if(s=e.getElementById(o),!s||!s.parentNode)return i;if(s.id===o)return i.push(s),i}else if(e.ownerDocument&&(s=e.ownerDocument.getElementById(o))&&N(e,s)&&s.id===o)return i.push(s),i}else{if(r[2])return te.apply(i,e.getElementsByTagName(t)),i;if((o=r[3])&&S.getElementsByClassName&&e.getElementsByClassName)return te.apply(i,e.getElementsByClassName(o)),i}if(S.qsa&&(!z||!z.test(t))){if(c=u=B,f=e,g=9===a&&t,1===a&&"object"!==e.nodeName.toLowerCase()){for(h=d(t),(u=e.getAttribute("id"))?c=u.replace(ke,"\\$&"):e.setAttribute("id",c),c="[id='"+c+"'] ",l=h.length;l--;)h[l]=c+p(h[l]);f=pe.test(t)&&e.parentNode||e,g=h.join(",")}if(g)try{return te.apply(i,f.querySelectorAll(g)),i}catch(m){}finally{u||e.removeAttribute("id")}}}return _(t.replace(ue,"$1"),e,i,n)}function n(){function t(i,n){return e.push(i+=" ")>C.cacheLength&&delete t[e.shift()],t[i]=n}var e=[];return t}function r(t){return t[B]=!0,t}function s(t){var e=P.createElement("div");try{return!!t(e)}catch(i){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function o(t,e){for(var i=t.split("|"),n=t.length;n--;)C.attrHandle[i[n]]=e}function a(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||K)-(~t.sourceIndex||K);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function l(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function h(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function u(t){return r(function(e){return e=+e,r(function(i,n){for(var r,s=t([],i.length,e),o=s.length;o--;)i[r=s[o]]&&(i[r]=!(n[r]=i[r]))})})}function c(){}function d(t,e){var n,r,s,o,a,l,h,u=W[t+" "];if(u)return e?0:u.slice(0);for(a=t,l=[],h=C.preFilter;a;){(!n||(r=ce.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),l.push(s=[])),n=!1,(r=de.exec(a))&&(n=r.shift(),s.push({value:n,type:r[0].replace(ue," ")}),a=a.slice(n.length));for(o in C.filter)!(r=ve[o].exec(a))||h[o]&&!(r=h[o](r))||(n=r.shift(),s.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return e?a.length:a?i.error(t):W(t,l).slice(0)}function p(t){for(var e=0,i=t.length,n="";i>e;e++)n+=t[e].value;return n}function f(t,e,i){var n=e.dir,r=i&&"parentNode"===n,s=H++;return e.first?function(e,i,s){for(;e=e[n];)if(1===e.nodeType||r)return t(e,i,s)}:function(e,i,o){var a,l,h,u=j+" "+s;if(o){for(;e=e[n];)if((1===e.nodeType||r)&&t(e,i,o))return!0}else for(;e=e[n];)if(1===e.nodeType||r)if(h=e[B]||(e[B]={}),(l=h[n])&&l[0]===u){if((a=l[1])===!0||a===x)return a===!0}else if(l=h[n]=[u],l[1]=t(e,i,o)||x,l[1]===!0)return!0}}function g(t){return t.length>1?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function m(t,e,i,n,r){for(var s,o=[],a=0,l=t.length,h=null!=e;l>a;a++)(s=t[a])&&(!i||i(s,n,r))&&(o.push(s),h&&e.push(a));return o}function v(t,e,i,n,s,o){return n&&!n[B]&&(n=v(n)),s&&!s[B]&&(s=v(s,o)),r(function(r,o,a,l){var h,u,c,d=[],p=[],f=o.length,g=r||b(e||"*",a.nodeType?[a]:a,[]),v=!t||!r&&e?g:m(g,d,t,a,l),y=i?s||(r?t:f||n)?[]:o:v;if(i&&i(v,y,a,l),n)for(h=m(y,p),n(h,[],a,l),u=h.length;u--;)(c=h[u])&&(y[p[u]]=!(v[p[u]]=c));if(r){if(s||t){if(s){for(h=[],u=y.length;u--;)(c=y[u])&&h.push(v[u]=c);s(null,y=[],h,l)}for(u=y.length;u--;)(c=y[u])&&(h=s?ie.call(r,c):d[u])>-1&&(r[h]=!(o[h]=c))}}else y=m(y===o?y.splice(f,y.length):y),s?s(null,o,y,l):te.apply(o,y)})}function y(t){for(var e,i,n,r=t.length,s=C.relative[t[0].type],o=s||C.relative[" "],a=s?1:0,l=f(function(t){return t===e},o,!0),h=f(function(t){return ie.call(e,t)>-1},o,!0),u=[function(t,i,n){return!s&&(n||i!==L)||((e=i).nodeType?l(t,i,n):h(t,i,n))}];r>a;a++)if(i=C.relative[t[a].type])u=[f(g(u),i)];else{if(i=C.filter[t[a].type].apply(null,t[a].matches),i[B]){for(n=++a;r>n&&!C.relative[t[n].type];n++);return v(a>1&&g(u),a>1&&p(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(ue,"$1"),i,n>a&&y(t.slice(a,n)),r>n&&y(t=t.slice(n)),r>n&&p(t))}u.push(i)}return g(u)}function w(t,e){var n=0,s=e.length>0,o=t.length>0,a=function(r,a,l,h,u){var c,d,p,f=[],g=0,v="0",y=r&&[],w=null!=u,b=L,_=r||o&&C.find.TAG("*",u&&a.parentNode||a),k=j+=null==b?1:Math.random()||.1;for(w&&(L=a!==P&&a,x=n);null!=(c=_[v]);v++){if(o&&c){for(d=0;p=t[d++];)if(p(c,a,l)){h.push(c);break}w&&(j=k,x=++n)}s&&((c=!p&&c)&&g--,r&&y.push(c))}if(g+=v,s&&v!==g){for(d=0;p=e[d++];)p(y,f,a,l);if(r){if(g>0)for(;v--;)y[v]||f[v]||(f[v]=Y.call(h));f=m(f)}te.apply(h,f),w&&!r&&f.length>0&&g+e.length>1&&i.uniqueSort(h)}return w&&(j=k,L=b),y};return s?r(a):a}function b(t,e,n){for(var r=0,s=e.length;s>r;r++)i(t,e[r],n);return n}function _(t,e,i,n){var r,s,o,a,l,h=d(t);if(!n&&1===h.length){if(s=h[0]=h[0].slice(0),s.length>2&&"ID"===(o=s[0]).type&&S.getById&&9===e.nodeType&&M&&C.relative[s[1].type]){if(e=(C.find.ID(o.matches[0].replace(Se,xe),e)||[])[0],!e)return i;t=t.slice(s.shift().value.length)}for(r=ve.needsContext.test(t)?0:s.length;r--&&(o=s[r],!C.relative[a=o.type]);)if((l=C.find[a])&&(n=l(o.matches[0].replace(Se,xe),pe.test(s[0].type)&&e.parentNode||e))){if(s.splice(r,1),t=n.length&&p(s),!t)return te.apply(i,n),i;break}}return I(t,h)(n,e,!M,i,pe.test(t)),i}var k,S,x,C,T,$,I,L,D,E,P,A,M,z,O,R,N,B="sizzle"+-new Date,F=t.document,j=0,H=0,V=n(),W=n(),G=n(),q=!1,U=function(t,e){return t===e?(q=!0,0):0},X=typeof e,K=1<<31,J={}.hasOwnProperty,Q=[],Y=Q.pop,Z=Q.push,te=Q.push,ee=Q.slice,ie=Q.indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(this[e]===t)return e;return-1},ne="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",re="[\\x20\\t\\r\\n\\f]",oe="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ae=oe.replace("w","w#"),le="\\["+re+"*("+oe+")"+re+"*(?:([*^$|!~]?=)"+re+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ae+")|)|)"+re+"*\\]",he=":("+oe+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+le.replace(3,8)+")*)|.*)\\)|)",ue=new RegExp("^"+re+"+|((?:^|[^\\\\])(?:\\\\.)*)"+re+"+$","g"),ce=new RegExp("^"+re+"*,"+re+"*"),de=new RegExp("^"+re+"*([>+~]|"+re+")"+re+"*"),pe=new RegExp(re+"*[+~]"),fe=new RegExp("="+re+"*([^\\]'\"]*)"+re+"*\\]","g"),ge=new RegExp(he),me=new RegExp("^"+ae+"$"),ve={ID:new RegExp("^#("+oe+")"),CLASS:new RegExp("^\\.("+oe+")"),TAG:new RegExp("^("+oe.replace("w","w*")+")"),ATTR:new RegExp("^"+le),PSEUDO:new RegExp("^"+he),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+re+"*(even|odd|(([+-]|)(\\d*)n|)"+re+"*(?:([+-]|)"+re+"*(\\d+)|))"+re+"*\\)|)","i"),bool:new RegExp("^(?:"+ne+")$","i"),needsContext:new RegExp("^"+re+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+re+"*((?:-\\d)?\\d*)"+re+"*\\)|)(?=[^-]|$)","i")},ye=/^[^{]+\{\s*\[native \w/,we=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,be=/^(?:input|select|textarea|button)$/i,_e=/^h\d$/i,ke=/'|\\/g,Se=new RegExp("\\\\([\\da-f]{1,6}"+re+"?|("+re+")|.)","ig"),xe=function(t,e,i){var n="0x"+e-65536;return n!==n||i?e:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)};try{te.apply(Q=ee.call(F.childNodes),F.childNodes),Q[F.childNodes.length].nodeType}catch(Ce){te={apply:Q.length?function(t,e){Z.apply(t,ee.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}$=i.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},S=i.support={},E=i.setDocument=function(t){var e=t?t.ownerDocument||t:F,i=e.defaultView;return e!==P&&9===e.nodeType&&e.documentElement?(P=e,A=e.documentElement,M=!$(e),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",function(){E()}),S.attributes=s(function(t){return t.className="i",!t.getAttribute("className")}),S.getElementsByTagName=s(function(t){return t.appendChild(e.createComment("")),!t.getElementsByTagName("*").length}),S.getElementsByClassName=s(function(t){return t.innerHTML="<div class='a'></div><div class='a i'></div>",t.firstChild.className="i",2===t.getElementsByClassName("i").length}),S.getById=s(function(t){return A.appendChild(t).id=B,!e.getElementsByName||!e.getElementsByName(B).length}),S.getById?(C.find.ID=function(t,e){if(typeof e.getElementById!==X&&M){var i=e.getElementById(t);return i&&i.parentNode?[i]:[]}},C.filter.ID=function(t){var e=t.replace(Se,xe);return function(t){return t.getAttribute("id")===e}}):(delete C.find.ID,C.filter.ID=function(t){var e=t.replace(Se,xe);return function(t){var i=typeof t.getAttributeNode!==X&&t.getAttributeNode("id");return i&&i.value===e}}),C.find.TAG=S.getElementsByTagName?function(t,e){return typeof e.getElementsByTagName!==X?e.getElementsByTagName(t):void 0}:function(t,e){var i,n=[],r=0,s=e.getElementsByTagName(t);if("*"===t){for(;i=s[r++];)1===i.nodeType&&n.push(i);return n}return s},C.find.CLASS=S.getElementsByClassName&&function(t,e){return typeof e.getElementsByClassName!==X&&M?e.getElementsByClassName(t):void 0},O=[],z=[],(S.qsa=ye.test(e.querySelectorAll))&&(s(function(t){t.innerHTML="<select><option selected=''></option></select>",t.querySelectorAll("[selected]").length||z.push("\\["+re+"*(?:value|"+ne+")"),t.querySelectorAll(":checked").length||z.push(":checked")}),s(function(t){var i=e.createElement("input");i.setAttribute("type","hidden"),t.appendChild(i).setAttribute("t",""),t.querySelectorAll("[t^='']").length&&z.push("[*^$]="+re+"*(?:''|\"\")"),t.querySelectorAll(":enabled").length||z.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),z.push(",.*:")})),(S.matchesSelector=ye.test(R=A.webkitMatchesSelector||A.mozMatchesSelector||A.oMatchesSelector||A.msMatchesSelector))&&s(function(t){S.disconnectedMatch=R.call(t,"div"),R.call(t,"[s!='']:x"),O.push("!=",he)}),z=z.length&&new RegExp(z.join("|")),O=O.length&&new RegExp(O.join("|")),N=ye.test(A.contains)||A.compareDocumentPosition?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},U=A.compareDocumentPosition?function(t,i){if(t===i)return q=!0,0;var n=i.compareDocumentPosition&&t.compareDocumentPosition&&t.compareDocumentPosition(i);return n?1&n||!S.sortDetached&&i.compareDocumentPosition(t)===n?t===e||N(F,t)?-1:i===e||N(F,i)?1:D?ie.call(D,t)-ie.call(D,i):0:4&n?-1:1:t.compareDocumentPosition?-1:1}:function(t,i){var n,r=0,s=t.parentNode,o=i.parentNode,l=[t],h=[i];if(t===i)return q=!0,0;if(!s||!o)return t===e?-1:i===e?1:s?-1:o?1:D?ie.call(D,t)-ie.call(D,i):0;if(s===o)return a(t,i);for(n=t;n=n.parentNode;)l.unshift(n);for(n=i;n=n.parentNode;)h.unshift(n);for(;l[r]===h[r];)r++;return r?a(l[r],h[r]):l[r]===F?-1:h[r]===F?1:0},e):P},i.matches=function(t,e){return i(t,null,null,e)},i.matchesSelector=function(t,e){if((t.ownerDocument||t)!==P&&E(t),e=e.replace(fe,"='$1']"),!(!S.matchesSelector||!M||O&&O.test(e)||z&&z.test(e)))try{var n=R.call(t,e);if(n||S.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(r){}return i(e,P,null,[t]).length>0},i.contains=function(t,e){return(t.ownerDocument||t)!==P&&E(t),N(t,e)},i.attr=function(t,i){(t.ownerDocument||t)!==P&&E(t);var n=C.attrHandle[i.toLowerCase()],r=n&&J.call(C.attrHandle,i.toLowerCase())?n(t,i,!M):e;return r===e?S.attributes||!M?t.getAttribute(i):(r=t.getAttributeNode(i))&&r.specified?r.value:null:r},i.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},i.uniqueSort=function(t){var e,i=[],n=0,r=0;if(q=!S.detectDuplicates,D=!S.sortStable&&t.slice(0),t.sort(U),q){for(;e=t[r++];)e===t[r]&&(n=i.push(r));for(;n--;)t.splice(i[n],1)}return t},T=i.getText=function(t){var e,i="",n=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=T(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[n];n++)i+=T(e);return i},C=i.selectors={cacheLength:50,createPseudo:r,match:ve,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Se,xe),t[3]=(t[4]||t[5]||"").replace(Se,xe),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||i.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&i.error(t[0]),t},PSEUDO:function(t){var i,n=!t[5]&&t[2];return ve.CHILD.test(t[0])?null:(t[3]&&t[4]!==e?t[2]=t[4]:n&&ge.test(n)&&(i=d(n,!0))&&(i=n.indexOf(")",n.length-i)-n.length)&&(t[0]=t[0].slice(0,i),t[2]=n.slice(0,i)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Se,xe).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=V[t+" "];return e||(e=new RegExp("(^|"+re+")"+t+"("+re+"|$)"))&&V(t,function(t){return e.test("string"==typeof t.className&&t.className||typeof t.getAttribute!==X&&t.getAttribute("class")||"")})},ATTR:function(t,e,n){return function(r){var s=i.attr(r,t);return null==s?"!="===e:e?(s+="","="===e?s===n:"!="===e?s!==n:"^="===e?n&&0===s.indexOf(n):"*="===e?n&&s.indexOf(n)>-1:"$="===e?n&&s.slice(-n.length)===n:"~="===e?(" "+s+" ").indexOf(n)>-1:"|="===e?s===n||s.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(t,e,i,n,r){var s="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===n&&0===r?function(t){return!!t.parentNode}:function(e,i,l){var h,u,c,d,p,f,g=s!==o?"nextSibling":"previousSibling",m=e.parentNode,v=a&&e.nodeName.toLowerCase(),y=!l&&!a;if(m){if(s){for(;g;){for(c=e;c=c[g];)if(a?c.nodeName.toLowerCase()===v:1===c.nodeType)return!1;f=g="only"===t&&!f&&"nextSibling"}return!0}if(f=[o?m.firstChild:m.lastChild],o&&y){for(u=m[B]||(m[B]={}),h=u[t]||[],p=h[0]===j&&h[1],d=h[0]===j&&h[2],c=p&&m.childNodes[p];c=++p&&c&&c[g]||(d=p=0)||f.pop();)if(1===c.nodeType&&++d&&c===e){u[t]=[j,p,d];break}}else if(y&&(h=(e[B]||(e[B]={}))[t])&&h[0]===j)d=h[1];else for(;(c=++p&&c&&c[g]||(d=p=0)||f.pop())&&((a?c.nodeName.toLowerCase()!==v:1!==c.nodeType)||!++d||(y&&((c[B]||(c[B]={}))[t]=[j,d]),c!==e)););return d-=r,d===n||d%n===0&&d/n>=0}}},PSEUDO:function(t,e){var n,s=C.pseudos[t]||C.setFilters[t.toLowerCase()]||i.error("unsupported pseudo: "+t);return s[B]?s(e):s.length>1?(n=[t,t,"",e],C.setFilters.hasOwnProperty(t.toLowerCase())?r(function(t,i){for(var n,r=s(t,e),o=r.length;o--;)n=ie.call(t,r[o]),t[n]=!(i[n]=r[o])}):function(t){return s(t,0,n)}):s}},pseudos:{not:r(function(t){var e=[],i=[],n=I(t.replace(ue,"$1"));return n[B]?r(function(t,e,i,r){for(var s,o=n(t,null,r,[]),a=t.length;a--;)(s=o[a])&&(t[a]=!(e[a]=s))}):function(t,r,s){return e[0]=t,n(e,null,s,i),!i.pop()}}),has:r(function(t){return function(e){return i(t,e).length>0}}),contains:r(function(t){return function(e){return(e.textContent||e.innerText||T(e)).indexOf(t)>-1}}),lang:r(function(t){return me.test(t||"")||i.error("unsupported lang: "+t),t=t.replace(Se,xe).toLowerCase(),function(e){var i;do if(i=M?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===A},focus:function(t){return t===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeName>"@"||3===t.nodeType||4===t.nodeType)return!1;return!0},parent:function(t){return!C.pseudos.empty(t)},header:function(t){return _e.test(t.nodeName)},input:function(t){return be.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||e.toLowerCase()===t.type)},first:u(function(){return[0]}),last:u(function(t,e){return[e-1]}),eq:u(function(t,e,i){return[0>i?i+e:i]}),even:u(function(t,e){for(var i=0;e>i;i+=2)t.push(i);return t}),odd:u(function(t,e){for(var i=1;e>i;i+=2)t.push(i);return t}),lt:u(function(t,e,i){for(var n=0>i?i+e:i;--n>=0;)t.push(n);return t}),gt:u(function(t,e,i){for(var n=0>i?i+e:i;++n<e;)t.push(n);return t})}},C.pseudos.nth=C.pseudos.eq;for(k in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[k]=l(k);for(k in{submit:!0,reset:!0})C.pseudos[k]=h(k);c.prototype=C.filters=C.pseudos,C.setFilters=new c,I=i.compile=function(t,e){var i,n=[],r=[],s=G[t+" "];if(!s){for(e||(e=d(t)),i=e.length;i--;)s=y(e[i]),s[B]?n.push(s):r.push(s);s=G(t,w(r,n))}return s},S.sortStable=B.split("").sort(U).join("")===B,S.detectDuplicates=q,E(),S.sortDetached=s(function(t){return 1&t.compareDocumentPosition(P.createElement("div"))
}),s(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||o("type|href|height|width",function(t,e,i){return i?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),S.attributes&&s(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||o("value",function(t,e,i){return i||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),s(function(t){return null==t.getAttribute("disabled")})||o(ne,function(t,e,i){var n;return i?void 0:(n=t.getAttributeNode(e))&&n.specified?n.value:t[e]===!0?e.toLowerCase():null}),se.find=i,se.expr=i.selectors,se.expr[":"]=se.expr.pseudos,se.unique=i.uniqueSort,se.text=i.getText,se.isXMLDoc=i.isXML,se.contains=i.contains}(t);var fe={};se.Callbacks=function(t){t="string"==typeof t?fe[t]||n(t):se.extend({},t);var i,r,s,o,a,l,h=[],u=!t.once&&[],c=function(e){for(i=t.memory&&e,r=!0,l=o||0,o=0,a=h.length,s=!0;h&&a>l;l++)if(h[l].apply(e[0],e[1])===!1&&t.stopOnFalse){i=!1;break}s=!1,h&&(u?u.length&&c(u.shift()):i?h=[]:d.disable())},d={add:function(){if(h){var e=h.length;!function n(e){se.each(e,function(e,i){var r=se.type(i);"function"===r?t.unique&&d.has(i)||h.push(i):i&&i.length&&"string"!==r&&n(i)})}(arguments),s?a=h.length:i&&(o=e,c(i))}return this},remove:function(){return h&&se.each(arguments,function(t,e){for(var i;(i=se.inArray(e,h,i))>-1;)h.splice(i,1),s&&(a>=i&&a--,l>=i&&l--)}),this},has:function(t){return t?se.inArray(t,h)>-1:!(!h||!h.length)},empty:function(){return h=[],a=0,this},disable:function(){return h=u=i=e,this},disabled:function(){return!h},lock:function(){return u=e,i||d.disable(),this},locked:function(){return!u},fireWith:function(t,e){return!h||r&&!u||(e=e||[],e=[t,e.slice?e.slice():e],s?u.push(e):c(e)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!r}};return d},se.extend({Deferred:function(t){var e=[["resolve","done",se.Callbacks("once memory"),"resolved"],["reject","fail",se.Callbacks("once memory"),"rejected"],["notify","progress",se.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var t=arguments;return se.Deferred(function(i){se.each(e,function(e,s){var o=s[0],a=se.isFunction(t[e])&&t[e];r[s[1]](function(){var t=a&&a.apply(this,arguments);t&&se.isFunction(t.promise)?t.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o+"With"](this===n?i.promise():this,a?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?se.extend(t,n):n}},r={};return n.pipe=n.then,se.each(e,function(t,s){var o=s[2],a=s[3];n[s[1]]=o.add,a&&o.add(function(){i=a},e[1^t][2].disable,e[2][2].lock),r[s[0]]=function(){return r[s[0]+"With"](this===r?n:this,arguments),this},r[s[0]+"With"]=o.fireWith}),n.promise(r),t&&t.call(r,r),r},when:function(t){var e,i,n,r=0,s=te.call(arguments),o=s.length,a=1!==o||t&&se.isFunction(t.promise)?o:0,l=1===a?t:se.Deferred(),h=function(t,i,n){return function(r){i[t]=this,n[t]=arguments.length>1?te.call(arguments):r,n===e?l.notifyWith(i,n):--a||l.resolveWith(i,n)}};if(o>1)for(e=new Array(o),i=new Array(o),n=new Array(o);o>r;r++)s[r]&&se.isFunction(s[r].promise)?s[r].promise().done(h(r,n,s)).fail(l.reject).progress(h(r,i,e)):--a;return a||l.resolveWith(n,s),l.promise()}}),se.support=function(e){var i=G.createElement("input"),n=G.createDocumentFragment(),r=G.createElement("div"),s=G.createElement("select"),o=s.appendChild(G.createElement("option"));return i.type?(i.type="checkbox",e.checkOn=""!==i.value,e.optSelected=o.selected,e.reliableMarginRight=!0,e.boxSizingReliable=!0,e.pixelPosition=!1,i.checked=!0,e.noCloneChecked=i.cloneNode(!0).checked,s.disabled=!0,e.optDisabled=!o.disabled,i=G.createElement("input"),i.value="t",i.type="radio",e.radioValue="t"===i.value,i.setAttribute("checked","t"),i.setAttribute("name","t"),n.appendChild(i),e.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,e.focusinBubbles="onfocusin"in t,r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",e.clearCloneStyle="content-box"===r.style.backgroundClip,se(function(){var i,n,s="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",o=G.getElementsByTagName("body")[0];o&&(i=G.createElement("div"),i.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",o.appendChild(i).appendChild(r),r.innerHTML="",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",se.swap(o,null!=o.style.zoom?{zoom:1}:{},function(){e.boxSizing=4===r.offsetWidth}),t.getComputedStyle&&(e.pixelPosition="1%"!==(t.getComputedStyle(r,null)||{}).top,e.boxSizingReliable="4px"===(t.getComputedStyle(r,null)||{width:"4px"}).width,n=r.appendChild(G.createElement("div")),n.style.cssText=r.style.cssText=s,n.style.marginRight=n.style.width="0",r.style.width="1px",e.reliableMarginRight=!parseFloat((t.getComputedStyle(n,null)||{}).marginRight)),o.removeChild(i))}),e):e}({});var ge,me,ve=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,ye=/([A-Z])/g;r.uid=1,r.accepts=function(t){return t.nodeType?1===t.nodeType||9===t.nodeType:!0},r.prototype={key:function(t){if(!r.accepts(t))return 0;var e={},i=t[this.expando];if(!i){i=r.uid++;try{e[this.expando]={value:i},Object.defineProperties(t,e)}catch(n){e[this.expando]=i,se.extend(t,e)}}return this.cache[i]||(this.cache[i]={}),i},set:function(t,e,i){var n,r=this.key(t),s=this.cache[r];if("string"==typeof e)s[e]=i;else if(se.isEmptyObject(s))se.extend(this.cache[r],e);else for(n in e)s[n]=e[n];return s},get:function(t,i){var n=this.cache[this.key(t)];return i===e?n:n[i]},access:function(t,i,n){var r;return i===e||i&&"string"==typeof i&&n===e?(r=this.get(t,i),r!==e?r:this.get(t,se.camelCase(i))):(this.set(t,i,n),n!==e?n:i)},remove:function(t,i){var n,r,s,o=this.key(t),a=this.cache[o];if(i===e)this.cache[o]={};else{se.isArray(i)?r=i.concat(i.map(se.camelCase)):(s=se.camelCase(i),i in a?r=[i,s]:(r=s,r=r in a?[r]:r.match(ae)||[])),n=r.length;for(;n--;)delete a[r[n]]}},hasData:function(t){return!se.isEmptyObject(this.cache[t[this.expando]]||{})},discard:function(t){t[this.expando]&&delete this.cache[t[this.expando]]}},ge=new r,me=new r,se.extend({acceptData:r.accepts,hasData:function(t){return ge.hasData(t)||me.hasData(t)},data:function(t,e,i){return ge.access(t,e,i)},removeData:function(t,e){ge.remove(t,e)},_data:function(t,e,i){return me.access(t,e,i)},_removeData:function(t,e){me.remove(t,e)}}),se.fn.extend({data:function(t,i){var n,r,o=this[0],a=0,l=null;if(t===e){if(this.length&&(l=ge.get(o),1===o.nodeType&&!me.get(o,"hasDataAttrs"))){for(n=o.attributes;a<n.length;a++)r=n[a].name,0===r.indexOf("data-")&&(r=se.camelCase(r.slice(5)),s(o,r,l[r]));me.set(o,"hasDataAttrs",!0)}return l}return"object"==typeof t?this.each(function(){ge.set(this,t)}):se.access(this,function(i){var n,r=se.camelCase(t);if(o&&i===e){if(n=ge.get(o,t),n!==e)return n;if(n=ge.get(o,r),n!==e)return n;if(n=s(o,r,e),n!==e)return n}else this.each(function(){var n=ge.get(this,r);ge.set(this,r,i),-1!==t.indexOf("-")&&n!==e&&ge.set(this,t,i)})},null,i,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){ge.remove(this,t)})}}),se.extend({queue:function(t,e,i){var n;return t?(e=(e||"fx")+"queue",n=me.get(t,e),i&&(!n||se.isArray(i)?n=me.access(t,e,se.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(t,e){e=e||"fx";var i=se.queue(t,e),n=i.length,r=i.shift(),s=se._queueHooks(t,e),o=function(){se.dequeue(t,e)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete s.stop,r.call(t,o,s)),!n&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return me.get(t,i)||me.access(t,i,{empty:se.Callbacks("once memory").add(function(){me.remove(t,[e+"queue",i])})})}}),se.fn.extend({queue:function(t,i){var n=2;return"string"!=typeof t&&(i=t,t="fx",n--),arguments.length<n?se.queue(this[0],t):i===e?this:this.each(function(){var e=se.queue(this,t,i);se._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&se.dequeue(this,t)})},dequeue:function(t){return this.each(function(){se.dequeue(this,t)})},delay:function(t,e){return t=se.fx?se.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,i){var n=setTimeout(e,t);i.stop=function(){clearTimeout(n)}})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,i){var n,r=1,s=se.Deferred(),o=this,a=this.length,l=function(){--r||s.resolveWith(o,[o])};for("string"!=typeof t&&(i=t,t=e),t=t||"fx";a--;)n=me.get(o[a],t+"queueHooks"),n&&n.empty&&(r++,n.empty.add(l));return l(),s.promise(i)}});var we,be,_e=/[\t\r\n\f]/g,ke=/\r/g,Se=/^(?:input|select|textarea|button)$/i;se.fn.extend({attr:function(t,e){return se.access(this,se.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){se.removeAttr(this,t)})},prop:function(t,e){return se.access(this,se.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[se.propFix[t]||t]})},addClass:function(t){var e,i,n,r,s,o=0,a=this.length,l="string"==typeof t&&t;if(se.isFunction(t))return this.each(function(e){se(this).addClass(t.call(this,e,this.className))});if(l)for(e=(t||"").match(ae)||[];a>o;o++)if(i=this[o],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(_e," "):" ")){for(s=0;r=e[s++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");i.className=se.trim(n)}return this},removeClass:function(t){var e,i,n,r,s,o=0,a=this.length,l=0===arguments.length||"string"==typeof t&&t;if(se.isFunction(t))return this.each(function(e){se(this).removeClass(t.call(this,e,this.className))});if(l)for(e=(t||"").match(ae)||[];a>o;o++)if(i=this[o],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(_e," "):"")){for(s=0;r=e[s++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");i.className=t?se.trim(n):""}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):this.each(se.isFunction(t)?function(i){se(this).toggleClass(t.call(this,i,this.className,e),e)}:function(){if("string"===i)for(var e,n=0,r=se(this),s=t.match(ae)||[];e=s[n++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);else(i===V||"boolean"===i)&&(this.className&&me.set(this,"__className__",this.className),this.className=this.className||t===!1?"":me.get(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(_e," ").indexOf(e)>=0)return!0;return!1},val:function(t){var i,n,r,s=this[0];return arguments.length?(r=se.isFunction(t),this.each(function(n){var s;1===this.nodeType&&(s=r?t.call(this,n,se(this).val()):t,null==s?s="":"number"==typeof s?s+="":se.isArray(s)&&(s=se.map(s,function(t){return null==t?"":t+""})),i=se.valHooks[this.type]||se.valHooks[this.nodeName.toLowerCase()],i&&"set"in i&&i.set(this,s,"value")!==e||(this.value=s))})):s?(i=se.valHooks[s.type]||se.valHooks[s.nodeName.toLowerCase()],i&&"get"in i&&(n=i.get(s,"value"))!==e?n:(n=s.value,"string"==typeof n?n.replace(ke,""):null==n?"":n)):void 0}}),se.extend({valHooks:{option:{get:function(t){var e=t.attributes.value;return!e||e.specified?t.value:t.text}},select:{get:function(t){for(var e,i,n=t.options,r=t.selectedIndex,s="select-one"===t.type||0>r,o=s?null:[],a=s?r+1:n.length,l=0>r?a:s?r:0;a>l;l++)if(i=n[l],!(!i.selected&&l!==r||(se.support.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&se.nodeName(i.parentNode,"optgroup"))){if(e=se(i).val(),s)return e;o.push(e)}return o},set:function(t,e){for(var i,n,r=t.options,s=se.makeArray(e),o=r.length;o--;)n=r[o],(n.selected=se.inArray(se(n).val(),s)>=0)&&(i=!0);return i||(t.selectedIndex=-1),s}}},attr:function(t,i,n){var r,s,o=t.nodeType;return t&&3!==o&&8!==o&&2!==o?typeof t.getAttribute===V?se.prop(t,i,n):(1===o&&se.isXMLDoc(t)||(i=i.toLowerCase(),r=se.attrHooks[i]||(se.expr.match.bool.test(i)?be:we)),n===e?r&&"get"in r&&null!==(s=r.get(t,i))?s:(s=se.find.attr(t,i),null==s?e:s):null!==n?r&&"set"in r&&(s=r.set(t,n,i))!==e?s:(t.setAttribute(i,n+""),n):void se.removeAttr(t,i)):void 0},removeAttr:function(t,e){var i,n,r=0,s=e&&e.match(ae);if(s&&1===t.nodeType)for(;i=s[r++];)n=se.propFix[i]||i,se.expr.match.bool.test(i)&&(t[n]=!1),t.removeAttribute(i)},attrHooks:{type:{set:function(t,e){if(!se.support.radioValue&&"radio"===e&&se.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(t,i,n){var r,s,o,a=t.nodeType;return t&&3!==a&&8!==a&&2!==a?(o=1!==a||!se.isXMLDoc(t),o&&(i=se.propFix[i]||i,s=se.propHooks[i]),n!==e?s&&"set"in s&&(r=s.set(t,n,i))!==e?r:t[i]=n:s&&"get"in s&&null!==(r=s.get(t,i))?r:t[i]):void 0},propHooks:{tabIndex:{get:function(t){return t.hasAttribute("tabindex")||Se.test(t.nodeName)||t.href?t.tabIndex:-1}}}}),be={set:function(t,e,i){return e===!1?se.removeAttr(t,i):t.setAttribute(i,i),i}},se.each(se.expr.match.bool.source.match(/\w+/g),function(t,i){var n=se.expr.attrHandle[i]||se.find.attr;se.expr.attrHandle[i]=function(t,i,r){var s=se.expr.attrHandle[i],o=r?e:(se.expr.attrHandle[i]=e)!=n(t,i,r)?i.toLowerCase():null;return se.expr.attrHandle[i]=s,o}}),se.support.optSelected||(se.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null}}),se.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){se.propFix[this.toLowerCase()]=this}),se.each(["radio","checkbox"],function(){se.valHooks[this]={set:function(t,e){return se.isArray(e)?t.checked=se.inArray(se(t).val(),e)>=0:void 0}},se.support.checkOn||(se.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var xe=/^key/,Ce=/^(?:mouse|contextmenu)|click/,Te=/^(?:focusinfocus|focusoutblur)$/,$e=/^([^.]*)(?:\.(.+)|)$/;se.event={global:{},add:function(t,i,n,r,s){var o,a,l,h,u,c,d,p,f,g,m,v=me.get(t);if(v){for(n.handler&&(o=n,n=o.handler,s=o.selector),n.guid||(n.guid=se.guid++),(h=v.events)||(h=v.events={}),(a=v.handle)||(a=v.handle=function(t){return typeof se===V||t&&se.event.triggered===t.type?e:se.event.dispatch.apply(a.elem,arguments)},a.elem=t),i=(i||"").match(ae)||[""],u=i.length;u--;)l=$e.exec(i[u])||[],f=m=l[1],g=(l[2]||"").split(".").sort(),f&&(d=se.event.special[f]||{},f=(s?d.delegateType:d.bindType)||f,d=se.event.special[f]||{},c=se.extend({type:f,origType:m,data:r,handler:n,guid:n.guid,selector:s,needsContext:s&&se.expr.match.needsContext.test(s),namespace:g.join(".")},o),(p=h[f])||(p=h[f]=[],p.delegateCount=0,d.setup&&d.setup.call(t,r,g,a)!==!1||t.addEventListener&&t.addEventListener(f,a,!1)),d.add&&(d.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),se.event.global[f]=!0);t=null}},remove:function(t,e,i,n,r){var s,o,a,l,h,u,c,d,p,f,g,m=me.hasData(t)&&me.get(t);if(m&&(l=m.events)){for(e=(e||"").match(ae)||[""],h=e.length;h--;)if(a=$e.exec(e[h])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p){for(c=se.event.special[p]||{},p=(n?c.delegateType:c.bindType)||p,d=l[p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=d.length;s--;)u=d[s],!r&&g!==u.origType||i&&i.guid!==u.guid||a&&!a.test(u.namespace)||n&&n!==u.selector&&("**"!==n||!u.selector)||(d.splice(s,1),u.selector&&d.delegateCount--,c.remove&&c.remove.call(t,u));o&&!d.length&&(c.teardown&&c.teardown.call(t,f,m.handle)!==!1||se.removeEvent(t,p,m.handle),delete l[p])}else for(p in l)se.event.remove(t,p+e[h],i,n,!0);se.isEmptyObject(l)&&(delete m.handle,me.remove(t,"events"))}},trigger:function(i,n,r,s){var o,a,l,h,u,c,d,p=[r||G],f=ne.call(i,"type")?i.type:i,g=ne.call(i,"namespace")?i.namespace.split("."):[];if(a=l=r=r||G,3!==r.nodeType&&8!==r.nodeType&&!Te.test(f+se.event.triggered)&&(f.indexOf(".")>=0&&(g=f.split("."),f=g.shift(),g.sort()),u=f.indexOf(":")<0&&"on"+f,i=i[se.expando]?i:new se.Event(f,"object"==typeof i&&i),i.isTrigger=s?2:3,i.namespace=g.join("."),i.namespace_re=i.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,i.result=e,i.target||(i.target=r),n=null==n?[i]:se.makeArray(n,[i]),d=se.event.special[f]||{},s||!d.trigger||d.trigger.apply(r,n)!==!1)){if(!s&&!d.noBubble&&!se.isWindow(r)){for(h=d.delegateType||f,Te.test(h+f)||(a=a.parentNode);a;a=a.parentNode)p.push(a),l=a;l===(r.ownerDocument||G)&&p.push(l.defaultView||l.parentWindow||t)}for(o=0;(a=p[o++])&&!i.isPropagationStopped();)i.type=o>1?h:d.bindType||f,c=(me.get(a,"events")||{})[i.type]&&me.get(a,"handle"),c&&c.apply(a,n),c=u&&a[u],c&&se.acceptData(a)&&c.apply&&c.apply(a,n)===!1&&i.preventDefault();return i.type=f,s||i.isDefaultPrevented()||d._default&&d._default.apply(p.pop(),n)!==!1||!se.acceptData(r)||u&&se.isFunction(r[f])&&!se.isWindow(r)&&(l=r[u],l&&(r[u]=null),se.event.triggered=f,r[f](),se.event.triggered=e,l&&(r[u]=l)),i.result}},dispatch:function(t){t=se.event.fix(t);var i,n,r,s,o,a=[],l=te.call(arguments),h=(me.get(this,"events")||{})[t.type]||[],u=se.event.special[t.type]||{};if(l[0]=t,t.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,t)!==!1){for(a=se.event.handlers.call(this,t,h),i=0;(s=a[i++])&&!t.isPropagationStopped();)for(t.currentTarget=s.elem,n=0;(o=s.handlers[n++])&&!t.isImmediatePropagationStopped();)(!t.namespace_re||t.namespace_re.test(o.namespace))&&(t.handleObj=o,t.data=o.data,r=((se.event.special[o.origType]||{}).handle||o.handler).apply(s.elem,l),r!==e&&(t.result=r)===!1&&(t.preventDefault(),t.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,t),t.result}},handlers:function(t,i){var n,r,s,o,a=[],l=i.delegateCount,h=t.target;if(l&&h.nodeType&&(!t.button||"click"!==t.type))for(;h!==this;h=h.parentNode||this)if(h.disabled!==!0||"click"!==t.type){for(r=[],n=0;l>n;n++)o=i[n],s=o.selector+" ",r[s]===e&&(r[s]=o.needsContext?se(s,this).index(h)>=0:se.find(s,this,null,[h]).length),r[s]&&r.push(o);r.length&&a.push({elem:h,handlers:r})}return l<i.length&&a.push({elem:this,handlers:i.slice(l)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,i){var n,r,s,o=i.button;return null==t.pageX&&null!=i.clientX&&(n=t.target.ownerDocument||G,r=n.documentElement,s=n.body,t.pageX=i.clientX+(r&&r.scrollLeft||s&&s.scrollLeft||0)-(r&&r.clientLeft||s&&s.clientLeft||0),t.pageY=i.clientY+(r&&r.scrollTop||s&&s.scrollTop||0)-(r&&r.clientTop||s&&s.clientTop||0)),t.which||o===e||(t.which=1&o?1:2&o?3:4&o?2:0),t}},fix:function(t){if(t[se.expando])return t;var e,i,n,r=t.type,s=t,o=this.fixHooks[r];for(o||(this.fixHooks[r]=o=Ce.test(r)?this.mouseHooks:xe.test(r)?this.keyHooks:{}),n=o.props?this.props.concat(o.props):this.props,t=new se.Event(s),e=n.length;e--;)i=n[e],t[i]=s[i];return t.target||(t.target=G),3===t.target.nodeType&&(t.target=t.target.parentNode),o.filter?o.filter(t,s):t},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==l()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===l()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&se.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(t){return se.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){t.result!==e&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,i,n){var r=se.extend(new se.Event,i,{type:t,isSimulated:!0,originalEvent:{}});n?se.event.trigger(r,null,e):se.event.dispatch.call(e,r),r.isDefaultPrevented()&&i.preventDefault()}},se.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)},se.Event=function(t,e){return this instanceof se.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.getPreventDefault&&t.getPreventDefault()?o:a):this.type=t,e&&se.extend(this,e),this.timeStamp=t&&t.timeStamp||se.now(),void(this[se.expando]=!0)):new se.Event(t,e)},se.Event.prototype={isDefaultPrevented:a,isPropagationStopped:a,isImmediatePropagationStopped:a,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=o,t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=o,t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=o,this.stopPropagation()}},se.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){se.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,r=t.relatedTarget,s=t.handleObj;return(!r||r!==n&&!se.contains(n,r))&&(t.type=s.origType,i=s.handler.apply(this,arguments),t.type=e),i}}}),se.support.focusinBubbles||se.each({focus:"focusin",blur:"focusout"},function(t,e){var i=0,n=function(t){se.event.simulate(e,t.target,se.event.fix(t),!0)};se.event.special[e]={setup:function(){0===i++&&G.addEventListener(t,n,!0)},teardown:function(){0===--i&&G.removeEventListener(t,n,!0)}}}),se.fn.extend({on:function(t,i,n,r,s){var o,l;if("object"==typeof t){"string"!=typeof i&&(n=n||i,i=e);for(l in t)this.on(l,i,n,t[l],s);return this}if(null==n&&null==r?(r=i,n=i=e):null==r&&("string"==typeof i?(r=n,n=e):(r=n,n=i,i=e)),r===!1)r=a;else if(!r)return this;return 1===s&&(o=r,r=function(t){return se().off(t),o.apply(this,arguments)},r.guid=o.guid||(o.guid=se.guid++)),this.each(function(){se.event.add(this,t,r,n,i)})},one:function(t,e,i,n){return this.on(t,e,i,n,1)},off:function(t,i,n){var r,s;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,se(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(s in t)this.off(s,i,t[s]);return this}return(i===!1||"function"==typeof i)&&(n=i,i=e),n===!1&&(n=a),this.each(function(){se.event.remove(this,t,n,i)})},trigger:function(t,e){return this.each(function(){se.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];return i?se.event.trigger(t,e,i,!0):void 0}});var Ie=/^.[^:#\[\.,]*$/,Le=/^(?:parents|prev(?:Until|All))/,De=se.expr.match.needsContext,Ee={children:!0,contents:!0,next:!0,prev:!0};se.fn.extend({find:function(t){var e,i=[],n=this,r=n.length;if("string"!=typeof t)return this.pushStack(se(t).filter(function(){for(e=0;r>e;e++)if(se.contains(n[e],this))return!0}));for(e=0;r>e;e++)se.find(t,n[e],i);return i=this.pushStack(r>1?se.unique(i):i),i.selector=this.selector?this.selector+" "+t:t,i},has:function(t){var e=se(t,this),i=e.length;return this.filter(function(){for(var t=0;i>t;t++)if(se.contains(this,e[t]))return!0})},not:function(t){return this.pushStack(u(this,t||[],!0))},filter:function(t){return this.pushStack(u(this,t||[],!1))},is:function(t){return!!u(this,"string"==typeof t&&De.test(t)?se(t):t||[],!1).length},closest:function(t,e){for(var i,n=0,r=this.length,s=[],o=De.test(t)||"string"!=typeof t?se(t,e||this.context):0;r>n;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&se.find.matchesSelector(i,t))){i=s.push(i);break}return this.pushStack(s.length>1?se.unique(s):s)},index:function(t){return t?"string"==typeof t?ee.call(se(t),this[0]):ee.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){var i="string"==typeof t?se(t,e):se.makeArray(t&&t.nodeType?[t]:t),n=se.merge(this.get(),i);return this.pushStack(se.unique(n))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),se.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return se.dir(t,"parentNode")},parentsUntil:function(t,e,i){return se.dir(t,"parentNode",i)},next:function(t){return h(t,"nextSibling")},prev:function(t){return h(t,"previousSibling")},nextAll:function(t){return se.dir(t,"nextSibling")},prevAll:function(t){return se.dir(t,"previousSibling")},nextUntil:function(t,e,i){return se.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return se.dir(t,"previousSibling",i)},siblings:function(t){return se.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return se.sibling(t.firstChild)},contents:function(t){return t.contentDocument||se.merge([],t.childNodes)}},function(t,e){se.fn[t]=function(i,n){var r=se.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=se.filter(n,r)),this.length>1&&(Ee[t]||se.unique(r),Le.test(t)&&r.reverse()),this.pushStack(r)}}),se.extend({filter:function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?se.find.matchesSelector(n,t)?[n]:[]:se.find.matches(t,se.grep(e,function(t){return 1===t.nodeType}))},dir:function(t,i,n){for(var r=[],s=n!==e;(t=t[i])&&9!==t.nodeType;)if(1===t.nodeType){if(s&&se(t).is(n))break;r.push(t)}return r},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}});var Pe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ae=/<([\w:]+)/,Me=/<|&#?\w+;/,ze=/<(?:script|style|link)/i,Oe=/^(?:checkbox|radio)$/i,Re=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^$|\/(?:java|ecma)script/i,Be=/^true\/(.*)/,Fe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,je={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};je.optgroup=je.option,je.tbody=je.tfoot=je.colgroup=je.caption=je.thead,je.th=je.td,se.fn.extend({text:function(t){return se.access(this,function(t){return t===e?se.text(this):this.empty().append((this[0]&&this[0].ownerDocument||G).createTextNode(t))},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=c(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=c(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var i,n=t?se.filter(t,this):this,r=0;null!=(i=n[r]);r++)e||1!==i.nodeType||se.cleanData(m(i)),i.parentNode&&(e&&se.contains(i.ownerDocument,i)&&f(m(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(se.cleanData(m(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return se.clone(this,t,e)})},html:function(t){return se.access(this,function(t){var i=this[0]||{},n=0,r=this.length;if(t===e&&1===i.nodeType)return i.innerHTML;if("string"==typeof t&&!ze.test(t)&&!je[(Ae.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(Pe,"<$1></$2>");try{for(;r>n;n++)i=this[n]||{},1===i.nodeType&&(se.cleanData(m(i,!1)),i.innerHTML=t);i=0}catch(s){}}i&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=se.map(this,function(t){return[t.nextSibling,t.parentNode]}),e=0;return this.domManip(arguments,function(i){var n=t[e++],r=t[e++];r&&(n&&n.parentNode!==r&&(n=this.nextSibling),se(this).remove(),r.insertBefore(i,n))},!0),e?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e,i){t=Y.apply([],t);var n,r,s,o,a,l,h=0,u=this.length,c=this,f=u-1,g=t[0],v=se.isFunction(g);if(v||!(1>=u||"string"!=typeof g||se.support.checkClone)&&Re.test(g))return this.each(function(n){var r=c.eq(n);v&&(t[0]=g.call(this,n,r.html())),r.domManip(t,e,i)});if(u&&(n=se.buildFragment(t,this[0].ownerDocument,!1,!i&&this),r=n.firstChild,1===n.childNodes.length&&(n=r),r)){for(s=se.map(m(n,"script"),d),o=s.length;u>h;h++)a=n,h!==f&&(a=se.clone(a,!0,!0),o&&se.merge(s,m(a,"script"))),e.call(this[h],a,h);if(o)for(l=s[s.length-1].ownerDocument,se.map(s,p),h=0;o>h;h++)a=s[h],Ne.test(a.type||"")&&!me.access(a,"globalEval")&&se.contains(l,a)&&(a.src?se._evalUrl(a.src):se.globalEval(a.textContent.replace(Fe,"")))}return this}}),se.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){se.fn[t]=function(t){for(var i,n=[],r=se(t),s=r.length-1,o=0;s>=o;o++)i=o===s?this:this.clone(!0),se(r[o])[e](i),Z.apply(n,i.get());return this.pushStack(n)}}),se.extend({clone:function(t,e,i){var n,r,s,o,a=t.cloneNode(!0),l=se.contains(t.ownerDocument,t);if(!(se.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||se.isXMLDoc(t)))for(o=m(a),s=m(t),n=0,r=s.length;r>n;n++)v(s[n],o[n]);if(e)if(i)for(s=s||m(t),o=o||m(a),n=0,r=s.length;r>n;n++)g(s[n],o[n]);else g(t,a);return o=m(a,"script"),o.length>0&&f(o,!l&&m(t,"script")),a},buildFragment:function(t,e,i,n){for(var r,s,o,a,l,h,u=0,c=t.length,d=e.createDocumentFragment(),p=[];c>u;u++)if(r=t[u],r||0===r)if("object"===se.type(r))se.merge(p,r.nodeType?[r]:r);else if(Me.test(r)){for(s=s||d.appendChild(e.createElement("div")),o=(Ae.exec(r)||["",""])[1].toLowerCase(),a=je[o]||je._default,s.innerHTML=a[1]+r.replace(Pe,"<$1></$2>")+a[2],h=a[0];h--;)s=s.lastChild;se.merge(p,s.childNodes),s=d.firstChild,s.textContent=""}else p.push(e.createTextNode(r));for(d.textContent="",u=0;r=p[u++];)if((!n||-1===se.inArray(r,n))&&(l=se.contains(r.ownerDocument,r),s=m(d.appendChild(r),"script"),l&&f(s),i))for(h=0;r=s[h++];)Ne.test(r.type||"")&&i.push(r);return d},cleanData:function(t){for(var i,n,s,o,a,l,h=se.event.special,u=0;(n=t[u])!==e;u++){if(r.accepts(n)&&(a=n[me.expando],a&&(i=me.cache[a]))){if(s=Object.keys(i.events||{}),s.length)for(l=0;(o=s[l])!==e;l++)h[o]?se.event.remove(n,o):se.removeEvent(n,o,i.handle);me.cache[a]&&delete me.cache[a]}delete ge.cache[n[ge.expando]]}},_evalUrl:function(t){return se.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),se.fn.extend({wrapAll:function(t){var e;return se.isFunction(t)?this.each(function(e){se(this).wrapAll(t.call(this,e))}):(this[0]&&(e=se(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this)},wrapInner:function(t){return this.each(se.isFunction(t)?function(e){se(this).wrapInner(t.call(this,e))}:function(){var e=se(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=se.isFunction(t);return this.each(function(i){se(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){se.nodeName(this,"body")||se(this).replaceWith(this.childNodes)}).end()}});var He,Ve,We=/^(none|table(?!-c[ea]).+)/,Ge=/^margin/,qe=new RegExp("^("+oe+")(.*)$","i"),Ue=new RegExp("^("+oe+")(?!px)[a-z%]+$","i"),Xe=new RegExp("^([+-])=("+oe+")","i"),Ke={BODY:"block"},Je={position:"absolute",visibility:"hidden",display:"block"},Qe={letterSpacing:0,fontWeight:400},Ye=["Top","Right","Bottom","Left"],Ze=["Webkit","O","Moz","ms"];se.fn.extend({css:function(t,i){return se.access(this,function(t,i,n){var r,s,o={},a=0;if(se.isArray(i)){for(r=b(t),s=i.length;s>a;a++)o[i[a]]=se.css(t,i[a],!1,r);return o}return n!==e?se.style(t,i,n):se.css(t,i)},t,i,arguments.length>1)},show:function(){return _(this,!0)},hide:function(){return _(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){w(this)?se(this).show():se(this).hide()})}}),se.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=He(t,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(t,i,n,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var s,o,a,l=se.camelCase(i),h=t.style;return i=se.cssProps[l]||(se.cssProps[l]=y(h,l)),a=se.cssHooks[i]||se.cssHooks[l],n===e?a&&"get"in a&&(s=a.get(t,!1,r))!==e?s:h[i]:(o=typeof n,"string"===o&&(s=Xe.exec(n))&&(n=(s[1]+1)*s[2]+parseFloat(se.css(t,i)),o="number"),void(null==n||"number"===o&&isNaN(n)||("number"!==o||se.cssNumber[l]||(n+="px"),se.support.clearCloneStyle||""!==n||0!==i.indexOf("background")||(h[i]="inherit"),a&&"set"in a&&(n=a.set(t,n,r))===e||(h[i]=n))))
}},css:function(t,i,n,r){var s,o,a,l=se.camelCase(i);return i=se.cssProps[l]||(se.cssProps[l]=y(t.style,l)),a=se.cssHooks[i]||se.cssHooks[l],a&&"get"in a&&(s=a.get(t,!0,n)),s===e&&(s=He(t,i,r)),"normal"===s&&i in Qe&&(s=Qe[i]),""===n||n?(o=parseFloat(s),n===!0||se.isNumeric(o)?o||0:s):s}}),He=function(t,i,n){var r,s,o,a=n||b(t),l=a?a.getPropertyValue(i)||a[i]:e,h=t.style;return a&&(""!==l||se.contains(t.ownerDocument,t)||(l=se.style(t,i)),Ue.test(l)&&Ge.test(i)&&(r=h.width,s=h.minWidth,o=h.maxWidth,h.minWidth=h.maxWidth=h.width=l,l=a.width,h.width=r,h.minWidth=s,h.maxWidth=o)),l},se.each(["height","width"],function(t,e){se.cssHooks[e]={get:function(t,i,n){return i?0===t.offsetWidth&&We.test(se.css(t,"display"))?se.swap(t,Je,function(){return x(t,e,n)}):x(t,e,n):void 0},set:function(t,i,n){var r=n&&b(t);return k(t,i,n?S(t,e,n,se.support.boxSizing&&"border-box"===se.css(t,"boxSizing",!1,r),r):0)}}}),se(function(){se.support.reliableMarginRight||(se.cssHooks.marginRight={get:function(t,e){return e?se.swap(t,{display:"inline-block"},He,[t,"marginRight"]):void 0}}),!se.support.pixelPosition&&se.fn.position&&se.each(["top","left"],function(t,e){se.cssHooks[e]={get:function(t,i){return i?(i=He(t,e),Ue.test(i)?se(t).position()[e]+"px":i):void 0}}})}),se.expr&&se.expr.filters&&(se.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0},se.expr.filters.visible=function(t){return!se.expr.filters.hidden(t)}),se.each({margin:"",padding:"",border:"Width"},function(t,e){se.cssHooks[t+e]={expand:function(i){for(var n=0,r={},s="string"==typeof i?i.split(" "):[i];4>n;n++)r[t+Ye[n]+e]=s[n]||s[n-2]||s[0];return r}},Ge.test(t)||(se.cssHooks[t+e].set=k)});var ti=/%20/g,ei=/\[\]$/,ii=/\r?\n/g,ni=/^(?:submit|button|image|reset|file)$/i,ri=/^(?:input|select|textarea|keygen)/i;se.fn.extend({serialize:function(){return se.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=se.prop(this,"elements");return t?se.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!se(this).is(":disabled")&&ri.test(this.nodeName)&&!ni.test(t)&&(this.checked||!Oe.test(t))}).map(function(t,e){var i=se(this).val();return null==i?null:se.isArray(i)?se.map(i,function(t){return{name:e.name,value:t.replace(ii,"\r\n")}}):{name:e.name,value:i.replace(ii,"\r\n")}}).get()}}),se.param=function(t,i){var n,r=[],s=function(t,e){e=se.isFunction(e)?e():null==e?"":e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(i===e&&(i=se.ajaxSettings&&se.ajaxSettings.traditional),se.isArray(t)||t.jquery&&!se.isPlainObject(t))se.each(t,function(){s(this.name,this.value)});else for(n in t)$(n,t[n],i,s);return r.join("&").replace(ti,"+")},se.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){se.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),se.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}});var si,oi,ai=se.now(),li=/\?/,hi=/#.*$/,ui=/([?&])_=[^&]*/,ci=/^(.*?):[ \t]*([^\r\n]*)$/gm,di=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,pi=/^(?:GET|HEAD)$/,fi=/^\/\//,gi=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,mi=se.fn.load,vi={},yi={},wi="*/".concat("*");try{oi=W.href}catch(bi){oi=G.createElement("a"),oi.href="",oi=oi.href}si=gi.exec(oi.toLowerCase())||[],se.fn.load=function(t,i,n){if("string"!=typeof t&&mi)return mi.apply(this,arguments);var r,s,o,a=this,l=t.indexOf(" ");return l>=0&&(r=t.slice(l),t=t.slice(0,l)),se.isFunction(i)?(n=i,i=e):i&&"object"==typeof i&&(s="POST"),a.length>0&&se.ajax({url:t,type:s,dataType:"html",data:i}).done(function(t){o=arguments,a.html(r?se("<div>").append(se.parseHTML(t)).find(r):t)}).complete(n&&function(t,e){a.each(n,o||[t.responseText,e,t])}),this},se.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){se.fn[e]=function(t){return this.on(e,t)}}),se.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:oi,type:"GET",isLocal:di.test(si[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":wi,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":se.parseJSON,"text xml":se.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?D(D(t,se.ajaxSettings),e):D(se.ajaxSettings,t)},ajaxPrefilter:I(vi),ajaxTransport:I(yi),ajax:function(t,i){function n(t,i,n,a){var h,c,y,w,_,S=i;2!==b&&(b=2,l&&clearTimeout(l),r=e,o=a||"",k.readyState=t>0?4:0,h=t>=200&&300>t||304===t,n&&(w=E(d,k,n)),w=P(d,w,k,h),h?(d.ifModified&&(_=k.getResponseHeader("Last-Modified"),_&&(se.lastModified[s]=_),_=k.getResponseHeader("etag"),_&&(se.etag[s]=_)),204===t||"HEAD"===d.type?S="nocontent":304===t?S="notmodified":(S=w.state,c=w.data,y=w.error,h=!y)):(y=S,(t||!S)&&(S="error",0>t&&(t=0))),k.status=t,k.statusText=(i||S)+"",h?g.resolveWith(p,[c,S,k]):g.rejectWith(p,[k,S,y]),k.statusCode(v),v=e,u&&f.trigger(h?"ajaxSuccess":"ajaxError",[k,d,h?c:y]),m.fireWith(p,[k,S]),u&&(f.trigger("ajaxComplete",[k,d]),--se.active||se.event.trigger("ajaxStop")))}"object"==typeof t&&(i=t,t=e),i=i||{};var r,s,o,a,l,h,u,c,d=se.ajaxSetup({},i),p=d.context||d,f=d.context&&(p.nodeType||p.jquery)?se(p):se.event,g=se.Deferred(),m=se.Callbacks("once memory"),v=d.statusCode||{},y={},w={},b=0,_="canceled",k={readyState:0,getResponseHeader:function(t){var e;if(2===b){if(!a)for(a={};e=ci.exec(o);)a[e[1].toLowerCase()]=e[2];e=a[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===b?o:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return b||(t=w[i]=w[i]||t,y[t]=e),this},overrideMimeType:function(t){return b||(d.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>b)for(e in t)v[e]=[v[e],t[e]];else k.always(t[k.status]);return this},abort:function(t){var e=t||_;return r&&r.abort(e),n(0,e),this}};if(g.promise(k).complete=m.add,k.success=k.done,k.error=k.fail,d.url=((t||d.url||oi)+"").replace(hi,"").replace(fi,si[1]+"//"),d.type=i.method||i.type||d.method||d.type,d.dataTypes=se.trim(d.dataType||"*").toLowerCase().match(ae)||[""],null==d.crossDomain&&(h=gi.exec(d.url.toLowerCase()),d.crossDomain=!(!h||h[1]===si[1]&&h[2]===si[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(si[3]||("http:"===si[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=se.param(d.data,d.traditional)),L(vi,d,i,k),2===b)return k;u=d.global,u&&0===se.active++&&se.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!pi.test(d.type),s=d.url,d.hasContent||(d.data&&(s=d.url+=(li.test(s)?"&":"?")+d.data,delete d.data),d.cache===!1&&(d.url=ui.test(s)?s.replace(ui,"$1_="+ai++):s+(li.test(s)?"&":"?")+"_="+ai++)),d.ifModified&&(se.lastModified[s]&&k.setRequestHeader("If-Modified-Since",se.lastModified[s]),se.etag[s]&&k.setRequestHeader("If-None-Match",se.etag[s])),(d.data&&d.hasContent&&d.contentType!==!1||i.contentType)&&k.setRequestHeader("Content-Type",d.contentType),k.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+wi+"; q=0.01":""):d.accepts["*"]);for(c in d.headers)k.setRequestHeader(c,d.headers[c]);if(d.beforeSend&&(d.beforeSend.call(p,k,d)===!1||2===b))return k.abort();_="abort";for(c in{success:1,error:1,complete:1})k[c](d[c]);if(r=L(yi,d,i,k)){k.readyState=1,u&&f.trigger("ajaxSend",[k,d]),d.async&&d.timeout>0&&(l=setTimeout(function(){k.abort("timeout")},d.timeout));try{b=1,r.send(y,n)}catch(S){if(!(2>b))throw S;n(-1,S)}}else n(-1,"No Transport");return k},getJSON:function(t,e,i){return se.get(t,e,i,"json")},getScript:function(t,i){return se.get(t,e,i,"script")}}),se.each(["get","post"],function(t,i){se[i]=function(t,n,r,s){return se.isFunction(n)&&(s=s||r,r=n,n=e),se.ajax({url:t,type:i,dataType:s,data:n,success:r})}}),se.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return se.globalEval(t),t}}}),se.ajaxPrefilter("script",function(t){t.cache===e&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),se.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(n,r){e=se("<script>").prop({async:!0,charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&r("error"===t.type?404:200,t.type)}),G.head.appendChild(e[0])},abort:function(){i&&i()}}}});var _i=[],ki=/(=)\?(?=&|$)|\?\?/;se.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=_i.pop()||se.expando+"_"+ai++;return this[t]=!0,t}}),se.ajaxPrefilter("json jsonp",function(i,n,r){var s,o,a,l=i.jsonp!==!1&&(ki.test(i.url)?"url":"string"==typeof i.data&&!(i.contentType||"").indexOf("application/x-www-form-urlencoded")&&ki.test(i.data)&&"data");return l||"jsonp"===i.dataTypes[0]?(s=i.jsonpCallback=se.isFunction(i.jsonpCallback)?i.jsonpCallback():i.jsonpCallback,l?i[l]=i[l].replace(ki,"$1"+s):i.jsonp!==!1&&(i.url+=(li.test(i.url)?"&":"?")+i.jsonp+"="+s),i.converters["script json"]=function(){return a||se.error(s+" was not called"),a[0]},i.dataTypes[0]="json",o=t[s],t[s]=function(){a=arguments},r.always(function(){t[s]=o,i[s]&&(i.jsonpCallback=n.jsonpCallback,_i.push(s)),a&&se.isFunction(o)&&o(a[0]),a=o=e}),"script"):void 0}),se.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(t){}};var Si=se.ajaxSettings.xhr(),xi={0:200,1223:204},Ci=0,Ti={};t.ActiveXObject&&se(t).on("unload",function(){for(var t in Ti)Ti[t]();Ti=e}),se.support.cors=!!Si&&"withCredentials"in Si,se.support.ajax=Si=!!Si,se.ajaxTransport(function(t){var i;return se.support.cors||Si&&!t.crossDomain?{send:function(n,r){var s,o,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)a[s]=t.xhrFields[s];t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(s in n)a.setRequestHeader(s,n[s]);i=function(t){return function(){i&&(delete Ti[o],i=a.onload=a.onerror=null,"abort"===t?a.abort():"error"===t?r(a.status||404,a.statusText):r(xi[a.status]||a.status,a.statusText,"string"==typeof a.responseText?{text:a.responseText}:e,a.getAllResponseHeaders()))}},a.onload=i(),a.onerror=i("error"),i=Ti[o=Ci++]=i("abort"),a.send(t.hasContent&&t.data||null)},abort:function(){i&&i()}}:void 0});var $i,Ii,Li=/^(?:toggle|show|hide)$/,Di=new RegExp("^(?:([+-])=|)("+oe+")([a-z%]*)$","i"),Ei=/queueHooks$/,Pi=[R],Ai={"*":[function(t,e){var i=this.createTween(t,e),n=i.cur(),r=Di.exec(e),s=r&&r[3]||(se.cssNumber[t]?"":"px"),o=(se.cssNumber[t]||"px"!==s&&+n)&&Di.exec(se.css(i.elem,t)),a=1,l=20;if(o&&o[3]!==s){s=s||o[3],r=r||[],o=+n||1;do a=a||".5",o/=a,se.style(i.elem,t,o+s);while(a!==(a=i.cur()/n)&&1!==a&&--l)}return r&&(o=i.start=+o||+n||0,i.unit=s,i.end=r[1]?o+(r[1]+1)*r[2]:+r[2]),i}]};se.Animation=se.extend(z,{tweener:function(t,e){se.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var i,n=0,r=t.length;r>n;n++)i=t[n],Ai[i]=Ai[i]||[],Ai[i].unshift(e)},prefilter:function(t,e){e?Pi.unshift(t):Pi.push(t)}}),se.Tween=N,N.prototype={constructor:N,init:function(t,e,i,n,r,s){this.elem=t,this.prop=i,this.easing=r||"swing",this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=s||(se.cssNumber[i]?"":"px")},cur:function(){var t=N.propHooks[this.prop];return t&&t.get?t.get(this):N.propHooks._default.get(this)},run:function(t){var e,i=N.propHooks[this.prop];return this.pos=e=this.options.duration?se.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):N.propHooks._default.set(this),this}},N.prototype.init.prototype=N.prototype,N.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=se.css(t.elem,t.prop,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){se.fx.step[t.prop]?se.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[se.cssProps[t.prop]]||se.cssHooks[t.prop])?se.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},N.propHooks.scrollTop=N.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},se.each(["toggle","show","hide"],function(t,e){var i=se.fn[e];se.fn[e]=function(t,n,r){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(B(e,!0),t,n,r)}}),se.fn.extend({fadeTo:function(t,e,i,n){return this.filter(w).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var r=se.isEmptyObject(t),s=se.speed(e,i,n),o=function(){var e=z(this,se.extend({},t),s);(r||me.get(this,"finish"))&&e.stop(!0)};return o.finish=o,r||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(t,i,n){var r=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=i,i=t,t=e),i&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,i=null!=t&&t+"queueHooks",s=se.timers,o=me.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&Ei.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem!==this||null!=t&&s[i].queue!==t||(s[i].anim.stop(n),e=!1,s.splice(i,1));(e||!n)&&se.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=me.get(this),n=i[t+"queue"],r=i[t+"queueHooks"],s=se.timers,o=n?n.length:0;for(i.finish=!0,se.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=s.length;e--;)s[e].elem===this&&s[e].queue===t&&(s[e].anim.stop(!0),s.splice(e,1));for(e=0;o>e;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),se.each({slideDown:B("show"),slideUp:B("hide"),slideToggle:B("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){se.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),se.speed=function(t,e,i){var n=t&&"object"==typeof t?se.extend({},t):{complete:i||!i&&e||se.isFunction(t)&&t,duration:t,easing:i&&e||e&&!se.isFunction(e)&&e};return n.duration=se.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in se.fx.speeds?se.fx.speeds[n.duration]:se.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){se.isFunction(n.old)&&n.old.call(this),n.queue&&se.dequeue(this,n.queue)},n},se.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},se.timers=[],se.fx=N.prototype.init,se.fx.tick=function(){var t,i=se.timers,n=0;for($i=se.now();n<i.length;n++)t=i[n],t()||i[n]!==t||i.splice(n--,1);i.length||se.fx.stop(),$i=e},se.fx.timer=function(t){t()&&se.timers.push(t)&&se.fx.start()},se.fx.interval=13,se.fx.start=function(){Ii||(Ii=setInterval(se.fx.tick,se.fx.interval))},se.fx.stop=function(){clearInterval(Ii),Ii=null},se.fx.speeds={slow:600,fast:200,_default:400},se.fx.step={},se.expr&&se.expr.filters&&(se.expr.filters.animated=function(t){return se.grep(se.timers,function(e){return t===e.elem}).length}),se.fn.offset=function(t){if(arguments.length)return t===e?this:this.each(function(e){se.offset.setOffset(this,t,e)});var i,n,r=this[0],s={top:0,left:0},o=r&&r.ownerDocument;return o?(i=o.documentElement,se.contains(i,r)?(typeof r.getBoundingClientRect!==V&&(s=r.getBoundingClientRect()),n=F(o),{top:s.top+n.pageYOffset-i.clientTop,left:s.left+n.pageXOffset-i.clientLeft}):s):void 0},se.offset={setOffset:function(t,e,i){var n,r,s,o,a,l,h,u=se.css(t,"position"),c=se(t),d={};"static"===u&&(t.style.position="relative"),a=c.offset(),s=se.css(t,"top"),l=se.css(t,"left"),h=("absolute"===u||"fixed"===u)&&(s+l).indexOf("auto")>-1,h?(n=c.position(),o=n.top,r=n.left):(o=parseFloat(s)||0,r=parseFloat(l)||0),se.isFunction(e)&&(e=e.call(t,i,a)),null!=e.top&&(d.top=e.top-a.top+o),null!=e.left&&(d.left=e.left-a.left+r),"using"in e?e.using.call(t,d):c.css(d)}},se.fn.extend({position:function(){if(this[0]){var t,e,i=this[0],n={top:0,left:0};return"fixed"===se.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),se.nodeName(t[0],"html")||(n=t.offset()),n.top+=se.css(t[0],"borderTopWidth",!0),n.left+=se.css(t[0],"borderLeftWidth",!0)),{top:e.top-n.top-se.css(i,"marginTop",!0),left:e.left-n.left-se.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||q;t&&!se.nodeName(t,"html")&&"static"===se.css(t,"position");)t=t.offsetParent;return t||q})}}),se.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(i,n){var r="pageYOffset"===n;se.fn[i]=function(s){return se.access(this,function(i,s,o){var a=F(i);return o===e?a?a[n]:i[s]:void(a?a.scrollTo(r?t.pageXOffset:o,r?o:t.pageYOffset):i[s]=o)},i,s,arguments.length,null)}}),se.each({Height:"height",Width:"width"},function(t,i){se.each({padding:"inner"+t,content:i,"":"outer"+t},function(n,r){se.fn[r]=function(r,s){var o=arguments.length&&(n||"boolean"!=typeof r),a=n||(r===!0||s===!0?"margin":"border");return se.access(this,function(i,n,r){var s;return se.isWindow(i)?i.document.documentElement["client"+t]:9===i.nodeType?(s=i.documentElement,Math.max(i.body["scroll"+t],s["scroll"+t],i.body["offset"+t],s["offset"+t],s["client"+t])):r===e?se.css(i,n,a):se.style(i,n,r,a)},i,o?r:e,o,null)}})}),se.fn.size=function(){return this.length},se.fn.andSelf=se.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=se:"function"==typeof define&&define.amd&&define("jquery",[],function(){return se}),"object"==typeof t&&"object"==typeof t.document&&(t.jQuery=t.$=se)}(window),function(t,e){t.rails!==e&&t.error("jquery-ujs has already been loaded!");var i,n=t(document);t.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",buttonClickSelector:"button[data-remote]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(e){var i=t('meta[name="csrf-token"]').attr("content");i&&e.setRequestHeader("X-CSRF-Token",i)},refreshCSRFTokens:function(){var e=t("meta[name=csrf-token]").attr("content"),i=t("meta[name=csrf-param]").attr("content");t('form input[name="'+i+'"]').val(e)},fire:function(e,i,n){var r=t.Event(i);return e.trigger(r,n),r.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t.attr("href")},handleRemote:function(n){var r,s,o,a,l,h,u,c;if(i.fire(n,"ajax:before")){if(a=n.data("cross-domain"),l=a===e?null:a,h=n.data("with-credentials")||null,u=n.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,n.is("form")){r=n.attr("method"),s=n.attr("action"),o=n.serializeArray();var d=n.data("ujs:submit-button");d&&(o.push(d),n.data("ujs:submit-button",null))}else n.is(i.inputChangeSelector)?(r=n.data("method"),s=n.data("url"),o=n.serialize(),n.data("params")&&(o=o+"&"+n.data("params"))):n.is(i.buttonClickSelector)?(r=n.data("method")||"get",s=n.data("url"),o=n.serialize(),n.data("params")&&(o=o+"&"+n.data("params"))):(r=n.data("method"),s=i.href(n),o=n.data("params")||null);c={type:r||"GET",data:o,dataType:u,beforeSend:function(t,r){return r.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),i.fire(n,"ajax:beforeSend",[t,r])},success:function(t,e,i){n.trigger("ajax:success",[t,e,i])},complete:function(t,e){n.trigger("ajax:complete",[t,e])},error:function(t,e,i){n.trigger("ajax:error",[t,e,i])},crossDomain:l},h&&(c.xhrFields={withCredentials:h}),s&&(c.url=s);var p=i.ajax(c);return n.trigger("ajax:send",p),p}return!1},handleMethod:function(n){var r=i.href(n),s=n.data("method"),o=n.attr("target"),a=t("meta[name=csrf-token]").attr("content"),l=t("meta[name=csrf-param]").attr("content"),h=t('<form method="post" action="'+r+'"></form>'),u='<input name="_method" value="'+s+'" type="hidden" />';l!==e&&a!==e&&(u+='<input name="'+l+'" value="'+a+'" type="hidden" />'),o&&h.attr("target",o),h.hide().append(u).appendTo("body"),h.submit()},disableFormElements:function(e){e.find(i.disableSelector).each(function(){var e=t(this),i=e.is("button")?"html":"val";e.data("ujs:enable-with",e[i]()),e[i](e.data("disable-with")),e.prop("disabled",!0)})},enableFormElements:function(e){e.find(i.enableSelector).each(function(){var e=t(this),i=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[i](e.data("ujs:enable-with")),e.prop("disabled",!1)})},allowAction:function(t){var e,n=t.data("confirm"),r=!1;return n?(i.fire(t,"confirm")&&(r=i.confirm(n),e=i.fire(t,"confirm:complete",[r])),r&&e):!0},blankInputs:function(e,i,n){var r,s,o=t(),a=i||"input,textarea",l=e.find(a);return l.each(function(){if(r=t(this),s=r.is("input[type=checkbox],input[type=radio]")?r.is(":checked"):r.val(),!s==!n){if(r.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+r.attr("name")+'"]').length)return!0;o=o.add(r)}}),o.length?o:!1},nonBlankInputs:function(t,e){return i.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){t.data("ujs:enable-with",t.html()),t.html(t.data("disable-with")),t.bind("click.railsDisable",function(t){return i.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},i.fire(n,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,n){t.crossDomain||i.CSRFProtection(n)}),n.delegate(i.linkDisableSelector,"ajax:complete",function(){i.enableElement(t(this))}),n.delegate(i.linkClickSelector,"click.rails",function(n){var r=t(this),s=r.data("method"),o=r.data("params"),a=n.metaKey||n.ctrlKey;if(!i.allowAction(r))return i.stopEverything(n);if(!a&&r.is(i.linkDisableSelector)&&i.disableElement(r),r.data("remote")!==e){if(a&&(!s||"GET"===s)&&!o)return!0;var l=i.handleRemote(r);return l===!1?i.enableElement(r):l.error(function(){i.enableElement(r)}),!1}return r.data("method")?(i.handleMethod(r),!1):void 0}),n.delegate(i.buttonClickSelector,"click.rails",function(e){var n=t(this);return i.allowAction(n)?(i.handleRemote(n),!1):i.stopEverything(e)}),n.delegate(i.inputChangeSelector,"change.rails",function(e){var n=t(this);return i.allowAction(n)?(i.handleRemote(n),!1):i.stopEverything(e)}),n.delegate(i.formSubmitSelector,"submit.rails",function(n){var r=t(this),s=r.data("remote")!==e,o=i.blankInputs(r,i.requiredInputSelector),a=i.nonBlankInputs(r,i.fileInputSelector);if(!i.allowAction(r))return i.stopEverything(n);if(o&&r.attr("novalidate")==e&&i.fire(r,"ajax:aborted:required",[o]))return i.stopEverything(n);if(s){if(a){setTimeout(function(){i.disableFormElements(r)},13);var l=i.fire(r,"ajax:aborted:file",[a]);return l||setTimeout(function(){i.enableFormElements(r)},13),l}return i.handleRemote(r),!1}setTimeout(function(){i.disableFormElements(r)},13)}),n.delegate(i.formInputClickSelector,"click.rails",function(e){var n=t(this);if(!i.allowAction(n))return i.stopEverything(e);var r=n.attr("name"),s=r?{name:r,value:n.val()}:null;n.closest("form").data("ujs:submit-button",s)}),n.delegate(i.formSubmitSelector,"ajax:beforeSend.rails",function(e){this==e.target&&i.disableFormElements(t(this))}),n.delegate(i.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&i.enableFormElements(t(this))}),t(function(){i.refreshCSRFTokens()}))}(jQuery),function(){flinto_checkBrowserCapability=function(){if($.support||($.support={}),!$.support.fileAPI){$.extend($.support,{fileAPI:!1});try{FileReader&&($.support.fileAPI=!0)}catch(t){}}return $.support}}.call(this),function(){var t,e;t=window.jQuery||("function"==typeof require?require("jquery"):void 0),e=t(document),t.turbo={version:"2.0.2",isReady:!1,use:function(t,i){return e.off(".turbo").on(""+t+".turbo",this.onLoad).on(""+i+".turbo",this.onFetch)},addCallback:function(i){return t.turbo.isReady?i(t):e.on("turbo:ready",function(){return i(t)})},onLoad:function(){return t.turbo.isReady=!0,e.trigger("turbo:ready")},onFetch:function(){return t.turbo.isReady=!1},register:function(){return t(this.onLoad),t.fn.ready=this.addCallback}},t.turbo.register(),t.turbo.use("page:load","page:fetch")}.call(this),function(){var t,e,i,n,r,s,o,a,l,h,u,c,d,p,f,g,m,v,y,w,b,_,k,S,x,C,T,$,I,L,D,E,P,A,M,z,O,R,N,B,F,j,H,V,W,G,q,U,X,K,J,Q,Y,Z,te,ee,ie,ne,re,se,oe=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1},ae=[].slice;O={},u=10,te=!1,g=null,P=null,C=["html"],H=null,p=null,re=null,b=function(t){var e;return U(),h(),V(t),te&&(e=ee(t))?(_(e),k(t)):k(t,Y)},ee=function(t){var e;return e=O[t],e&&!e.transitionCacheDisabled?e:void 0},m=function(t){return null==t&&(t=!0),te=t},k=function(t,e){return null==e&&(e=function(){return function(){}}(this)),ie("page:fetch",{url:t}),null!=re&&re.abort(),re=new XMLHttpRequest,re.open("GET",K(t),!0),re.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml"),re.setRequestHeader("X-XHR-Referer",H),re.onload=function(){var i;return ie("page:receive"),(i=F())?(c.apply(null,w(i)),W(),e(),ie("page:load")):document.location.href=t},re.onloadend=function(){return re=null},re.onerror=function(){return document.location.href=t},re.send()},_=function(t){return null!=re&&re.abort(),c(t.title,t.body),j(t),ie("page:restore")},h=function(){return O[g.url]={url:document.location.href,body:document.body,title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset,cachedAt:(new Date).getTime(),transitionCacheDisabled:null!=document.querySelector("[data-no-transition-cache]")},d(u)},N=function(t){return null==t&&(t=u),/^[\d]+$/.test(t)?u=parseInt(t):void 0},d=function(t){var e,i,n,r,s,o;for(n=Object.keys(O),e=n.map(function(t){return O[t].cachedAt}).sort(function(t,e){return e-t}),o=[],r=0,s=n.length;s>r;r++)i=n[r],O[i].cachedAt<=e[t]&&(ie("page:expire",O[i]),o.push(delete O[i]));return o},c=function(e,i,n,r){return document.title=e,document.documentElement.replaceChild(i,document.body),null!=n&&t.update(n),r&&v(),g=window.history.state,ie("page:change"),ie("page:update")},v=function(){var t,e,i,n,r,s,o,a,l,h,u,c;for(s=Array.prototype.slice.call(document.body.querySelectorAll('script:not([data-turbolinks-eval="false"])')),o=0,l=s.length;l>o;o++)if(r=s[o],""===(u=r.type)||"text/javascript"===u){for(e=document.createElement("script"),c=r.attributes,a=0,h=c.length;h>a;a++)t=c[a],e.setAttribute(t.name,t.value);e.appendChild(document.createTextNode(r.innerHTML)),n=r.parentNode,i=r.nextSibling,n.removeChild(r),n.insertBefore(e,i)}},J=function(t){return t.innerHTML=t.innerHTML.replace(/<noscript[\S\s]*?<\/noscript>/gi,""),t},V=function(t){return t!==H?window.history.pushState({turbolinks:!0,url:t},"",t):void 0},W=function(){var t,e;return(t=re.getResponseHeader("X-XHR-Redirected-To"))?(e=X(t)===t?document.location.hash:"",window.history.replaceState(g,"",t+e)):void 0},U=function(){return H=document.location.href},q=function(){return window.history.replaceState({turbolinks:!0,url:document.location.href},"",document.location.href)},G=function(){return g=window.history.state},j=function(t){return window.scrollTo(t.positionX,t.positionY)},Y=function(){return document.location.hash?document.location.href=document.location.href:window.scrollTo(0,0)},K=function(t){return X(t)},X=function(t){var e;return e=t,null==t.href&&(e=document.createElement("A"),e.href=t),e.href.replace(e.hash,"")},B=function(t){var e,i;return e=(null!=(i=document.cookie.match(new RegExp(t+"=(\\w+)")))?i[1].toUpperCase():void 0)||"",document.cookie=t+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/",e},ie=function(t,e){var i;return i=document.createEvent("Events"),e&&(i.data=e),i.initEvent(t,!0,!0),document.dispatchEvent(i)},R=function(){return!ie("page:before-change")},F=function(){var t,e,i,n,r,s;return e=function(){var t;return 400<=(t=re.status)&&600>t},s=function(){return re.getResponseHeader("Content-Type").match(/^(?:text\/html|application\/xhtml\+xml|application\/xml)(?:;|$)/)},n=function(t){var e,i,n,r,s;for(r=t.head.childNodes,s=[],i=0,n=r.length;n>i;i++)e=r[i],null!=("function"==typeof e.getAttribute?e.getAttribute("data-turbolinks-track"):void 0)&&s.push(e.getAttribute("src")||e.getAttribute("href"));return s},t=function(t){var e;return P||(P=n(document)),e=n(t),e.length!==P.length||r(e,P).length!==P.length},r=function(t,e){var i,n,r,s,o;for(t.length>e.length&&(s=[e,t],t=s[0],e=s[1]),o=[],n=0,r=t.length;r>n;n++)i=t[n],oe.call(e,i)>=0&&o.push(i);return o},!e()&&s()&&(i=p(re.responseText),i&&!t(i))?i:void 0},w=function(e){var i;return i=e.querySelector("title"),[null!=i?i.textContent:void 0,J(e.body),t.get(e).token,"runScripts"]},t={get:function(t){var e;return null==t&&(t=document),{node:e=t.querySelector('meta[name="csrf-token"]'),token:null!=e&&"function"==typeof e.getAttribute?e.getAttribute("content"):void 0}},update:function(t){var e;return e=this.get(),null!=e.token&&null!=t&&e.token!==t?e.node.setAttribute("content",t):void 0}},n=function(){var t,e,i,n,r,s;e=function(t){return(new DOMParser).parseFromString(t,"text/html")},t=function(t){var e;return e=document.implementation.createHTMLDocument(""),e.documentElement.innerHTML=t,e},i=function(t){var e;return e=document.implementation.createHTMLDocument(""),e.open("replace"),e.write(t),e.close(),e};try{if(window.DOMParser)return r=e("<html><body><p>test"),e}catch(o){return n=o,r=t("<html><body><p>test"),t}finally{if(1!==(null!=r&&null!=(s=r.body)?s.childNodes.length:void 0))return i}},I=function(t){return t.defaultPrevented?void 0:(document.removeEventListener("click",S,!1),document.addEventListener("click",S,!1))},S=function(t){var e;return t.defaultPrevented||(e=y(t),"A"!==e.nodeName||T(t,e))?void 0:(R()||ne(e.href),t.preventDefault())},y=function(t){var e;for(e=t.target;e.parentNode&&"A"!==e.nodeName;)e=e.parentNode;return e},f=function(t){return location.protocol!==t.protocol||location.host!==t.host},i=function(t){return(t.hash&&X(t))===X(location)||t.href===location.href+"#"},M=function(t){var e;return e=X(t),e.match(/\.[a-z]+(\?.*)?$/g)&&!e.match(new RegExp("\\.(?:"+C.join("|")+")?(\\?.*)?$","g"))},A=function(t){for(var e;!e&&t!==document;)e=null!=t.getAttribute("data-no-turbolink"),t=t.parentNode;return e},Z=function(t){return 0!==t.target.length},z=function(t){return t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey},T=function(t,e){return f(e)||i(e)||M(e)||A(e)||Z(e)||z(t)},e=function(){var t,e,i,n;for(e=1<=arguments.length?ae.call(arguments,0):[],i=0,n=e.length;n>i;i++)t=e[i],C.push(t);return C},l=function(t){return setTimeout(t,500)},L=function(){return document.addEventListener("DOMContentLoaded",function(){return ie("page:change"),ie("page:update")},!0)},E=function(){return"undefined"!=typeof jQuery?jQuery(document).on("ajaxSuccess",function(t,e){return jQuery.trim(e.responseText)?ie("page:update"):void 0}):void 0},D=function(t){var e,i;return(null!=(i=t.state)?i.turbolinks:void 0)?(e=O[t.state.url])?(h(),_(e)):ne(t.target.location.href):void 0},$=function(){return q(),G(),p=n(),document.addEventListener("click",I,!0),l(function(){return window.addEventListener("popstate",D,!1)})},x=void 0!==window.history.state||navigator.userAgent.match(/Firefox\/2[6|7]/),o=window.history&&window.history.pushState&&window.history.replaceState&&x,r=!navigator.userAgent.match(/CriOS\//),Q="GET"===(se=B("request_method"))||""===se,a=o&&r&&Q,s=document.addEventListener&&document.createEvent,s&&(L(),E()),a?(ne=b,$()):ne=function(t){return document.location.href=t},this.Turbolinks={visit:ne,pagesCached:N,enableTransitionCache:m,allowLinkExtensions:e,supported:a}}.call(this),function(){var t=this,e=t._,i={},n=Array.prototype,r=Object.prototype,s=Function.prototype,o=n.push,a=n.slice,l=n.concat,h=r.toString,u=r.hasOwnProperty,c=n.forEach,d=n.map,p=n.reduce,f=n.reduceRight,g=n.filter,m=n.every,v=n.some,y=n.indexOf,w=n.lastIndexOf,b=Array.isArray,_=Object.keys,k=s.bind,S=function(t){return t instanceof S?t:this instanceof S?void(this._wrapped=t):new S(t)
};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=S),exports._=S):t._=S,S.VERSION="1.5.2";var x=S.each=S.forEach=function(t,e,n){if(null!=t)if(c&&t.forEach===c)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var o=S.keys(t),r=0,s=o.length;s>r;r++)if(e.call(n,t[o[r]],o[r],t)===i)return};S.map=S.collect=function(t,e,i){var n=[];return null==t?n:d&&t.map===d?t.map(e,i):(x(t,function(t,r,s){n.push(e.call(i,t,r,s))}),n)};var C="Reduce of empty array with no initial value";S.reduce=S.foldl=S.inject=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduce===p)return n&&(e=S.bind(e,n)),r?t.reduce(e,i):t.reduce(e);if(x(t,function(t,s,o){r?i=e.call(n,i,t,s,o):(i=t,r=!0)}),!r)throw new TypeError(C);return i},S.reduceRight=S.foldr=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return n&&(e=S.bind(e,n)),r?t.reduceRight(e,i):t.reduceRight(e);var s=t.length;if(s!==+s){var o=S.keys(t);s=o.length}if(x(t,function(a,l,h){l=o?o[--s]:--s,r?i=e.call(n,i,t[l],l,h):(i=t[l],r=!0)}),!r)throw new TypeError(C);return i},S.find=S.detect=function(t,e,i){var n;return T(t,function(t,r,s){return e.call(i,t,r,s)?(n=t,!0):void 0}),n},S.filter=S.select=function(t,e,i){var n=[];return null==t?n:g&&t.filter===g?t.filter(e,i):(x(t,function(t,r,s){e.call(i,t,r,s)&&n.push(t)}),n)},S.reject=function(t,e,i){return S.filter(t,function(t,n,r){return!e.call(i,t,n,r)},i)},S.every=S.all=function(t,e,n){e||(e=S.identity);var r=!0;return null==t?r:m&&t.every===m?t.every(e,n):(x(t,function(t,s,o){return(r=r&&e.call(n,t,s,o))?void 0:i}),!!r)};var T=S.some=S.any=function(t,e,n){e||(e=S.identity);var r=!1;return null==t?r:v&&t.some===v?t.some(e,n):(x(t,function(t,s,o){return r||(r=e.call(n,t,s,o))?i:void 0}),!!r)};S.contains=S.include=function(t,e){return null==t?!1:y&&t.indexOf===y?-1!=t.indexOf(e):T(t,function(t){return t===e})},S.invoke=function(t,e){var i=a.call(arguments,2),n=S.isFunction(e);return S.map(t,function(t){return(n?e:t[e]).apply(t,i)})},S.pluck=function(t,e){return S.map(t,function(t){return t[e]})},S.where=function(t,e,i){return S.isEmpty(e)?i?void 0:[]:S[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},S.findWhere=function(t,e){return S.where(t,e,!0)},S.max=function(t,e,i){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&S.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return x(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o>n.computed&&(n={value:t,computed:o})}),n.value},S.min=function(t,e,i){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&S.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return x(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o<n.computed&&(n={value:t,computed:o})}),n.value},S.shuffle=function(t){var e,i=0,n=[];return x(t,function(t){e=S.random(i++),n[i-1]=n[e],n[e]=t}),n},S.sample=function(t,e,i){return arguments.length<2||i?t[S.random(t.length-1)]:S.shuffle(t).slice(0,Math.max(0,e))};var $=function(t){return S.isFunction(t)?t:function(e){return e[t]}};S.sortBy=function(t,e,i){var n=$(e);return S.pluck(S.map(t,function(t,e,r){return{value:t,index:e,criteria:n.call(i,t,e,r)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index-e.index}),"value")};var I=function(t){return function(e,i,n){var r={},s=null==i?S.identity:$(i);return x(e,function(i,o){var a=s.call(n,i,o,e);t(r,a,i)}),r}};S.groupBy=I(function(t,e,i){(S.has(t,e)?t[e]:t[e]=[]).push(i)}),S.indexBy=I(function(t,e,i){t[e]=i}),S.countBy=I(function(t,e){S.has(t,e)?t[e]++:t[e]=1}),S.sortedIndex=function(t,e,i,n){i=null==i?S.identity:$(i);for(var r=i.call(n,e),s=0,o=t.length;o>s;){var a=s+o>>>1;i.call(n,t[a])<r?s=a+1:o=a}return s},S.toArray=function(t){return t?S.isArray(t)?a.call(t):t.length===+t.length?S.map(t,S.identity):S.values(t):[]},S.size=function(t){return null==t?0:t.length===+t.length?t.length:S.keys(t).length},S.first=S.head=S.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:a.call(t,0,e)},S.initial=function(t,e,i){return a.call(t,0,t.length-(null==e||i?1:e))},S.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},S.rest=S.tail=S.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},S.compact=function(t){return S.filter(t,S.identity)};var L=function(t,e,i){return e&&S.every(t,S.isArray)?l.apply(i,t):(x(t,function(t){S.isArray(t)||S.isArguments(t)?e?o.apply(i,t):L(t,e,i):i.push(t)}),i)};S.flatten=function(t,e){return L(t,e,[])},S.without=function(t){return S.difference(t,a.call(arguments,1))},S.uniq=S.unique=function(t,e,i,n){S.isFunction(e)&&(n=i,i=e,e=!1);var r=i?S.map(t,i,n):t,s=[],o=[];return x(r,function(i,n){(e?n&&o[o.length-1]===i:S.contains(o,i))||(o.push(i),s.push(t[n]))}),s},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=function(t){var e=a.call(arguments,1);return S.filter(S.uniq(t),function(t){return S.every(e,function(e){return S.indexOf(e,t)>=0})})},S.difference=function(t){var e=l.apply(n,a.call(arguments,1));return S.filter(t,function(t){return!S.contains(e,t)})},S.zip=function(){for(var t=S.max(S.pluck(arguments,"length").concat(0)),e=new Array(t),i=0;t>i;i++)e[i]=S.pluck(arguments,""+i);return e},S.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},S.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=S.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}if(y&&t.indexOf===y)return t.indexOf(e,i);for(;r>n;n++)if(t[n]===e)return n;return-1},S.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(w&&t.lastIndexOf===w)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},S.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,s=new Array(n);n>r;)s[r++]=t,t+=i;return s};var D=function(){};S.bind=function(t,e){var i,n;if(k&&t.bind===k)return k.apply(t,a.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(a.call(arguments)));D.prototype=t.prototype;var r=new D;D.prototype=null;var s=t.apply(r,i.concat(a.call(arguments)));return Object(s)===s?s:r}},S.partial=function(t){var e=a.call(arguments,1);return function(){return t.apply(this,e.concat(a.call(arguments)))}},S.bindAll=function(t){var e=a.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return x(e,function(e){t[e]=S.bind(t[e],t)}),t},S.memoize=function(t,e){var i={};return e||(e=S.identity),function(){var n=e.apply(this,arguments);return S.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},S.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},S.defer=function(t){return S.delay.apply(S,[t,1].concat(a.call(arguments,1)))},S.throttle=function(t,e,i){var n,r,s,o=null,a=0;i||(i={});var l=function(){a=i.leading===!1?0:new Date,o=null,s=t.apply(n,r)};return function(){var h=new Date;a||i.leading!==!1||(a=h);var u=e-(h-a);return n=this,r=arguments,0>=u?(clearTimeout(o),o=null,a=h,s=t.apply(n,r)):o||i.trailing===!1||(o=setTimeout(l,u)),s}},S.debounce=function(t,e,i){var n,r,s,o,a;return function(){s=this,r=arguments,o=new Date;var l=function(){var h=new Date-o;e>h?n=setTimeout(l,e-h):(n=null,i||(a=t.apply(s,r)))},h=i&&!n;return n||(n=setTimeout(l,e)),h&&(a=t.apply(s,r)),a}},S.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},S.wrap=function(t,e){return function(){var i=[t];return o.apply(i,arguments),e.apply(this,i)}},S.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},S.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},S.keys=_||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)S.has(t,i)&&e.push(i);return e},S.values=function(t){for(var e=S.keys(t),i=e.length,n=new Array(i),r=0;i>r;r++)n[r]=t[e[r]];return n},S.pairs=function(t){for(var e=S.keys(t),i=e.length,n=new Array(i),r=0;i>r;r++)n[r]=[e[r],t[e[r]]];return n},S.invert=function(t){for(var e={},i=S.keys(t),n=0,r=i.length;r>n;n++)e[t[i[n]]]=i[n];return e},S.functions=S.methods=function(t){var e=[];for(var i in t)S.isFunction(t[i])&&e.push(i);return e.sort()},S.extend=function(t){return x(a.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},S.pick=function(t){var e={},i=l.apply(n,a.call(arguments,1));return x(i,function(i){i in t&&(e[i]=t[i])}),e},S.omit=function(t){var e={},i=l.apply(n,a.call(arguments,1));for(var r in t)S.contains(i,r)||(e[r]=t[r]);return e},S.defaults=function(t){return x(a.call(arguments,1),function(e){if(e)for(var i in e)void 0===t[i]&&(t[i]=e[i])}),t},S.clone=function(t){return S.isObject(t)?S.isArray(t)?t.slice():S.extend({},t):t},S.tap=function(t,e){return e(t),t};var E=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof S&&(t=t._wrapped),e instanceof S&&(e=e._wrapped);var r=h.call(t);if(r!=h.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;var o=t.constructor,a=e.constructor;if(o!==a&&!(S.isFunction(o)&&o instanceof o&&S.isFunction(a)&&a instanceof a))return!1;i.push(t),n.push(e);var l=0,u=!0;if("[object Array]"==r){if(l=t.length,u=l==e.length)for(;l--&&(u=E(t[l],e[l],i,n)););}else{for(var c in t)if(S.has(t,c)&&(l++,!(u=S.has(e,c)&&E(t[c],e[c],i,n))))break;if(u){for(c in e)if(S.has(e,c)&&!l--)break;u=!l}}return i.pop(),n.pop(),u};S.isEqual=function(t,e){return E(t,e,[],[])},S.isEmpty=function(t){if(null==t)return!0;if(S.isArray(t)||S.isString(t))return 0===t.length;for(var e in t)if(S.has(t,e))return!1;return!0},S.isElement=function(t){return!(!t||1!==t.nodeType)},S.isArray=b||function(t){return"[object Array]"==h.call(t)},S.isObject=function(t){return t===Object(t)},x(["Arguments","Function","String","Number","Date","RegExp"],function(t){S["is"+t]=function(e){return h.call(e)=="[object "+t+"]"}}),S.isArguments(arguments)||(S.isArguments=function(t){return!(!t||!S.has(t,"callee"))}),"function"!=typeof/./&&(S.isFunction=function(t){return"function"==typeof t}),S.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},S.isNaN=function(t){return S.isNumber(t)&&t!=+t},S.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==h.call(t)},S.isNull=function(t){return null===t},S.isUndefined=function(t){return void 0===t},S.has=function(t,e){return u.call(t,e)},S.noConflict=function(){return t._=e,this},S.identity=function(t){return t},S.times=function(t,e,i){for(var n=Array(Math.max(0,t)),r=0;t>r;r++)n[r]=e.call(i,r);return n},S.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var P={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};P.unescape=S.invert(P.escape);var A={escape:new RegExp("["+S.keys(P.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(P.unescape).join("|")+")","g")};S.each(["escape","unescape"],function(t){S[t]=function(e){return null==e?"":(""+e).replace(A[t],function(e){return P[t][e]})}}),S.result=function(t,e){if(null==t)return void 0;var i=t[e];return S.isFunction(i)?i.call(t):i},S.mixin=function(t){x(S.functions(t),function(e){var i=S[e]=t[e];S.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),N.call(this,i.apply(S,t))}})};var M=0;S.uniqueId=function(t){var e=++M+"";return t?t+e:e},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(t,e,i){var n;i=S.defaults({},i,S.templateSettings);var r=new RegExp([(i.escape||z).source,(i.interpolate||z).source,(i.evaluate||z).source].join("|")+"|$","g"),s=0,o="__p+='";t.replace(r,function(e,i,n,r,a){return o+=t.slice(s,a).replace(R,function(t){return"\\"+O[t]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(o+="';\n"+r+"\n__p+='"),s=a+e.length,e}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(i.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(e)return n(e,S);var l=function(t){return n.call(this,t,S)};return l.source="function("+(i.variable||"obj")+"){\n"+o+"}",l},S.chain=function(t){return S(t).chain()};var N=function(t){return this._chain?S(t).chain():t};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];S.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],N.call(this,i)}}),x(["concat","join","slice"],function(t){var e=n[t];S.prototype[t]=function(){return N.call(this,e.apply(this._wrapped,arguments))}}),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this);var JSON;JSON||(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,r,s,o,a=gap,l=e[t];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(t)),"function"==typeof rep&&(l=rep.call(e,t,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(l)){for(s=l.length,i=0;s>i;i+=1)o[i]=str(i,l)||"null";return r=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;s>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],r=str(n,l),r&&o.push(quote(n)+(gap?": ":":")+r));else for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(r=str(n,l),r&&o.push(quote(n)+(gap?": ":":")+r));return r=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var i,n,r=t[e];if(r&&"object"==typeof r)for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n=walk(r,i),void 0!==n?r[i]=n:delete r[i]);return reviver.call(t,e,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){var t,e=this,i=e.Backbone,n=[],r=(n.push,n.slice);n.splice,t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="1.1.0";var s=e._;s||"undefined"==typeof require||(s=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=t.Events={on:function(t,e,i){if(!l(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,i){if(!l(this,"once",t,[e,i])||!e)return this;var n=this,r=s.once(function(){n.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,i)},off:function(t,e,i){var n,r,o,a,h,u,c,d;if(!this._events||!l(this,"off",t,[e,i]))return this;if(!t&&!e&&!i)return this._events={},this;for(a=t?[t]:s.keys(this._events),h=0,u=a.length;u>h;h++)if(t=a[h],o=this._events[t]){if(this._events[t]=n=[],e||i)for(c=0,d=o.length;d>c;c++)r=o[c],(e&&e!==r.callback&&e!==r.callback._callback||i&&i!==r.context)&&n.push(r);n.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=r.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t],n=this._events.all;return i&&h(i,e),n&&h(n,arguments),this},stopListening:function(t,e,i){var n=this._listeningTo;if(!n)return this;var r=!e&&!i;i||"object"!=typeof e||(i=this),t&&((n={})[t._listenId]=t);for(var o in n)t=n[o],t.off(e,i,this),(r||s.isEmpty(t._events))&&delete this._listeningTo[o];return this}},a=/\s+/,l=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)t[e].apply(t,[r,i[r]].concat(n));return!1}if(a.test(i)){for(var s=i.split(a),o=0,l=s.length;l>o;o++)t[e].apply(t,[s[o]].concat(n));return!1}return!0},h=function(t,e){var i,n=-1,r=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,o);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,o,a);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e)}},u={listenTo:"on",listenToOnce:"once"};s.each(u,function(t,e){o[e]=function(e,i,n){var r=this._listeningTo||(this._listeningTo={}),o=e._listenId||(e._listenId=s.uniqueId("l"));return r[o]=e,n||"object"!=typeof i||(n=this),e[t](i,n,this),this}}),o.bind=o.on,o.unbind=o.off,s.extend(t,o);var c=t.Model=function(t,e){var i=t||{};e||(e={}),this.cid=s.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{}),i=s.defaults({},i,s.result(this,"defaults")),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};s.extend(c.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return s.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,i){var n,r,o,a,l,h,u,c;if(null==t)return this;if("object"==typeof t?(r=t,i=e):(r={})[t]=e,i||(i={}),!this._validate(r,i))return!1;o=i.unset,l=i.silent,a=[],h=this._changing,this._changing=!0,h||(this._previousAttributes=s.clone(this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(n in r)e=r[n],s.isEqual(c[n],e)||a.push(n),s.isEqual(u[n],e)?delete this.changed[n]:this.changed[n]=e,o?delete c[n]:c[n]=e;if(!l){a.length&&(this._pending=!0);for(var d=0,p=a.length;p>d;d++)this.trigger("change:"+a[d],this,c[a[d]],i)}if(h)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,s.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,s.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!s.isEmpty(this.changed):s.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?s.clone(this.changed):!1;var e,i=!1,n=this._changing?this._previousAttributes:this.attributes;for(var r in t)s.isEqual(n[r],e=t[r])||((i||(i={}))[r]=e);return i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},fetch:function(t){t=t?s.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,i=t.success;return t.success=function(n){return e.set(e.parse(n,t),t)?(i&&i(e,n,t),void e.trigger("sync",e,n,t)):!1},O(this,t),this.sync("read",this,t)},save:function(t,e,i){var n,r,o,a=this.attributes;if(null==t||"object"==typeof t?(n=t,i=e):(n={})[t]=e,i=s.extend({validate:!0},i),n&&!i.wait){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;n&&i.wait&&(this.attributes=s.extend({},a,n)),void 0===i.parse&&(i.parse=!0);var l=this,h=i.success;return i.success=function(t){l.attributes=a;var e=l.parse(t,i);return i.wait&&(e=s.extend(n||{},e)),s.isObject(e)&&!l.set(e,i)?!1:(h&&h(l,t,i),void l.trigger("sync",l,t,i))},O(this,i),r=this.isNew()?"create":i.patch?"patch":"update","patch"===r&&(i.attrs=n),o=this.sync(r,this,i),n&&i.wait&&(this.attributes=a),o},destroy:function(t){t=t?s.clone(t):{};var e=this,i=t.success,n=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(r){(t.wait||e.isNew())&&n(),i&&i(e,r,t),e.isNew()||e.trigger("sync",e,r,t)},this.isNew())return t.success(),!1;O(this,t);var r=this.sync("delete",this,t);return t.wait||n(),r},url:function(){var t=s.result(this,"urlRoot")||s.result(this.collection,"url")||z();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},s.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=s.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return i?(this.trigger("invalid",this,i,s.extend(e,{validationError:i})),!1):!0}});var d=["keys","values","pairs","invert","pick","omit"];s.each(d,function(t){c.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.attributes),s[t].apply(s,e)}});var p=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,s.extend({silent:!0},e))},f={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};s.extend(p.prototype,o,{model:c,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,s.extend({merge:!1},e,g))},remove:function(t,e){var i=!s.isArray(t);t=i?[t]:s.clone(t),e||(e={});var n,r,o,a;for(n=0,r=t.length;r>n;n++)a=t[n]=this.get(t[n]),a&&(delete this._byId[a.id],delete this._byId[a.cid],o=this.indexOf(a),this.models.splice(o,1),this.length--,e.silent||(e.index=o,a.trigger("remove",a,this,e)),this._removeReference(a));return i?t[0]:t},set:function(t,e){e=s.defaults({},e,f),e.parse&&(t=this.parse(t,e));var i=!s.isArray(t);t=i?t?[t]:[]:s.clone(t);var n,r,o,a,l,h,u,d=e.at,p=this.model,g=this.comparator&&null==d&&e.sort!==!1,m=s.isString(this.comparator)?this.comparator:null,v=[],y=[],w={},b=e.add,_=e.merge,k=e.remove,S=!g&&b&&k?[]:!1;for(n=0,r=t.length;r>n;n++){if(l=t[n],o=l instanceof c?a=l:l[p.prototype.idAttribute],h=this.get(o))k&&(w[h.cid]=!0),_&&(l=l===a?a.attributes:l,e.parse&&(l=h.parse(l,e)),h.set(l,e),g&&!u&&h.hasChanged(m)&&(u=!0)),t[n]=h;else if(b){if(a=t[n]=this._prepareModel(l,e),!a)continue;v.push(a),a.on("all",this._onModelEvent,this),this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a)}S&&S.push(h||a)}if(k){for(n=0,r=this.length;r>n;++n)w[(a=this.models[n]).cid]||y.push(a);y.length&&this.remove(y,e)}if(v.length||S&&S.length)if(g&&(u=!0),this.length+=v.length,null!=d)for(n=0,r=v.length;r>n;n++)this.models.splice(d+n,0,v[n]);else{S&&(this.models.length=0);var x=S||v;for(n=0,r=x.length;r>n;n++)this.models.push(x[n])}if(u&&this.sort({silent:!0}),!e.silent){for(n=0,r=v.length;r>n;n++)(a=v[n]).trigger("add",a,this,e);(u||S&&S.length)&&this.trigger("sort",this,e)}return i?t[0]:t},reset:function(t,e){e||(e={});for(var i=0,n=this.models.length;n>i;i++)this._removeReference(this.models[i]);return e.previousModels=this.models,this._reset(),t=this.add(t,s.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,s.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,s.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return r.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[t.id]||this._byId[t.cid]||this._byId[t]},at:function(t){return this.models[t]},where:function(t,e){return s.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),s.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(s.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return s.invoke(this.models,"get",t)},fetch:function(t){t=t?s.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,i=this;return t.success=function(n){var r=t.reset?"reset":"set";i[r](n,t),e&&e(i,n,t),i.trigger("sync",i,n,t)},O(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?s.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var i=this,n=e.success;return e.success=function(t,e,r){r.wait&&i.add(t,r),n&&n(t,e,r)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof c)return t.collection||(t.collection=this),t;e=e?s.clone(e):{},e.collection=this;var i=new this.model(t,e);return i.validationError?(this.trigger("invalid",this,i.validationError,e),!1):i},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var m=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];s.each(m,function(t){p.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.models),s[t].apply(s,e)}});var v=["groupBy","countBy","sortBy"];s.each(v,function(t){p.prototype[t]=function(e,i){var n=s.isFunction(e)?e:function(t){return t.get(e)};return s[t](this.models,n,i)}});var y=t.View=function(t){this.cid=s.uniqueId("view"),t||(t={}),s.extend(this,s.pick(t,b)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,b=["model","collection","el","id","attributes","className","tagName","events"];s.extend(y.prototype,o,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=s.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var i=t[e];if(s.isFunction(i)||(i=this[t[e]]),i){var n=e.match(w),r=n[1],o=n[2];i=s.bind(i,this),r+=".delegateEvents"+this.cid,""===o?this.$el.on(r,i):this.$el.on(r,o,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var e=s.extend({},s.result(this,"attributes"));this.id&&(e.id=s.result(this,"id")),this.className&&(e["class"]=s.result(this,"className"));var i=t.$("<"+s.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,n){var r=k[e];s.defaults(n||(n={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:r,dataType:"json"};if(n.url||(o.url=s.result(i,"url")||z()),null!=n.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(n.attrs||i.toJSON(n))),n.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),n.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){o.type="POST",n.emulateJSON&&(o.data._method=r);var a=n.beforeSend;n.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",r),a?a.apply(this,arguments):void 0}}"GET"===o.type||n.emulateJSON||(o.processData=!1),"PATCH"===o.type&&_&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=n.xhr=t.ajax(s.extend(o,n));return i.trigger("request",i,l,n),l};var _=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var S=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},x=/\((.*?)\)/g,C=/(\(\?)?:\w+/g,T=/\*\w+/g,$=/[\-{}\[\]+?.,\\\^$|#\s]/g;s.extend(S.prototype,o,{initialize:function(){},route:function(e,i,n){s.isRegExp(e)||(e=this._routeToRegExp(e)),s.isFunction(i)&&(n=i,i=""),n||(n=this[i]);var r=this;return t.history.route(e,function(s){var o=r._extractParameters(e,s);n&&n.apply(r,o),r.trigger.apply(r,["route:"+i].concat(o)),r.trigger("route",i,o),t.history.trigger("route",r,i,o)}),this},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=s.result(this,"routes");for(var t,e=s.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace($,"\\$&").replace(x,"(?:$1)?").replace(C,function(t,e){return e?t:"([^/]+)"}).replace(T,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return s.map(i,function(t){return t?decodeURIComponent(t):null})}});var I=t.History=function(){this.handlers=[],s.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},L=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,E=/msie [\w.]+/,P=/\/$/,A=/[?#].*$/;I.started=!1,s.extend(I.prototype,o,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(P,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(L,"")},start:function(e){if(I.started)throw new Error("Backbone.history has already been started");I.started=!0,this.options=s.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),n=document.documentMode,r=E.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);this.root=("/"+this.root+"/").replace(D,"/"),r&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(i)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;
var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!a)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace(L,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),I.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(t){return t=this.fragment=this.getFragment(t),s.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!I.started)return!1;e&&e!==!0||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(A,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),t.history=new I;var M=function(t,e){var i,n=this;i=t&&s.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},s.extend(i,n,e);var r=function(){this.constructor=i};return r.prototype=n.prototype,i.prototype=new r,t&&s.extend(i.prototype,t),i.__super__=n.prototype,i};c.extend=p.extend=S.extend=y.extend=I.extend=M;var z=function(){throw new Error('A "url" property or function must be specified')},O=function(t,e){var i=e.error;e.error=function(n){i&&i(t,n,e),t.trigger("error",t,n,e)}}}.call(this),function(t){var e={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"},i=function(t){return t&&t.url?_.isFunction(t.url)?t.url():t.url:null},n=function(){throw new Error("A 'url' property or function must be specified")};Backbone.sync=function(r,s,o){var a=e[r],l=_.extend({type:a,dataType:"json",beforeSend:function(e){if(!o.noCSRF){var i=t('meta[name="csrf-token"]').attr("content");i&&e.setRequestHeader("X-CSRF-Token",i)}s.trigger("sync:start")}},o);if(l.url||(l.url=i(s)||n()),!l.data&&s&&("create"==r||"update"==r)){l.contentType="application/json";var h={};s.paramRoot?h[s.paramRoot]=s.toJSON():h=s.toJSON(),l.data=JSON.stringify(h)}"GET"!==l.type&&(l.processData=!1);var u=o.complete;return l.complete=function(t,e){s.trigger("sync:end"),u&&u(t,e)},t.ajax(l)}}(jQuery),function(t){function e(e,i){this.el=t(e),this.options=i||{},this.x=!1!==this.options.x||this.options.forceHorizontal,this.y=!1!==this.options.y||this.options.forceVertical,navigator.userAgent.match(/Gecko.*Firefox/)&&navigator.platform.match(/Mac/)&&(this.x=!1),this.autoHide=!1!==this.options.autoHide,this.padding=void 0==this.options.padding?2:this.options.padding,this.paddingTop=void 0==this.options.paddingTop?0:this.options.paddingTop,this.paddingBottom=void 0==this.options.paddingBottom?0:this.options.paddingBottom,this.inner=this.el.find(".antiscroll-inner"),barSize=this.inner.width()-this.inner.children().width(),0==barSize&&(barSize=o),this.inner.css({width:"+="+(this.y?barSize:0),height:"+="+(this.x?barSize:0)}),s()&&this.inner.css({"margin-right":"14px"}),this.refresh()}function i(e){this.pane=e,this.pane.el.append(this.el),this.innerEl=this.pane.inner.get(0),this.dragging=!1,this.enter=!1,this.shown=!1,this.el.mousedown(t.proxy(this,"mousedown")),this.innerPaneScrollListener=t.proxy(this,"scroll"),this.pane.inner.scroll(this.innerPaneScrollListener),this.innerPaneMouseWheelListener=t.proxy(this,"mousewheel"),this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);var i=this.pane.options.initialDisplay;i!==!1&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(t.proxy(this,"hide"),parseInt(i,10)||3e3)))}function n(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i}function r(){if(void 0===a){var e=t('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');t("body").append(e);var i=t(e).innerWidth(),n=t("div",e).innerWidth();t(e).remove(),a=i-n,0==a&&(a=o)}return a}function s(){return ua=window.navigator.userAgent,isOSXFF=/(?=.+Mac OS X)(?=.+Firefox)/.test(ua),version=/Firefox\/\d{2}\./.exec(ua),version&&(version=version[0].replace(/\D+/g,"")),isOSXFF&&+version>23}var o=0;s()&&(o=14),t.fn.antiscroll=function(e){return this.each(function(){t(this).data("antiscroll")&&t(this).data("antiscroll").destroy(),t(this).data("antiscroll",new t.Antiscroll(this,e))})},t.Antiscroll=e,e.prototype.refresh=function(){var t=this.inner.get(0).scrollWidth>this.el.width()+(this.y?r():0),e=this.inner.get(0).scrollHeight>this.el.height()-this.paddingTop-this.paddingBottom+(this.x?r():0);this.x&&(!this.horizontal&&t?this.horizontal=new i.Horizontal(this):this.horizontal&&!t?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update()),this.y&&(!this.vertical&&e?this.vertical=new i.Vertical(this):this.vertical&&!e?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update())},e.prototype.destroy=function(){return this.horizontal&&(this.horizontal.destroy(),this.horizontal=null),this.vertical&&(this.vertical.destroy(),this.vertical=null),this},e.prototype.rebuild=function(){return this.destroy(),this.inner.attr("style",""),e.call(this,this.el,this.options),this},i.prototype.destroy=function(){return this.el.remove(),this.pane.inner.unbind("scroll",this.innerPaneScrollListener),this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener),this},i.prototype.mouseenter=function(){this.enter=!0,this.show()},i.prototype.mouseleave=function(){this.enter=!1,this.dragging||this.pane.autoHide&&this.hide()},i.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||this.pane.autoHide&&(this.hiding=setTimeout(t.proxy(this,"hide"),1500))),this.update()},i.prototype.mousedown=function(e){e.preventDefault(),this.dragging=!0,this.startPageY=e.pageY-parseInt(this.el.css("top"),10),this.startPageX=e.pageX-parseInt(this.el.css("left"),10),this.el[0].ownerDocument.onselectstart=function(){return!1};var i=(this.pane,t.proxy(this,"mousemove")),n=this;t(this.el[0].ownerDocument).mousemove(i).mouseup(function(){n.dragging=!1,this.onselectstart=null,t(this).unbind("mousemove",i),n.enter||n.hide()})},i.prototype.show=function(){!this.shown&&this.update()&&(this.el.addClass("antiscroll-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)},i.prototype.hide=function(){this.pane.autoHide!==!1&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)},i.Horizontal=function(e){this.el=t('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal">',e.el),i.call(this,e)},n(i.Horizontal,i),i.Horizontal.prototype.update=function(){var t=this.pane.el.width(),e=t-2*this.pane.padding,i=this.pane.inner.get(0);return this.el.css("width",e*t/i.scrollWidth).css("left",e*i.scrollLeft/i.scrollWidth),t<i.scrollWidth},i.Horizontal.prototype.mousemove=function(t){var e=this.pane.el.width()-2*this.pane.padding,i=t.pageX-this.startPageX,n=this.el.width(),r=this.pane.inner.get(0),s=Math.min(Math.max(i,0),e-n);r.scrollLeft=(r.scrollWidth-this.pane.el.width())*s/(e-n)},i.Horizontal.prototype.mousewheel=function(t,e,i){return 0>i&&0==this.pane.inner.get(0).scrollLeft||i>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())==this.innerEl.scrollWidth?(t.preventDefault(),!1):void 0},i.Vertical=function(e){this.el=t('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical">',e.el),i.call(this,e)},n(i.Vertical,i),i.Vertical.prototype.update=function(){var t=this.pane.el.height()-this.pane.paddingTop-this.pane.paddingBottom,e=t-2*this.pane.padding,i=this.innerEl,n=e*t/(i.scrollHeight-this.pane.paddingTop-this.pane.paddingBottom);n=20>n?20:n;var r=e*i.scrollTop/(i.scrollHeight-this.pane.paddingTop-this.pane.paddingBottom)+this.pane.paddingTop;if(r+n>this.pane.el.height()){var s=r+n-e;r=r-s-3}return this.el.css("height",n).css("top",r),t<i.scrollHeight},i.Vertical.prototype.mousemove=function(t){var e=this.pane.el.height(),i=e-2*this.pane.padding,n=t.pageY-this.startPageY,r=this.el.height(),s=this.innerEl,o=Math.min(Math.max(n,0),i-r);s.scrollTop=(s.scrollHeight-e)*o/(i-r)},i.Vertical.prototype.mousewheel=function(t,e,i,n){return n>0&&0==this.innerEl.scrollTop||0>n&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())==this.innerEl.scrollHeight?(t.preventDefault(),!1):void 0};var a}(jQuery),!function(){!function(t){function e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function i(t){return"undefined"==typeof t}var n={},r=t.TraceKit,s=[].slice,o="?";n.noConflict=function(){return t.TraceKit=r,n},n.wrap=function(t){function e(){try{return t.apply(this,arguments)}catch(e){throw n.report(e),e}}return e},n.report=function(){function i(t){l(),d.push(t)}function r(t){for(var e=d.length-1;e>=0;--e)d[e]===t&&d.splice(e,1)}function o(t,i){var r=null;if(!i||n.collectWindowErrors){for(var o in d)if(e(d,o))try{d[o].apply(null,[t].concat(s.call(arguments,2)))}catch(a){r=a}if(r)throw r}}function a(t,e,i){var r=null;if(f)n.computeStackTrace.augmentStackTraceWithInitialElement(f,e,i,t),r=f,f=null,p=null;else{var s={url:e,line:i};s.func=n.computeStackTrace.guessFunctionName(s.url,s.line),s.context=n.computeStackTrace.gatherContext(s.url,s.line),r={mode:"onerror",message:t,url:document.location.href,stack:[s],useragent:navigator.userAgent}}return o(r,"from window.onerror"),u?u.apply(this,arguments):!1}function l(){c!==!0&&(u=t.onerror,t.onerror=a,c=!0)}function h(e){var i=s.call(arguments,1);if(f){if(p===e)return;var r=f;f=null,p=null,o.apply(null,[r,null].concat(i))}var a=n.computeStackTrace(e);throw f=a,p=e,t.setTimeout(function(){p===e&&(f=null,p=null,o.apply(null,[a,null].concat(i)))},a.incomplete?2e3:0),e}var u,c,d=[],p=null,f=null;return h.subscribe=i,h.unsubscribe=r,h}(),n.computeStackTrace=function(){function r(e){function i(){try{return new t.XMLHttpRequest}catch(e){return new t.ActiveXObject("Microsoft.XMLHTTP")}}if(!n.remoteFetching)return"";try{var r=i();return r.open("GET",e,!1),r.send(""),r.responseText}catch(s){return""}}function s(t){if(!e(k,t)){var i="";-1!==t.indexOf(document.domain)&&(i=r(t)),k[t]=i?i.split("\n"):[]}return k[t]}function a(t,e){var n,r=/function ([^(]*)\(([^)]*)\)/,a=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,l="",h=10,u=s(t);if(!u.length)return o;for(var c=0;h>c;++c)if(l=u[e-c]+l,!i(l)){if(n=a.exec(l))return n[1];if(n=r.exec(l))return n[1]}return o}function l(t,e){var r=s(t);if(!r.length)return null;var o=[],a=Math.floor(n.linesOfContext/2),l=a+n.linesOfContext%2,h=Math.max(0,e-a-1),u=Math.min(r.length,e+l-1);e-=1;for(var c=h;u>c;++c)i(r[c])||o.push(r[c]);return o.length>0?o:null}function h(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function u(t){return h(t).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function c(t,e){for(var i,n,r=0,o=e.length;o>r;++r)if((i=s(e[r])).length&&(i=i.join("\n"),n=t.exec(i)))return{url:e[r],line:i.substring(0,n.index).split("\n").length,column:n.index-i.lastIndexOf("\n",n.index)-1};return null}function d(t,e,i){var n,r=s(e),o=new RegExp("\\b"+h(t)+"\\b");return i-=1,r&&r.length>i&&(n=o.exec(r[i]))?n.index:null}function p(e){for(var i,n,r,s,o=[t.location.href],a=document.getElementsByTagName("script"),l=""+e,d=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,p=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,f=0;f<a.length;++f){var g=a[f];g.src&&o.push(g.src)}if(r=d.exec(l)){var m=r[1]?"\\s+"+r[1]:"",v=r[2].split(",").join("\\s*,\\s*");i=h(r[3]).replace(/;$/,";?"),n=new RegExp("function"+m+"\\s*\\(\\s*"+v+"\\s*\\)\\s*{\\s*"+i+"\\s*}")}else n=new RegExp(h(l).replace(/\s+/g,"\\s+"));if(s=c(n,o))return s;if(r=p.exec(l)){var y=r[1];if(i=u(r[2]),n=new RegExp("on"+y+"=[\\'\"]\\s*"+i+"\\s*[\\'\"]","i"),s=c(n,o[0]))return s;if(n=new RegExp(i),s=c(n,o))return s}return null}function f(t){if(!t.stack)return null;for(var e,i,n=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,r=/^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,s=t.stack.split("\n"),h=[],u=/^(.*) is undefined$/.exec(t.message),c=0,p=s.length;p>c;++c){if(e=r.exec(s[c]))i={url:e[3],func:e[1]||o,args:e[2]?e[2].split(","):"",line:+e[4],column:e[5]?+e[5]:null};else{if(!(e=n.exec(s[c])))continue;i={url:e[2],func:e[1]||o,line:+e[3],column:e[4]?+e[4]:null}}!i.func&&i.line&&(i.func=a(i.url,i.line)),i.line&&(i.context=l(i.url,i.line)),h.push(i)}return h[0]&&h[0].line&&!h[0].column&&u&&(h[0].column=d(u[1],h[0].url,h[0].line)),h.length?{mode:"stack",name:t.name,message:t.message,url:document.location.href,stack:h,useragent:navigator.userAgent}:null}function g(t){for(var e,i=t.stacktrace,n=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,r=i.split("\n"),s=[],o=0,h=r.length;h>o;o+=2)if(e=n.exec(r[o])){var u={line:+e[1],column:+e[2],func:e[3]||e[4],args:e[5]?e[5].split(","):[],url:e[6]};if(!u.func&&u.line&&(u.func=a(u.url,u.line)),u.line)try{u.context=l(u.url,u.line)}catch(c){}u.context||(u.context=[r[o+1]]),s.push(u)}return s.length?{mode:"stacktrace",name:t.name,message:t.message,url:document.location.href,stack:s,useragent:navigator.userAgent}:null}function m(i){var n=i.message.split("\n");if(n.length<4)return null;var r,o,h,d,p=/^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,f=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,g=/^\s*Line (\d+) of function script\s*$/i,m=[],v=document.getElementsByTagName("script"),y=[];for(o in v)e(v,o)&&!v[o].src&&y.push(v[o]);for(o=2,h=n.length;h>o;o+=2){var w=null;if(r=p.exec(n[o]))w={url:r[2],func:r[3],line:+r[1]};else if(r=f.exec(n[o])){w={url:r[3],func:r[4]};var b=+r[1],_=y[r[2]-1];if(_&&(d=s(w.url))){d=d.join("\n");var k=d.indexOf(_.innerText);k>=0&&(w.line=b+d.substring(0,k).split("\n").length)}}else if(r=g.exec(n[o])){var S=t.location.href.replace(/#.*$/,""),x=r[1],C=new RegExp(u(n[o+1]));d=c(C,[S]),w={url:S,line:d?d.line:x,func:""}}if(w){w.func||(w.func=a(w.url,w.line));var T=l(w.url,w.line),$=T?T[Math.floor(T.length/2)]:null;w.context=T&&$.replace(/^\s*/,"")===n[o+1].replace(/^\s*/,"")?T:[n[o+1]],m.push(w)}}return m.length?{mode:"multiline",name:i.name,message:n[0],url:document.location.href,stack:m,useragent:navigator.userAgent}:null}function v(t,e,i,n){var r={url:e,line:i};if(r.url&&r.line){t.incomplete=!1,r.func||(r.func=a(r.url,r.line)),r.context||(r.context=l(r.url,r.line));var s=/ '([^']+)' /.exec(n);if(s&&(r.column=d(s[1],r.url,r.line)),t.stack.length>0&&t.stack[0].url===r.url){if(t.stack[0].line===r.line)return!1;if(!t.stack[0].line&&t.stack[0].func===r.func)return t.stack[0].line=r.line,t.stack[0].context=r.context,!1}return t.stack.unshift(r),t.partial=!0,!0}return t.incomplete=!0,!1}function y(t,e){for(var i,r,s,l=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,h=[],u={},c=!1,f=y.caller;f&&!c;f=f.caller)if(f!==w&&f!==n.report){if(r={url:null,func:o,line:null,column:null},f.name?r.func=f.name:(i=l.exec(f.toString()))&&(r.func=i[1]),s=p(f)){r.url=s.url,r.line=s.line,r.func===o&&(r.func=a(r.url,r.line));var g=/ '([^']+)' /.exec(t.message||t.description);g&&(r.column=d(g[1],s.url,s.line))}u[""+f]?c=!0:u[""+f]=!0,h.push(r)}e&&h.splice(0,e);var m={mode:"callers",name:t.name,message:t.message,url:document.location.href,stack:h,useragent:navigator.userAgent};return v(m,t.sourceURL||t.fileName,t.line||t.lineNumber,t.message||t.description),m}function w(t,e){var i=null;e=null==e?0:+e;try{if(i=g(t))return i}catch(n){if(_)throw n}try{if(i=f(t))return i}catch(n){if(_)throw n}try{if(i=m(t))return i}catch(n){if(_)throw n}try{if(i=y(t,e+1))return i}catch(n){if(_)throw n}return{mode:"failed"}}function b(t){t=(null==t?0:+t)+1;try{throw new Error}catch(e){return w(e,t+1)}return null}var _=!1,k={};return w.augmentStackTraceWithInitialElement=v,w.guessFunctionName=a,w.gatherContext=l,w.ofCaller=b,w}(),!function(){var e=function(e){var i=t[e];t[e]=function(){var t=s.call(arguments),e=t[0];return"function"==typeof e&&(t[0]=n.wrap(e)),i.apply?i.apply(this,t):i(t[0],t[1])}};e("setTimeout"),e("setInterval")}(),n.remoteFetching||(n.remoteFetching=!0),n.collectWindowErrors||(n.collectWindowErrors=!0),(!n.linesOfContext||n.linesOfContext<1)&&(n.linesOfContext=11),t.TraceKit=n}(window);var t;t=function(){function t(t){var i,n,r,s,o,a,l;this.options=null!=t?t:{},this.error=this.options.error,this.stackInfo=this.options.stackInfo||this.error&&TraceKit.computeStackTrace(this.error),this.trace=this._parseBacktrace(null!=(r=this.stackInfo)?r.stack:void 0),this["class"]=null!=(s=this.stackInfo)?s.name:void 0,this.message=null!=(o=this.stackInfo)?o.message:void 0,this.source=this.stackInfo&&this._extractSource(this.stackInfo.stack),this.url=document.URL,this.project_root=e.configuration.project_root,this.environment=e.configuration.environment,this.component=e.configuration.component,this.action=e.configuration.action,this.context={},a=e.context;for(i in a)n=a[i],this.context[i]=n;if(this.options.context){l=this.options.context;for(i in l)n=l[i],this.context[i]=n}}return t.prototype.toJSON=function(){return JSON.stringify({notifier:{name:"honeybadger.js",url:"https://github.com/honeybadger-io/honeybadger-js",version:e.version,language:"javascript"},error:{"class":this["class"],message:this.message,backtrace:this.trace,source:this.source},request:{url:this.url,component:this.component,action:this.action,context:this.context,cgi_data:this._cgiData()},server:{project_root:this.project_root,environment_name:this.environment}})},t.prototype._parseBacktrace=function(t){var i,n,r,s,o,a;for(null==t&&(t=[]),i=[],r=0,s=t.length;s>r;r++)n=t[r],(null!=(o=n.url)?o.match(/honeybadger(?:\.min)?\.js/):0)||i.push({file:(null!=(a=n.url)?a.replace(e.configuration.project_root,"[PROJECT_ROOT]"):void 0)||"unknown",number:n.line,method:n.func});return i},t.prototype._extractSource=function(t){var e,i,n,r,s,o,a,l;for(null==t&&(t=[]),n={},l=null!=(o=null!=(a=t[0])?a.context:void 0)?o:[],e=r=0,s=l.length;s>r;e=++r)i=l[e],n[e]=i;return n},t.prototype._cgiData=function(){var t,e,i;t={};for(e in navigator)i=navigator[e],"object"!=typeof i&&(t[e.split(/(?=[A-Z][a-z]*)/).join("_").toUpperCase()]=i);return t.HTTP_USER_AGENT=t.USER_AGENT,delete t.USER_AGENT,document.referrer.match(/\S/)&&(t.HTTP_REFERER=document.referrer),t},t}();var e;e=function(){function e(){}return e.version="0.0.2",e.default_configuration={api_key:null,host:"api.honeybadger.io",ssl:!0,project_root:window.location.protocol+"//"+window.location.host,environment:"production",component:null,action:null,disabled:!0,onerror:!1},e.configured=!1,e.configure=function(t){var e,i;null==t&&(t={}),this.configured===!1&&("undefined"==typeof t.disabled&&(t.disabled=!1),this.configured=!0);for(e in t)i=t[e],this.configuration[e]=i;return TraceKit.collectWindowErrors=this.configuration.onerror,this},e.configuration={reset:function(){var t,i,n;e.configured=!1,n=e.default_configuration;for(t in n)i=n[t],e.configuration[t]=i;return TraceKit.collectWindowErrors=e.configuration.onerror,e}},e.configuration.reset(),e.context={},e.resetContext=function(t){return null==t&&(t={}),this.context="object"==typeof t?t:{},this},e.setContext=function(t){var e,i;if(null==t&&(t={}),"object"==typeof t)for(e in t)i=t[e],this.context[e]=i;return this},e.beforeNotifyHandlers=[],e.beforeNotify=function(t){return this.beforeNotifyHandlers.push(t)},e.notify=function(e,i){var n,r,s,o,a;if(null==i&&(i={}),this.configuration.disabled===!0)return!1;for(e&&(i.error=e),r=new t(i),a=this.beforeNotifyHandlers,s=0,o=a.length;o>s;s++)if(n=a[s],n(r)===!1)return!1;return this._sendRequest(r.toJSON())},e._sendRequest=function(t){var e;return e="http"+(this.configuration.ssl&&"s"||"")+"://"+this.configuration.host+"/v1/notices.html",this._crossDomainPost(e,t)},e._crossDomainPost=function(t,e){var i,n,r,s;return n=document.createElement("iframe"),s="_hb_"+(new Date).getTime(),document.body.appendChild(n),n.style.display="none",n.contentWindow.name=s,i=document.createElement("form"),i.target=s,i.action=t,i.method="POST",r=document.createElement("input"),r.type="hidden",r.name="payload",r.value=e,i.appendChild(r),r=document.createElement("input"),r.type="hidden",r.name="api_key",r.value=this.configuration.api_key,i.appendChild(r),document.body.appendChild(i),i.submit()},e._handleTraceKitSubscription=function(t){return e.notify(null,{stackInfo:t})},e}.call(this),TraceKit.report.subscribe(e._handleTraceKitSubscription),("undefined"!=typeof exports&&null!==exports?exports:this).Honeybadger=e}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};jQuery.fn.popover=function(e){var i,n,r;return null==e&&(e={}),r=null,n=null,$(document).on("click",function(){return null!=r?r.hide():void 0}),$(document).on("keydown",function(t){return(t.keyCode===flinto.keys.ESC||t.keyCode===flinto.keys.ENTER)&&null!=r?r.hide():void 0}),i=function(){function e(e,i){this.toggle=t(this.toggle,this),this.animateOut=t(this.animateOut,this),this.animateIn=t(this.animateIn,this),this.hideModal=t(this.hideModal,this),this.showModal=t(this.showModal,this),this.hide=t(this.hide,this),this.show=t(this.show,this),this.bind=t(this.bind,this),this.trigger=$(e),this.target=$("#"+this.trigger.data("target")).hide(),this.options=$.extend({position:$.noop,animateIn:this.animateIn,animateOut:this.animateOut,modal:!0},i),this.bind()}return e.prototype.bind=function(){return this.trigger.on("click",function(t){return function(e){return t.toggle(),e.stopPropagation()}}(this)),this.target.on("click",function(){return function(){return event.stopPropagation()}}(this))},e.prototype.show=function(){return null!=r&&r.hide(),r=this,this.showModal(),this.options.position(this.trigger,this.target),this.options.animateIn(this.target)},e.prototype.hide=function(){return r=null,this.hideModal(),this.options.animateOut(this.target)},e.prototype.showModal=function(){return this.options.modal?(this.target.css({zIndex:11}),n=$("<div>").addClass("modal_shade").css({width:"100%",height:"100%",position:"fixed",top:0,left:0,zIndex:10,opacity:0}).appendTo("body"),this.animateIn(n)):void 0},e.prototype.hideModal=function(){return this.options.modal?this.animateOut(n):void 0},e.prototype.animateIn=function(t){return t.css({display:"block",opacity:0}).transition({opacity:1,duration:100,easing:"ease-out"})},e.prototype.animateOut=function(t){return t.transition({opacity:0,duration:150,easing:"ease-out"},function(){return function(){return t.css({display:"none",opacity:1})}}(this))},e.prototype.toggle=function(){return this.target.is(":visible")?this.hide():this.show()},e}(),$(this).each(function(){return function(t,n){return new i(n,e)}}(this)),$(this)}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};jQuery.fn.selectDescription=function(){var e;return e=function(){function e(e){this.$el=e,this.showCurrentDescription=t(this.showCurrentDescription,this),this.handleChange=t(this.handleChange,this),this.hideAllDescriptions=t(this.hideAllDescriptions,this),this.descriptionForOption=t(this.descriptionForOption,this),this.$el=$(this.$el),this.$el.change(this.handleChange),this.hideAllDescriptions(),this.showCurrentDescription()}return e.prototype.descriptionForOption=function(t){var e;return e=$(null!=t.data("description")?"#"+t.data("description"):"#"+t.attr("value"))},e.prototype.hideAllDescriptions=function(){var t=this;return this.$el.find("option").each(function(e,i){return t.descriptionForOption($(i)).hide()})},e.prototype.handleChange=function(){return this.hideAllDescriptions(),this.showCurrentDescription()},e.prototype.showCurrentDescription=function(){var t;return t=this.$el.find("option[value="+this.$el.val()+"]"),this.descriptionForOption(t).show()},e}(),$(this).each(function(t,i){return new e($(i))}),$(this)}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};jQuery.fn.toggleAll=function(e){var i;return i=function(){function e(e,i){this.areAllChecked=t(this.areAllChecked,this);var n,r;this.$el=$(e),r=this.$el.is("input[type=checkbox]")?"checkbox":"button",this.$targets=$(i),n="checkbox"===r?"change":"click",this.$el.on(n,function(t){return function(){var e;return e="checkbox"===r?t.$el.is(":checked"):t.areAllChecked()?!1:!0,t.$targets.prop({checked:e})}}(this)),"checkbox"===r&&this.$targets.on("change",function(t){return function(){return t.$el.prop({checked:t.areAllChecked()})}}(this))}return e.prototype.areAllChecked=function(){return 0===this.$targets.filter(":not(:checked)").size()},e}(),$(this).each(function(){return function(t,n){return new i(n,e)}}(this)),$(this)}}.call(this),function(t,e){"use strict";var i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";t.fn.imagesLoaded=function(n){function r(){var e=t(c),i=t(d);a&&(d.length?a.reject(h,e,i):a.resolve(h)),t.isFunction(n)&&n.call(o,h,e,i)}function s(e,n){e.src!==i&&-1===t.inArray(e,u)&&(u.push(e),n?d.push(e):c.push(e),t.data(e,"imagesLoaded",{isBroken:n,src:e.src}),l&&a.notifyWith(t(e),[n,h,t(c),t(d)]),h.length===u.length&&(setTimeout(r),h.unbind(".imagesLoaded")))}var o=this,a=t.isFunction(t.Deferred)?t.Deferred():0,l=t.isFunction(a.notify),h=o.find("img").add(o.filter("img")),u=[],c=[],d=[];return t.isPlainObject(n)&&t.each(n,function(t,e){"callback"===t?n=e:a&&a[t](e)}),h.length?h.bind("load.imagesLoaded error.imagesLoaded",function(t){s(t.target,"error"===t.type)}).each(function(n,r){var o=r.src,a=t.data(r,"imagesLoaded");return a&&a.src===o?void s(r,a.isBroken):r.complete&&r.naturalWidth!==e?void s(r,0===r.naturalWidth||0===r.naturalHeight):void((r.readyState||r.complete)&&(r.src=i,r.src=o))}):r(),a?a.promise(o):o}}(jQuery),function(){jQuery.fn.linkTableRows=function(t){var e;return null==t&&(t={}),e=function(){function t(t,e){var i,n;this.$el=t,this.options=e,this.$el=$(this.$el),i={excludeClass:null,hoverClass:null},this.options=$.extend(i,this.options),this.$el.find("tbody tr").each(function(t){return function(e,i){var n,r,s;return i=$(i),n=i.data("href"),null!=n?(s=i.find("td"),null!=t.options.excludeClass&&(s=s.filter(":not(."+t.options.excludeClass+")")),r=$("<a>").attr("href",n),r.css({display:"block"}),s.wrapInner(r)):void 0}}(this)),null!=this.options.hoverClass&&(n=this.$el.find("tbody tr td a"),n.on("mouseover",function(t){return function(e){return $(e.target).parents("tr").addClass(t.options.hoverClass)}}(this)),n.on("mouseout",function(t){return function(e){return $(e.target).parents("tr").removeClass(t.options.hoverClass)}}(this)))}return t}(),$(this).each(function(){return function(i,n){return new e($(n),t)}}(this)),$(this)}}.call(this),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var r,s=e||window.event,o=[].slice.call(arguments,1),a=0,l=0,h=0,u=0,c=0;return e=t.event.fix(s),e.type="mousewheel",s.wheelDelta&&(a=s.wheelDelta),s.detail&&(a=-1*s.detail),s.deltaY&&(h=-1*s.deltaY,a=h),s.deltaX&&(l=s.deltaX,a=-1*l),void 0!==s.wheelDeltaY&&(h=s.wheelDeltaY),void 0!==s.wheelDeltaX&&(l=-1*s.wheelDeltaX),u=Math.abs(a),(!i||i>u)&&(i=u),c=Math.max(Math.abs(h),Math.abs(l)),(!n||n>c)&&(n=c),r=a>0?"floor":"ceil",a=Math[r](a/i),l=Math[r](l/n),h=Math[r](h/n),o.unshift(e,a,l,h),(t.event.dispatch||t.event.handle).apply(this,o)}var i,n,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(t.event.fixHooks)for(var o=r.length;o;)t.event.fixHooks[r[--o]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=s.length;t;)this.addEventListener(s[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=s.length;t;)this.removeEventListener(s[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),function(){!function(t){var e;return t.event.fix=function(t){return function(e){return e=t.apply(this,arguments),(0===e.type.indexOf("copy")||0===e.type.indexOf("paste"))&&(e.clipboardData=e.originalEvent.clipboardData),e}}(t.event.fix),e={callback:t.noop,matchType:/image.*/},t.fn.pasteImageReader=function(i){return"function"==typeof i&&(i={callback:i}),i=t.extend({},e,i),this.each(function(){var e,n;return n=this,e=t(this),e.bind("paste",function(t){var e,r;return r=!1,e=t.clipboardData,Array.prototype.forEach.call(e.types,function(t,s){var o,a;return r?void 0:t.match(i.matchType)||e.items&&e.items[s].type.match(i.matchType)?(o=e.items[s].getAsFile(),a=new FileReader,a.onload=function(t){return i.callback.call(n,{dataURL:t.target.result,event:t,file:o,name:o.name})},a.readAsDataURL(o),r=!0):void 0})})})}}(jQuery)}.call(this),function(t){t.fn.stupidtable=function(e){return this.each(function(){var i=t(this);e=e||{},e=t.extend({},t.fn.stupidtable.default_sort_fns,e);var n=function(e,i,n){var r=[],s=0,o=e.slice(0).sort(i);n&&o.reverse();for(var a=0;a<e.length;a++){for(s=t.inArray(e[a],o);-1!=t.inArray(s,r);)s++;r.push(s)}return r},r=function(t,e){for(var i=t.slice(0),n=0,r=0;r<e.length;r++)n=e[r],i[n]=t[r];return i};i.on("click","th",function(){var s=i.children("tbody").children("tr"),o=t(this),a=0,l=t.fn.stupidtable.dir;i.find("th").slice(0,o.index()).each(function(){var e=t(this).attr("colspan")||1;a+=parseInt(e,10)});var h=o.data("sort-dir")===l.ASC?l.DESC:l.ASC;if(h==l.DESC)var u=o.data("sort-desc")||o.data("sort")||null;else var u=o.data("sort")||null;null!==u&&(i.trigger("beforetablesort",{column:a,direction:h}),i.css("display"),setTimeout(function(){var c=[],d=e[u];s.each(function(e,i){var n=t(i).children().eq(a),r=n.data("sort-value"),s="undefined"!=typeof r?r:n.text();c.push(s)});var p=n(c,d,h==l.DESC);i.find("th").data("sort-dir",null).removeClass("sorting-desc sorting-asc"),o.data("sort-dir",h).addClass("sorting-"+h);var f=t(r(s,p));i.children("tbody").append(f),i.trigger("aftertablesort",{column:a,direction:h}),i.css("display")},10))})})},t.fn.stupidtable.dir={ASC:"asc",DESC:"desc"},t.fn.stupidtable.default_sort_fns={"int":function(t,e){return parseInt(t,10)-parseInt(e,10)},"float":function(t,e){return parseFloat(t)-parseFloat(e)},string:function(t,e){return e>t?-1:t>e?1:0},"string-ins":function(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),e>t?-1:t>e?1:0}}}(jQuery),function(t){function e(t){if(t in c.style)return t;var e=["Moz","Webkit","O","ms"],i=t.charAt(0).toUpperCase()+t.substr(1);if(t in c.style)return t;for(var n=0;n<e.length;++n){var r=e[n]+i;if(r in c.style)return r}}function i(){return c.style[d.transform]="",c.style[d.transform]="rotateY(90deg)",""!==c.style[d.transform]}function n(t){return"string"==typeof t&&this.parse(t),this}function r(t,e,i){e===!0?t.queue(i):e?t.queue(e,i):i()}function s(e){var i=[];return t.each(e,function(e){e=t.camelCase(e),e=t.transit.propertyMap[e]||t.cssProps[e]||e,e=l(e),-1===t.inArray(e,i)&&i.push(e)}),i}function o(e,i,n,r){var o=s(e);t.cssEase[n]&&(n=t.cssEase[n]);var a=""+u(i)+" "+n;parseInt(r,10)>0&&(a+=" "+u(r));var l=[];return t.each(o,function(t,e){l.push(e+" "+a)}),l.join(", ")}function a(e,i){i||(t.cssNumber[e]=!0),t.transit.propertyMap[e]=d.transform,t.cssHooks[e]={get:function(i){var n=t(i).css("transit:transform");return n.get(e)},set:function(i,n){var r=t(i).css("transit:transform");r.setFromString(e,n),t(i).css({"transit:transform":r})}}}function l(t){return t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}function h(t,e){return"string"!=typeof t||t.match(/^[\-0-9\.]+$/)?""+t+e:t}function u(e){var i=e;return t.fx.speeds[i]&&(i=t.fx.speeds[i]),h(i,"ms")
}t.transit={version:"0.9.9",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:!0,useTransitionEnd:!1};var c=document.createElement("div"),d={},p=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;d.transition=e("transition"),d.transitionDelay=e("transitionDelay"),d.transform=e("transform"),d.transformOrigin=e("transformOrigin"),d.transform3d=i();var f={transition:"transitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"},g=d.transitionEnd=f[d.transition]||null;for(var m in d)d.hasOwnProperty(m)&&"undefined"==typeof t.support[m]&&(t.support[m]=d[m]);c=null,t.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"},t.cssHooks["transit:transform"]={get:function(e){return t(e).data("transform")||new n},set:function(e,i){var r=i;r instanceof n||(r=new n(r)),e.style[d.transform]="WebkitTransform"!==d.transform||p?r.toString():r.toString(!0),t(e).data("transform",r)}},t.cssHooks.transform={set:t.cssHooks["transit:transform"].set},t.fn.jquery<"1.8"&&(t.cssHooks.transformOrigin={get:function(t){return t.style[d.transformOrigin]},set:function(t,e){t.style[d.transformOrigin]=e}},t.cssHooks.transition={get:function(t){return t.style[d.transition]},set:function(t,e){t.style[d.transition]=e}}),a("scale"),a("translate"),a("rotate"),a("rotateX"),a("rotateY"),a("rotate3d"),a("perspective"),a("skewX"),a("skewY"),a("x",!0),a("y",!0),n.prototype={setFromString:function(t,e){var i="string"==typeof e?e.split(","):e.constructor===Array?e:[e];i.unshift(t),n.prototype.set.apply(this,i)},set:function(t){var e=Array.prototype.slice.apply(arguments,[1]);this.setter[t]?this.setter[t].apply(this,e):this[t]=e.join(",")},get:function(t){return this.getter[t]?this.getter[t].apply(this):this[t]||0},setter:{rotate:function(t){this.rotate=h(t,"deg")},rotateX:function(t){this.rotateX=h(t,"deg")},rotateY:function(t){this.rotateY=h(t,"deg")},scale:function(t,e){void 0===e&&(e=t),this.scale=t+","+e},skewX:function(t){this.skewX=h(t,"deg")},skewY:function(t){this.skewY=h(t,"deg")},perspective:function(t){this.perspective=h(t,"px")},x:function(t){this.set("translate",t,null)},y:function(t){this.set("translate",null,t)},translate:function(t,e){void 0===this._translateX&&(this._translateX=0),void 0===this._translateY&&(this._translateY=0),null!==t&&void 0!==t&&(this._translateX=h(t,"px")),null!==e&&void 0!==e&&(this._translateY=h(e,"px")),this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var t=(this.scale||"1,1").split(",");return t[0]&&(t[0]=parseFloat(t[0])),t[1]&&(t[1]=parseFloat(t[1])),t[0]===t[1]?t[0]:t},rotate3d:function(){for(var t=(this.rotate3d||"0,0,0,0deg").split(","),e=0;3>=e;++e)t[e]&&(t[e]=parseFloat(t[e]));return t[3]&&(t[3]=h(t[3],"deg")),t}},parse:function(t){var e=this;t.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(t,i,n){e.setFromString(i,n)})},toString:function(t){var e=[];for(var i in this)if(this.hasOwnProperty(i)){if(!d.transform3d&&("rotateX"===i||"rotateY"===i||"perspective"===i||"transformOrigin"===i))continue;"_"!==i[0]&&e.push(t&&"scale"===i?i+"3d("+this[i]+",1)":t&&"translate"===i?i+"3d("+this[i]+",0)":i+"("+this[i]+")")}return e.join(" ")}},t.fn.transition=t.fn.transit=function(e,i,n,s){var a=this,l=0,h=!0;"function"==typeof i&&(s=i,i=void 0),"function"==typeof n&&(s=n,n=void 0),"undefined"!=typeof e.easing&&(n=e.easing,delete e.easing),"undefined"!=typeof e.duration&&(i=e.duration,delete e.duration),"undefined"!=typeof e.complete&&(s=e.complete,delete e.complete),"undefined"!=typeof e.queue&&(h=e.queue,delete e.queue),"undefined"!=typeof e.delay&&(l=e.delay,delete e.delay),"undefined"==typeof i&&(i=t.fx.speeds._default),"undefined"==typeof n&&(n=t.cssEase._default),i=u(i);var c=o(e,i,n,l),p=t.transit.enabled&&d.transition,f=p?parseInt(i,10)+parseInt(l,10):0;if(0===f){var m=function(t){a.css(e),s&&s.apply(a),t&&t()};return r(a,h,m),a}var v={},y=function(i){var n=!1,r=function(){n&&a.unbind(g,r),f>0&&a.each(function(){this.style[d.transition]=v[this]||null}),"function"==typeof s&&s.apply(a),"function"==typeof i&&i()};f>0&&g&&t.transit.useTransitionEnd?(n=!0,a.bind(g,r)):window.setTimeout(r,f),a.each(function(){f>0&&(this.style[d.transition]=c),t(this).css(e)})},w=function(t){this.offsetWidth,y(t)};return r(a,h,w),this},t.transit.getTransitionValue=o}(jQuery),function(){function t(){var t,e=!1,i=this;i._DeArray=function(t,e,i){return[t.slice(e,e+i)]},i._EnArray=function(t,e,i,n){for(var r=0;i>r;t[e+r]=n[r]?n[r]:0,r++);},i._DeChar=function(t,e){return String.fromCharCode(t[e])},i._EnChar=function(t,e,i){t[e]=i.charCodeAt(0)},i._DeInt=function(i,n){var r,s,o,a=e?t.len-1:0,l=e?-1:1,h=a+l*t.len;for(r=0,s=a,o=1;s!=h;r+=i[n+s]*o,s+=l,o*=256);return t.bSigned&&r&Math.pow(2,8*t.len-1)&&(r-=Math.pow(2,8*t.len)),r},i._EnInt=function(i,n,r){var s,o=e?t.len-1:0,a=e?-1:1,l=o+a*t.len;for(r=r<t.min?t.min:r>t.max?t.max:r,s=o;s!=l;i[n+s]=255&r,s+=a,r>>=8);},i._DeString=function(t,e,i){for(var n=new Array(i),r=0;i>r;n[r]=String.fromCharCode(t[e+r]),r++);return n.join("")},i._EnString=function(t,e,i,n){for(var r,s=0;i>s;t[e+s]=(r=n.charCodeAt(s))?r:0,s++);},i._De754=function(i,n){var r,s,o,a,l,h,u,c,d,p;for(u=t.mLen,c=8*t.len-t.mLen-1,p=(1<<c)-1,d=p>>1,a=e?0:t.len-1,l=e?1:-1,r=i[n+a],a+=l,h=-7,s=r&(1<<-h)-1,r>>=-h,h+=c;h>0;s=256*s+i[n+a],a+=l,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=u;h>0;o=256*o+i[n+a],a+=l,h-=8);switch(s){case 0:s=1-d;break;case p:return o?0/0:1/0*(r?-1:1);default:o+=Math.pow(2,u),s-=d}return(r?-1:1)*o*Math.pow(2,s-u)},i._En754=function(i,n,r){var s,o,a,l,h,u,c,d,p,f;for(c=t.mLen,d=8*t.len-t.mLen-1,f=(1<<d)-1,p=f>>1,s=0>r?1:0,r=Math.abs(r),isNaN(r)||1/0==r?(a=isNaN(r)?1:0,o=f):(o=Math.floor(Math.log(r)/Math.LN2),r*(u=Math.pow(2,-o))<1&&(o--,u*=2),r+=o+p>=1?t.rt/u:t.rt*Math.pow(2,1-p),r*u>=2&&(o++,u/=2),o+p>=f?(a=0,o=f):o+p>=1?(a=(r*u-1)*Math.pow(2,c),o+=p):(a=r*Math.pow(2,p-1)*Math.pow(2,c),o=0)),l=e?t.len-1:0,h=e?-1:1;c>=8;i[n+l]=255&a,l+=h,a/=256,c-=8);for(o=o<<c|a,d+=c;d>0;i[n+l]=255&o,l+=h,o/=256,d-=8);i[n+l-h]|=128*s},i._sPattern="(\\d+)?([AxcbBhHsfdiIlL])",i._lenLut={A:1,x:1,c:1,b:1,B:1,h:2,H:2,s:1,f:4,d:8,i:4,I:4,l:4,L:4},i._elLut={A:{en:i._EnArray,de:i._DeArray},s:{en:i._EnString,de:i._DeString},c:{en:i._EnChar,de:i._DeChar},b:{en:i._EnInt,de:i._DeInt,len:1,bSigned:!0,min:-Math.pow(2,7),max:Math.pow(2,7)-1},B:{en:i._EnInt,de:i._DeInt,len:1,bSigned:!1,min:0,max:Math.pow(2,8)-1},h:{en:i._EnInt,de:i._DeInt,len:2,bSigned:!0,min:-Math.pow(2,15),max:Math.pow(2,15)-1},H:{en:i._EnInt,de:i._DeInt,len:2,bSigned:!1,min:0,max:Math.pow(2,16)-1},i:{en:i._EnInt,de:i._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},I:{en:i._EnInt,de:i._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},l:{en:i._EnInt,de:i._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},L:{en:i._EnInt,de:i._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},f:{en:i._En754,de:i._De754,len:4,mLen:23,rt:Math.pow(2,-24)-Math.pow(2,-77)},d:{en:i._En754,de:i._De754,len:8,mLen:52,rt:0}},i._UnpackSeries=function(e,i,n,r){for(var s=t.de,o=[],a=0;e>a;o.push(s(n,r+a*i)),a++);return o},i._PackSeries=function(e,i,n,r,s,o){for(var a=t.en,l=0;e>l;a(n,r+l*i,s[o+l]),l++);},i.Unpack=function(i,n,r){e="<"!=i.charAt(0),r=r?r:0;for(var s,o,a,l=new RegExp(this._sPattern,"g"),h=[];s=l.exec(i);){if(o=void 0==s[1]||""==s[1]?1:parseInt(s[1]),a=this._lenLut[s[2]],r+o*a>n.length)return void 0;switch(s[2]){case"A":case"s":h.push(this._elLut[s[2]].de(n,r,o));break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":t=this._elLut[s[2]],h.push(this._UnpackSeries(o,a,n,r))}r+=o*a}return Array.prototype.concat.apply([],h)},i.PackTo=function(i,n,r,s){e="<"!=i.charAt(0);for(var o,a,l,h,u=new RegExp(this._sPattern,"g"),c=0;o=u.exec(i);){if(a=void 0==o[1]||""==o[1]?1:parseInt(o[1]),l=this._lenLut[o[2]],r+a*l>n.length)return!1;switch(o[2]){case"A":case"s":if(c+1>s.length)return!1;this._elLut[o[2]].en(n,r,a,s[c]),c+=1;break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":if(t=this._elLut[o[2]],c+a>s.length)return!1;this._PackSeries(a,l,n,r,s,c),c+=a;break;case"x":for(h=0;a>h;h++)n[r+h]=0}r+=a*l}return n},i.Pack=function(t,e){return this.PackTo(t,new Array(this.CalcLength(t)),0,e)},i.CalcLength=function(t){for(var e,i=new RegExp(this._sPattern,"g"),n=0;e=i.exec(t);)n+=(void 0==e[1]||""==e[1]?1:parseInt(e[1]))*this._lenLut[e[2]];return n}}var e,i,n,r,s,o,a,l,h,u,c,d,p,f,g,m,v,y,w,b,_,k,S,x,C,T,$,I,L,D,E,P,A,M,z,O,R,N=new t,B={}.hasOwnProperty,F=function(t,e){function i(){this.constructor=t}for(var n in e)B.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};O=function(t){return"undefined"!=typeof exports&&null!==exports?require("assert"):(t=function(t){if(t!==!0)throw"Assertion error"},t.equal=function(t,e){if(t!==e)throw"Assertion error"},t)}(O),"undefined"!=typeof exports&&null!==exports?(M=exports,R=require("fs")):M=window,M.PSD=i=function(){function t(t){this.file=new f(t),this.header=null,this.resources=null,this.layerMask=null,this.layers=null,this.images=null,this.image=null}return t.VERSION="0.4.5",t.DEBUG=!1,t.fromFile=function(e,i){var n,r;return null==i&&(i=function(){}),"undefined"!=typeof exports&&null!==exports?(n=R.readFileSync(e),new t(n)):(r=new FileReader,r.onload=function(e){var n,r;return n=new Uint8Array(e.target.result),r=new t(n),i(r)},r.readAsArrayBuffer(e))},t.fromURL=function(e,i){var n;return null==i&&(i=function(){}),n=new XMLHttpRequest,n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){var e,r;return e=new Uint8Array(n.response||n.mozResponseArrayBuffer),r=new t(e),i(r)},n.send(null)},t.prototype.options={layerImages:!1,onlyVisibleLayers:!1},t.prototype.setOptions=function(t){var e,i,n;n=[];for(e in t)B.call(t,e)&&(i=t[e],n.push(this.options[e]=i));return n},t.prototype.parse=function(){return e.debug("Beginning parsing"),this.startTime=(new Date).getTime(),this.parseHeader(),this.parseImageResources(),this.parseLayersMasks(),this.parseImageData(),this.endTime=(new Date).getTime(),e.debug("Parsing finished in "+(this.endTime-this.startTime)+"ms")},t.prototype.parseHeader=function(){return e.debug("\n### Header ###"),this.header=new m(this.file),this.header.parse(),e.debug(this.header)},t.prototype.parseImageResources=function(t){var i,n,r,s,o;if(null==t&&(t=!1),e.debug("\n### Resources ###"),this.resources=[],n=this.file.readInt(),i=n,t)return e.debug("Skipped!"),this.file.seek(n);for(o=this.file.tell();n>0;)r=this.file.tell(),s=new I(this.file),s.parse(),n-=this.file.tell()-r,this.resources.push(s),e.debug("Resource: ",s);return 0!==n?(e.debug("Image resources overran expected size by "+-n+" bytes"),this.file.seek(o+i)):void 0},t.prototype.parseLayersMasks=function(t){return null==t&&(t=!1),this.header||this.parseHeader(),this.resources||this.parseImageResources(!0),e.debug("\n### Layers & Masks ###"),this.layerMask=new S(this.file,this.header,this.options),this.layers=this.layerMask.layers,t?(e.debug("Skipped!"),this.layerMask.skip()):this.layerMask.parse()},t.prototype.parseImageData=function(){return this.header||this.parseHeader(),this.resources||this.parseImageResources(!0),this.layerMask||this.parseLayersMasks(!0),this.image=new y(this.file,this.header),this.image.parse()},t.prototype.getLayerStructure=function(){var t,e,i,n,r,s,o;for(this.layerMask||this.parseLayersMasks(),i={layers:[]},e=[],o=this.layers,r=0,s=o.length;s>r;r++)t=o[r],t.isFolder?(e.push(i),i={name:t.name,layers:[]}):t.isHidden?(n=i,i=e.pop(),i.layers.push(n)):i.layers.push(t);return i},t.prototype.toFile=function(t,e){return null==e&&(e=function(){}),this.image||this.parseImageData(),this.image.toFile(t,e)},t.prototype.toFileSync=function(t){return this.image||this.parseImageData(),this.image.toFileSync(t)},t.prototype.toCanvas=function(t,e,i){return null==e&&(e=null),null==i&&(i=null),this.image||this.parseImageData(),this.image.toCanvas(t,e,i)},t.prototype.toImage=function(){return this.image||this.parseImageData(),this.image.toImage()},t.prototype.toJSON=function(){var t,e,i,n,r,s,o,a,l;for(this.layerMask||this.parseLayersMasks(),n=["header","layerMask"],t={resources:[]},l=this.resources,r=0,o=l.length;o>r;r++)e=l[r],t.resources.push(e.toJSON());for(s=0,a=n.length;a>s;s++)i=n[s],t[i]=this[i].toJSON();return t},t}(),i.PSDColor=o=function(){function t(){}return t.hexToRGB=function(t){var e,i,n;return"#"===t.charAt(0)&&(t=t.substr(1)),n=parseInt(t.substr(0,2),16),i=parseInt(t.substr(2,2),16),e=parseInt(t.substr(4,2),16),{r:n,g:i,b:e}},t.rgbToHex=function(t){var e;return 1===arguments.length?e=/rgba?\((\d+), (\d+), (\d+)/.exec(t):(e=Array.prototype.slice.call(arguments),e.unshift(0)),e?"#"+(e[1]<<16|e[2]<<8|e[3]).toString(16):t},t.rgbToHSL=function(t,e,i){var n,r,s,o,a,l;return t/=255,e/=255,i/=255,o=Math.max(t,e,i),a=Math.min(t,e,i),s=(o+a)/2,o===a?r=l=0:(n=o-a,l=s>.5?n/(2-o-a):n/(o+a),r=function(){switch(o){case t:return(e-i)/n+(i>e?6:0);case e:return(i-t)/n+2;case i:return(t-e)/n+4}}(),r/=6),{h:z.round(r,3),s:z.round(l,3),l:z.round(s,3)}},t.hslToRGB=function(t,e,i){var n,r,s,o,a;return 0===e?a=r=n=i:(o=.5>i?i*(1+e):i+e-i*e,s=2*i-o,a=this.hueToRGB(s,o,t+1/3),r=this.hueToRGB(s,o,t),n=this.hueToRGB(s,o,t-1/3)),a*=255,r*=255,n*=255,{r:Math.round(a),g:Math.round(r),b:Math.round(n)}},t.hueToRGB=function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t},t.rgbToHSV=function(t,e,i){var n,r,s,o,a,l;return t/=255,e/=255,i/=255,s=Math.max(t,e,i),o=Math.min(t,e,i),l=s,n=s-o,a=0===s?0:n/s,s===o?r=0:(r=function(){switch(s){case t:return(e-i)/n+(i>e?6:0);case e:return(i-t)/n+2;case i:return(t-e)/n+4}}(),r/=6),{h:r,s:a,v:l}},t.hsvToRGB=function(t,e,i){var n,r,s,o,a,l,h,u;switch(o=Math.floor(6*t),r=6*t-o,a=i*(1-e),l=i*(1-r*e),u=i*(1-(1-r)*e),o%6){case 0:h=i,s=u,n=a;break;case 1:h=l,s=i,n=a;break;case 2:h=a,s=i,n=u;break;case 3:h=a,s=l,n=i;break;case 4:h=u,s=a,n=i;break;case 5:h=i,s=a,n=l}return z.clamp({r:255*h,g:255*s,b:255*n},0,255)},t.rgbToXYZ=function(t,e,i){var n,r,s;return t/=255,e/=255,i/=255,t>.04045?t=Math.pow((t+.055)/1.055,2.4):t/=12.92,e>.04045?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,n=.4124*t+.3576*e+.1805*i,r=.2126*t+.7152*e+.0722*i,s=.0193*t+.1192*e+.9505*i,{x:100*n,y:100*r,z:100*s}},t.xyzToRGB=function(t,e,i){var n,r,s;return t/=100,e/=100,i/=100,s=3.2406*t+-1.5372*e+-.4986*i,r=-.9689*t+1.8758*e+.0415*i,n=.0557*t+-.204*e+1.057*i,s>.0031308?s=1.055*Math.pow(s,.4166666667)-.055:s*=12.92,r>.0031308?r=1.055*Math.pow(r,.4166666667)-.055:r*=12.92,n>.0031308?n=1.055*Math.pow(n,.4166666667)-.055:n*=12.92,z.clamp({r:255*s,g:255*r,b:255*n},0,255)},t.xyzToLab=function(t,e,i){var n,r,s,o,a,l;return o=95.047,a=100,l=108.883,t/=o,e/=a,i/=l,t=t>.008856451679?Math.pow(t,.3333333333):7.787037037*t+.1379310345,e=e>.008856451679?Math.pow(e,.3333333333):7.787037037*e+.1379310345,i=i>.008856451679?Math.pow(i,.3333333333):7.787037037*i+.1379310345,s=116*e-16,n=500*(t-e),r=200*(e-i),{l:s,a:n,b:r}},t.labToXYZ=function(t,e,i){var n,r,s;return r=(t+16)/116,n=r+e/500,s=r-i/200,n=Math.pow(n,3)>.008856?Math.pow(n,3):(n-16/116)/7.787,r=Math.pow(r,3)>.008856?Math.pow(r,3):(r-16/116)/7.787,s=Math.pow(s,3)>.008856?Math.pow(s,3):(s-16/116)/7.787,{x:95.047*n,y:100*r,z:108.883*s}},t.labToRGB=function(t,e,i){var n;return n=this.labToXYZ(t,e,i),z.clamp(this.xyzToRGB(n.x,n.y,n.z),0,255)},t.cmykToRGB=function(t,e,i,n){var r,s,o;return o=65535-(t*(255-n)+(n<<8))>>8,s=65535-(e*(255-n)+(n<<8))>>8,r=65535-(i*(255-n)+(n<<8))>>8,z.clamp({r:o,g:s,b:r},0,255)},t.rgbToColor=function(t,e,i){return this.argbToColor(255,t,e,i)},t.argbToColor=function(t,e,i,n){return alpha<<24|e<<16|i<<8|n},t.hsbToColor=function(t,e,i){return this.ahsbToColor(255,t,e,i)},t.ahsbToColor=function(t,e,i,n){var r,s,o,a,l;return 0===i?r=s=l=255*n:(a=.5>=n?n*(1+i):n+i-n*i,o=2*n-a,l=this.hueToColor(e+120,o,a),s=this.hueToColor(e,o,a),r=this.hueToColor(e-120,o,a)),this.argbToColor(t,l,s,r)},t.hueToColor=function(t,e,i){var n;return t%=360,n=60>t?e+(i-e)*t/60:180>t?i:240>t?e+(i-e)*(240-t)/60:e,255*n},t.cmykToColor=function(t,e,i,n){var r,s,o;return o=1-255*(t*(1-n)+n),s=1-255*(e*(1-n)+n),r=1-255*(i*(1-n)+n),o=z.clamp(o,0,255),s=z.clamp(s,0,255),r=z.clamp(r,0,255),this.rgbToColor(o,s,r)},t.labToColor=function(t,e,i){return this.alabToColor(255,t,e,i)},t.alabToColor=function(t,e,i,n){var r;return r=this.labToXYZ(e,i,n),this.axyzToColor(t,r.x,r.y,r.z)},t.axyzToColor=function(t,e,i,n){var r;return r=this.xyzToRGB(e,i,n),this.argbToColor(t,r.r,r.g,r.b)},t.colorSpaceToARGB=function(t,e){var i;switch(t){case 0:i=this.rgbToColor(e[0],e[1],e[2]);break;case 1:i=this.hsbToColor(e[0],e[1]/100,e[2]/100);break;case 2:i=this.cmykToColor(e[0]/100,e[1]/100,e[2]/100,e[3]/100);break;case 7:i=this.labToColor(e[0],e[1],e[2]);break;default:i=16777215}return i},t}(),h=function(){function t(t){this.file=t}return t.prototype.parse=function(){var t,i,n,r,s;for(e.debug("Parsing descriptor..."),t={},t["class"]=this.parseClass(),r=this.file.readInt(),e.debug("Descriptor contains "+r+" items"),i=s=0;r>=0?r>s:s>r;i=r>=0?++s:--s)n=this.parseKeyItem(),t[n.id]=n.value;return t},t.prototype.parseID=function(){var t;return t=this.file.readInt(),0===t?this.file.readInt():this.file.readString(t)},t.prototype.parseClass=function(){return{name:this.file.readUnicodeString(),id:this.parseID()}},t.prototype.parseKeyItem=function(){var t,e;return t=this.parseID(),e=this.parseItem(t),{id:t,value:e}},t.prototype.parseItem=function(t,i){var n;return null==i&&(i=null),i||(i=this.file.readString(4)),e.debug("Found descriptor type: "+i),n=function(){switch(i){case"bool":return this.parseBoolean();case"type":case"GlbC":return this.parseClass();case"Objc":case"GlbO":return this.parse();case"doub":return this.parseDouble();case"enum":return this.parseEnum();case"alis":return this.parseAlias();case"Pth ":return this.parseFilePath();case"long":return this.parseInteger();case"comp":return this.parseLargeInteger();case"VlLs":return this.parseList();case"ObAr":return this.parseObjectArray();case"tdta":return this.parseRawData();case"obj ":return this.parseReference();case"TEXT":return this.file.readUnicodeString();case"UntF":return this.parseUnitDouble()}}.call(this)},t.prototype.parseBoolean=function(){return this.file.readBoolean()},t.prototype.parseDouble=function(){return this.file.readDouble()},t.prototype.parseInteger=function(){return this.file.readInt()},t.prototype.parseLargeInteger=function(){return this.file.readLongLong()},t.prototype.parseIdentifier=function(){return this.file.readInt()},t.prototype.parseIndex=function(){return this.file.readInt()},t.prototype.parseOffset=function(){return this.file.readInt()},t.prototype.parseProperty=function(){return this.parseID()},t.prototype.parseEnum=function(){return this.parseID(),this.parseID()},t.prototype.parseAlias=function(){var t;return t=this.file.readInt(),this.file.read(t)},t.prototype.parseFilePath=function(){var t,e,i,n,r,s,o;return e=this.file.readInt(),o=this.file.readf("<4s2i"),s=o[0],r=o[1],i=o[2],t=2*i,n=this.file.read(t),{sig:s,path:n}},t.prototype.parseList=function(){var t,e,i,n;for(i=this.file.readInt(),e=[],t=n=0;i>=0?i>n:n>i;t=i>=0?++n:--n)e.push(this.parseItem());return e},t.prototype.parseObjectArray=function(){var t,e,i,n,r,s,o,a,l;for(s=this.file.readInt(),r=this.parseClass(),i=this.file.readInt(),o=[],t=a=0;s>=0?s>a:a>s;t=s>=0?++a:--a){for(e=[],n=l=0;i>=0?i>l:l>i;n=i>=0?++l:--l)e.push(this.parseObjectArray());o.push(e)}return o},t.prototype.parseObjectArray=function(){var t,e,i,n,r,s,o;for(e=this.parseID(),n=this.file.readString(4),r=this.file.readString(),i=this.file.readInt(),s=[],t=o=0;i>=0?i>o:o>i;t=i>=0?++o:--o)s.push(this.file.readDouble());return s},t.prototype.parseRawData=function(){var t;return t=this.file.readInt(),this.file.read(t)},t.prototype.parseReference=function(){var t,e,i;return t=this.file.readString(4),e=this.parseClass(),i=function(){switch(t){case"Clss":return null;case"Enmr":return this.parseEnum();case"Idnt":return this.parseIdentifier();case"indx":return this.parseIndex();case"name":return this.file.readUnicodeString();case"rele":return this.parseOffset();case"prop":return this.parseProperty()}}.call(this)},t.prototype.parseUnitDouble=function(){var t,e,i;return e=this.file.readString(4),t=function(){switch(e){case"#Ang":return"Angle";case"#Rsl":return"Density";case"#Rlt":return"Distance";case"#Nne":return"None";case"#Prc":return"Percent";case"#Pxl":return"Pixels";case"#Mlm":return"Millimeters";case"#Pnt":return"Points"}}(),i=this.file.readDouble(),{id:e,unit:t,value:i}},t}(),f=function(){function t(t){this.data=t,this.pos=0}return t.prototype.unicodeRegex=/\\u([\d\w]{4})/gi,t.prototype.tell=function(){return this.pos},t.prototype.read=function(t){var e,i,n;for(n=[],e=i=0;t>=0?t>i:i>t;e=t>=0?++i:--i)n.push(this.data[this.pos++]);return n},t.prototype.seek=function(t,e){return null==e&&(e=!0),e?this.pos+=t:this.pos=t},t.prototype.readInt=function(){var t;return t=this.readUInt(),t>=2147483648?t-4294967296:t},t.prototype.readUInt=function(){var t,e,i,n;return t=this.read(1)[0]<<24,e=this.read(1)[0]<<16,i=this.read(1)[0]<<8,n=this.read(1)[0],t|e|i|n},t.prototype.readShortInt=function(){var t;return t=this.readShortUInt(),t>=32768?t-65536:t},t.prototype.readShortUInt=function(){var t,e;return t=this.read(1)[0]<<8,e=this.read(1)[0],t|e},t.prototype.readLongInt=function(){return this.readf(">l")[0]},t.prototype.readLongUInt=function(){return this.readf(">L")[0]},t.prototype.readDouble=function(){return this.readf(">d")[0]},t.prototype.readBoolean=function(){return 0!==this.read(1)[0]},t.prototype.readLongLong=function(){return this.read(8)},t.prototype.readULongLong=function(){return this.read(8)},t.prototype.readString=function(t){var e;return e=String.fromCharCode.apply(null,this.read(t)),e.replace(/\u0000/g,"")},t.prototype.readUnicodeString=function(){var t,e;return t=2*this.readInt(),e=this.readf(">"+t+"s")[0],e=e.replace(this.unicodeRegex,function(t,e){return String.fromCharCode(parseInt(e,16))}),e.replace(/\u0000/g,"")},t.prototype.readLengthWithString=function(t){var e,i;return null==t&&(t=4),e=this.read(1)[0],i=this.readString(0===e?t:e)},t.prototype.readBytesList=function(t){return this.read(t)},t.prototype.readSpaceColor=function(){var t,e,i,n;for(e=this.readShortInt(),t=[],i=n=0;4>n;i=++n)t.push(this.readShortInt()>>8);return o.colorSpaceToARGB(e,t)},t.prototype.readf=function(t){return N.Unpack(t,this.read(N.CalcLength(t)))},t.prototype.skipBlock=function(t){var i;return null==t&&(t="unknown"),i=this.readf(">L")[0],i&&this.seek(i),e.debug("Skipped "+t+" with "+i+" bytes")},t}(),m=function(){function t(t){this.file=t}var e,i;return e=["sig","version","r0","r1","r2","r3","r4","r5","channels","rows","cols","depth","mode"],i={0:"Bitmap",1:"GrayScale",2:"IndexedColor",3:"RGBColor",4:"CMYKColor",5:"HSLColor",6:"HSBColor",7:"Multichannel",8:"Duotone",9:"LabColor",10:"Gray16",11:"RGB48",12:"Lab48",13:"CMYK64",14:"DeepMultichannel",15:"Duotone16"},t.prototype.parse=function(){var t,n,r,s,o;for(t=this.file.readf(">4sH 6B HLLHH"),r=0,s=e.length;s>r;r++)n=e[r],this[n]=t.shift();if(this.size=[this.rows,this.cols],"8BPS"!==this.sig)throw"Not a PSD signature: "+this.header.sig;if(1!==this.version)throw"Can not handle PSD version "+this.header.version;return this.modename=0<=(o=this.mode)&&16>o?i[this.mode]:"("+this.mode+")",this.colormodepos=this.file.pos,this.file.skipBlock("color mode data")},t.prototype.toJSON=function(){var t,i,n,r;for(t={},n=0,r=e.length;r>n;n++)i=e[n],t[i]=this[i];return t.modename=this.modename,t},t}(),y=function(){function t(t,e){this.file=t,this.header=e,this.numPixels=this.getImageWidth()*this.getImageHeight(),16===this.getImageDepth()&&(this.numPixels*=2),this.calculateLength(),this.channelData=new Uint8Array(this.length),this.startPos=this.file.tell(),this.endPos=this.startPos+this.length,this.pixelData=[]}var i;return i={0:"Raw",1:"RLE",2:"ZIP",3:"ZIPPrediction"},t.prototype.channelsInfo=[{id:0},{id:1},{id:2},{id:-1}],t.prototype.calculateLength=function(){return this.length=function(){switch(this.getImageDepth()){case 1:return(this.getImageWidth()+7)/8*this.getImageHeight();case 16:return this.getImageWidth()*this.getImageHeight()*2;default:return this.getImageWidth()*this.getImageHeight()}}.call(this),this.channelLength=this.length,this.length*=this.getImageChannels()},t.prototype.parse=function(){var t;return this.compression=this.parseCompression(),e.debug("Image size: "+this.length+" ("+this.getImageWidth()+"x"+this.getImageHeight()+")"),2===(t=this.compression)||3===t?(e.debug("ZIP compression not implemented yet, skipping."),this.file.seek(this.endPos,!1)):this.parseImageData()},t.prototype.skip=function(){return e.debug("Skipping image data"),this.file.seek(this.length)},t.prototype.parseCompression=function(){return this.file.readShortInt()},t.prototype.parseImageData=function(){switch(e.debug("Image compression: id="+this.compression+", name="+i[this.compression]),this.compression){case 0:this.parseRaw();break;case 1:this.parseRLE();break;case 2:case 3:this.parseZip();break;default:return e.debug("Unknown image compression. Attempting to skip."),this.file.seek(this.endPos,!1)}return this.processImageData()},t.prototype.parseRaw=function(t){var i,n;for(null==t&&(t=this.length),e.debug("Attempting to parse RAW encoded image..."),i=n=0;t>=0?t>n:n>t;i=t>=0?++n:--n)this.channelData[i]=this.file.read(1)[0];return!0},t.prototype.parseRLE=function(){return e.debug("Attempting to parse RLE encoded image..."),this.byteCounts=this.getByteCounts(),e.debug("Read byte counts. Current pos = "+this.file.tell()+", Pixels = "+this.length),this.parseChannelData()},t.prototype.getImageHeight=function(){return this.header.rows},t.prototype.getImageWidth=function(){return this.header.cols},t.prototype.getImageChannels=function(){return this.header.channels},t.prototype.getImageDepth=function(){return this.header.depth},t.prototype.getByteCounts=function(){var t,e,i,n,r,s,o;for(t=[],e=n=0,s=this.getImageChannels();s>=0?s>n:n>s;e=s>=0?++n:--n)for(i=r=0,o=this.getImageHeight();o>=0?o>r:r>o;i=o>=0?++r:--r)t.push(this.file.readShortInt());return t},t.prototype.parseChannelData=function(){var t,i,n,r,s,o;for(t=0,n=0,i=r=0,s=this.getImageChannels();s>=0?s>r:r>s;i=s>=0?++r:--r)e.debug("Parsing channel #"+i+", Start = "+this.file.tell()),o=this.decodeRLEChannel(t,n),t=o[0],n=o[1];return!0},t.prototype.decodeRLEChannel=function(t,e){var i,n,r,s,o,a,l,h,u,c,d,p,f,g,m,v;for(s=c=0,g=this.getImageHeight();g>=0?g>c:c>g;s=g>=0?++c:--c)for(i=this.byteCounts[e++],l=this.file.tell();this.file.tell()<l+i;)if(a=this.file.read(1)[0],128>a){for(a++,n=this.file.read(a),r=0,o=d=t,m=t+a;m>=t?m>d:d>m;o=m>=t?++d:--d)this.channelData[o]=n[r++];t+=a}else if(a>128){for(a^=255,a+=2,h=this.file.read(1)[0],n=[],u=p=0;a>=0?a>p:p>a;u=a>=0?++p:--p)n.push(h);for(r=0,o=f=t,v=t+a;v>=t?v>f:f>v;o=v>=t?++f:--f)this.channelData[o]=n[r++];t+=a}return[t,e]},t.prototype.parseZip=function(t){return null==t&&(t=!1),this.file.seek(this.endPos,!1)},t.prototype.processImageData=function(){switch(e.debug("Processing parsed image data. "+this.channelData.length+" pixels read."),this.header.mode){case 1:8===this.getImageDepth()&&this.combineGreyscale8Channel(),16===this.getImageDepth()&&this.combineGreyscale16Channel();break;case 3:8===this.getImageDepth()&&this.combineRGB8Channel(),16===this.getImageDepth()&&this.combineRGB16Channel();break;case 4:8===this.getImageDepth()&&this.combineCMYK8Channel(),16===this.getImageDepth()&&this.combineCMYK16Channel();break;case 7:this.combineMultiChannel8();break;case 9:8===this.getImageDepth()&&this.combineLAB8Channel(),16===this.getImageDepth()&&this.combineLAB16Channel()}return delete this.channelData},t.prototype.getAlphaValue=function(t){return null==t&&(t=255),null!=this.layer&&(t*=this.layer.blendMode.opacity/255),t},t.prototype.combineGreyscale8Channel=function(){var t,e,i,n,r,s,o,a,l;if(2===this.getImageChannels()){for(a=[],i=n=0,s=this.numPixels;s>=0?s>n:n>s;i=s>=0?++n:--n)t=this.channelData[i],e=this.channelData[this.channelLength+i],a.push(this.pixelData.push(e,e,e,this.getAlphaValue(t)));return a}for(l=[],i=r=0,o=this.numPixels;o>=0?o>r:r>o;i=o>=0?++r:--r)l.push(this.pixelData.push(this.channelData[i],this.channelData[i],this.channelData[i],this.getAlphaValue()));return l},t.prototype.combineGreyscale16Channel=function(){var t,e,i,n,r,s,o,a,l,h;if(2===this.getImageChannels()){for(l=[],i=r=0,o=this.numPixels;o>r;i=r+=2)t=z.toUInt16(this.channelData[i+1],this.channelData[i]),e=z.toUInt16(this.channelData[this.channelLength+i+1],this.channelData[this.channelLength+i]),l.push(this.pixelData.push(e,e,e,this.getAlphaValue(t)));return l}for(h=[],i=s=0,a=this.numPixels;a>s;i=s+=2)n=z.toUInt16(this.channelData[i+1],this.channelData[i]),h.push(this.pixelData.push(n,n,n,this.getAlphaValue()));return h},t.prototype.combineRGB8Channel=function(){var t,e,i,n,r,s,o,a,l,h;for(h=[],e=r=0,a=this.numPixels;a>=0?a>r:r>a;e=a>=0?++r:--r){for(i=0,n={r:0,g:0,b:0,a:255},l=this.channelsInfo,s=0,o=l.length;o>s;s++){switch(t=l[s],t.id){case-1:if(4!==this.getImageChannels())continue;n.a=this.channelData[e+this.channelLength*i];break;case 0:n.r=this.channelData[e+this.channelLength*i];break;case 1:n.g=this.channelData[e+this.channelLength*i];break;case 2:n.b=this.channelData[e+this.channelLength*i]}i++}h.push(this.pixelData.push(n.r,n.g,n.b,this.getAlphaValue(n.a)))}return h},t.prototype.combineRGB16Channel=function(){var t,e,i,n,r,s,o,a,l,h,u,c;for(c=[],n=o=0,h=this.numPixels;h>o;n=o+=2){for(r=0,s={r:0,g:0,b:0,a:255},u=this.channelsInfo,a=0,l=u.length;l>a;a++){switch(i=u[a],t=this.channelData[n+this.channelLength*r+1],e=this.channelData[n+this.channelLength*r],i.id){case-1:if(4!==this.getImageChannels())continue;s.a=z.toUInt16(t,e);break;case 0:s.r=z.toUInt16(t,e);break;case 1:s.g=z.toUInt16(t,e);break;case 2:s.b=z.toUInt16(t,e)}r++}c.push(this.pixelData.push(s.r,s.g,s.b,this.getAlphaValue(s.a)))}return c},t.prototype.combineCMYK8Channel=function(){var t,e,i,n,r,s,a,l,h,u;for(u=[],i=l=0,h=this.numPixels;h>=0?h>l:l>h;i=h>=0?++l:--l)5===this.getImageChannels()?(t=this.channelData[i],e=this.channelData[i+this.channelLength],r=this.channelData[i+2*this.channelLength],a=this.channelData[i+3*this.channelLength],n=this.channelData[i+4*this.channelLength]):(t=255,e=this.channelData[i],r=this.channelData[i+this.channelLength],a=this.channelData[i+2*this.channelLength],n=this.channelData[i+3*this.channelLength]),s=o.cmykToRGB(255-e,255-r,255-a,255-n),u.push(this.pixelData.push(s.r,s.g,s.b,this.getAlphaValue(t)));return u},t.prototype.combineCMYK16Channel=function(){var t,e,i,n,r,s,a,l,h,u;for(u=[],i=l=0,h=this.numPixels;h>l;i=l+=2)5===this.getImageChannels()?(t=this.channelData[i],e=this.channelData[i+this.channelLength],r=this.channelData[i+2*this.channelLength],a=this.channelData[i+3*this.channelLength],n=this.channelData[i+3*this.channelLength]):(t=255,e=this.channelData[i],r=this.channelData[i+this.channelLength],a=this.channelData[i+2*this.channelLength],n=this.channelData[i+3*this.channelLength]),s=o.cmykToRGB(255-e,255-r,255-a,255-n),u.push(this.pixelData.push(s.r,s.g,s.b,this.getAlphaValue(t)));return u},t.prototype.combineLAB8Channel=function(){var t,e,i,n,r,s,a,l,h;for(h=[],n=a=0,l=this.numPixels;l>=0?l>a:a>l;n=l>=0?++a:--a)4===this.getImageChannels()?(e=this.channelData[n],r=this.channelData[n+this.channelLength],t=this.channelData[n+2*this.channelLength],i=this.channelData[n+3*this.channelLength]):(e=255,r=this.channelData[n],t=this.channelData[n+this.channelLength],i=this.channelData[n+2*this.channelLength]),s=o.labToRGB(100*r>>8,t-128,i-128),h.push(this.pixelData.push(s.r,s.g,s.b,this.getAlphaValue(e)));
return h},t.prototype.combineLAB16Channel=function(){var t,e,i,n,r,s,a,l,h;for(h=[],n=a=0,l=this.numPixels;l>a;n=a+=2)4===this.getImageChannels()?(e=this.channelData[n],r=this.channelData[n+this.channelLength],t=this.channelData[n+2*this.channelLength],i=this.channelData[n+3*this.channelLength]):(e=255,r=this.channelData[n],t=this.channelData[n+this.channelLength],i=this.channelData[n+2*this.channelLength]),s=o.labToRGB(100*r>>8,t-128,i-128),h.push(this.pixelData.push(s.r,s.g,s.b,this.getAlphaValue(e)));return h},t.prototype.combineMultiChannel8=function(){var t,e,i,n,r,s,a,l,h;for(h=[],e=a=0,l=this.numPixels;l>=0?l>a:a>l;e=l>=0?++a:--a)t=this.channelData[e],n=this.channelData[e+this.channelLength],s=this.channelData[e+2*this.channelLength],i=4===this.getImageChannels()?this.channelData[e+3*this.channelLength]:255,r=o.cmykToRGB(255-t,255-n,255-s,255-i),h.push(this.pixelData.push(r.r,r.g,r.b,this.getAlphaValue(255)));return h},t.prototype.toCanvasPixels=function(){return this.pixelData},t.prototype.toFile=function(t,e){var i;return 0===this.toCanvasPixels().length?e():(i=this.getPng(),null===i?e():i.encode(function(i){return R.writeFile(t,i,e)}))},t.prototype.toFileSync=function(t){var e,i;return 0!==this.toCanvasPixels().length&&(i=this.getPng(),null!==i)?(e=i.encodeSync(),R.writeFileSync(t,e)):void 0},t.prototype.getPng=function(){var t,i,n,r,s,o;try{t=require("png").Png}catch(a){throw"Exporting PSDs to file requires the node-png library"}for(i=new Buffer(this.toCanvasPixels().length),r=this.toCanvasPixels(),n=s=0,o=r.length;o>s;n=s+=4)i[n]=r[n],i[n+1]=r[n+1],i[n+2]=r[n+2],i[n+3]=255-r[n+3];try{return new t(i,this.getImageWidth(),this.getImageHeight(),"rgba")}catch(a){return e.debug(a),null}},t.prototype.toCanvas=function(t,e,i){var n,r,s,o,a,l,h,u;if(null==e&&(e=this.getImageWidth()),null==i&&(i=this.getImageHeight()),null==e||null==i||0>=e||0>=i)throw"Layer does not contain image data";for(t.width=e,t.height=i,n=t.getContext("2d"),s=n.getImageData(0,0,t.width,t.height),o=s.data,u=this.toCanvasPixels(),r=l=0,h=u.length;h>l;r=++l)a=u[r],o[r]=a;return n.putImageData(s,0,0)},t.prototype.toImage=function(){var t;return t=document.createElement("canvas"),this.toCanvas(t),t.toDataURL("image/png")},t}(),s=function(t){function i(t,e,n){this.layer=n,this.width=this.layer.cols,this.height=this.layer.rows,this.channelsInfo=this.layer.channelsInfo,i.__super__.constructor.call(this,t,e)}return F(i,t),i.prototype.skip=function(){var t,i,n,r,s;for(e.debug("Skipping channel image data. Layer = "+this.layer.name),r=this.channelsInfo,s=[],i=0,n=r.length;n>i;i++)t=r[i],s.push(this.file.seek(t.length));return s},i.prototype.getImageWidth=function(){return this.width},i.prototype.getImageHeight=function(){return this.height},i.prototype.getImageChannels=function(){return this.layer.channels},i.prototype.getByteCounts=function(){var t,e,i,n;for(t=[],e=i=0,n=this.getImageHeight();n>=0?n>i:i>n;e=n>=0?++i:--i)t.push(this.file.readShortInt());return t},i.prototype.parse=function(){var t,i,n,r,s,o,a,l;for(e.debug("\nLayer: "+this.layer.name+", image size: "+this.length+" ("+this.getImageWidth()+"x"+this.getImageHeight()+")"),this.chanPos=0,i=a=0,l=this.getImageChannels();l>=0?l>a:a>l;i=l>=0?++a:--a)this.chInfo=this.layer.channelsInfo[i],this.chInfo.length<=0?this.parseCompression():(-2===this.chInfo.id?(this.width=this.layer.mask.width,this.height=this.layer.mask.height):(this.width=this.layer.cols,this.height=this.layer.rows),r=this.file.tell(),e.debug("Channel #"+this.chInfo.id+": length="+this.chInfo.length),this.parseImageData(),t=this.file.tell(),t!==r+this.chInfo.length&&(e.debug("ERROR: read incorrect number of bytes for channel #"+this.chInfo.id+". Layer="+this.layer.name+", Expected = "+(r+this.chInfo.length)+", Actual: "+t),this.file.seek(r+this.chInfo.length,!1)));return this.channelData.length!==this.length&&e.debug("ERROR: "+this.channelData.length+" read; expected "+this.length),this.processImageData(),"undefined"!=typeof exports&&null!==exports?(n=process.memoryUsage(),o=Math.round(n.heapUsed/1024/1024),s=Math.round(n.heapTotal/1024/1024),e.debug("\nMemory usage: "+o+"MB / "+s+"MB")):void 0},i.prototype.parseRaw=function(){var t,i,n,r,s,o;for(e.debug("Attempting to parse RAW encoded channel..."),t=this.file.read(this.chInfo.length-2),i=0,n=r=s=this.chanPos,o=this.chanPos+this.chInfo.length-2;o>=s?o>r:r>o;n=o>=s?++r:--r)this.channelData[n]=t[i++];return this.chanPos+=this.chInfo.length-2},i.prototype.parseImageData=function(){switch(this.compression=this.parseCompression(),this.compression){case 0:return this.parseRaw();case 1:return this.parseRLE();case 2:case 3:return this.parseZip();default:return e.debug("Unknown image compression. Attempting to skip."),this.file.seek(this.endPos,!1)}},i.prototype.parseChannelData=function(){var t,i;return t=0,e.debug("Parsing layer channel #"+this.chInfo.id+", Start = "+this.file.tell()),i=this.decodeRLEChannel(this.chanPos,t),this.chanPos=i[0],t=i[1],i},i}(y),b=function(){function t(t,e){this.file=t,this.header=null!=e?e:null,this.image=null,this.mask={},this.blendingRanges={},this.adjustments={},this.layerType="normal",this.blendingMode="normal",this.opacity=255,this.fillOpacity=255,this.isFolder=!1,this.isHidden=!1}var i,s,o,h,u,c;return o={"-2":"layer mask","-1":"A",0:"R",1:"G",2:"B",3:"RGB",4:"CMYK",5:"HSL",6:"HSB",9:"Lab",11:"RGB",12:"Lab",13:"CMYK"},c={0:"other",1:"open folder",2:"closed folder",3:"bounding section divider"},s={norm:"normal",dark:"darken",lite:"lighten",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity",mul:"multiply",scrn:"screen",diss:"dissolve",over:"overlay",hLit:"hard light",sLit:"soft light",diff:"difference",smud:"exclusion",div:"color dodge",idiv:"color burn",lbrn:"linear burn",lddg:"linear dodge",vLit:"vivid light",lLit:"linear light",pLit:"pin light",hMix:"hard mix"},i={0:"transparency protected",1:"visible",2:"obsolete",3:"bit 4 useful",4:"pixel data irrelevant"},h={0:"position relative",1:"layer mask disabled",2:"invert layer mask"},u=["Arial","Courier New","Georgia","Times New Roman","Verdana","Trebuchet MS","Lucida Sans","Tahoma"],t.prototype.parse=function(t){var i,n,r;return null==t&&(t=null),this.parseInfo(t),this.parseBlendModes(),i=this.file.readInt(),this.layerEnd=this.file.tell()+i,O(i>0),n=this.file.tell(),(r=this.parseMaskData())?(this.parseBlendingRanges(),this.parseLegacyLayerName(),this.parseExtraData(),null==this.name&&(this.name=this.legacyName),e.debug("Layer "+t+":",this),this.file.seek(n+i,!1)):(e.debug("Error parsing mask data for layer #"+t+". Skipping."),this.file.seek(this.layerEnd,!1))},t.prototype.parseInfo=function(t){var i,n,r,s,a,l,h,u,c;if(this.idx=t,a=this.file.readf(">iiiih"),this.top=a[0],this.left=a[1],this.bottom=a[2],this.right=a[3],this.channels=a[4],l=[this.bottom-this.top,this.right-this.left],this.rows=l[0],this.cols=l[1],O(this.channels>0),this.height=this.rows,this.width=this.cols,this.bottom<this.top||this.right<this.left||this.channels>64)return e.debug("Somethings not right, attempting to skip layer."),this.file.seek(6*this.channels+12),void this.file.skipBlock("layer info: extra data");for(this.channelsInfo=[],c=[],r=s=0,h=this.channels;h>=0?h>s:s>h;r=h>=0?++s:--s)u=this.file.readf(">hi"),i=u[0],n=u[1],e.debug("Channel "+r+": id="+i+", "+n+" bytes, type="+o[i]),c.push(this.channelsInfo.push({id:i,length:n}));return c},t.prototype.parseBlendModes=function(){var t,i,n;return this.blendMode={},n=this.file.readf(">4s4sBBBB"),this.blendMode.sig=n[0],this.blendMode.key=n[1],this.blendMode.opacity=n[2],this.blendMode.clipping=n[3],i=n[4],t=n[5],O("8BIM"===this.blendMode.sig),this.blendMode.key=this.blendMode.key.trim(),this.blendMode.opacityPercentage=100*this.blendMode.opacity/255,this.blendMode.blender=s[this.blendMode.key],this.blendMode.transparencyProtected=1&i,this.blendMode.visible=(2&i)>0,this.blendMode.visible=1-this.blendMode.visible,this.blendMode.obsolete=(4&i)>0,(8&i)>0&&(this.blendMode.pixelDataIrrelevant=(16&i)>0),this.blendingMode=this.blendMode.blender,this.opacity=this.blendMode.opacity,this.visible=this.blendMode.visible,e.debug("Blending mode:",this.blendMode)},t.prototype.parseMaskData=function(){var t,e,i,n,r;return this.mask.size=this.file.readInt(),O(36===(e=this.mask.size)||20===e||0===e),0===this.mask.size?!0:(i=this.file.readf(">llllBB"),this.mask.top=i[0],this.mask.left=i[1],this.mask.bottom=i[2],this.mask.right=i[3],this.mask.defaultColor=i[4],t=i[5],O(0===(n=this.mask.defaultColor)||255===n),this.mask.width=this.mask.right-this.mask.left,this.mask.height=this.mask.bottom-this.mask.top,this.mask.relative=1&t,this.mask.disabled=(2&t)>0,this.mask.invert=(4&t)>0,20===this.mask.size?this.file.seek(2):(r=this.file.readf(">BB"),t=r[0],this.mask.defaultColor=r[1],this.mask.relative=1&t,this.mask.disabled=(2&t)>0,this.mask.invert=(4&t)>0,this.file.seek(16)),!0)},t.prototype.parseBlendingRanges=function(){var t,e,i,n,r,s;for(e=this.file.readInt(),this.blendingRanges.grey={source:{black:this.file.readShortInt(),white:this.file.readShortInt()},dest:{black:this.file.readShortInt(),white:this.file.readShortInt()}},i=this.file.tell(),this.blendingRanges.numChannels=(e-8)/8,O(this.blendingRanges.numChannels>0),this.blendingRanges.channels=[],s=[],t=n=0,r=this.blendingRanges.numChannels;r>=0?r>n:n>r;t=r>=0?++n:--n)s.push(this.blendingRanges.channels.push({source:{black:this.file.readShortInt(),white:this.file.readShortInt()},dest:{black:this.file.readShortInt(),white:this.file.readShortInt()}}));return s},t.prototype.parseLegacyLayerName=function(){var t;return t=z.pad4(this.file.read(1)[0]),this.legacyName=z.decodeMacroman(this.file.read(t)).replace(/\u0000/g,"")},t.prototype.parseExtraData=function(){var t,i,s,o,h,u;for(u=[];this.file.tell()<this.layerEnd;){switch(h=this.file.readf(">4s4s"),o=h[0],t=h[1],O.equal(o,"8BIM"),i=z.pad2(this.file.readInt()),s=this.file.tell(),e.debug("Extra layer info: key = "+t+", length = "+i),t){case"SoCo":this.adjustments.solidColor=new D(this,i).parse();break;case"GdFl":this.adjustments.gradient=new g(this,i).parse();break;case"PtFl":this.adjustments.pattern=new C(this,i).parse();break;case"brit":this.adjustments.brightnessContrast=new r(this,i).parse();break;case"levl":this.adjustments.levels=new x(this,i).parse();break;case"curv":this.adjustments.curves=new l(this,i).parse();break;case"expA":this.adjustments.exposure=new p(this,i).parse();break;case"vibA":this.adjustments.vibrance=new A(this,i).parse();break;case"hue2":this.adjustments.hueSaturation=new v(this,i).parse();break;case"blnc":this.adjustments.colorBalance=new a(this,i).parse();break;case"blwh":this.adjustments.blackWhite=new n(this,i).parse();break;case"phfl":this.adjustments.photoFilter=new T(this,i).parse();break;case"thrs":this.adjustments.threshold=new E(this,i).parse();break;case"nvrt":this.adjustments.invert=new w(this,i).parse();break;case"post":this.adjustments.posterize=new $(this,i).parse();break;case"tySh":this.adjustments.typeTool=new P(this,i).parse(!0);break;case"TySh":this.adjustments.typeTool=new P(this,i).parse();break;case"luni":this.name=this.file.readUnicodeString(),this.file.seek(s+i,!1);break;case"lyid":this.layerId=this.file.readInt();break;case"lsct":this.readLayerSectionDivider();break;case"lrFX":this.adjustments.legacyEffects=new d(this,i).parseLegacy(),this.file.read(2);break;case"lfx2":this.adjustments.effects=new d(this,i).parse();break;case"selc":this.adjustments.selectiveColor=new L(this,i).parse();break;default:this.file.seek(i),e.debug("Skipping additional layer info with key "+t)}this.file.tell()!==s+i?(e.debug("Warning: additional layer info with key "+t+" - unexpected end. Position = "+this.file.tell()+", Expected = "+(s+i)),u.push(this.file.seek(s+i,!1))):u.push(void 0)}return u},t.prototype.readLayerSectionDivider=function(){var t;switch(t=this.file.readInt(),this.layerType=c[t],e.debug("Layer type:",this.layerType),t){case 1:case 2:return this.isFolder=!0;case 3:return this.isHidden=!0}},t.prototype.toJSON=function(){var t,e,i,n,r;for(i=["name","legacyName","top","left","bottom","right","channels","rows","cols","channelsInfo","mask","layerType","blendMode","adjustments","visible"],t={},n=0,r=i.length;r>n;n++)e=i[n],t[e]=this[e];return t},t}(),S=function(){function t(t,e,i){this.file=t,this.header=e,this.options=i,this.layers=[],this.mergedAlpha=!1,this.globalMask={},this.extras=[]}return t.prototype.skip=function(){return this.file.seek(this.file.readInt())},t.prototype.parse=function(){var t,i,n,r,o,a,l,h,u,c,d;if(o=this.file.readInt(),t=this.file.tell()+o,e.debug("Layer mask size is "+o),!(0>=o)){if(r=z.pad2(this.file.readInt()),a=this.file.tell(),r>0){if(this.numLayers=this.file.readShortInt(),this.numLayers<0&&(e.debug("Note: first alpha channel contains transparency data"),this.numLayers=Math.abs(this.numLayers),this.mergedAlpha=!0),this.numLayers*(18+6*this.header.channels)>r)throw"Unlikely number of "+this.numLayers+" layers for "+this.header.channels+" with "+r+" layer info size. Giving up.";for(e.debug("Found "+this.numLayers+" layer(s)"),i=l=0,c=this.numLayers;c>=0?c>l:l>c;i=c>=0?++l:--l)n=new b(this.file),n.parse(i),this.layers.push(n);for(d=this.layers,h=0,u=d.length;u>h;h++)n=d[h],n.isFolder||n.isHidden?this.file.seek(8):(n.image=new s(this.file,this.header,n),this.options.layerImages&&(this.options.onlyVisibleLayers&&n.visible||!this.options.onlyVisibleLayers)?n.image.parse():n.image.skip());this.layers.reverse(),this.groupLayers()}this.file.seek(a+r,!1),this.parseGlobalMask(),this.file.seek(t,!1)}},t.prototype.parseGlobalMask=function(){var t,i,n,r,s;if(n=this.file.readInt(),0!==n){for(r=this.file.tell(),t=this.file.tell()+n,e.debug("Global mask length: "+n),this.globalMask.overlayColorSpace=this.file.readShortInt(),this.globalMask.colorComponents=[],i=s=0;4>s;i=++s)this.globalMask.colorComponents.push(this.file.readShortInt()>>8);return this.globalMask.opacity=this.file.readShortInt(),this.globalMask.kind=this.file.read(1)[0],e.debug("Global mask:",this.globalMask),this.file.seek(t,!1)}},t.prototype.parseExtraInfo=function(t){var i,n,r,s,o;for(o=[];this.file.tell()<t;)s=this.file.readf(">4s4sI"),r=s[0],i=s[1],n=s[2],n=z.pad2(n),e.debug("Layer extra:",r,i,n),o.push(this.file.seek(n));return o},t.prototype.groupLayers=function(){var t,e,i,n,r,s;for(t=null,r=this.layers,s=[],i=0,n=r.length;n>i;i++)e=r[i],s.push(e.isFolder?t=e:e.isHidden?t=null:e.groupLayer=t);return s},t.prototype.toJSON=function(){var t,e,i,n,r;for(t={mergedAlpha:this.mergedAlpha,globalMask:this.globalMask,extraInfo:this.extras,numLayers:this.numLayers,layers:[]},r=this.layers,i=0,n=r.length;n>i;i++)e=r[i],t.layers.push(e.toJSON());return t},t}(),n=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){var t;return t=this.file.readInt(),O(16===t),new h(this.file).parse()},t}(),r=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file,this.data={}}return t.prototype.parse=function(){return this.data.brightness=this.file.getShortInt(),this.data.contrast=this.file.getShortInt(),this.data.meanValue=this.file.getShortInt(),this.data.labColor=this.file.getShortInt(),this.data},t}(),a=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file,this.data={cyanRed:[],magentaGreen:[],yellowBlue:[]}}return t.prototype.parse=function(){var t,e;for(t=e=0;3>e;t=++e)this.data.cyanRed.push(this.file.getShortInt()),this.data.magentaGreen.push(this.file.getShortInt()),this.data.yellowBlue.push(this.file.getShortInt());return this.data},t}(),l=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file,this.data={curve:[]}}return t.prototype.parse=function(){var t,e,i,n,r,s,o,a,l,h,u,c,d,p,f,g,m,v,y;for(a=this.file.tell(),this.file.seek(1),h=this.file.readShortInt(),O(1===h||4===h),l=this.file.readInt(),this.data.curveCount=0,i=u=0;32>u;i=++u)l&1<<i&&this.data.curveCount++;for(i=c=0,m=this.data.curveCount;m>=0?m>c:c>m;i=m>=0?++c:--c){for(t=0,r=d=0;32>d;r=++d)if(l&1<<r){if(t===i){this.data.curve[i]={channelIndex:r};break}t++}for(this.data.curve[i].pointCount=this.file.getShortInt(),O(this.data.curve[i].pointCount>=2),O(this.data.curve[i].pointCount<=19),r=p=0,v=this.data.curve[i].pointCount;v>=0?v>p:p>v;r=v>=0?++p:--p)this.data.curve[i].outputValue[r]=this.file.readShortInt(),this.data.curve[i].inputValue[r]=this.file.readShortInt(),O(this.data.curve[i].outputValue[r]>=0),O(this.data.curve[i].outputValue[r]<=255),O(this.data.curve[i].inputValue[r]>=0),O(this.data.curve[i].inputValue[r]<=255)}if(this.file.tell()-a<this.length-4)for(l=this.file.readString(4),O.equal(l,"Crv "),h=this.file.readShortInt(),O(4===h),e=this.file.readInt(),O.equal(e,this.data.curveCount),i=f=0,y=this.data.curveCount;y>=0?y>f:f>y;i=y>=0?++f:--f)for(this.data.curve[i].channelIndex=this.file.readShortInt(),o=this.file.readShortInt(),O(o===this.data.curve[i].pointCount),r=g=0;o>=0?o>g:g>o;r=o>=0?++g:--g)s=this.file.getShortInt(),n=this.file.getShortInt(),O.equal(s,this.data.curve[i].outputValue[r]),O.equal(n,this.data.curve[i].inputValue[r]);return this.data},t}(),p=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){var t;return t=this.file.parseInt(),O(1===t),{exposure:this.file.parseInt(),offset:this.file.parseInt(),gamma:this.file.parseInt()}},t}(),g=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){var t;return t=this.file.readInt(),O(16===t),new h(this.file).parse()},t}(),v=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){var t,e,i,n,r,s;for(i=this.file.getShortInt(),O(2===i),this.data.colorization=this.file.readBoolean(),this.file.seek(1),this.data.hue=this.file.getShortInt(),this.data.saturation=this.file.getShortInt(),this.data.lightness=this.file.getShortInt(),this.data.masterHue=this.file.getShortInt(),this.data.masterSaturation=this.file.getShortInt(),this.data.masterLightness=this.file.getShortInt(),this.data.rangeValues=[],this.data.settingValues=[],t=n=0;6>n;t=++n){for(this.data.rangeValues[t]=[],this.data.settingValues[t]=[],e=r=0;4>r;e=++r)this.data.rangeValues[t][e]=this.file.getShortInt();for(e=s=0;3>s;e=++s)this.data.settingValues[t][e]=this.file.getShortInt()}return this.data},t}(),w=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){return!0},t}(),d=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){var t,e;return t=this.file.readInt(),O(0===t),e=this.file.readInt(),O(16===e),new c(this.file).parse()},t.prototype.parseLegacy=function(){var t,i,n,r,s,o,a,l,h,c,d,p;for(r=[],d=this.file.readf(">HH"),c=d[0],t=d[1];t-->0;)p=this.file.readf(">4s4s"),a=p[0],h=p[1],l=this.file.readf(">i")[0],o=this.file.tell(),e.debug("Parsing effect layer with type "+h+" and size "+l),n=function(){switch(h){case"cmnS":return new k(this.file);case"dsdw":return new u(this.file);case"isdw":return new u(this.file,!0)}}.call(this),i=null!=n?n.parse():void 0,s=o+l-this.file.tell(),0!==s?(e.debug("Failed to parse effect layer with type "+h),this.file.seek(s)):"cmnS"!==h&&r.push(i);return{legacy:!0,effects:r}},t}(),c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return F(e,t),e.prototype.parseItem=function(t){var i,n;return n=this.file.readString(4),i=function(){switch(t){case"patternFill":return this.parseLayerPatternOverlay();default:return e.__super__.parseItem.call(this,t,n)}}.call(this)},e}(h),_=function(){function t(t){this.file=t}return t.prototype.parse=function(){var t;return t=this.file.readf(">i"),this.version=t[0],t},t.prototype.getSpaceColor=function(){return this.file.read(2),this.file.readf(">HHHH")},t}(),k=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return F(e,t),e.prototype.parse=function(){return e.__super__.parse.call(this),this.visible=this.file.readBoolean(),this.file.read(2),{visible:this.visible}},e}(_),u=function(t){function e(t,i){this.inner=null!=i?i:!1,e.__super__.constructor.call(this,t),this.blendMode="mul",this.color=this.nativeColor=[0,0,0,0],this.opacity=191,this.angle=120,this.useGlobalLight=!0,this.distance=5,this.spread=0,this.size=5,this.antiAliased=!1,this.knocksOut=!1}return F(e,t),e.prototype.parse=function(){var t,i,n,r,s;e.__super__.parse.call(this),r=this.file.readf(">hiii"),this.blur=r[0],this.intensity=r[1],this.angle=r[2],this.distance=r[3],this.file.read(2),this.color=this.getSpaceColor(),s=this.file.readf(">4s4s"),this.signature=s[0],this.blendMode=s[1],this.enabled=this.file.readBoolean(),this.useAngleInAllFX=this.file.readBoolean(),this.opacity=this.file.read(1)[0],2===this.version&&(this.nativeColor=this.getSpaceColor()),t={};for(i in this)B.call(this,i)&&(n=this[i],"file"!==i&&(t[i]=n));return t},e}(_),x=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file,this.data={records:[]}}return t.prototype.parse=function(){var t,e,i;return t=this.file.tell(),i=this.file.readShortInt(),O(1===i),this.parseLevelRecords(),this.file.tell()-t<this.length-4?(e=this.file.readf(">4s"),O.equal(e,"Lvls"),i=this.file.readShortInt(),O.equal(i,3),this.data.levelCount=this.file.readShortInt()-29,O(levelCount>=0),this.parseLevelRecords(levelCount),this.data):void 0},t.prototype.parseLevelRecords=function(t){var e,i,n,r,s;for(null==t&&(t=29),s=[],e=n=0;t>=0?t>n:n>t;e=t>=0?++n:--n)i={},r=this.file.readf(">hhhhh"),i.inputFloor=r[0],i.inputCeiling=r[1],i.outputFloor=r[2],i.outputCeiling=r[3],i.gamma=r[4],i.gamma/=100,27>e&&(O(i.inputFloor>=0&&i.inputFloor<=255),O(i.inputCeiling>=2&&i.inputCeiling<=255),O(i.outputFloor>=0&&i.outputFloor<=255),O(i.outputCeiling>=0&&i.outputCeiling<=255),O(i.gamma>=.1&&i.gamma<=9.99)),s.push(this.data.records.push(i));return s},t}(),C=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){var t;return t=this.file.parseInt(),O(16===t),new h(this.file).parse()},t}(),T=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){var t,e;return e=this.file.parseInt(),O(3===e),t={},t.color={x:this.file.readInt(),y:this.file.readInt(),z:this.file.readInt()},t.density=this.file.readInt(),t.preserveLuminosity=this.file.readBoolean(),t},t}(),$=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file,this.data={}}return t.prototype.parse=function(){return this.data.levels=this.file.readShortInt(),O(this.data.levels>=2&&this.data.levels<=255),this.file.seek(2),this.data},t}(),L=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file,this.data={cyanCorrection:[],magentaCorrection:[],yellowCorrection:[],blackCorrection:[]}}return t.prototype.parse=function(){var t,e,i;for(e=this.file.getShortInt(),O(1===e),this.data.correctionMethod=this.file.getShortInt(),t=i=0;10>i;t=++i)this.data.cyanCorrection.push(this.file.getShortInt()),this.data.magentaCorrection.push(this.file.getShortInt()),this.data.yellowCorrection.push(this.file.getShortInt()),this.data.blackCorrection.push(this.file.getShortInt());return this.data},t}(),D=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){var t;return t=this.file.readInt(),O(16===t),new h(this.file).parse()},t}(),E=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file,this.data={}}return t.prototype.parse=function(){return this.data.level=this.file.readShortInt(),O(this.data.level>=1&&this.data.level<=255),this.file.seek(2),this.data},t}(),P=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file,this.data={}}return t.prototype.parse=function(t){var e,i,n,r,s,o,a,l,u,c,d;if(null==t&&(t=!1),s=this.file.readShortInt(),O(1===s),this.data.transformInfo={},u=this.file.readf(">6d"),this.data.transformInfo.xx=u[0],this.data.transformInfo.xy=u[1],this.data.transformInfo.yx=u[2],this.data.transformInfo.yy=u[3],this.data.transformInfo.tx=u[4],this.data.transformInfo.ty=u[5],t)return this.parseLegacy();for(r=this.file.readShortInt(),O(50===r),i=this.file.readInt(),O(16===i),this.data.text=new h(this.file).parse(),n="",c=this.data.text.EngineData,a=0,l=c.length;l>a;a++)e=c[a],n+=String.fromCharCode(e);return this.data.text.EngineData=n.replace(/\u0000/g,""),o=this.file.readShortInt(),O(1===o),i=this.file.readInt(),O(16===i),this.data.warp=new h(this.file).parse(),d=this.file.readf(">4d"),this.data.left=d[0],this.data.top=d[1],this.data.right=d[2],this.data.bottom=d[3],this.data},t.prototype.parseLegacy=function(){var t,e,i,n,r,s,o,a,l,h,u;for(i=this.file.readShortInt(),O(6===i),this.data.facesCount=this.file.readShortInt(),this.data.face=[],t=n=0,a=this.data.facesCount;a>=0?a>n:n>a;t=a>=0?++n:--n)for(this.data.face[t]={},this.data.face[t].mark=this.file.readShortInt(),this.data.face[t].fontType=this.file.readInt(),this.data.face[t].fontName=this.file.readLengthWithString(),this.data.face[t].fontFamilyName=this.file.readLengthWithString(),this.data.face[t].fontStyleName=this.file.readLengthWithString(),this.data.face[t].script=this.file.readShortInt(),this.data.face[t].numberAxesVector=this.file.readInt(),this.data.face[t].vector=[],e=r=0,l=this.data.face[t].numberAxesVector;l>=0?l>r:r>l;e=l>=0?++r:--r)this.data.face[t].vector[e]=this.file.readInt();for(this.data.stylesCount=this.file.readShortInt(),this.data.style=[],t=s=0,h=this.data.stylesCount;h>=0?h>s:s>h;t=h>=0?++s:--s)this.data.style[t]={},this.data.style[t].mark=this.file.readShortInt(),this.data.style[t].faceMark=this.file.readShortInt(),this.data.style[t].size=this.file.readInt(),this.data.style[t].tracking=this.file.readInt(),this.data.style[t].kerning=this.file.readInt(),this.data.style[t].leading=this.file.readInt(),this.data.style[t].baseShift=this.file.readInt(),this.data.style[t].autoKern=this.file.readBoolean(),this.file.read(1),this.data.style[t].rotate=this.file.readBoolean();for(this.data.type=this.file.readShortInt(),this.data.scalingFactor=this.file.readInt(),this.data.sharacterCount=this.file.readInt(),this.data.horzPlace=this.file.readInt(),this.data.vertPlace=this.file.readInt(),this.data.selectStart=this.file.readInt(),this.data.selectEnd=this.file.readInt(),this.data.linesCount=this.file.readShortInt(),this.data.line=[],t=o=0,u=this.data.linesCount;u>=0?u>o:o>u;t=u>=0?++o:--o)this.data.line[t].charCount=this.file.readInt(),this.data.line[t].orientation=this.file.readShortInt(),this.data.line[t].alignment=this.file.readShortInt(),this.data.line[t].actualChar=this.file.readShortInt(),this.data.line[t].style=this.file.readShortInt();return this.data.color=this.file.readSpaceColor(),this.data.antialias=this.file.readBoolean(),this.data},t}(),A=function(){function t(t,e){this.layer=t,this.length=e,this.file=this.layer.file}return t.prototype.parse=function(){var t;return t=this.file.readInt(),O(16===t),new h(this.file).parse()},t}(),I=function(){function t(t){this.file=t}var i;return i={1e3:{name:"PS2.0 mode data",parse:function(){var t;return t=this.file.readf(">5H"),this.channels=t[0],this.rows=t[1],this.cols=t[2],this.depth=t[3],this.mode=t[4],t}},1001:{name:"Macintosh print record"},1003:{name:"PS2.0 indexed color table"},1005:{name:"ResolutionInfo"},1006:{name:"Names of the alpha channels"},1007:{name:"DisplayInfo"},1008:{name:"Caption",parse:function(){return this.caption=this.file.readLengthWithString()}},1009:{name:"Border information",parse:function(){var t,e;return e=this.file.readf(">fH"),this.width=e[0],t=e[1],this.units=function(){switch(t){case 1:return"inches";case 2:return"cm";case 3:return"points";case 4:return"picas";case 5:return"columns"}}()}},1010:{name:"Background color"},1011:{name:"Print flags",parse:function(){var t,e;return t=this.file.tell(),e=this.file.readf(">9B"),this.labels=e[0],this.cropMarks=e[1],this.colorBars=e[2],this.registrationMarks=e[3],this.negative=e[4],this.flip=e[5],this.interpolate=e[6],this.caption=e[7],this.file.seek(t+this.size,!1)}},1012:{name:"Grayscale/multichannel halftoning info"},1013:{name:"Color halftoning info"},1014:{name:"Duotone halftoning info"},1015:{name:"Grayscale/multichannel transfer function"},1016:{name:"Color transfer functions"},1017:{name:"Duotone transfer functions"},1018:{name:"Duotone image info"},1019:{name:"B&W values for the dot range",parse:function(){var t;return t=this.file.readf(">H"),this.bwvalues=t[0],t}},1021:{name:"EPS options"},1022:{name:"Quick Mask info",parse:function(){var t;return t=this.file.readf(">HB"),this.quickMaskChannelID=t[0],this.wasMaskEmpty=t[1],t}},1024:{name:"Layer state info",parse:function(){var t;return t=this.file.readf(">H"),this.targetLayer=t[0],t}},1025:{name:"Working path"},1026:{name:"Layers group info",parse:function(){var t,e,i;for(e=this.file.tell(),this.layerGroupInfo=[],i=[];this.file.tell()<e+this.size;)t=this.file.readf(">H")[0],i.push(this.layerGroupInfo.push(t));return i}},1028:{name:"IPTC-NAA record (File Info)"},1029:{name:"Image mode for raw format files"},1030:{name:"JPEG quality"},1032:{name:"Grid and guides info"},1033:{name:"Thumbnail resource"},1034:{name:"Copyright flag",parse:function(){var t;return t=this.file.readf(">"+this.size+"B"),this.copyrighted=t[0],t}},1035:{name:"URL",parse:function(){var t;return t=this.file.readf(">"+this.size+"s"),this.url=t[0],t}},1036:{name:"Thumbnail resource"},1037:{name:"Global Angle"},1038:{name:"Color samplers resource"},1039:{name:"ICC Profile"},1040:{name:"Watermark",parse:function(){var t;return t=this.file.readf(">B"),this.watermarked=t[0],t}},1041:{name:"ICC Untagged"},1042:{name:"Effects visible",parse:function(){var t;return t=this.file.readf(">B"),this.showEffects=t[0],t}},1043:{name:"Spot Halftone",parse:function(){return[this.halftoneVersion,length](this.file.readf(">LL")),this.halftoneData=this.file.read(length)}},1044:{name:"Document specific IDs seed number",parse:function(){var t;return t=this.file.readf(">L"),this.docIdSeedNumber=t[0],t}},1045:{name:"Unicode Alpha Names"},1046:{name:"Indexed Color Table Count",parse:function(){var t;return t=this.file.readf(">H"),this.indexedColorCount=t[0],t}},1047:{name:"Transparent Index",parse:function(){var t;return t=this.file.readf(">H"),this.transparencyIndex=t[0],t}},1049:{name:"Global Altitude",parse:function(){var t;return t=this.file.readf(">L"),this.globalAltitude=t[0],t}},1050:{name:"Slices"},1051:{name:"Workflow URL",parse:function(){return this.workflowName=this.file.readLengthWithString()}},1052:{name:"Jump To XPEP",parse:function(){var t,e,i,n,r,s;for(r=this.file.readf(">HHL"),this.majorVersion=r[0],this.minorVersion=r[1],e=r[2],this.xpepBlocks=[],s=[],i=n=0;e>=0?e>n:n>e;i=e>=0?++n:--n)t={size:this.file.readf(">L"),key:this.file.readf(">4s")},"jtDd"===t.key?t.dirty=this.file.readBoolean():t.modDate=this.file.readf(">L"),s.push(this.xpepBlocks.push(t));return s}},1053:{name:"Alpha Identifiers"},1054:{name:"URL List"},1057:{name:"Version Info"},1058:{name:"EXIF data 1"},1059:{name:"EXIF data 3"},1060:{name:"XMP metadata"},1061:{name:"Caption digest"},1062:{name:"Print scale"},1064:{name:"Pixel Aspect Ratio"},1065:{name:"Layer Comps"},1066:{name:"Alternate Duotone Colors"},1067:{name:"Alternate Spot Colors"},1069:{name:"Layer Selection ID(s)"},1070:{name:"HDR Toning information"},1071:{name:"Print info"},1072:{name:"Layer Groups Enabled"},1073:{name:"Color samplers resource"},1074:{name:"Measurement Scale"},1075:{name:"Timeline Information"},1076:{name:"Sheet Disclosure"},1077:{name:"DisplayInfo"},1078:{name:"Onion Skins"},1080:{name:"Count Information"},1082:{name:"Print Information"},1083:{name:"Print Style"},1084:{name:"Macintosh NSPrintInfo"},1085:{name:"Windows DEVMODE"},2999:{name:"Name of clipping path"},7e3:{name:"Image Ready variables"},7001:{name:"Image Ready data sets"},8e3:{name:"Lightroom workflow",parse:t.isLightroom=!0},1e4:{name:"Print flags info",parse:function(){var t,e;return e=this.file.readf(">HBBLH"),this.version=e[0],this.centerCropMarks=e[1],t=e[2],this.bleedWidth=e[3],this.bleedWidthScale=e[4],e}}},t.prototype.parse=function(){var t,n,r,s,o;return this.at=this.file.tell(),r=this.file.readf(">4s H B"),this.type=r[0],this.id=r[1],this.namelen=r[2],e.debug("Resource #"+this.id+": type="+this.type),t=z.pad2(this.namelen+1)-1,this.name=this.file.readf(">"+t+"s")[0],this.name=this.name.substr(0,this.name.length-1),this.shortName=this.name.substr(0,20),this.size=this.file.readInt(),this.size=z.pad2(this.size),2e3<=(s=this.id)&&2998>=s?(this.rdesc="[Path Information]",this.file.seek(this.size)):2999===this.id?O(0):4e3<=(o=this.id)&&5e3>o?(this.rdesc="[Plug-in Resource]",this.file.seek(this.size)):null!=i[this.id]?(n=i[this.id],this.rdesc="["+n.name+"]",null!=n.parse?n.parse.call(this):this.file.seek(this.size)):this.file.seek(this.size)
},t.prototype.toJSON=function(){var t,e,i,n,r;for(i=["type","id","name","rdesc"],t={},n=0,r=i.length;r>n;n++)e=i[n],t[e]=this[e];return t},t}(),z=function(){function t(){}return t.pad2=function(t){return 2*Math.floor((t+1)/2)},t.pad4=function(t){return t-t%4+3},t.toUInt16=function(t,e){return t<<8|e},t.toInt16=function(t,e){var i;return i=this.toUInt16(t,e),i>=32768?i-65536:i},t.round=function(t,e){var i;return null==e&&(e=2),0===e?Math.round(t):(i=Math.pow(10,e),Math.round(t*i)/i)},t.clamp=function(t,e,i){var n,r,s,o;if(null==e&&(e=Number.MIN_VALUE),null==i&&(i=Number.MAX_VALUE),"object"==typeof t&&null!=t.length)for(n=s=0,o=t.length;o>s;n=++s)r=t[n],t[n]=Math.max(Math.min(r,i),e);else if("object"==typeof t)for(n in t)B.call(t,n)&&(r=t[n],t[n]=Math.max(Math.min(r,i),e));else t=Math.max(Math.min(t,i),e);return t},t.decodeMacroman=function(){var t;return t="\xc4\xc5\xc7\xc9\xd1\xd6\xdc\xe1\n\xe0\xe2\xe4\xe3\xe5\xe7\xe9\xe8\n\xea\xeb\xed\xec\xee\xef\xf1\xf3\n\xf2\xf4\xf6\xf5\xfa\xf9\xfb\xfc\n\u2020\xb0\xa2\xa3\xa7\u2022\xb6\xdf\n\xae\xa9\u2122\xb4\xa8\u2260\xc6\xd8\n\u221e\xb1\u2264\u2265\xa5\xb5\u2202\u2211\n\u220f\u03c0\u222b\xaa\xba\u03a9\xe6\xf8\n\xbf\xa1\xac\u221a\u0192\u2248\u2206\xab\n\xbb\u2026\xa0\xc0\xc3\xd5\u0152\u0153\n\u2013\u2014\u201c\u201d\u2018\u2019\xf7\u25ca\n\xff\u0178\u2044\u20ac\u2039\u203a\ufb01\ufb02\n\u2021\xb7\u201a\u201e\u2030\xc2\xca\xc1\n\xcb\xc8\xcd\xce\xcf\xcc\xd3\xd4\n\uf8ff\xd2\xda\xdb\xd9\u0131\u02c6\u02dc\n\xaf\u02d8\u02d9\u02da\xb8\u02dd\u02db\u02c7".replace(/\n/g,""),function(e){var i,n,r;return n=function(){var n,s,o;for(o=[],r=n=0,s=e.length;s>n;r=++n)i=e[r],o.push(128>i?String.fromCharCode(i):t.charAt(i-128));return o}(),n.join("")}}(),t}(),e=function(){function t(){}return t.debug=t.log=function(){return this.output("log",arguments)},t.output=function(t,e){if("undefined"!=typeof exports&&null!==exports){if(i.DEBUG)return console[t].apply(null,e)}else if(i.DEBUG)return console[t]("[PSD]",e)},t}()}.call(this),function(){Backbone.Model.prototype.original_save=Backbone.Model.prototype.save,Backbone.Model.prototype.original_destroy=Backbone.Model.prototype.destroy,Backbone.Model.prototype.save=function(t,e,i){var n,r,s,o;return this._requestQueue||(this._requestQueue=[]),this._requestQueue.push({key:t,val:e,options:i}),n=this.attributes,null===t||"undefined"==typeof t||"object"==typeof t?(n=t,i=e):(n={})[t]=e,i||(i={}),!n||i&&i.wait||this.set(n,i)?(this._saveCalled=!0,this._requestQueue.length>1?!1:(o=i.success,s=i.error,r=function(t){return function(){var e,i;return i=_.last(t._requestQueue),e=t._requestQueue.length,t._requestQueue=[],e>1?t.save(i.key,i.val,i.options):void 0}}(this),i.success=function(t,e,i){return o&&o(t,e,i),r()},i.error=function(t,e,i){return s&&s(t,e,i),r()},(null===t||"undefined"==typeof t||"object"==typeof t)&&(e=i),this.original_save(t,e,i))):!1},Backbone.Model.prototype.destroy=function(t){return!this.get("id")&&this._saveCalled?this.on("change:id",function(e){return function(){return e.get("id")?e.original_destroy(t):void 0}}(this)):this.original_destroy(t)}}.call(this),function(){var t,e;e=[],t=Backbone.sync,Backbone.sync=function(i,n,r){var s,o,a;return a=r.success,o=r.error,s=function(){return function(){var t;return e.length>0?(t=e.shift(),t.object[t.method].apply(t.object,t.args)):void 0}}(this),r.success=function(){return function(t){return a&&a(t),s()}}(this),r.error=function(){return function(t){return o&&o(t),s()}}(this),t(i,n,r)},Backbone.enqueueRequest=function(){return function(t,i,n){return e.push({object:t,method:i,args:n})}}(this)}.call(this),SnapWait=function(t,e){return this.element=t,this.currentFrame=0,this.timer=!1,this.options=$.extend({frames:". o O @ *".split(" "),timeout:120},e),this.txt=function(t){return"undefined"==typeof t?this.element[this.element.is("input")?"val":"text"]():this.element[this.element.is("input")?"val":"text"](t)},this.originalText=this.txt(),this.step=function(){thisFrame=this.options.frames[this.currentFrame++%this.options.frames.length],this.txt(thisFrame)},this.isWaiting=function(){return!!this.timer},this.wait=function(){return this.timer?!1:(this.step(),this.timer=setInterval($.proxy(this.step,this),this.options.timeout),!0)},this.stopWaiting=function(){return this.timer?(this.currentFrame=0,clearTimeout(this.timer),this.timer=!1,this.txt(this.originalText),!0):!1},this},function(){window.flinto={},window.p=function(){return console&&console.log?console.log.apply(console,arguments):void 0},flinto.keys={DELETE:8,TAB:9,ENTER:13,SHIFT:16,ESC:27,SPACE:32,UP:38,DOWN:40,LEFT:37,RIGHT:39},flinto.reportFPM=function(){var t,e,i,n,r;for(t=FPM[0],e=n=1,r=FPM.length-1;r>=1?r>=n:n>=r;e=r>=1?++n:--n)i=FPM[e],p(i[0],i[1]-t[1]+"ms");return null},flinto.reportFPMWithAlert=function(){var t,e,i,n,r,s;for(t=FPM[0],n=[],e=r=1,s=FPM.length-1;s>=1?s>=r:r>=s;e=s>=1?++r:--r)i=FPM[e],n.push(i[0]+" "+(i[1]-t[1])+"ms");return alert(n.join("\n"))},flinto.markFPM=function(t){var e;return window.FPM?(e=(new Date).getTime(),FPM.push([t,e])):void 0},flinto.queryParameters=function(){var t,e,i,n,r,s,o,a;if(""===window.location.search)return{};for(n={},i=window.location.search.replace(/^\?/,"").split(/&/),s=0,o=i.length;o>s;s++)e=i[s],a=e.split("="),t=a[0],r=a[1],n[t]=r;return n},window.Zepto&&Zepto(function(){return function(t){return t.ajaxSettings.headers||(t.ajaxSettings.headers={}),t.ajaxSettings.headers["X-CSRF-TOKEN"]=t("meta[name='csrf-token']").attr("content")}}(this)),flinto.isMobileBrowser=function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},window.reorderLinkViews=function(t){var e,i,n,r,s,o,a,l,h,u;o=[];for(e in t)u=t[e],o.push(u);o.sort(function(t,e){return t.area()-e.area()}),o=o.reverse(),h=function(t,e){return t.$el.css("z-index",(parseInt(e.$el.css("z-index"))||0)+1)};for(i in o){r=o[i],a=r.rect();for(n in o)s=o[n],i!==n&&r.el&&s.el&&(l=s.rect(),a.contains(l)?h(s,r):a.intersects(l)&&(a.area()>l.area()?h(s,r):h(r,s)))}return!0},window.readCookie=function(t){var e,i,n,r,s,o,a;if(!document.cookie)return null;for(i=document.cookie.split(/;\s+/),s=0,o=i.length;o>s;s++)if(e=i[s],a=e.split("="),n=a[0],r=a[1],n===t)return decodeURIComponent(unescape(r));return null},window.setCookie=function(t,e,i,n){var r,s;return null==i&&(i=null),null==n&&(n=null),n||(r=new Date,n=new Date(r.getFullYear()+1,r.getMonth(),r.getDate())),s=i?"path="+i:"",document.cookie=t+"="+escape(e)+";expires="+n.toGMTString()+(";"+s)},window.clearCookie=function(t,e){var i,n;return null==e&&(e=null),i=new Date("1999-01-01T12:00:00"),n=e?"path="+e+";":"",document.cookie=t+("=;"+n+"expires=")+i.toGMTString()},window.clearAllCookies=function(){var t,e,i,n,r,s,o;for(e=document.cookie.split(";"),o=[],r=0,s=e.length;s>r;r++)t=e[r],i=t.indexOf("="),n=i>-1?t.substr(0,i):t,o.push(document.cookie=n+"=;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT");return o}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.jQuery&&(jQuery(function(){return jQuery.event.fixHooks.drop={props:["dataTransfer"]},jQuery.event.fixHooks.dragover={props:["dataTransfer"]}}),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),flinto.mobileBrowser=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},flinto.browserSupported=function(){var t,e,i,n,r,s;for(n=flinto_checkBrowserCapability(),t=["fileAPI","cors","transform","transition"],i=[],r=0,s=t.length;s>r;r++)e=t[r],n[e]||i.push(e);return i.length>0?(flinto.reportedError||(flinto.reportedError=!0,window.mixpanel&&mixpanel.track("Saw Unsupported Browser Message on Editor",{features:i.join(","),ua:navigator.userAgent,page:window.location.href}),p("This browser doesn't support the following features:",i)),!1):/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)?!1:!0},flinto.setupSnapWait=function(){return $("form").bind("submit",function(t){var e,i,n,r;return n=$(t.target).find("input[type=submit]"),n.hasClass("js-autodisable")?n.attr("disabled",!0):n.hasClass("js-snapwait")&&(r=new SnapWait(n,{frames:["\u25cf\u25cb\u25cb","\u25cb\u25cf\u25cb","\u25cb\u25cb\u25cf","\u25cb\u25cb\u25cb"]}),r.wait(),i=$(t.target).find("input, textarea, button, select"),e=$(document.body),e.data("snapwait",r),e.data("snapwait_disabled_form",i),setTimeout(function(){return function(){return i.attr("disabled","disabled")}}(this),10)),!0})},flinto.stopSnapWait=function(){var t,e,i;return t=$(document.body),null!=(e=t.data("snapwait"))&&e.stopWaiting(),null!=(i=t.data("snapwait_disabled_form"))?i.removeAttr("disabled"):void 0},flinto.Tabs=function(){function e(e,i){var n;this.options=null!=i?i:{},this.getPanes=t(this.getPanes,this),this.showHidePanes=t(this.showHidePanes,this),this.doInitialHiding=t(this.doInitialHiding,this),_.defaults(this.options,{activeClass:"active",tagName:"a",classPanes:!1}),this.tabs=$(e).find(""+this.options.tagName+"[href^=#]"),this.tabs.on("click",this.showHidePanes),this.doInitialHiding(),n=this.tabs.filter("."+this.options.activeClass).first(),0===n.size()&&this.tabs.first().addClass(this.options.activeClass),n.click()}return e.prototype.doInitialHiding=function(){return this.options.classPanes?this.tabs.each(function(){return function(t,e){var i,n,r;return i=$(e),r=$($(e).attr("href")),n="."+$(e).data("class"),r.find(n).hide()}}(this)):this.getPanes().hide()},e.prototype.showHidePanes=function(t){var e,i,n,r;return t.preventDefault(),this.tabs.removeClass(this.options.activeClass),n=$(t.target).closest(this.options.tagName),n.addClass(this.options.activeClass),r=$(n.attr("href")),this.options.classPanes?(null!=this.lastClass&&r.find(this.lastClass).hide(),e="."+n.data("class"),r.find(e).show(),this.lastClass=e):(i=this.getPanes(),i.hide(),r.show())},e.prototype.getPanes=function(){var t;return t=[],this.tabs.each(function(e,i){return t.push($(i).attr("href"))}),$(t.join(", "))},e}(),flinto.HoverDropMenu=function(){function e(e,i){this.hideMenu=t(this.hideMenu,this),this.showMenu=t(this.showMenu,this),this.setWidth=t(this.setWidth,this);var n;this.$el=$(e),n={trigger:this.$el.find("a").first(),target:this.$el.find("ul").first(),setPosition:$.noop},this.options=$.extend(n,i),this.options.trigger.add(this.options.target).on("mouseenter",function(t){return function(){return t.showMenu()}}(this)),this.options.trigger.add(this.options.target).on("mouseleave",function(t){return function(){return t.hideMenu(400)}}(this)),this.timer=null}return e.prototype.setWidth=function(){var t;return t=this.options.trigger.width(),150>t?void 0:this.options.target.width(t)},e.prototype.showMenu=function(){return this.setWidth(),this.options.setPosition(this.options.trigger,this.options.target),null!=this.timer&&clearTimeout(this.timer),this.options.target.show()},e.prototype.hideMenu=function(t){var e;return e=function(t){return function(){return t.options.target.hide()}}(this),this.timer=setTimeout(e,t)},e}(),flinto.ClickDropMenu=function(){function e(e){this.handleDocumentKeydown=t(this.handleDocumentKeydown,this),this.handleDocumentClick=t(this.handleDocumentClick,this),this.isVisible=t(this.isVisible,this),this.toggleMenu=t(this.toggleMenu,this),this.hideMenu=t(this.hideMenu,this),this.$el=$(e),$("body").on("click",this.handleDocumentClick),$("body").on("keydown",this.handleDocumentKeydown),$(document).on("page:change",this.hideMenu),this.$el.on("click",function(t){return function(e){var i;return i=$(e.target),i.closest("ul.sub").length?void 0:t.toggleMenu()}}(this))}return e.prototype.hideMenu=function(){return this.$el.removeClass("active")},e.prototype.toggleMenu=function(){return this.$el.toggleClass("active")},e.prototype.isVisible=function(){return this.$el.hasClass("active")},e.prototype.handleDocumentClick=function(t){var e;return this.isVisible()&&(e=$(t.target),!e.closest(this.$el).length)?this.toggleMenu():void 0},e.prototype.handleDocumentKeydown=function(t){return this.isVisible()&&t.which===fleditor.keys.ESC?this.toggleMenu():void 0},e}(),window.getURLParameter=function(t){var e;return e=RegExp(t+"=(.+?)(&|$)").exec(location.search),e?decodeURI(e[1]):null},window.dataURItoBlob=function(t){var e,i,n,r,s,o,a,l,h,u,c;for(e=";base64,",-1===t.indexOf(e)&&(l=t.split(","),r=l[0].split(":")[1],h=l[1],new Blob([h],{type:r})),l=t.split(e),r=l[0].split(":")[1],h=window.atob(l[1]),u=h.length,i=new ArrayBuffer(u),a=new Uint8Array(i),o=c=0;u>=0?u>=c:c>=u;o=u>=0?++c:--c)a[o]=h.charCodeAt(o);try{return new Blob([i],{type:r})}catch(d){return s=d,n=new WebKitBlobBuilder,n.append(a),n.getBlob()}},window.getFiles=function(t,e){var i;return null==e&&(e=!0),i=$("<input>").attr({type:"file"}).hide(),e&&i.attr("multiple","multiple"),i.appendTo($("body")),i.click(),i.change(function(){return function(n){var r;return r=n.target.files,e||(r=r[0]),t(r),i.remove()}}(this))},window.readFile=function(t,e){var i;return"undefined"!=typeof FileReader&&null!==FileReader&&/image/i.test(t.type)?(i=new FileReader,i.onload=function(){return function(t){return e(t,i)}}(this),i.readAsDataURL(t)):void 0},window.escapePlusSign=function(t){return t.replace(/\+/g,"%2B").replace(/\?/g,"%3F").replace(/\#/,"%23")},window.fakeCrop=function(t){var e,i,n,r,s,o,a,l,h;return t.css({overflow:"hidden"}),n=t.find("img"),n.css({marginLeft:"",marginTop:"",width:"",height:""}),r={width:n[0].width,height:n[0].height},i={width:t.width(),height:t.height()},r.ratio=r.width/r.height,i.ratio=i.width/i.height,r.ratio===i.ratio?n.width(i.width):(r.ratio<i.ratio?(l=["width","height","top"],e=l[0],a=l[1],o=l[2]):(h=["height","width","left"],e=h[0],a=h[1],o=h[2]),n[e](i[e]),s=(n[a]()-i[a])/-2,n.css("margin-"+o,""+s+"px")),n.show()},flinto.buildErrorMessages=function(t){var e,i,n,r;n=$("<ul>").addClass("errors");for(e in t)r=t[e],i="base"===e?r:""+e+" "+r,$("<li>").addClass("error").text(i).appendTo(n);return n},window.RGBColor=function(){function t(t,e,i){this.r=null!=t?t:null,this.g=null!=e?e:null,this.b=null!=i?i:null}return t.prototype.addColor=function(e){return new t(this.r+e.r,this.g+e.g,this.b+e.b)},t.prototype.subtractColor=function(e){return new t(this.r-e.r,this.g-e.g,this.b-e.b)},t.prototype.distanceFromColor=function(e){return new t(Math.abs(this.r-e.r),Math.abs(this.g-e.g),Math.abs(this.b-e.b))},t.prototype.divide=function(e){return new t(Math.round(this.r/e),Math.round(this.g/e),Math.round(this.b/e))},t.prototype.withinTolerance=function(t,e){var i,n,r,s;for(null==e&&(e=0),s=this.distanceFromColor(t).toArray(),n=0,r=s.length;r>n;n++)if(i=s[n],i>e)return!1;return!0},t.prototype.toArray=function(){return[this.r,this.g,this.b]},t.prototype.componentToHex=function(t){var e;return e=t.toString(16),1===e.length?"0"+e:e},t.prototype.toHex=function(){var t,e,i,n,r;for(e="#",r=this.toArray(),i=0,n=r.length;n>i;i++)t=r[i],e+=this.componentToHex(t);return e},t}(),flinto.StickyElement=function(){function e(e,i){this.element=e,this.options=null!=i?i:{},this.stick=t(this.stick,this),this.handleScroll=t(this.handleScroll,this),this.options=_.extend({offset:this.element.offset().top,onStick:$.noop,onPeel:$.noop,padding:0},this.options),this.options.offset-=this.options.padding,this.element.css({position:"relative"}),this.threshold=this.element.offset().top,this.diff=this.options.offset-this.threshold,this.threshold<$(window).scrollTop()&&this.stick($(window).scrollTop()),$(window).scroll($.proxy(this.handleScroll,this))}return e.prototype.resetStickyElement=function(){return this.handleScroll()},e.prototype.handleScroll=function(){return this.threshold<$(window).scrollTop()?this.stick():this.peel()},e.prototype.stick=function(){return"fixed"!==this.element.css("position")?(this.element.css({position:"fixed",top:0}),this.options.onStick(this.element)):void 0},e.prototype.peel=function(){return"fixed"===this.element.css("position")?(this.element.css({position:"relative"}),this.options.onPeel(this.element)):void 0},e}(),window.Flile=function(){function e(e,i){var n;this.$el=e,this.options=null!=i?i:{},this.handleDrop=t(this.handleDrop,this),this.handleDragLeave=t(this.handleDragLeave,this),this.handleDragOver=t(this.handleDragOver,this),this.handleDragEnter=t(this.handleDragEnter,this),this.outElement=t(this.outElement,this),this.overElement=t(this.overElement,this),this.outWindow=t(this.outWindow,this),this.overWindow=t(this.overWindow,this),this.chooseFiles=t(this.chooseFiles,this),this.unbind=t(this.unbind,this),this.bind=t(this.bind,this),n={click:!0,multiple:!0,hoverWindowClass:"over",hoverElementClass:"hover",handleFiles:$.noop,restrictDragDrop:function(){return!1},onDrop:$.noop,onChange:$.noop,mouseOverWindow:$.noop,mouseOverElement:$.noop,mouseOutWindow:$.noop,mouseOutElement:$.noop},this.options=_.extend(n,this.options),this.baseElement=$(window),this.bind(),this.dragCount=0,this.isOverWindow=this.isOverElement=!1}return e.prototype.bind=function(){return this.bound?void 0:(this.baseElement.on("dragenter",this.handleDragEnter).on("dragleave",this.handleDragLeave).on("dragover",this.handleDragOver).on("drop",this.handleDrop),this.options.click&&this.$el.on("click",this.chooseFiles),this.bound=!0)},e.prototype.unbind=function(){return this.bound?(this.baseElement.off("dragenter",this.handleDragEnter).off("dragleave",this.handleDragLeave).off("dragover",this.handleDragOver).off("drop",this.handleDrop),this.options.click&&this.$el.off("click",this.chooseFiles),this.bound=!1):void 0},e.prototype.chooseFiles=function(){return getFiles(function(t){return function(e){var i;return t.options.handleFiles(e),i=!0,t.options.onChange(e,i)}}(this))},e.prototype.overWindow=function(t){return this.isOverWindow?void 0:(this.isOverWindow=!0,this.$el.addClass(this.options.hoverWindowClass),this.options.mouseOverWindow(t))},e.prototype.outWindow=function(t){return this.isOverWindow?(this.isOverWindow=!1,this.$el.removeClass(this.options.hoverWindowClass),this.options.mouseOutWindow(t)):void 0},e.prototype.overElement=function(t){return this.isOverElement?void 0:(this.isOverElement=!0,this.$el.addClass(this.options.hoverElementClass),this.options.mouseOverElement(t))},e.prototype.outElement=function(t){return this.isOverElement?(this.isOverElement=!1,this.$el.removeClass(this.options.hoverElementClass),this.options.mouseOutElement(t)):void 0},e.prototype.handleDragEnter=function(t){return this.options.restrictDragDrop()?void 0:(this.dragCount++,this.overWindow(t),$(t.target).closest(this.$el).length&&this.overElement(t),t.preventDefault(),t.stopPropagation())},e.prototype.handleDragOver=function(t){return!this.options.restrictDragDrop()&&(t.preventDefault(),t.stopPropagation(),$(t.target).closest(this.$el).length)?this.overElement(t):void 0},e.prototype.handleDragLeave=function(t){return!this.options.restrictDragDrop()&&(t.preventDefault(),t.stopPropagation(),this.dragCount--,0===this.dragCount&&this.outWindow(t),$(t.target).closest(this.$el).length)?this.outElement(t):void 0},e.prototype.handleDrop=function(t){var e,i;if(!this.options.restrictDragDrop()){t.preventDefault(),t.stopPropagation(),this.dragCount=0;try{$(t.target).closest(this.$el).length&&(this.options.handleFiles(t.dataTransfer.files),i=!1,this.options.onChange(t.dataTransfer.files,i))}catch(n){throw e=n}return this.options.onDrop(t),this.outElement(t),this.outWindow(t)}},e}(),window.dumpStackTrace=function(t){var e,i,n,r,s,o,a,l,h,u,c,d,p,f;e=[],l=!1;try{a.dont.exist+=0}catch(g){if(n=g,n.stack){for(u=n.stack.split("\n"),c=0,p=u.length;p>c;c++)h=u[c],e.push(h);e.shift(),l=!0}else if(window.opera&&n.message){for(u=n.message.split("\n"),a=d=0,f=u.length;f>=0?f>=d:d>=f;a=f>=0?++d:--d)u[a].match(/^\s*[A-Za-z0-9\-_\$]+\(/)&&(r=u[a],u[a+1]&&(r+=" at "+u[a+1],a++),e.push(r));e.shift(),l=!0}}if(!l)for(i=arguments.callee.caller;i;)s=i.toString(),o=s.substring(s.indexOf("function")+8,s.indexOf("("))||"anonymous",e.push(o),i=i.caller;return e.shift(),console.log(t?e.slice(0,t).join("\n"):e.join("\n"))}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.Point=function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.fromEvent=function(e){return new t(e.pageX,e.pageY)},t.fromElement=function(e,i){return null==i&&(i=!1),i?new t(e.position().left,e.position().top):new t(e.offset().left,e.offset().top)},t.fromArray=function(e){return new t(e[0],e[1])},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.offset=function(e,i){return new t(this.x+e,this.y+i)},t.prototype.offsetToElement=function(e){var i;return i=$(e).offset(),this.subtract(new t(i.left,i.top))},t.prototype.round=function(){return this.x=parseInt(Math.round(this.x),10),this.y=parseInt(Math.round(this.y),10),this},t.prototype.floor=function(){return this.x=parseInt(this.x),this.y=parseInt(this.y),this},t.prototype.distance=function(t){var e,i;return e=this.x-t.x,i=this.y-t.y,Math.sqrt(e*e+i*i)},t.prototype.min=function(e){return new t(Math.min(this.x,e.x),Math.min(this.y,e.y))},t.prototype.max=function(e){return new t(Math.max(this.x,e.x),Math.max(this.y,e.y))},t.prototype.multiply=function(e){return new t(this.x*e,this.y*e)},t.prototype.lerp=function(e,i){return new t(this.x+(e.x-this.x)*i,this.y+(e.y-this.y)*i)},t.prototype.constraintInElement=function(t){return this.x<t.offset().left&&(this.x=t.offset().left),this.y<t.offset().top&&(this.y=t.offset().top),this.x>t.offset().left+t.width()&&(this.x=t.offset().left+t.width()),this.y>t.offset().top+t.height()?this.y=t.offset().top+t.height():void 0},t.prototype.moveTo=function(t){return t.moveTo(this.origin.x,this.origin.y)},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},t}(),window.Size=function(){function t(t,e){this.width=null!=t?t:0,this.height=null!=e?e:0}return t.fromElement=function(e){return new t(e.outerWidth(),e.outerHeight())},t.prototype.equals=function(t){return this.width===t.width&&this.height===t.height},t.prototype.isZero=function(){return 0===this.width&&0===this.height},t.prototype.toString=function(){return"("+this.width+" x "+this.height+")"},t.prototype.round=function(){return this.width=parseInt(Math.round(this.width),10),this.height=parseInt(Math.round(this.height),10),this},t.prototype.floor=function(){return this.width=parseInt(this.width),this.height=parseInt(this.height),this},t}(),window.Rect=function(){function e(i,n){this.containment=t(this.containment,this),this.offset=t(this.offset,this),this.standardize=t(this.standardize,this),i instanceof e?(this.origin=new Point(i.origin.x,i.origin.y),this.size=new Size(i.size.width,i.size.height)):(this.origin=new Point(i.x,i.y),this.size=new Size(n.width,n.height))}return e.fromDimensions=function(t,i,n,r){return null==t&&(t={}),"object"==typeof t?new e(new Point(t.x,t.y),new Size(t.w,t.h)):new e(new Point(t,i),new Size(n,r))},e.fromElement=function(t,i,n){return null==i&&(i=!1),null==n&&(n=!1),e.fromDimensions(i?{x:t.position().left,y:t.position().top,w:t.outerWidth(n),h:t.outerHeight(n)}:{x:t.offset().left,y:t.offset().top,w:t.outerWidth(n),h:t.outerHeight(n)})},e.fromPoints=function(t,i){var n;return n=new e(t,new Size(i.x-t.x,i.y-t.y)),n.standardize(),n},e.prototype.round=function(){return this.origin.round(),this.size.round(),this},e.prototype.floor=function(){return this.origin.floor(),this.size.floor(),this},e.prototype.standardize=function(){return this.size.width<0&&(this.origin.x=this.origin.x+this.size.width,this.size.width=-this.size.width),this.size.height<0&&(this.origin.y=this.origin.y+this.size.height,this.size.height=-this.size.height),this},e.prototype.area=function(){return this.size.width*this.size.height},e.prototype.right=function(){return this.origin.x+this.size.width},e.prototype.bottom=function(){return this.origin.y+this.size.height},e.prototype.tl=function(){return new Point(this.origin.x,this.origin.y)},e.prototype.tr=function(){return new Point(this.origin.x+this.size.width,this.origin.y)},e.prototype.br=function(){return new Point(this.origin.x+this.size.width,this.origin.y+this.size.height)},e.prototype.bl=function(){return new Point(this.origin.x,this.origin.y+this.size.height)},e.prototype.intersects=function(t){return this.origin.x<t.br().x&&this.br().x>t.origin.x&&this.origin.y<t.br().y&&this.br().y>t.origin.y},e.prototype.equals=function(t){return this.origin.x===t.origin.x&&this.origin.y===t.origin.y&&this.size.width===t.size.width&&this.size.height===t.size.height},e.prototype.offset=function(t,i){var n;return n=new e(this),n.origin.x+=t,n.origin.y+=i,n},e.prototype.scale=function(t){var i;return i=new e(this),i.origin.x*=t,i.origin.y*=t,i.size.width*=t,i.size.height*=t,i},e.prototype.inset=function(t,i){var n;return n=new e(this),n.origin.x+=t,n.origin.y+=i,n.size.width-=2*t,n.size.height-=2*i,n},e.prototype.center=function(){return new Point(this.origin.x+this.size.width/2,this.origin.y+this.size.height/2)},e.prototype.contains=function(t){if(t instanceof e)return this.origin.x<=t.origin.x&&this.origin.y<=t.origin.y&&this.br().x>=t.br().x&&this.br().y>=t.br().y;if(t instanceof Point)return this.origin.x<=t.x&&this.origin.y<=t.y&&this.br().x>=t.x&&this.br().y>=t.y;throw new TypeError("Invalid argument")},e.prototype.anchorPoints=function(t){switch(t){case flinto.radian.top:return new Point(this.origin.x+this.size.width/2,this.origin.y);case flinto.radian.right:return new Point(this.origin.x+this.size.width,this.origin.y+this.size.height/2);case flinto.radian.bottom:return new Point(this.origin.x+this.size.width/2,this.origin.y+this.size.height);case flinto.radian.left:return new Point(this.origin.x,this.origin.y+this.size.height/2)}},e.prototype.closestEdge=function(t){var e,i,n,r,s;i=[Math.abs(t.x-(this.origin.x+this.size.width)),Math.abs(t.y-this.origin.y),Math.abs(t.x-this.origin.x),Math.abs(t.y-(this.origin.y+this.size.height))],r=Number.MAX_VALUE,e=null;for(n in i)s=i[n],r>s&&(r=s,e=n);return Math.PI*e/2},e.prototype.containment=function(t){var i,n,r;return r=new e(this),r.origin.x=Math.max(r.origin.x,t.origin.x),r.origin.y=Math.max(r.origin.y,t.origin.y),i=r.br(),n=t.br(),i.x>n.x&&(r.origin.x=n.x-r.size.width),i.y>n.y&&(r.origin.y=n.y-r.size.height),r},e.prototype.intersection=function(t){var i,n,r;return this.intersects(t)?(r=new e(this),r.origin.x<t.origin.x&&(r.size.width-=t.origin.x-r.origin.x,r.origin.x=t.origin.x),r.origin.y<t.origin.y&&(r.size.height-=t.origin.y-r.origin.y,r.origin.y=t.origin.y),i=this.br(),n=t.br(),i.x>n.x&&(r.size.width-=i.x-n.x),i.y>n.y&&(r.size.height-=i.y-n.y),r):null},e.prototype.intersectionWithLine=function(t,e){var i,n,r,s,o,a,l,h;return i=e.x-t.x,n=e.y-t.y,o=i>0?1:-1,a=n>0?1:-1,r=this.size.width/2*o,s=this.size.height/2*a,l=r,h=l/i*n,Math.abs(h)>Math.abs(s)&&(h=s,l=h/n*i),l+=t.x,h+=t.y,new Point(l,h)},e.prototype.draw=function(t){return t.rect(this.origin.x,this.origin.y,this.size.width,this.size.height)},e.prototype.fill=function(t){return t.fillRect(this.origin.x,this.origin.y,this.size.width,this.size.height)},e.prototype.clearRect=function(t){return t.clearRect(this.origin.x,this.origin.y,this.size.width,this.size.height)},e.prototype.toString=function(){return"("+this.origin.x+", "+this.origin.y+") - ("+this.size.width+" x "+this.size.height+")"},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};flinto.radian={right:0,top:Math.PI/2,left:Math.PI,bottom:3*Math.PI/2},window.Vector=function(){function t(t,e,i){i?(this.p1=t,this.r=e,this.v=i,this.p2=new Point(this.p1.x+Math.cos(this.r)*i,this.p1.y-Math.sin(this.r)*i)):(this.p1=t,this.p2=e)}return t.prototype.radian=function(){return this.r?this.r:(this._calcVandR(),this.r)},t.prototype.deg=function(){var t;return t=this.radian(),t*(180/Math.PI)},t.prototype.vector=function(){return this.v?this.v:(this._calcVandR(),this.v)},t.prototype._calcVandR=function(){return this.v=Math.sqrt(Math.pow(Math.abs(this.p1.x-this.p2.x),2)+Math.pow(Math.abs(this.p1.y-this.p2.y),2)),this.r=Math.atan2(this.p1.y-this.p2.y,this.p2.x-this.p1.x),this.r<0?this.r+=2*Math.PI:void 0},t}(),window.HiDPICanvasRatio=function(t){var e,i;return i=window.devicePixelRatio||1,e=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i/e},window.BezierPath=function(){function t(t,e,i,n){this.p1=null!=t?t:t,this.p2=null!=e?e:e,this.p3=null!=i?i:i,this.p4=null!=n?n:n}return t.prototype.v1=function(){return new window.Vector(this.p1,this.p2)},t.prototype.v2=function(){return new window.Vector(this.p4,this.p3)},t.prototype.partialPath=function(e,i){var n,r,s,o,a,l,h,u,c,d,p,f,g,m,v,y,w,b;return c=1-e,d=1-i,n=this.p1.x*c*c+2*this.p2.x*e*c+this.p3.x*e*e,r=this.p1.x*d*d+2*this.p2.x*i*d+this.p3.x*i*i,s=this.p2.x*c*c+2*this.p3.x*e*c+this.p4.x*e*e,o=this.p2.x*d*d+2*this.p3.x*i*d+this.p4.x*i*i,a=this.p1.y*c*c+2*this.p2.y*e*c+this.p3.y*e*e,l=this.p1.y*d*d+2*this.p2.y*i*d+this.p3.y*i*i,h=this.p2.y*c*c+2*this.p3.y*e*c+this.p4.y*e*e,u=this.p2.y*d*d+2*this.p3.y*i*d+this.p4.y*i*i,p=n*c+s*e,f=n*d+s*i,g=r*c+o*e,m=r*d+o*i,v=a*c+h*e,y=a*d+h*i,w=l*c+u*e,b=l*d+u*i,new t(new Point(p,v),new Point(f,y),new Point(g,w),new Point(m,b),0,1)},t.prototype.offset=function(e,i){return new t(this.p1.offset(e,i),this.p2.offset(e,i),this.p3.offset(e,i),this.p4.offset(e,i))},t.prototype.bezierPoint=function(t){var e,i,n;return n=1-t,e=n*n*n*this.p1.x+3*n*n*t*this.p2.x+3*n*t*t*this.p3.x+t*t*t*this.p4.x,i=n*n*n*this.p1.y+3*n*n*t*this.p2.y+3*n*t*t*this.p3.y+t*t*t*this.p4.y,new Point(e,i)},t.prototype.intersection=function(t,e){var i,n,r,s,o,a,l,h;for(o=e%Math.PI===0,r=function(t,e,i){var n;switch(i){case flinto.radian.right:n=t.origin.x+t.size.width-e.x;break;case flinto.radian.left:n=e.x-t.origin.x;break;case flinto.radian.top:n=e.y-t.origin.y;break;case flinto.radian.bottom:n=t.origin.y+t.size.height-e.y}return n>0?.5>n?o?e.y>t.origin.y&&e.y<t.origin.y+t.size.height?0:Number.MAX_VALUE:e.x>t.origin.x&&e.x<t.origin.x+t.size.width?0:Number.MAX_VALUE:1:-1},h=function(t){return function(e,i){var n,s,o,a;for(a=1,n=.5,s=t.bezierPoint(a),o=r(e,s,i);0!==o;){if(o===Number.MAX_VALUE)return null;if(o>0?a-=n:a+=n,n/=2,1e-6>n)return null;s=t.bezierPoint(a),o=r(e,s,i)}return{point:s,t:a}}}(this),e?(n=[e],o?(n.push(flinto.radian.top),n.push(flinto.radian.bottom)):(n.push(flinto.radian.left),n.push(flinto.radian.right))):n=_.values(flinto.radian),a=0,l=n.length;l>a;a++)if(i=n[a],s=h(t,i))return s;return null},t.prototype.draw=function(t){return t.moveTo(this.p1.x,this.p1.y),t.bezierCurveTo(this.p2.x,this.p2.y,this.p3.x,this.p3.y,this.p4.x,this.p4.y)},t}(),window.Graphics=function(){function t(){}return t.resize=function(t,e,i,n){var r,s,o;return o=t.naturalWidth,s=t.naturalHeight,0===i&&(i=n/s*o),0===n&&(n=i/o*s),e.width=i,e.height=n,r=e.getContext("2d"),r.drawImage(t,0,0,o,s,0,0,i,n),e.toDataURL()},t.resizeAndCrop=function(t,e,i,n,r,s){var o,a,l;return null==r&&(r=-1),null==s&&(s=-1),l=t.naturalWidth,a=t.naturalHeight,i/l*a>n?(r=0,-1===s?(s=(a-l/i*n)/2,a-=2*s):a-=a-l/i*n):(s=0,-1===r?(r=(l-a/n*i)/2,l-=2*r):l-=l-a/n*i),e.width=i,e.height=n,o=e.getContext("2d"),o.drawImage(t,r,s,l,a,0,0,i,n),e.toDataURL()},t}(),this.flanimation={},window.Animation=function(){function e(i,n){this.startAnimation=t(this.startAnimation,this),this.duration=n,this.key=i,this.startTime=0,this.abort=!1,this.rand=Date.now(),flanimation[i]&&e.abortAnimation(i),flanimation[i]=this}return e.prototype.startAnimation=function(t){var e;return t||(t=this.frame),e=function(i){return function(n){return 0===i.startTime&&(i.startTime=n,i.started&&i.started(i.startTime)),i.progress=n-i.startTime,n>i.startTime+i.duration||i.abort?(i.finish&&i.finish(!i.abort),void(flanimation[i.key]&&flanimation[i.key].rand===i.rand&&delete flanimation[i.key])):(t(i.progress,i.duration),i.frame_count=requestAnimationFrame(e)-i.start_frames)}}(this),this.frame_count=0,this.start_frames=requestAnimationFrame(e)},e.prototype.easeIn=function(t,e){var i,n;return i=Math.easeInCubic(this.progress,0,1,this.duration),n=e-t,t+n*i},e.prototype.easeOut=function(t,e){var i,n;return i=Math.easeOutCubic(this.progress,0,1,this.duration),n=e-t,t+n*i},e.prototype.easeInOut=function(t,e){var i,n;return i=Math.easeInOutCubic(this.progress,0,1,this.duration),n=e-t,t+n*i},e.isAnimating=function(t){return flanimation[t]},e.abortAnimation=function(t){return flanimation[t]?(flanimation[t].abort=!0,delete flanimation[t]):void 0},e}(),window.loadAndResizeImage=function(t,e,i){var n,r,s,o;return n=function(t){return t.size>fleditor.constants.MAX_IMAGE_SIZE},s=function(t,e){return t*e>=fleditor.constants.MAX_IMAGE_PIXEL
},o=function(){return function(t,e,i){var r,a,l,h,u,c,d;return r=$("<canvas>"),r.appendTo($("body")).hide(),n(e)?(d=parseInt(.75*t.naturalWidth),l=parseInt(.75*t.naturalHeight)):(d=t.naturalWidth,l=t.naturalHeight),s(d,l)&&(u=d*l/fleditor.constants.MAX_IMAGE_PIXEL,d=parseInt(d/Math.sqrt(u)),l=parseInt(l/Math.sqrt(u))),r[0].width=d,r[0].height=l,a=r[0].getContext("2d"),a.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,d,l),c=new Image,c.src=r[0].toDataURL(e.type),h=window.dataURItoBlob(c.src),p("resize from "+t.naturalWidth+"x"+t.naturalHeight+" to "+d+"x"+l+" (file size "+e.size+" to "+h.size+")"),$(c).imagesLoaded({done:function(){return h.size>fleditor.constants.MAX_IMAGE_SIZE?o(c,h,i):i.done(c,h)},fail:function(){return i.fail(c)}})}}(this),r=new Image,r.src=t,$(r).imagesLoaded({fail:function(){return function(){return i.fail(r)}}(this),done:function(){return function(){return n(e)||s(r.naturalWidth,r.naturalHeight)?o(r,e,i):void i.done(r,e)}}(this)})},Math.easeInCubic=function(t,e,i,n){return t/=n,i*t*t*t+e},Math.easeOutCubic=function(t,e,i,n){return t/=n,t--,i*(t*t*t+1)+e},Math.easeInOutCubic=function(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t+e:(t-=2,i/2*(t*t*t+2)+e)},function(t){return t.extend(t.fn,{setCoordinates:function(t){return this.css({left:parseInt(t.origin.x),top:parseInt(t.origin.y),width:parseInt(t.size.width),height:parseInt(t.size.height)})},setPosition:function(t){return this.css({left:t.x,top:t.y})},setSize:function(t){return this.width(t.width),this.height(t.width)}})}(window.Zepto||window.jQuery)}.call(this),function(){var t,e,i,n,r=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,o=function(t,e){function i(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};for(jQuery(function(){return flinto.selectableGroup={},flinto.mouseHandled=!1,$("body").mouseup(function(){return flinto.mouseHandled=!1,!0})}),flinto.Mouse=function(){function t(){this._mouseDistanceMet=r(this._mouseDistanceMet,this),this._mouseUp=r(this._mouseUp,this),this._mouseMove=r(this._mouseMove,this),this._mouseDown=r(this._mouseDown,this),this.element.bind("mousedown."+this.widgetName,this._mouseDown),_.defaults(this.options,{distance:0})}return t.prototype._mouseDown=function(t){return this.options.disabled?!0:1!==t.which?!0:this._mouseCapture(t)?(this.mouseStarted=!1,this.ui.moved=null,this.mouseDownEvent=t,this.mouseDragEvent=t,this.ui.startPosition=this.ui.position=Point.fromEvent(t),this._mouseDistanceMet(t)&&(this.mouseStarted=this._mouseStart(t),!this.mouseStarted)?(t.preventDefault(),!0):(flinto.mouseHandled=!0,$("body").bind("mouseup."+this.widgetName,this._mouseUp),$("body").bind("mousemove."+this.widgetName,this._mouseMove),t.preventDefault(),!0)):!0},t.prototype._mouseMove=function(t){return this.mouseStarted?(this._calcMovement(t),this._mouseDrag(t),t.preventDefault(),!0):(this._mouseDistanceMet(t)&&(this.mouseStarted=!0),this.mouseStarted&&(this._mouseStart(t)?(this._calcMovement(t),this._mouseDrag(t)):this._mouseUp(t)),t.preventDefault(),!this.mouseStarted)},t.prototype._mouseUp=function(t){return $("body").unbind("mouseup."+this.widgetName,this._mouseUp),$("body").unbind("mousemove."+this.widgetName,this._mouseMove),this._mouseStop(t),flinto.mouseHandled=!1,t.preventDefault(),!0},t.prototype._mouseDistanceMet=function(t){return this._distanceFromStart(t)>=this.options.distance},t.prototype._distanceFromStart=function(t){return Math.max(Math.abs(this.mouseDownEvent.pageX-t.pageX),Math.abs(this.mouseDownEvent.pageY-t.pageY))},t.prototype._calcMovement=function(t){return this.mouseDragEvent=t,this.ui.position=Point.fromEvent(t),this.ui.moved=this.ui.position.subtract(this.ui.startPosition)},t.prototype._mouseStart=function(){return!0},t.prototype._mouseDrag=function(){return!0},t.prototype._mouseStop=function(){return!0},t.prototype._mouseCapture=function(){return!0},t.prototype.option=function(t){return _.extend(this.options,t)},t}(),flinto.Widget=function(t){function e(){_.defaults(this.options,{disabled:!1}),e.__super__.constructor.apply(this,arguments),this.element.addClass("ui-"+this.widgetName),this.options.disabled&&this.element.addClass("disabled"),this.ui={}}return o(e,t),e.prototype.disable=function(){return this.options.disabled=!0,this.element.addClass("disabled")},e.prototype.enable=function(){return this.options.disabled=!1,this.element.removeClass("disabled")},e.prototype._trigger=function(t,e){return _.extend(this.ui,{element:this.element}),this.options[t]?this.options[t](e,this.ui):null},e}(flinto.Mouse),flinto.Resizable=function(t){function e(t,i){var n,r,s,o,a;for(this.element=null!=t?t:null,this.options=null!=i?i:{},_.defaults(this.options,{containment:null,minWidth:0,minHeight:0,maxWidth:Math.pow(2,32),maxHeight:Math.pow(2,32)}),this.widgetName="resizable",e.__super__.constructor.apply(this,arguments),s=["n","e","s","w","se","sw","ne","nw"],o=0,a=s.length;a>o;o++)r=s[o],n=$("<div class='ui-resizable-handle ui-resizable-"+r+"'/>"),this.element.append(n)}return o(e,t),e.prototype._mouseCapture=function(t){return $(t.target).hasClass("ui-resizable-handle")},e.prototype._mouseStart=function(t){var e;return this.handle=null,this.ui.resized=!1,e=new RegExp(/ui-resizable-(\w\w?)\s*$/),e.exec($(t.target).attr("class"))?(this.handle=RegExp.$1,this.r=Rect.fromElement(this.element,!0),this._trigger("start",t),!0):!1},e.prototype._mouseDrag=function(t){var e,i,n,r;return null===this.handle?!1:(this.ui.resized=!0,n=new Rect(this.r),r=function(t,e,i,n,r){return t.size[e]+i<n?t.size[e]=n:t.size[e]+i>r?t.size[e]=r:t.size[e]+=i},i=function(t,e,i,n,r,s){return r=parseInt(r),s=parseInt(s),t.size[e]-n<r?(t.origin[i]=t.origin[i]+t.size[e]-r,t.size[e]=r):t.size[e]-n>s?(t.origin[i]=t.origin[i]+t.size[e]-s,t.size[e]=s):(t.origin[i]+=n,t.size[e]-=n)},this.handle.match("s")&&r(n,"height",this.ui.moved.y,this.options.minHeight,this.options.maxHeight),this.handle.match("e")&&r(n,"width",this.ui.moved.x,this.options.minWidth,this.options.maxWidth),this.handle.match("n")&&i(n,"height","y",this.ui.moved.y,this.options.minHeight,this.options.maxHeight),this.handle.match("w")&&i(n,"width","x",this.ui.moved.x,this.options.minWidth,this.options.maxWidth),this.options.containment&&(e=Rect.fromElement(this.options.containment,!1),e.origin.x=0,e.origin.y=0,n=n.intersection(e)),this.element.setCoordinates(n),this._trigger("resize",t),!0)},e.prototype._mouseStop=function(t){return this._trigger("stop",t)},e}(flinto.Widget),flinto.Selectable=function(t){function e(t,i){this.element=null!=t?t:null,this.options=null!=i?i:{},_.defaults(this.options,{selectOnMouseDown:!1,groupName:!1}),this._selected=!1,this.widgetName||(this.widgetName="selectable"),this.options.groupName&&!flinto.selectableGroup[this.options.groupName]&&(flinto.selectableGroup[this.options.groupName]=[]),e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype._handleSelect=function(t,e){return null==e&&(e=!1),e===!1&&(e=t.shiftKey),this.options.groupName?e?this._selected?this._deselect(t,!0):this._select(t,!0):this._selected?this._trigger("clicked",t):(this._deselectAll(t),this._select(t,!0)):this._selected?e?this._deselect(t,!1):this._trigger("clicked",t):this._select(t,!1)},e.prototype._select=function(t,e){return this._selected=!0,this.element.addClass("selected"),this.ui.multiple=e,this._trigger("selected",t),e?flinto.selectableGroup[this.options.groupName]=_.compact(_.union(flinto.selectableGroup[this.options.groupName],this)):void 0},e.prototype._deselect=function(t){return this._selected=!1,this.element.removeClass("selected"),this._trigger("unselected",t),flinto.selectableGroup[this.options.groupName]=_.without(flinto.selectableGroup[this.options.groupName],this)},e.prototype._deselectAll=function(t){return _.each(flinto.selectableGroup[this.options.groupName],function(e){return e._deselect(t)}),flinto.selectableGroup[this.options.groupName]=[]},e.prototype._mouseCapture=function(){return this.element.addClass("active")},e.prototype._mouseStart=function(t){return this.options.selectOnMouseDown&&this._handleSelect(t),!0},e.prototype._mouseDrag=function(){return!0},e.prototype._mouseStop=function(t){return this.element.removeClass("active"),this.options.selectOnMouseDown||this.ui.moved||this._handleSelect(t),!0},e.prototype._broadcast=function(t){var e,i;return e=Array.prototype.slice.call(arguments),e.shift(),i=_.clone(flinto.selectableGroup[this.options.groupName]),_.each(i,function(i){return function(n){return n!==i?n[t].apply(n,e):void 0}}(this))},e.prototype.select=function(t,e){return null==e&&(e=!1),this._handleSelect(t,e)},e.prototype.deselect=function(t){return this._deselect(t,!1)},e.prototype.selected=function(){return this._selected},e.prototype.clicked=function(){return this.ui.clicked},e.prototype.deselectAll=function(t){return this._deselectAll(t)},e.prototype.broadcast=function(t){var e,i;return e=Array.prototype.slice.call(arguments),e.shift(),i=_.clone(flinto.selectableGroup[this.options.groupName]),_.each(i,function(i){return function(n){return n!==i?n.options[t].apply(n,e):void 0}}(this))},e}(flinto.Widget),flinto.Draggable=function(t){function e(t,i){this.element=null!=t?t:null,this.options=null!=i?i:{},this._mouseDrag=r(this._mouseDrag,this),_.defaults(this.options,{axis:null,containment:null,clone:!1}),this.widgetName="draggable",this.dragStarted=this.dragMoved=!1,this.originalElement=this.element,e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype._mouseCapture=function(t){return!$(t.target).hasClass("ui-resizable-handle")},e.prototype._mouseStart=function(t){return this._makeClone(t),this.dragStarted=!0,this.mouseStartRect=Rect.fromElement(this.element,!0),this.options.containment&&(this.containerRect=Rect.fromElement(this.options.containment,!0),this.containerRect.origin.x=this.containerRect.origin.y=0),0!==this.options.distance&&(this._selected||this._handleSelect(t)),this._broadcast("_makeClone",t),this._broadcast("_start",t,this.mouseStartRect.origin),this.ui.clicked=!0,this.ui.canceled=this.ui.paused=!1,this._trigger("start",t),e.__super__._mouseStart.apply(this,arguments)},e.prototype._mouseDrag=function(t){var i;return!this.dragStarted||this.ui.canceled||this.ui.paused?void 0:(this.dragMoved=!0,"y"===this.options.axis&&(this.ui.moved.x=0),"x"===this.options.axis&&(this.ui.moved.y=0),i=this.mouseStartRect.offset(this.ui.moved.x,this.ui.moved.y),this.options.containment&&(i=i.containment(this.containerRect)),this.element.setPosition(i.origin),this._trigger("drag",t),this._broadcast("_moveBy",t,i.origin,this.containerRect),e.__super__._mouseDrag.apply(this,arguments))},e.prototype._mouseStop=function(t){return this.dragStarted&&(this._broadcast("_stop",t),this._stop(t)),this.dragStarted=this.dragMoved=!1,this.ui.canceled=this.ui.paused=!1,e.__super__._mouseStop.apply(this,arguments)},e.prototype._makeClone=function(t){return t.altKey&&this.options.clone?(this.originalElement.removeClass("selected"),this.element=this.originalElement.clone(!0),this.element.addClass("selected").unbind().appendTo(this.originalElement.parent()),this.ui.cloning=this.element):(this.ui.cloning=null,this.options.helper?(this.element=this._trigger("helper"),this.element.css({top:this.originalElement.offset().top,left:this.originalElement.offset().left})):this.element=this.originalElement)},e.prototype._start=function(t,e){return this.ui.clicked=!1,this.dragStarted=!0,this.ui.startPosition=Point.fromEvent(t),this._trigger("start",t),this.startRect=Rect.fromElement(this.element,!0),this.mouseDownEvent=this.mouseDragEvent=t,this.distance=new Point(this.startRect.origin.x-e.x,this.startRect.origin.y-e.y)},e.prototype._moveBy=function(t,e,i){var n,r;return this.dragStarted?(this._calcMovement(t),n=e.offset(this.distance.x,this.distance.y),r=new Rect(n,this.startRect.size),i&&(r=r.containment(i)),this.element.setPosition(r.origin),this._trigger("drag",t)):void 0},e.prototype._stop=function(t){return this._trigger("stop",t),this.ui.cloning?(this._deselect(t,!0),this.element.remove(),this.element=this.originalElement):void 0},e.prototype.cancel=function(){return this.ui.canceled=!0},e.prototype.pause=function(t,e){return this.ui.paused=!!e},e}(flinto.Selectable),flinto.Slider=function(t){function e(t,i){var n;this.element=null!=t?t:null,this.options=null!=i?i:{},this._mouseDrag=r(this._mouseDrag,this),_.defaults(this.options,{axis:null,min:0,max:0,step:1,value:0}),this.widgetName="slider",this.dragStarted=this.dragMoved=!1,this.options.axis=this.element.width()>this.element.height()?"x":"y",e.__super__.constructor.apply(this,arguments),this.element.css({cursor:"pointer"}),this.handle=$("<div>").addClass("ui-slider-handle").appendTo(this.element),n=(this.options.value-this.options.min)/(this.options.max-this.options.min),this._setValue(null,n,null)}return o(e,t),e.prototype._mouseStart=function(t){return this.initialPosition=Point.fromElement(this.element,!0),this.width=this.element.width(),this.height=this.element.height(),this.dragStarted=!0,this._trigger("start",t),$(t.target).hasClass("ui-slider-handle")||this._calcValue(t,"change"),e.__super__._mouseStart.apply(this,arguments)},e.prototype._mouseDrag=function(t){return this.dragStarted?(this.dragMoved=!0,this._calcValue(t,"slide"),e.__super__._mouseDrag.apply(this,arguments)):void 0},e.prototype._mouseStop=function(t){return this.dragStarted&&(this._calcValue(t,"change"),this._trigger("stop",t)),this.dragStarted=this.dragMoved=!1,e.__super__._mouseStop.apply(this,arguments)},e.prototype._calcValue=function(t,e){var i;return"x"===this.options.axis&&(i=(t.pageX-this.initialPosition.x)/this.width),"y"===this.options.axis&&(i=(t.pageY-this.initialPosition.y)/this.height),this._setValue(t,i,e)},e.prototype._setValue=function(t,e,i){var n;return"x"===this.options.axis&&(n="left"),"y"===this.options.axis&&(n="top"),0>e&&(e=0),e>1&&(e=1),this.handle.css(n,""+100*e+"%"),this.ui.value=parseInt(this.options.min+e*(this.options.max-this.options.min)),i?this._trigger(i,t):void 0},e.prototype.value=function(t){var e;return e=(t-this.options.min)/(this.options.max-this.options.min),this._setValue(null,e,"change")},e.prototype.addValue=function(t){var e;return e=(this.ui.value+t-this.options.min)/(this.options.max-this.options.min),this._setValue(null,e,"change")},e}(flinto.Widget),flinto.Sortable=function(t){function e(t,i){this.element=null!=t?t:null,this.options=null!=i?i:{},this._scroll=r(this._scroll,this),this._mouseDrag=r(this._mouseDrag,this),_.defaults(this.options,{handle:null,item:null,scrollSensitivity:10}),this.widgetName="sortable",this.dragStarted=this.dragMoved=!1,e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype._mouseCapture=function(t){var e,i,n,r;for(i=this.element.find(this.options.handle),n=0,r=i.length;r>n;n++)if(e=i[n],e===t.target)return!0;return!1},e.prototype._mouseStart=function(t){for(this.dragStarted=!0,this.dragTarget=$(t.target);this.dragTarget.parent()[0]!==this.element[0];)this.dragTarget=this.dragTarget.parent();return this.mouseStartRect=Rect.fromElement(this.dragTarget,!1,!0),this.placeHolder=this.dragTarget.clone().insertBefore(this.dragTarget).css({opacity:0}),this.savedCSS={position:this.dragTarget.css("position"),margin:this.dragTarget.css("margin"),zIndex:this.dragTarget.css("z-index")},this.dragTarget.css({position:"absolute",zIndex:1e3,left:this.mouseStartRect.origin.x,top:this.mouseStartRect.origin.y,margin:0}),this._trigger("start",t),this.timer=setInterval(function(t){return function(){return t._scroll(!0)}}(this),10),e.__super__._mouseStart.apply(this,arguments)},e.prototype._mouseDrag=function(){var t,i,n,r,s,o,a,l,h,u,c,d,p;if(this.dragStarted){for(this.dragMoved=!0,a=this.mouseStartRect.offset(this.ui.moved.x,this.ui.moved.y),l=a.area()/2,this._prepareScroll(),u=!1,p=this.element.children(),s=c=0,d=p.length;d>c;s=++c)if(n=p[s],n!==this.placeHolder[0]&&n!==this.dragTarget[0]&&(n=$(n),h=Rect.fromElement(n,!1,!0),o=h.intersection(a),t=Math.min(l,h.area()/2),o&&o.area()>t)){n.next()[0]===this.placeHolder[0]?this.placeHolder.insertBefore(n):this.placeHolder.insertAfter(n),u=!0;break}return u||(n=_.last(this.element.children()),h=Rect.fromElement($(n),!1,!0),r=Rect.fromElement(this.element,!1,!0),i=Rect.fromDimensions(h.right(),h.origin.y,r.right()-h.right(),h.size.height),o=i.intersection(a),o&&o.area()>h.area()/2&&this.placeHolder.insertAfter(n)),this.dragTarget.setPosition(a.origin),this._scroll(!1),e.__super__._mouseDrag.apply(this,arguments)}},e.prototype._mouseStop=function(t){return this.dragStarted&&(clearTimeout(this.timer),this._trigger("stop",t),this.dragTarget.css({position:this.savedCSS.position,margin:this.savedCSS.margin,left:"",top:"",zIndex:this.savedCSS.zIndex}),this.dragTarget.insertBefore(this.placeHolder),this.placeHolder.remove(),this._trigger("update",t)),this.dragStarted=this.dragMoved=!1,e.__super__._mouseStop.apply(this,arguments)},e.prototype._prepareScroll=function(){return this.windowInnerHeight=window.innerHeight,this.windowScrollTop=$(window).scrollTop()},e.prototype._scroll=function(t){var e,i,n;return n=this.mouseDragEvent.clientY,t&&this._prepareScroll(),i=0,n>this.windowInnerHeight-this.options.scrollSensitivity?i=this.options.scrollSensitivity-(window.innerHeight-n):n<this.options.scrollSensitivity&&(i=-(this.options.scrollSensitivity-n)),i&&(e=this.windowScrollTop+i,e>=0&&($(window).scrollTop(e),t))?this.dragTarget.css({top:parseInt(this.dragTarget.css("top"))+i}):void 0},e}(flinto.Widget),flinto.LoadingIndicator=function(){function t(t,e){this.element=null!=t?t:null,this.options=null!=e?e:{},this.step=r(this.step,this),this.widgetName="loading_indicator",this.indicator=$("<div>").addClass("ui-loading-indicator").appendTo(this.element),this.frames=this.options.frames?this.options.frames:["\u25cb\u25cb\u25cb","\u25cf\u25cb\u25cb","\u25cb\u25cf\u25cb","\u25cb\u25cb\u25cf"],this.timeout=this.options.timeout?this.options.timeout:120,this.index=0,this.options.startAnimating&&this.startAnimating()}return t.prototype.startAnimating=function(){return this.timer=setInterval(this.step,this.timeout)},t.prototype.stopAnimating=function(){return clearTimeout(this.timer),this.indicator.text(this.frames[0])},t.prototype.step=function(){return this.indicator.text(this.frames[this.index]),this.index++,this.index>=this.frames.length?this.index=0:void 0},t}(),flinto.bridge=function(t){return $.fn["flinto_"+t]=function(e){var i,n,r;return n=t.charAt(0).toUpperCase()+t.slice(1),n=n.replace(/_(\w)/,function(t,e){return e.toUpperCase()}),"string"==typeof e?(i=Array.prototype.slice.call(arguments),i.shift(),r=this.data(t),r?r[e].apply(r,i):null):(this.data(t,new flinto[n](this,e)),this)}},n=["draggable","selectable","resizable","slider","sortable","loading_indicator"],e=0,i=n.length;i>e;e++)t=n[e],flinto.bridge(t)}.call(this),function(){this.fleditor={models:{},collections:{},views:{}},this.fleditor.constants={MAX_SCREEN_ZOOM:640,MIN_SCREEN_ZOOM:100,DEFAULT_SCREEN_ZOOM:320,MIN_LINK_SIZE:25,MIN_GUTTER:30,INSERT_GAP:10,REGULAR_LINK_SIZE:36,DRAG_TOLERANCE:5,MAX_IMAGE_SIZE:5242880,MAX_IMAGE_PIXEL:5242880},this.fleditor.keys=flinto.keys,$(document).on("page:restore",function(t){return function(){return $("#fleditor").data("fleditor")?t.fleditor.local=$("#fleditor").data("fleditor"):void 0}}(this)),$(document).on("page:receive",function(t){return function(){return t.fleditor.local&&t.fleditor.local.modal?t.fleditor.local.modal.hide():void 0}}(this)),$(window).on("resize",function(t){return t.originalEvent.target!==window?!0:this.prevWindowResizeTimsstamp&&t.timeStamp===this.prevWindowResizeTimsstamp?!0:($("body").trigger("window:resize"),this.prevWindowResizeTimsstamp=t.timeStamp,!0)}),$(window).on("scroll",function(t){return $("body").trigger("window:scroll",t)}),$(document).ajaxStart(function(){return window.onbeforeunload=function(){return"Flinto is still working hard uploading your data! If you leave the page now some changes will be lost."}}),$(document).ajaxStop(function(){return window.onbeforeunload=null}),$(document).ajaxError(function(t){return function(e,i,n){return n.noGlobalErrorDialog?void 0:(window.onbeforeunload=null,200!==i.status&&t.fleditor&&t.fleditor.local?t.fleditor.local.vent.trigger("server_error"):void 0)}}(this)),$(window).bind("offline",function(){return this.fleditor&&this.fleditor.local?this.fleditor.local.vent.trigger("network_error"):void 0}),$(window).bind("online",function(){return this.fleditor&&this.fleditor.local?this.fleditor.local.vent.trigger("clear_network_error"):void 0}),$("html").pasteImageReader(function(t){return function(e){return t.fleditor&&t.fleditor.local?t.fleditor.local.vent.trigger("pasteImage",e):void 0}}(this))}.call(this),function(){this.JST||(this.JST={}),this.JST["fleditor/templates/prototype"]=function(t){t||(t={});var e,i=[],n=function(t){return t&&t.ecoSafe?t:"undefined"!=typeof t&&null!=t?s(t):""},r=t.safe,s=t.escape;return e=t.safe=function(t){if(t&&t.ecoSafe)return t;("undefined"==typeof t||null==t)&&(t="");var e=new String(t);return e.ecoSafe=!0,e},s||(s=t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="prototype'),this.is_creator&&i.push(" creator"),i.push('">\n  <a href="/prototypes/'),i.push(n(this.id)),i.push('/edit">\n    <div class="icon '),i.push(n(this.precomposed_icon)),i.push('">\n      <img src="'),i.push(n(this.proper_icon_url)),i.push('"/>\n    </div>\n    <div class="meta">\n      <div class="title">'),i.push(n(this.title)),i.push('</div>\n      <div class="device '),i.push(n(this.orientation)),i.push('">'),i.push(n(this.device_name)),i.push("</div>\n    </div>\n  </a>\n</div>\n")}).call(this)}.call(t),t.safe=r,t.escape=s,i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["fleditor/templates/screen"]=function(t){t||(t={});var e,i=[],n=t.safe,r=t.escape;return e=t.safe=function(t){if(t&&t.ecoSafe)return t;("undefined"==typeof t||null==t)&&(t="");var e=new String(t);return e.ecoSafe=!0,e},r||(r=t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="content">\n\n  <div class="screen_liner">\n\n    <header style="opacity:0">\n      <div class="title">\n        <h1 class="title_header display"></h1>\n      </div>\n      <div class="timed-screen js-timed-screen"></div>\n    </header>\n\n    <div class="screen_image">\n      <div class="screen_image_wrapper">\n        <div class="linksnap_preview"></div>\n        <div class="links"></div>\n        <div class="error_message"></div>\n      </div>\n\n      <div class="slicers">\n      </div>\n    </div>\n\n  </div>\n\n</div>\n\n')}).call(this)}.call(t),t.safe=n,t.escape=r,i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["fleditor/templates/screen_error"]=function(t){t||(t={});var e,i=[],n=function(t){return t&&t.ecoSafe?t:"undefined"!=typeof t&&null!=t?s(t):""},r=t.safe,s=t.escape;return e=t.safe=function(t){if(t&&t.ecoSafe)return t;("undefined"==typeof t||null==t)&&(t="");var e=new String(t);return e.ecoSafe=!0,e},s||(s=t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var t,e,r,s;for(i.push('<div class="content">\n  <span class="error glyph">&#9888;</span>\n  <ul class="error">\n    '),s=this.errors,e=0,r=s.length;r>e;e++)t=s[e],i.push("\n      <li>"),i.push(n(t)),i.push("</li>\n    ");i.push('\n  </ul>\n  <div class="reupload_button">Retry Upload</div>\n  <div class="replace_button">Replace Screen</div>\n</div>\n')}).call(this)}.call(t),t.safe=r,t.escape=s,i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["fleditor/templates/share"]=function(t){t||(t={});var e,i=[],n=function(t){return t&&t.ecoSafe?t:"undefined"!=typeof t&&null!=t?s(t):""},r=t.safe,s=t.escape;return e=t.safe=function(t){if(t&&t.ecoSafe)return t;("undefined"==typeof t||null==t)&&(t="");var e=new String(t);return e.ecoSafe=!0,e},s||(s=t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){this.generic?i.push('\n  <a class="js-generic_a the_link" href=""></a>\n  <div class="regenerate">&#128260;</div>\n'):(i.push('\n  <td class="recipient">\n    <span class="glyph">&#9888;</span>\n    '),i.push(n(this.recipient)),i.push("\n    "),this.error_message&&i.push('\n      <div class="error_message">\n        There was an error causing this share link not to be sent.\n      </div>\n    '),i.push('\n  </td>\n  <td class="date">'),i.push(n(this.created_at)),i.push('</td>\n  <td class="view_count">\n    '),this.error_message?i.push("\n      N/A\n    "):(i.push("\n      "),i.push(n(this.view_count)),i.push("\n    ")),i.push('\n  </td>\n  <td class="actions">\n    <ul>\n      '),this.error_message?i.push('\n        <li><span class="a delete">Delete</span></li>\n      '):(i.push('\n        <li><a target="_new" href="/p/'),i.push(n(this.token)),i.push('" class="a link">View</a></li>\n        <li><span class="a resend" value="'),i.push(n(this.id)),i.push('">Re-send</span></li>\n        <li><span class="a delete">Revoke Access</span></li>\n      ')),i.push("\n    </ul>\n  </td>\n")),i.push("\n")}).call(this)}.call(t),t.safe=r,t.escape=s,i.join("")}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};this.fleditor.models.Link=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.paramRoot="link",i.prototype.initialize=function(t,e){return this.options=null!=e?e:e,this.options?this.linkGroup=this.options.linkGroup:void 0},i.prototype.cloneLink=function(t){var e,i,n;i=_.omit(t.attributes,"id","link_group_id","timer"),n={};for(e in i)n[e]=t.get(e);return this.set(n)},i.prototype.scale=function(t,e){return this.set({x:this.get("x")*t,y:this.get("y")*t,w:this.get("w")*t,h:this.get("h")*t}),this.cropToScreen(e)},i.prototype.move=function(t){return this.save("y",this.get("y")+t)},i.prototype.cropToScreen=function(t){return this.get("y")+this.get("h")>t&&this.get("y")<t?this.set("h",t-this.get("y")):void 0},i.prototype.validate=function(t){return t.screen_id||t.link_group_id?void 0:"You need to set either screen_id or link_group_id"},i}(Backbone.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.fleditor.models.LinkGroup=function(e){function n(){return this.saveCore=t(this.saveCore,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.paramRoot="link_group",n.prototype.initialize=function(t,e){return this.options=null!=e?e:e,this.screens=[e.screen],this.links=new fleditor.collections.Links(this.get("links"),{screen:e.screen,prototypeId:e.prototypeId,linkGroup:this})},n.prototype.save=function(t){return _.find(this.links.models,function(t){return!t.get("id")})?Backbone.enqueueRequest(this,"save",arguments):this.saveCore(t)},n.prototype.saveCore=function(t){var e;return e=this.sync("create",this,{contentType:"application/json",data:JSON.stringify(this.toJSON()),url:"/prototypes/"+this.options.prototypeId+"/screens/"+this.screens[0].get("id")+"/link_groups",success:function(e){return function(i){return e.set("id",i.id),t()}}(this)})},n.prototype.addLinks=function(t,e){return _.each(e,function(t){return function(e){return t.links.add(e),e.linkGroup=t,e.set({link_group_id:t.get("id"),screen_id:null}),e.trigger("snapToBottom")}}(this)),this.addLinksCore(t,e)},n.prototype.addLinksCore=function(t,e){var i,n;return _.each(e,function(t){return function(e){return e.set({link_group_id:t.get("id"),screen_id:null}),e.trigger("snapToBottom")}}(this)),_.find(e,function(t){return!t.get("id")})?Backbone.enqueueRequest(this,"addLinksCore",arguments):(i=_.omit(this.attributes,"links"),i.links=_.map(e,function(t){return t.id}),n=this.sync("create",this,{contentType:"application/json",data:JSON.stringify(i),url:"/prototypes/"+this.options.prototypeId+"/screens/"+t+"/link_groups/"+this.get("id")+"/add_links",success:function(){return function(){return _.each(e,function(t){return t.save()})}}(this)}))},n.prototype.ungroup=function(t){var e;return e=this.sync("delete",this,{contentType:"application/json",data:JSON.stringify({}),url:"/prototypes/"+this.options.prototypeId+"/screens/"+t.get("id")+"/link_groups/"+this.get("id")}),t.linkGroups.remove(this)},n.prototype.copyTo=function(t){return t.linkGroups.add(this),this.copyToCore(t),this.trigger("selectAllLinks",this,t.id)},n.prototype.copyToCore=function(t){var e,i;return this.get("id")?(e=_.omit(this.attributes,"links"),e.target_screen_id=t.get("id"),i=this.sync("create",this,{contentType:"application/json",data:JSON.stringify(e),url:"/prototypes/"+this.options.prototypeId+"/screens/"+this.screens[0].get("id")+"/link_groups/"+this.get("id")+"/copy"})):Backbone.enqueueRequest(this,"copyToCore",arguments)},n.prototype.toJSON=function(){var t;return t=_.omit(this.attributes,"links"),t.links=_.map(this.links.models,function(t){return t.get("id")}),t},n.prototype.toViewerJSON=function(){var t;return t=_.omit(this.attributes,"links"),t.links=_.map(this.links.models,function(t){return t.toJSON()}),t},n}(Backbone.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.fleditor.models.Proto=function(e){function n(){return this.uploadToS3=t(this.uploadToS3,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.urlRoot="/prototypes",n.prototype.paramRoot="prototype",n.prototype.initialize=function(){return this.screens=new fleditor.collections.Screens(this.get("screens"),{proto:this}),fleditor.local.viewer_width=this.get("viewer_width"),fleditor.local.viewer_height=this.get("viewer_height")},n.prototype.toJSON=function(){return _.omit(this.attributes,["id","screens","viewer_width","viewer_height","creators","icons","icon_url","startup_url","icon_data_url","startup_data_url","has_password","device_info"])},n.prototype.toViewerJSON=function(){var t;return t=_.omit(this.attributes,["screens"]),t.screens=_.map(this.screens.models,function(t){return t.toViewerJSON()}),t},n.prototype.isAndroid=function(){return this.get("device").match(/android/)},n.prototype.isiOS=function(){return!this.get("device").match(/(iphone|ipad)/)},n.prototype.directUploadImages=function(t){var e,i,n,r;for(i in t)r=t[i],this.set(""+i+"_url",t[i].data_url),this.set(""+i+"_data_url",t[i].data_url);return e={},this.du_images=t,_.each(t,function(){return function(t,i){return e[""+i+"_file_name"]=t.filename,e[""+i+"_content_type"]=t.content_type}}(this)),n=Backbone.sync("read",this,{data:{prototype:e},url:"/prototypes/"+this.get("id")+"/prepare"}),n.success(function(e){return function(n){var r,s;e.du_resp=n;for(i in n)r=n[i],t[i]&&(s=new Image,s.src=t[i].data_url,e.uploadToS3(i,s,r));return!0}}(this)),!0},n.prototype.uploadToS3=function(t,e,i){return $(e).on("load",function(n){return function(){var r,s,o,a,l;for(a=0,l=i.length;l>a;a++)s=i[a],n.du_images[t].file&&e.naturalWidth===s.width&&e.naturalHeight===s.height?r=n.du_images[t].file:(o=Graphics.resizeAndCrop(e,$("<canvas>")[0],s.width,s.height,-1,0),r=window.dataURItoBlob(o)),flinto.S3DirectUpload(s,r,{success:function(t,e){return e.done=!0,n.checkAllUploaded()}});return!0}}(this)),!0},n.prototype.checkAllUploaded=function(){var t,e,i,n,r,s,o;s=this.du_resp;for(e in s)if(t=s[e],this.du_images[e])for(n=0,r=t.length;r>n;n++)if(i=t[n],!i.done)return!1;o=this.du_resp;for(e in o)t=o[e],this.du_images[e]&&(this.set(""+e+"_file_name",escapePlusSign(this.du_images[e].filename)),this.set(""+e+"_content_type",this.du_images[e].content_type),this.set(""+e+"_updated_at",t[0].updated_at));return this.save(null,{silent:!0})},n}(Backbone.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.fleditor.models.Screen=function(e){function n(){return this.saveScreen=t(this.saveScreen,this),n.__super__.constructor.apply(this,arguments)
}return i(n,e),n.prototype.paramRoot="screen",n.prototype.defaults={top_slice:0,bottom_slice:0},n.prototype.default_image_url="/assets/default_attachments/screens/images_original.png",n.prototype.validate=function(t){return""===t.title||null==t.title?"Error: Title cannot be blank":void 0},n.prototype.initialize=function(t){var e,i;return this.options=null!=t?t:t,!(null!=(e=this.get("title"))?e.length:void 0)&&(null!=(i=this.get("image_file_name"))?i.length:void 0)&&this.set("title",this.convertFilenameToTitle(this.get("image_file_name"))),this.get("title")||this.set("title","Untitled"),this.links=new fleditor.collections.Links(this.get("links"),{screen:this,prototypeId:t.prototype_id}),this.linkGroups=new fleditor.collections.LinkGroups(this.get("link_groups"),{screen:this,prototypeId:t.prototype_id})},n.prototype.convertFilenameToTitle=function(t){return t=t.replace(/^\.+/,""),t.lastIndexOf(".")>0&&(t=t.substring(0,t.lastIndexOf("."))),t.replace(/_/g," ").replace(/@2x/,"")},n.prototype.toJSON=function(){return _.omit(this.attributes,"links","id","file","cross_origin","has_image","image_url","direct_upload_params","prototype_id")},n.prototype.toViewerJSON=function(){var t;return t=_.omit(this.attributes,"links","link_groups"),this.image&&(t.image_url=this.image.src),t.links=_.map(this.links.models,function(t){return t.toJSON()}),t.link_groups=_.map(this.linkGroups.models,function(t){return t.toViewerJSON()}),t},n.prototype.destroy=function(){return this.linkGroups.removeAll(),this.directUploadXHR&&this.directUploadXHR.abort(),window.mixpanel&&mixpanel.people.increment("Screens",-1),n.__super__.destroy.apply(this,arguments)},n.prototype.loadImage=function(t,e){var i;return null==t&&(t=null),null==e&&(e=null),null===t&&(t=this.get("image_url")),i=new Image,!t.match(window.location.host)&&t.match(/^https?:\/\//)&&(i.crossOrigin="anonymous"),i.src=t,i=$(i),e?(i.on("load",function(t){return function(){return t.loadedImage=i,e(i)}}(this)),i.on("error",function(){return function(){return e(null)}}(this)),i.on("abort",function(){return function(){return e(null)}}(this))):i.on("load",function(t){return function(){return t.loadedImage=i}}(this))},n.prototype.loadScreenImageFromFile=function(t,e){var i;return null==e&&(e=!1),this.trigger("error",null),e&&this.set("direct_upload_params",null),i=new FileReader,i.onload=function(e){return function(i){return e.createImageFromDataURL(i.target.result,t,document.getElementById("statusbar_canvas"))}}(this),i.readAsDataURL(t)},n.prototype.uploadImageToS3=function(t){var e,i,n;return n=function(e){return function(i){return e.directUploadXHR=flinto.S3DirectUpload(i,e.fileObject,{success:function(n){return e.set("image_updated_at",i.updated_at),e.directUploadXHR=null,t.success(n)},error:function(i){return e.directUploadXHR=null,t.error(i)}})}}(this),e=this.get("direct_upload_params"),e?n(e.image):this.get("id")?(this.get("image_file_name")||this.set({image_file_name:this.fileObject.name||"Untitled."+this.fileObject.type.replace("image/","")}),i=Backbone.sync("read",this,{data:{image_file_name:this.get("image_file_name"),image_content_type:this.fileObject.type},url:"/prototypes/"+this.get("prototype_id")+"/screens/"+this.get("id")+"/prepare"}),i.success(function(){return function(t){return n(t.direct_upload_params.image)}}(this)),i.error(function(t){return function(e){return t.trigger("error",e)}}(this))):this.save(null,{noGlobalErrorDialog:!0,success:function(t){return function(){return n(t.get("direct_upload_params").image)}}(this),error:function(t){return function(e){return t.trigger("error",e)}}(this)})},n.prototype.saveScreen=function(){return this.uploadImageToS3({success:function(t){return function(){return t.save(null,{noGlobalErrorDialog:!0,success:function(){return t.trigger("error",null)},error:function(e){return t.trigger("error",e)}})}}(this),error:function(t){return function(e){return t.trigger("error",e)}}(this)})},n.prototype.createImageFromDataURL=function(t,e){return window.loadAndResizeImage(t,e,{done:function(e){return function(i,n){var r;return r=flinto.detectStatusbar(i,e),e.image=i,e.fileObject=n,e.get("title")||e.set("title","untitled"),e.set({width:e.image.naturalWidth,height:e.image.naturalHeight,has_image:!0,statusbar_height:r}),e.set("image_url",t),e.get("id")&&e.saveScreen(),e.imageIsLoaded=!0}}(this),fail:function(t){return function(e){return t.image=e,t.failToLoadImage=!0,t.image.src=t.default_image_url,t.get("id")&&t.saveScreen(),t.imageIsLoaded=!0}}(this)})},n.prototype.createImageFromPSD=function(t){return this.set({image_content_type:"image/png",image_file_name:this.get("image_file_name").replace(/psd/,"png")}),PSD.fromFile(t,function(e){return function(i){var n;return n=i.toImage(),t=dataURItoBlob(n),e.createImageFromDataURL(n,t,document.getElementById("statusbar_canvas"))}}(this))},n.prototype.isPortrait=function(){return this.get("width")<this.get("height")},n.prototype.isLandscape=function(){return this.get("height")>this.get("width")},n.prototype.isSquare=function(){return this.get("height")===this.get("width")},n.prototype.actualScreenHeight=function(){return this.get("height")-this.get("statusbar_height")},n.prototype.isDeadEnd=function(){return 0===this.links.length},n.prototype.imageIsDataUrl=function(){return this.get("image_url")?this.get("image_url").match(/^data\:image/):!1},n}(Backbone.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};this.fleditor.models.Share=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.paramRoot="share",i}(Backbone.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.fleditor.collections.LinkGroups=function(e){function n(e,i){this.options=null!=i?i:{},this.each=t(this.each,this),this.models={},_.each(e,function(t){return function(e){var i;return _.has(t.pool,e.id)?(i=t.pool[e.id],i.screens.push(t.options.screen),t._add(t.pool[e.id])):(i=new fleditor.models.LinkGroup(e,t.options),t._add(i),t.pool[e.id]=i)}}(this))}return i(n,e),n.prototype.model=fleditor.models.LinkGroup,n.linkGroupPool={},n.prototype.url=function(){return"/prototypes/"+this.options.prototypeId+"/screens/"+this.options.screen.get("id")+"/link_groups"},n.prototype.pool=function(){return fleditor.collections.LinkGroups.linkGroupPool},n.prototype._add=function(t){return this.models[t.cid]=t,t.links.on("remove",this.removeLink,this)},n.prototype.add=function(t){return this._add(t),t.screens=_.union(t.screens,[this.options.screen]),this.trigger("add",t)},n.prototype.remove=function(t){return t.screens=_.without(t.screens,this.options.screen),delete this.models[t.cid],this.trigger("remove",t)},n.prototype.removeAll=function(){return _.each(this.models,function(t){return function(e){return e.screens=_.without(e.screens,t.options.screen),t.trigger("remove",e)}}(this))},n.prototype.each=function(t){return _.each(this.models,t)},n.prototype.find=function(t){return _.find(this.models,t)},n.prototype.ids=function(){return _.map(this.models,function(t){return t.id})},n.prototype.removeLink=function(t){var e;try{if(e=this.models[t.linkGroup.cid],0===_.size(e.links))return this.remove(e)}catch(i){}},n}(Backbone.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};this.fleditor.collections.Links=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=fleditor.models.Link,i.prototype.url=function(){return"/prototypes/"+this.options.prototypeId+"/screens/"+this.options.screen.get("id")+"/links"},i.prototype.initialize=function(t,e){this.options=null!=e?e:{}},i}(Backbone.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};this.fleditor.collections.Screens=function(e){function n(){return this.postSortRequest=t(this.postSortRequest,this),this.updateScreenOrder=t(this.updateScreenOrder,this),this.bulkUploadCore=t(this.bulkUploadCore,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.model=fleditor.models.Screen,n.prototype.url=function(){return"/prototypes/"+this.prototype.id+"/screens"},n.prototype.initialize=function(t,e){return this.options=null!=e?e:{},this.prototype=this.options.proto,this.sortQueue=[]},n.prototype.hasDeadEndScreen=function(){var t,e,i,n,r;for(t=0,r=this.models,i=0,n=r.length;n>i;i++)e=r[i],e.isDeadEnd()&&++t;return t},n.prototype.comparator=function(t){return t.get("position")},n.prototype.hasUnlinkedScreen=function(){var t,e,i,n,r;for(e=this.pluck("id"),r=this.models,i=0,n=r.length;n>i;i++)t=r[i],e=_.difference(e,t.links.pluck("target_id"));return e.length},n.prototype.lastPosition=function(){var t,e;return e=0,t=_.last(this.models),t&&(e=t.get("position")+1),e},n.prototype.normalizeFilename=function(t){return t.name.replace(/@2x/g,"").replace(/[\s\+\?\#\&\:\;\,\@\=]/g,"_")},n.prototype.bulkUploadScreens=function(t,e){var i,n,r,s,o,a,l,h,u,c;if(null==e&&(e=-1),null!=t){for(-1===e&&(e=this.models.length),t=this.findHomeScreen(t),a=_.countBy(this.models,function(t){return t.get("image_file_name")}),l=_.reject(this.models,function(t){return 1!==a[t.get("image_file_name")]}),n=[],s=[],u=0,c=t.length;c>u;u++)r=t[u],h=this.normalizeFilename(r),o=_.find(l,function(){return function(t){return t.get("image_file_name")===h}}(this)),o?n.push({model:o,file:r}):s.push(r);return 0!==n.length?(i=function(i){return function(r){var o,a,l;if(r)for(t=s,a=0,l=n.length;l>a;a++)o=n[a],o.model.loadScreenImageFromFile(o.file,!0);return i.bulkUploadCore(t,e)}}(this),fleditor.local.vent.trigger("replace_screen_with_same_name",n,i)):this.bulkUploadCore(t,e)}},n.prototype.bulkUploadCore=function(t,e){var i,n,r,s,o,a;for(s=[],o=0,a=t.length;a>o;o++)i=t[o],"undefined"!=typeof FileReader&&null!==FileReader&&(i.type.match(/(image|photoshop)/)||i.name.match(/\.psd/))&&(r=new fleditor.models.Screen({image_file_name:this.normalizeFilename(i),image_file_size:i.size,image_content_type:i.type,prototype_id:this.prototype.id}),s.push(r),i.type.match(/photoshop/)||i.name.match(/\.psd/)?r.createImageFromPSD(i):i.dataURL?r.createImageFromDataURL(i.dataURL,i.blob,document.getElementById("statusbar_canvas")):r.loadScreenImageFromFile(i),this.add(r,{at:e++}));return 0!==s.length?(window.mixpanel&&mixpanel.people.increment("Screens",s.length),n=Backbone.sync("create",this,{contentType:"application/json",data:JSON.stringify({screens:s})}),n.success(function(){return function(t){var e,i,n,o;for(e=n=0,o=t.length;o>n;e=++n)i=t[e],r=s[e],i.id&&(r.set({title:i.title,id:i.id,direct_upload_params:i.direct_upload_params}),r.imageIsLoaded&&r.saveScreen());return fleditor.local.vent.trigger("screen:bulkUplaoded")}}(this)),n.error(function(t){return function(){var e,i,n;for(n=[],e=0,i=s.length;i>e;e++)r=s[e],t.remove(r),n.push(r.destroy());return n}}(this))):void 0},n.prototype.findHomeScreen=function(t){var e,i,n;if(0!==this.models.length)return t;for(i=0,n=t.length;n>i;i++)if(e=t[i],e.name.match(/^home\./i)){t=_.without(t,e),t.unshift(e);break}return t},n.prototype.updateScreenOrder=function(t){var e,i;if(t&&0!==t.length){for(i in t)e=t[i],this.get(e).set({position:i},{silent:!0});return this.sort({silent:!0}),this.sortQueue.push(t),1===_.size(this.sortQueue)&&this.postSortRequest(),fleditor.local.vent.trigger("updateHomeScreen")}},n.prototype.postSortRequest=function(){var t,e;return t=function(t){return function(){return _.size(t.sortQueue)>1?(t.sortQueue=[_.last(t.sortQueue)],t.postSortRequest()):t.sortQueue=[]}}(this),e=Backbone.sync("patch",this,{contentType:"application/json",data:JSON.stringify({id:this.prototype.id,screen_ids:this.sortQueue[0]}),url:"/prototypes/"+this.prototype.id+"/sort",success:t,error:t})},n.prototype.pasteImage=function(t){var e;return e=document.getElementById("statusbar_canvas"),window.loadAndResizeImage(t.dataURL,t.file,{done:function(t){return function(e,i){var n,r,s;return 1===(null!=(s=fleditor.local.header)?s.screen_statusbar.selectedScreens.length:void 0)?(n=fleditor.local.header.screen_statusbar.selectedScreens[0].model,r=flinto.detectStatusbar(e,n),n.image=e,n.set({image_file_size:i.size,image_content_type:i.type,image_url:e.src,width:e.width,height:e.height,statusbar_height:r})):(n=new fleditor.models.Screen({image_file_name:"Untitled."+i.type.replace("image/",""),image_file_size:i.size,image_content_type:i.type,position:t.lastPosition(),prototype_id:t.prototype.id,width:e.width,height:e.height,statusbar_height:flinto.detectStatusbar(e)}),n.image=e,n.set("image_url",e.src),t.add(n),window.mixpanel&&mixpanel.people.increment("Screens",1)),n.fileObject=i,n.saveScreen()}}(this),fail:function(){return function(){}}(this)})},n}(Backbone.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};this.fleditor.collections.Shares=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=fleditor.models.Share,i.prototype.url=function(){return"/prototypes/"+this.prototype.id+"/shares"},i.prototype.initialize=function(t,e){return this.options=null!=e?e:{},this.prototype=this.options.prototype},i}(Backbone.Collection)}.call(this),function(){jQuery(function(){return $("body").hasClass("collaborations")?($("#toggle_all").toggleAll(".js-transfer_checkbox"),$(".transfer_option").on("change",function(t){var e;return e=$(".transfer_or_delete"),e.val("delete"===$(t.target).val()?e.val().replace("Transfer","Delete"):e.val().replace("Delete","Transfer"))}),$("#transfer_to").on("change",function(){var t;return t=$(".transfer_or_delete"),t.val(t.val().replace("Delete","Transfer")),$("#transfer_option_transfer").prop("checked",!0)})):void 0})}.call(this),EdgeDetector.prototype.initCanvas=function(t){var e=this.width,i=this.height;if(this.canvas.width=e,this.canvas.height=i,!this.initialized){var n=this.canvas.getContext("2d");n.drawImage(this.image,0,this.offset,e,i,0,0,e,i),t&&(n.strokeStyle="#000",n.lineWidth=4,n.rect(0,0,e,i),n.stroke());var r=n.getImageData(0,0,e,i);this.output=n.createImageData(e,i),EdgeDetector.applySobelFilter(r,this.output,e,i),this.initialized=!0}},EdgeDetector.prototype.detect=function(t,e){var i=parseInt(t,10),n=parseInt(e,10);if(isNaN(i)||isNaN(n))throw"Invalid argment";this.initCanvas(!0);var r=this.width,s=this.height,o=this.canvas.getContext("2d");o.putImageData(this.output,0,0);for(var a=o.getImageData(0,0,r,s),l=a.data,h=EdgeDetector.quickFill(i,n,l,r,s),u=Rect.fromDimensions(0,0,r,s),c=0;(h.size.width<this.min_size/4||h.size.height<this.min_size/4)&&(o.fillStyle="rgba(0,0,0,255)",h=h.inset(-2,-2),h=u.intersection(h),h.fill(o),a=o.getImageData(0,0,r,s),l=a.data,h=EdgeDetector.quickFill(i,n,l,r,s),!(++c>3)););return h=u.intersection(h.inset(-2,-2))},EdgeDetector.prototype.detectSlice=function(t){this.initCanvas(!1);var e=this.width,i=this.height,n=this.canvas.getContext("2d");n.putImageData(this.output,0,0);var r=n.getImageData(0,0,e,i),s=r.data;return slice=this.detectLine(s,0,i,t,1.2,64)},EdgeDetector.prototype.detectLine=function(t,e,i,n,r,s){var o=this.width,a=(this.height,0);for(candidates=[],y=e;i>=y;++y){var l=y*o*4;points=[],sum=0;for(var h=1;o-1>h;++h){var u=t[l];sum+=u,points[u]?points[u]+=1:points[u]=1,l+=4}var c=0;for(var d in points)points[d]>5&&parseInt(d)>s&&(c+=points[d]);_.contains(n,y)&&(c*=r,sum*=r),c>o/8*7&&(candidates[y]=sum)}var p=0;for(d in candidates)candidates[d]>p&&(p=candidates[d],a=parseInt(d)),candidates[d]==p&&parseInt(d)-1==a&&(p=candidates[d],a=parseInt(d)),candidates[d]>.98*p&&parseInt(d)-2==a&&(!candidates[d-1]||candidates[d-1]<.5*candidates[d])&&(a=parseInt(d)-1);return a},EdgeDetector.applySobelFilter=function(t,e,i,n){for(var r=t.data,s=e.data,o=4*i,a=i-1,l=n-1,h=o+4,u=1;l>u;++u){var c,d,p,f,g,m,v,y,w,b=h-o,_=h,k=h+o;c=.34*r[b-4]+.5*r[b-3]+.16*r[b-2],d=.34*r[b]+.5*r[b+1]+.16*r[b+2],f=.34*r[_-4]+.5*r[_-3]+.16*r[_-2],g=.34*r[_]+.5*r[_+1]+.16*r[_+2],v=.34*r[k-4]+.5*r[k-3]+.16*r[k-2],y=.34*r[k]+.5*r[k+1]+.16*r[k+2];for(var S=1;a>S;++S){b=h-o,_=h,k=h+o,p=.34*r[b+4]+.5*r[b+5]+.16*r[b+6],m=.34*r[_+4]+.5*r[_+5]+.16*r[_+6],w=.34*r[k+4]+.5*r[k+5]+.16*r[k+6];var x=p+2*m+w-c-2*f-v,C=v+2*y+w-c-2*d-p,T=Math.sqrt(x*x+C*C);s[h]=T,s[h+3]=255,h+=4,c=d,d=p,f=g,g=m,v=y,y=w}h+=8}},EdgeDetector.quickFill=function(t,e,i,n,r){function s(t,e,n){for(var r=e*v+4*t;r>e*v+4*n&&!(i[r]>k);r-=4);return r%(e*v)/4}function o(t,e,n){for(var r=e*v+4*t;e*v+4*n>r&&!(i[r]>k);r+=4);return r%(e*v)/4}function a(t,e,n){for(var r=e*v+4*t;e*v+4*n>=r&&!(i[r]<k);r+=4);return r%(e*v)/4}function l(t,e,i,n){S.push([t,e,i,n])}function h(){return S.shift()}function u(t,e){i[e*v+4*t]=255,i[e*v+4*t+3]=255,y=Math.min(t,y),w=Math.max(t,w),b=Math.min(e,b),_=Math.max(e,_)}function c(t,e,n){for(var r=n*v+4*t;n*v+4*e>r;r+=4)i[r]=255,i[r+3]=255;y=Math.min(t,y),w=Math.max(e,w),b=Math.min(n,b),_=Math.max(n,_)}var d,p,f,g,m,v=4*n,y=t,w=t,b=e,_=e,k=64,S=[];for(--n,--r,l(t,t,e,1),l(t,t,e+1,-1);S.length;){var x=h();if(g=x[0],m=x[1],e=x[2],d=x[3],e+=d,!(0>e||e>r))for(p=s(g,e,0)+1,g>=p?(f=o(g,e,n)-1,p==f?u(f,e):c(p,f,e),p>=g-1&&m+1>=f?l(p,f,e,d):(l(p,f,e,-d),l(p,f,e,d)),++f):f=g;m>f;)f=a(f,e,m),m>=f&&(p=f,f=o(p,e,n)-1,p==f?u(f,e):c(p,f,e),m+1>=f?l(p,f,e,d):(l(p,f,e,-d),l(p,f,e,d)),++f)}return Rect.fromDimensions(y,b,w-y,_-b)},EdgeDetector.applyConvolution3=function(t,e,i,n){function r(t){return.34*l[t]+.5*l[t+1]+.16*l[t+2]}function s(){m+=4,g+=4,v+=4}for(var o=i,a=n,l=t.data,h=e.data,u=4*o,c=u+4,d=a-1,p=o-1,f=1;d>f;++f){var g=c-4,m=g-u,v=g+u,y=r(m)+r(g)+r(v);s();for(var w=r(m),b=r(g),_=r(v),k=w+b+_,S=1;p>S;++S){g=c+4,m=g-u,v=g+u;var x=127+(b<<3)-y-w-_;y=k,w=r(m),b=r(g),_=r(v),s(),k=w+b+_;var C=x-k;h[c++]=C,h[c++]=C,h[c++]=C,h[c++]=255}c+=8}},function(){jQuery(function(){return function(t){var e,i,n;return e=t("body"),i=function(e){var i,n,r;return this.fleditor.local={},this.fleditor.local={prototypeId:t("#fleditor").data("prototype_id"),vent:_.extend({},Backbone.Events),modal:null,viewer_width:0,viewer_height:0},t("#fleditor").data("fleditor",this.fleditor.local),n=new fleditor.models.Proto(e),this.fleditor.local.proto=n,fleditor.local.screenExists=function(){return function(t){return-1===t?!0:-1===_.indexOf(_.map(n.screens.models,function(t){return t.get("id")}),t)?!1:!0}}(this),this.fleditor.local.screensView=new fleditor.views.Screens({proto:fleditor.local.proto,collection:n.screens,el:t("#fleditor")}).render(),this.fleditor.local.header=new fleditor.views.PrototypeHeader({screensView:this.fleditor.local.screensView,model:n,el:t("#fleditor_header")}).render(),this.fleditor.local.settings=new fleditor.views.PrototypeSettings({model:n,el:t("#prototype_settings")}),this.fleditor.local.networkError=new fleditor.views.NetworkError({model:n,el:t("#network_error_modal"),disallowShadeClick:!0}),this.fleditor.local.replaceScreen=new fleditor.views.ReplaceScreen({model:n,el:t("#replace_screen_modal")}),this.fleditor.local.prototypePreview=new fleditor.views.PrototypePreview({model:n}).render().appendTo(t("body")),r=function(e){return function(){return e.onboardModal?fleditor.local.vent.trigger("onboard:toggle"):e.onboardModal=new fleditor.views.PrototypeOnboard({el:t("#onboard"),proto:n})}}(this),t("#editor_basics_button").click(r),window.is_onboard&&r(),0===n.screens.length&&t("#instructions").show(),i=t("#instructions_drop_target"),i.on("click",function(t){return function(e){return t.fleditor.local.header.chooseScreens(e)}}(this)),i.on("mouseover",function(){return function(){return t("#fleditor").addClass("initial_upload_hover")}}(this)),i.on("mouseout",function(){return function(){return t("#fleditor").removeClass("initial_upload_hover")}}(this)),t(".sample_screens").click(function(){return function(){return mixpanel.people.set_once("Download Sample Screen","true")}}(this)),fleditor.local.vent.on("pasteImage",function(t){return n.screens.pasteImage(t)})},e.hasClass("fleditor")&&(flinto.browserSupported()?(t(".browser_supported").show(),t(".browser_unsupported, .mobile_browser").hide(),i(prototypeBootstrapData)):flinto.mobileBrowser()?(t(".browser_supported, .browser_unsupported").hide(),t(".mobile_browser").show(),t("#instructions").show()):(t(".browser_supported, .mobile_browser").hide(),t(".browser_unsupported").show(),t("#instructions").show())),e.hasClass("flviewer")&&(e.hasClass("js-disabled")||(n=window.location.search.match(/embed=true/),flinto.flviewer=new flviewer.Viewer(flviewerPrototypeBootstrapData,t("#flviewer"),!1,!1,n),flviewerPrototypeBootstrapData.device.match(/android/)&&t(".device").width(flinto.flviewer.attributes.viewer_width+flinto.flviewer.menubar_width).height(flinto.flviewer.attributes.viewer_height+flinto.flviewer.menubar_height))),t("#logout").on("click",function(e){try{mixpanel.cookie.clear()}catch(i){}return clearAllCookies(),t("#logout").prop("disabled")?(e.preventDefault(),!1):(t("#logout").prop("disabled",!0),t("#logout_form").submit(),!1)})}}(this))}.call(this),function(){flinto.detectStatusbar=function(t,e){var i,n,r;return n=new statusbarDetector(t).detectHeight(),e&&e.image?(r=new statusbarDetector(e.image).detectHeight(),i=e.get("statusbar_height"),"undefined"==typeof i||r===i?n:i):n},window.statusbarDetector=function(){function t(t){this.image=t,this.setup()}var e,i,n,r,s,o,a,l;return i=80,e=40,a=[[20,11],[64,29]],l=[[4,11],[48,29]],o=[[33,9],[68,27]],r=[[56,4],[74,13]],s=[[33,10],[68,28]],n=[[56,4],[74,13]],t.prototype.testValues=[{height:40,coord:a,color:255,name:"retina_ios7",threshold:10,tolerance:.9},{height:40,coord:l,color:255,name:"retina_ios7c",threshold:10,tolerance:.9},{height:40,coord:a,color:0,name:"retina_ios7b",threshold:10,tolerance:.9},{height:40,coord:l,color:0,name:"retina_ios7bc",threshold:10,tolerance:.9},{height:40,coord:o,color:255,name:"retina_ios6",threshold:10,tolerance:.9},{height:40,coord:s,color:0,name:"retina_ios5",threshold:10,tolerance:.9},{height:20,coord:r,color:255,name:"legacy_ios6",threshold:10,tolerance:.9},{height:20,coord:n,color:0,name:"legacy_ios5",threshold:40,tolerance:.8}],t.prototype.detectHeight=function(){return this.height()},t.prototype.setup=function(){var t,n,r,s;if(s=parseInt(this.image.naturalWidth,10),n=parseInt(this.image.naturalHeight,10),!this.image||"img"!==this.image.tagName.toLowerCase()||isNaN(s)||isNaN(n))throw"Invalid argument";t=$("#statusbar_detector_canvas"),this.canvas=t.length?t:$("<canvas>").attr("id","statusbar_detector_canvas"),this.canvas=this.canvas[0],this.canvas.width=i,this.canvas.height=e,this.context=this.canvas.getContext("2d"),this.context.drawImage(this.image,-(s-i),0,s,n),r=this.context.getImageData(0,0,i,e),this.data=this.context.createImageData(i,e),EdgeDetector.applyConvolution3(r,this.data,i,e)},t.prototype.test=function(t){var e,n,r,s,o,a,l,h,u,c,d,p,f,g,m,v,y,w,b,_;for(o=Point.fromArray(t.coord[0]),r=Point.fromArray(t.coord[1]),n=t.color,a=0,s=0,e=4*i,m=[o.y,r.y],u=0,f=m.length;f>u;u++)for(h=m[u],l=c=v=o.x,y=r.x;y>=v?y>=c:c>=y;l=y>=v?++c:--c)Math.abs(this.data.data[h*e+4*l]-n)<t.threshold&&++s,++a;for(w=[o.x,r.x],d=0,g=w.length;g>d;d++)for(l=w[d],h=p=b=o.y,_=r.y;_>=b?_>=p:p>=_;h=_>=b?++p:--p)Math.abs(this.data.data[h*e+4*l]-n)<t.threshold&&++s,++a;return s/a>t.tolerance?!0:!1},t.prototype.height=function(){var t,e,i,n;for(n=this.testValues,e=0,i=n.length;i>e;e++)if(t=n[e],this.test(t))return t.height;return 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};jQuery(function(){var e,i;return $("body").hasClass("subscription")&&$("body").hasClass("edit")?($.getScript("https://js.stripe.com/v2/",function(){return Stripe.setPublishableKey("pk_live_hrbRRomMcn9cQbx5Dc7YB5Ro"),window.subscription=new t}),e=$("#billing-frequency .choice"),i=function(t,i){var n,r,s;return null==i&&(i=!0),e.removeClass("active"),t.is(":checked")?(n=t.parents(".choice"),n.addClass("active"),r=t.data("cost"),s=t.data("frequency"),$("#price_summary_amount").text(r),$("#price_summary_frequency").text(s)):void 0},i(e.find("input[type=radio]:checked"),!1),e.find("input[type=radio]").change(function(t){return i($(t.target))})):void 0}),t=function(){function t(){this.pollingCardStatus=e(this.pollingCardStatus,this),this.handleStripeResponse=e(this.handleStripeResponse,this),this.validateCard=e(this.validateCard,this),this.clearErrors=e(this.clearErrors,this),this.error=e(this.error,this),this.submitButton=$("#subscription .save_plan_form"),window.credit_card_update_is_in_progress&&($(".yearly_billing_tout").hide(),$("#subscription").hide(),this.pollingCardStatus()),$("#number").on("keyup",function(t){return function(e){return t.highlightCard($(e.target).val())}}(this)),$("#subscription").on("submit",function(t){return function(){return t.clearErrors(),$(".credit_card").length&&!t.validateCard()?!1:(t.disableForm(),$(".credit_card").length?t.processCard():t.submitForm(),!1)}}(this)),$("#change_yearly_billing").on("submit",function(t){return function(){return window.mixpanel&&mixpanel.track("Change Billing Frequency",{frequency:"yearly"}),t.clearErrors(),t.disableForm(!1),t.pollingCardStatus()}}(this))}return t.prototype.error=function(t,e){var i,n;return i=$(e),n=$("<div>").addClass("error").text(t),n.appendTo(i),i.show()},t.prototype.clearErrors=function(){return $(".error").empty(),$(".credit_card_form_errors").hide()},t.prototype.highlightCard=function(t){var e,i,n;return n=Stripe.card.cardType(t).replace(" ","").toLowerCase(),i=$("#js-preview-card"),i.attr({"class":"card"}),null!=n&&"unknown"!==n&&i.addClass(n).addClass("active"),e=$("#cvc-note"),e.toggleClass("amex","americanexpress"===n)},t.prototype.validateCard=function(){var t;return t=0,Stripe.validateCardNumber(this.cardNumber())||(this.error("Card number is invalid.",".number"),++t),Stripe.validateExpiry(this.expMonth(),this.expYear())||(this.error("Expiration date is invalid.",".expiration"),++t),Stripe.validateCVC(this.cvc())||(this.error("CVC code is invalid.",".cvc"),++t),0===t},t.prototype.cardNumber=function(){return $("#number").val()},t.prototype.cvc=function(){return $("#cvc").val()},t.prototype.expMonth=function(){return $("#expMonth").val()},t.prototype.expYear=function(){return $("#expYear").val()},t.prototype.processCard=function(){var t,e,i,n,r;for(this.disableForm(),t={},r=["number","cvc","expMonth","expYear","name","address_zip"],i=0,n=r.length;n>i;i++)e=r[i],t[e]=$("#"+e).val();return Stripe.createToken(t,this.handleStripeResponse)},t.prototype.disableForm=function(t){return null==t&&(t=!0),$(".card_form").attr("disabled","disabled"),$("#change_yearly_billing .submit").attr("disabled","disabled"),t?null==this.waiter&&(this.waiter=new SnapWait(this.submitButton,{frames:["\u25cf\u25cb\u25cb","\u25cb\u25cf\u25cb","\u25cb\u25cb\u25cf","\u25cb\u25cb\u25cb"]})):null==this.waiter&&(this.waiter=new SnapWait($("#change_yearly_billing .submit"),{frames:["\u25cf\u25cb\u25cb","\u25cb\u25cf\u25cb","\u25cb\u25cb\u25cf","\u25cb\u25cb\u25cb"]})),this.waiter.wait()},t.prototype.enableForm=function(){return $(".card_form").removeAttr("disabled"),null!=this.waiter?this.waiter.stopWaiting():void 0},t.prototype.submitForm=function(){var t;return t=$("#subscription").serializeArray(),$.ajax({url:window.location.pathname+".json",data:$("#subscription").serialize(),dataType:"json",type:"PATCH",success:function(t){return function(){return t.pollingCardStatus()}}(this),error:function(t){return function(e){return t.error("Something went wrong. Please try later. ("+e.statusText+")",".credit_card_form_errors"),t.enableForm()}}(this)})},t.prototype.handleStripeResponse=function(t,e){var i;return e.error?(e.error.param?(i=e.error.param,("exp_month"===i||"exp_year"===i)&&(i="expiration"),this.error(e.error.message,"."+i)):this.error(e.error.message,".credit_card_form_errors"),this.enableForm()):($("#subscription_stripe_card_token").val(e.id),this.submitForm())},t.prototype.pollingCardStatus=function(){var t,e;return e=function(){return function(){return setTimeout(function(){return t()},2e3)}}(this),t=function(){var t;return t=window.location.pathname,$.getJSON(t+("/card_status.json?"+parseInt(Date.now())),function(){return function(i){return"updating"!==i.stripe_status?window.location=t:e()}}(this))},e()},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.LinkLine=function(e){function n(){return this.drawLine=t(this.drawLine,this),this.setTransition=t(this.setTransition,this),this.handleMouseClick=t(this.handleMouseClick,this),this.handleMouseMoveImpl=t(this.handleMouseMoveImpl,this),this.handleMouseMove=t(this.handleMouseMove,this),this.snapCursorToButton=t(this.snapCursorToButton,this),this.hitTest=t(this.hitTest,this),this.setTransition=t(this.setTransition,this),this.scrollWindow=t(this.scrollWindow,this),this.resizeWindow=t(this.resizeWindow,this),this.abortLinkup=t(this.abortLinkup,this),this.setLinkToBack=t(this.setLinkToBack,this),this.finishLinkup=t(this.finishLinkup,this),this.startLinkup=t(this.startLinkup,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.id="link_line",n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.canvas=$('<canvas id="link_line">').appendTo(this.options.parent.$el).css({"pointer-events":"none"}),this.clockImage=$('<div class="canvas_clock_image">').appendTo(this.options.parent.$el),fleditor.local.vent.on("linkup:start",this.startLinkup),fleditor.local.vent.on("linkup:abort",this.abortLinkup),fleditor.local.vent.on("linkup:setBack",this.setLinkToBack),fleditor.local.vent.on("linkup:setTransition",this.setTransition),fleditor.local.vent.on("snapMouseToButton",this.snapCursorToButton),this.offsetTop=0,$("body").on("window:resize",this.resizeWindow),$("body").on("window:scroll",this.scrollWindow),$("body").on("keydown",this.handleKeydown)},n.prototype.startLinkup=function(t,e){if(this.bezierAnimation={animation:null,previous:{first:null},deg:{first:{start:null,end:null},second:{start:null,end:null}},dist:{first:{start:null,end:null},second:{start:null,end:null}}},this.isLinkup())throw"Something went wrong...";return fleditor.local.vent.trigger("disableZoomSlider"),this.canvas.css({top:this.offsetTop}),this.currentPoint=null,this.selectedScreen=null,this.linkView=t,this.linkRect=t.coordinates(),this.timedLink=!!t.model.get("timer"),this.linkView.$el.addClass("linkup"),this.screenViews=this.options.parent.screenViews,this.canvas.css({"pointer-events":"auto",cursor:"default"}),$("body").on("mouseup",this.handleMouseClick),$("body").on("mousemove",this.handleMouseMove),this.transition=this.linkView.model.get("transition"),this.sourceScreen=this.linkView.screen,this.drawLine(Point.fromEvent(e)),fleditor.local.vent.trigger("linkup:started",t)},n.prototype.finishLinkup=function(){return Animation.abortAnimation("snapLink"),Animation.abortAnimation("bezierAnimation"),fleditor.local.vent.trigger("enableZoomSlider"),this.linkView.model.linkup=!1,this.linkView.$el.removeClass("linkup"),this.clearCanvas(),this.clearStatusbarCanvas(),this.canvas.css({"pointer-events":"none"}),$("body").off("mouseup",this.handleMouseClick),$("body").off("mousemove",this.handleMouseMove),fleditor.local.vent.trigger("linkup:ended"),this.linkView.isSelected()||this.linkView.select(),this.linkView=null},n.prototype.setLinkToBack=function(){var t,e,i,n,r,s;s=this.screenViews;for(e in s)n=s[e],n.model.get("id")===this.linkView.model.get("target_id"),n.unhighlightLinkup();return this.linkView.setTargetToBack(),this.finishLinkup(),this.buttonToSnap?(t=this.buttonToSnap,this.destination=this.drawSnapOnStatusbar(t,1),r=function(e){return function(){return e.drawSnapOnStatusbar(t,1)}}(this),i=function(e){return function(i,n,r,s){return e.drawSnapOnStatusbar(t,n,r,s)}}(this),this.shrinkAnimation(1,200,r,i)):(Animation.abortAnimation("snapLink"),void Animation.abortAnimation("bezierAnimation"))},n.prototype.abortLinkup=function(){var t,e,i;
if(this.isLinkup()){this.selectedScreen&&this.selectedScreen.unhighlightLinkup(),i=this.screenViews;for(t in i)if(e=i[t],e.model.get("id")===this.linkView.model.get("target_id")){e.unhighlightLinkup();break}return this.linkView.model.get("target_id")||this.linkView.destroy(),this.finishLinkup(),this.clearLineAnimation()}},n.prototype.isLinkup=function(){return this.linkView},n.prototype.clearCanvas=function(){var t;return t=this.canvas[0].getContext("2d"),t.clearRect(0,0,this.canvas.width(),this.canvas.height())},n.prototype.handleKeydown=function(t){return t.which===fleditor.keys.ESC||t.which===fleditor.keys.DELETE?fleditor.local.vent.trigger("linkup:abort"):void 0},n.prototype.resizeWindow=function(){var t,e,i,n;return n=$(window).width(),e=$(window).height(),this.offsetTop=$(window).scrollTop(),this.canvas.css({top:this.offsetTop}),this.canvas.width(n),this.canvas.height(e),t=this.canvas[0].getContext("2d"),i=HiDPICanvasRatio(t),this.canvas[0].width=n*i,this.canvas[0].height=e*i,t.scale(i,i),this.setupContext()},n.prototype.scrollWindow=function(){var t,e;return e=$(window).scrollTop(),t=e-this.offsetTop,this.offsetTop=e,this.isLinkup()&&(this.canvas.css({top:this.offsetTop}),this.currentPoint)?this.handleMouseMoveImpl(this.currentPoint.offset(0,t)):void 0},n.prototype.offsetPoint=function(t){return t.offset(0,-this.offsetTop)},n.prototype.setTransition=function(t){return this.transition=t},n.prototype.hitTest=function(t,e){var i,n,r,s,o,a;o=this.screenViews,a=[];for(i in o){if(s=o[i],r=s.coordinates(-2),n=e(s,r.contains(t)),!n)break;a.push(void 0)}return a},n.prototype.cursorIsOnStatusbar=function(t){var e,i;return e=$("#link_statusbar"),0===e.length?null:(i=Rect.fromElement(e),t.y<i.origin.y+i.size.height+15?(t.y=i.origin.y+i.size.height+15,this.buttonToSnap?t=this.drawSnapOnStatusbar(this.buttonToSnap):this.clearStatusbarCanvas(),t):(this.clearStatusbarCanvas(),null))},n.prototype.drawSnapOnStatusbar=function(t,e,i,n){var r,s,o,a,l;return null==e&&(e=1),null==i&&(i=3),null==n&&(n=5),l=Rect.fromElement($("#link_statusbar")),o=new Point(t.offset().left+t.width()/2,7),r=$("#link_statusbar_canvas"),s=r[0].getContext("2d"),a=HiDPICanvasRatio(s),r[0].width=r.width()*a,r[0].height=15*a,s.scale(a,a),r.css({top:l.size.height-7,width:"100%",height:"15px"}),s.strokeStyle="rgba(255, 72, 19, "+e+")",s.fillStyle="rgba(255, 255, 255, "+e+")",s.lineWidth=i,s.lineCap="round",this.offsetPoint(o),s.beginPath(),s.moveTo(o.x,o.y),s.arc(o.x,o.y,n,0,2*Math.PI,!0),s.stroke(),s.beginPath(),s.moveTo(o.x,o.y),--n,0>n&&(n=0),s.arc(o.x,o.y,n,0,2*Math.PI,!0),s.fill(),o.y=l.origin.y+l.size.height-1,o},n.prototype.clearStatusbarCanvas=function(){var t;return t=$("#link_statusbar_canvas"),t.length?t[0].width=t[0].width:void 0},n.prototype.snapCursorToButton=function(t){return this.buttonToSnap=t},n.prototype.handleMouseMove=function(t){return this.handleMouseMoveImpl(Point.fromEvent(t))},n.prototype.handleMouseMoveImpl=function(t){var e,i,n,r;return this.currentPoint=t,e="default",(r=this.cursorIsOnStatusbar(t))?(this.selectedScreen&&this.selectedScreen.unhighlightLinkup(),this.selectedScreen=null,fleditor.local.vent.trigger("linkup:unhighlight"),this.drawLine(r),!1):(n=null,this.hitTest(t,function(t){return function(i,r){return r&&(n=i,n.cid!==t.sourceScreen.cid&&(e="pointer")),!0}}(this)),n!==this.selectedScreen?(this.selectedScreen&&this.selectedScreen.unhighlightLinkup(),i=!0,this.selectedScreen===this.sourceScreen&&null===n?i=!1:n===this.sourceScreen&&(i=!1),this.selectedScreen=n,this.drawLine(t,i)):this.drawLine(t),this.canvas.css({cursor:e}),this.selectedScreen?this.selectedScreen.selectLinkup():fleditor.local.vent.trigger("linkup:unhighlight"),!0)},n.prototype.handleMouseClick=function(t){var e;return e=Point.fromEvent(t),this.cursorIsOnStatusbar(e)?!1:this.timedLink&&$(t.target).hasClass("canvas_clock_image")?!1:(this.hitTest(e,function(t){return function(i,n){return n?t.linkRect.contains(e)?!0:(t.linkup(i),t.shrinkAnimation(1),t.selectedScreen&&t.selectedScreen.highlightLinkup(),!1):!0}}(this)),this.selectedScreen||this.linkRect.contains(e)||this.abortLinkup(),!0)},n.prototype.linkup=function(t){if(t.linkup())try{this.linkView.setTarget(t,this.transition)}catch(e){}return this.finishLinkup()},n.prototype.originateScreenId=function(){return this.linkView.model.get("screen_id")},n.prototype.setTransition=function(t){return this.transition=t},n.prototype.drawLine=function(t,e){var i,n,r,s,o;if(null==e&&(e=!1),this.destination=t,this.origin=this.linkRect.center(),this.origin.round(),this.destination.round(),this.snapOnOriginAndDest(!1),this.path=new BezierPath(this.origin,this.firstControlPoint(this.origin,this.destination),this.secondControlPoint(this.origin,this.destination),this.destination),this.selectedScreen&&this.linkView&&this.selectedScreen.model.get("id")!==this.linkView.model.get("screen_id")&&(o=this.selectedScreen),o&&(r=this.path.intersection(o.coordinates(-2),this.dest_dir)),e||Animation.isAnimating("snapLink")){if(o){if(this.startT1=this.currentT1?this.currentT1:this.t1,this.endT1=r?r.t:this.startT1,r&&Animation.isAnimating("snapLink")&&(n=r.point.distance(this.destination),100>n))return void Animation.abortAnimation("snapLink")}else this.startT1=this.currentT1?this.currentT1:this.t1,this.endT1=1;if(this.doBezierAnimation(this.path,this.currentT1,s),!e)return;return i=new Animation("snapLink",120),i.frame=function(t){return function(){return t.currentT1=i.easeOut(t.startT1,t.endT1),Animation.isAnimating("bezierAnimation")?void 0:t.drawBezierLine(t.path,0,t.currentT1,null,!0,!o)}}(this),i.finish=function(t){return function(){return t.currentT1=0,t.isLinkup()?(t.t1=t.endT1,t.drawBezierLine(t.path,0,t.endT1,null,!0,!o)):t.clearCanvas()}}(this),i.startAnimation()}return this.t1=r?r.t:1,s=!o,this.buttonToSnap&&(s=!1),this.doBezierAnimation(this.path,this.t1,s)?void 0:this.drawBezierLine(this.path,0,this.t1,null,!0,s)},n.prototype.doBezierAnimation=function(){return!1},n.prototype.shrinkAnimation=function(t,e,i,n){var r,s,o,a,l,h,u;return null==e&&(e=200),null==i&&(i=null),null==n&&(n=null),s=this.origin,o=this.destination,a=new BezierPath(this.origin,this.firstControlPoint(this.origin,this.destination),this.secondControlPoint(this.origin,this.destination),this.destination),this.selectedScreen?(u=this.selectedScreen.coordinates(-2),r=a.intersection(u,this.dest_dir),h=r?r.t:1):h=1,l=new Animation("shrinkLink",e),l.frame=function(e){return function(){var n,r,u,c;return n=e.setupContext(),e.setupShadow(n),t>0?(u=l.easeInOut(0,h),c=h):(u=0,c=l.easeInOut(h,0)),r=Rect.fromPoints(s,o).standardize().inset(-10,-10).offset(0,-e.offsetTop),r.clearRect(n),e.drawBezierLine(a,u,c,n,!1),i?i(a,u,c):void 0}}(this),l.finish=function(i){return function(){var a;return i.selectedScreen&&i.selectedScreen.unhighlightLinkup(!0),i.clearCanvas(),a=new Animation("ripple",e),a.frame=function(){var e,l,h,u;return l=i.canvas[0].getContext("2d"),e=Math.floor(a.easeOut(100,0))/100,l.strokeStyle="rgba(255, 72, 19, "+e+")",l.lineWidth=a.easeOut(3,0),u=a.easeOut(5,0),h=t>0?r?r.point:o:s,h=i.offsetPoint(h),l.clearRect(h.x-150,h.y-150,h.x+150,h.y+150),l.beginPath(),l.arc(h.x,h.y,u,0,2*Math.PI,!0),l.stroke(),n?n(h,e,l.lineWidth,u):void 0},a.finish=function(){return i.selectedScreen&&i.selectedScreen.unhighlightLinkup(),i.clearCanvas()},a.startAnimation()}}(this),l.startAnimation()},n.prototype.clearLineAnimation=function(){var t;return Animation.abortAnimation("snapLink"),Animation.abortAnimation("bezierAnimation"),t=new Animation("clearLine",100),t.frame=function(e){return function(){var i,n,r;return n=e.setupContext(),n.clearRect(0,0,e.canvas.width(),e.canvas.height()),i=parseInt(t.easeOut(100,0))/100,n.strokeStyle="rgba(255, 72, 19, "+i+")",n.fillStyle="rgba(255, 255, 255, "+i+")",r=e.t1?e.t1:1,e.drawBezierLine(e.path,0,r,n,!1,!0),e.buttonToSnap?e.drawSnapOnStatusbar(e.buttonToSnap,i):void 0}}(this),t.finish=function(t){return function(){return t.clearCanvas()}}(this),t.startAnimation()},n.prototype.snapOnOriginAndDest=function(){var t;return this.dest_dir=this.destination.x>this.origin.x?flinto.radian.left:flinto.radian.right,t=Rect.fromElement(this.sourceScreen.$el).inset(-2,-2),this.destination.y<t.origin.y||this.destination.y>t.bottom()?this.dest_dir=this.destination.y>this.origin.y?flinto.radian.top:flinto.radian.bottom:this.destination.x>=this.linkRect.origin.x&&this.destination.x<=this.linkRect.right()&&(this.dest_dir=this.destination.y>this.origin.y?flinto.radian.top:flinto.radian.bottom),this.origin_dir=this.dest_dir+Math.PI,this.origin_dir>=2*Math.PI&&(this.origin_dir-=2*Math.PI),this.linkRect.contains(this.destination)&&(this.origin_dir=this.linkRect.closestEdge(this.destination)),this.origin=this.linkRect.inset(1,1).anchorPoints(this.origin_dir),this.buttonToSnap?this.dest_dir=flinto.radian.bottom:void 0},n.prototype.firstControlPoint=function(t,e){return this.origin_dir%Math.PI===0?new Point(t.x+.75*(e.x-t.x),t.y):new Point(t.x,t.y+.75*(e.y-t.y))},n.prototype.secondControlPoint=function(t,e){return this.dest_dir%Math.PI===0?new Point(e.x-.75*(e.x-t.x),e.y):new Point(e.x,e.y-.75*(e.y-t.y))},n.prototype.drawBezierLine=function(t,e,i,n,r,s){var o,a;return null==e&&(e=0),null==i&&(i=1),null==n&&(n=null),null==r&&(r=!0),null==s&&(s=!1),r&&this.clearCanvas(),n||(n=this.setupContext()),this.setupShadow(n),n.beginPath(),o=t,(0!==e||0!==i)&&(o=t.partialPath(e,i)),o=this.offsetPoint(o),0===e&&(n.moveTo(o.p1.x,o.p1.y),n.arc(o.p1.x,o.p1.y,5,0,2*Math.PI,!0)),a=s?2:5,n.moveTo(o.p4.x,o.p4.y),n.arc(o.p4.x,o.p4.y,a,0,2*Math.PI,!0),o.draw(n),n.stroke(),n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.shadowColor="rgba( 0, 0, 0, 0)",n.beginPath(),0===e&&(n.moveTo(o.p1.x,o.p1.y),n.arc(o.p1.x,o.p1.y,4,0,2*Math.PI,!0)),s||(n.moveTo(o.p4.x,o.p4.y),n.arc(o.p4.x,o.p4.y,4,0,2*Math.PI,!0)),n.fill(),r&&this.timedLink?this.clockImage.show().css({top:o.p1.y-8,left:o.p1.x-8}):this.clockImage.hide()},n.prototype.setupContext=function(){var t;return t=this.canvas[0].getContext("2d"),t.strokeStyle="#ff461f",t.fillStyle="#ffffff",t.lineWidth=3,t.lineCap="round",t},n.prototype.setupShadow=function(t){return t.shadowOffsetX=0,t.shadowOffsetY=2,t.shadowBlur=1,t.shadowColor="rgba( 0, 0, 0, 0.22 )"},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.Links=function(e){function n(){return this.selectLinkGroup=t(this.selectLinkGroup,this),this.reorderZIndex=t(this.reorderZIndex,this),this.selectAllLinks=t(this.selectAllLinks,this),this.linkGroupRemoved=t(this.linkGroupRemoved,this),this.linkGroupAdded=t(this.linkGroupAdded,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.linkViews={},this.model.links.on("add",this.addOne,this),this.model.links.on("remove",this.removeLinkView,this),this.model.linkGroups.on("add",this.linkGroupAdded),this.model.linkGroups.on("remove",this.linkGroupRemoved),this.model.linkGroups.each(function(t){return function(e){return e.on("selectAllLinks",t.selectAllLinks),e.links.on("add",t.addOne,t),e.links.on("remove",t.removeLinkView,t)}}(this))},n.prototype.render=function(){return this.addAll(),this},n.prototype.linkViewsForId=function(t){return _.find(this.linkViews,function(e){return e.model.get("id")===t})},n.prototype.linkViewsForGroupId=function(t){return _.filter(this.linkViews,function(e){return e.model.get("link_group_id")===t})},n.prototype.resize=function(t){var e,i,n,r;n=this.linkViews,r=[];for(e in n)i=n[e],r.push(i.setScale(t));return r},n.prototype.removeLinkView=function(t){var e;return e=this.linkViews[t.cid],e&&(e.deselect(),e.unbindEvents(),t.get("timer")?this.timedLink=null:e.$el.remove()),delete this.linkViews[t.cid]},n.prototype.addAll=function(){return this.model.links.each(this.addOne,this),this.model.linkGroups.each(function(t){return function(e){return e.links.each(t.addOneCore,t)}}(this)),this.reorderZIndex(this.options.screenView.model.get("id"))},n.prototype.addOne=function(t){var e;return e=this.addOneCore(t),this.reorderZIndex(this.options.screenView.model.get("id")),e},n.prototype.addOneCore=function(t){var e;if(t.get("timer"))e=new fleditor.views.TimedLink({model:t,canvas:this,screen:this.options.screenView}).render(),this.timedLink=e;else{if(null===t.get("w")||null===!t.get("h"))return;e=new fleditor.views.Link({model:t,canvas:this,screen:this.options.screenView}),e.setScale(this.options.screenView.screenImageScaleFactor()),e.render(),this.$el.append(e.$el),e.initDragResize()}return this.linkViews[t.cid]=e,t.linkup&&fleditor.local.vent.trigger("linkup:start",e,t.clickEvent),e},n.prototype.destroy=function(){var t,e,i,n;i=this.linkViews,n=[];for(t in i)e=i[t],n.push(e.remove());return n},n.prototype.linkGroupAdded=function(t){return t.on("remove",this.linkGroupRemoved),t.links.each(function(t){return function(e){return t.addOne(e)}}(this)),t.links.on("add",this.addOne,this),t.links.on("remove",this.removeLinkView,this),t.on("selectAllLinks",this.selectAllLinks)},n.prototype.linkGroupRemoved=function(t){return t.off("remove"),t.off("selectAllLinks",this.selectAllLinks),t.links.each(function(t){return function(e){return t.removeLinkView(e)}}(this)),t.links.off("add",this.addOne,this),t.links.off("remove",this.removeLinkView,this)},n.prototype.selectAllLinks=function(t,e){return e===this.model.get("id")?t.links.each(function(t){return function(e){return t.linkViews[e.cid].select()}}(this)):void 0},n.prototype.reorderZIndex=function(){return this.topIndex=reorderLinkViews(this.linkViews),this.topIndex},n.prototype.resizeLinks=function(t,e){var i,n,r,s;r=this.linkViews,s=[];for(i in r)n=r[i],s.push(n.model.scale(t,e));return s},n.prototype.moveLinks=function(t){var e,i,n,r;n=this.linkViews,r=[];for(e in n)i=n[e],r.push(i.model.move(t));return r},n.prototype.highlightLinkGroup=function(t,e){var i,n,r,s;r=this.linkViews,s=[];for(i in r)n=r[i],s.push(n.model.get("link_group_id")===t.model.get("link_group_id")?e?n.$el.addClass("highlighted"):n.$el.removeClass("highlighted"):void 0);return s},n.prototype.selectLinkGroup=function(t){return this.model.linkGroups.each(function(e){return function(i){return i.id===t?i.links.each(function(t){return e.linkViews[t.cid].isSelected()?void 0:e.linkViews[t.cid].select()}):void 0}}(this))},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.Link=function(e){function n(){return this.restore=t(this.restore,this),this.restorePosition=t(this.restorePosition,this),this.recordNewPosition=t(this.recordNewPosition,this),this.setNewPosition=t(this.setNewPosition,this),this.snapToBottom=t(this.snapToBottom,this),this.cloneLink=t(this.cloneLink,this),this.initDragResize=t(this.initDragResize,this),this.destroy=t(this.destroy,this),this.disableTargetHighlight=t(this.disableTargetHighlight,this),this.deselectTarget=t(this.deselectTarget,this),this.selectTarget=t(this.selectTarget,this),this.hide=t(this.hide,this),this.show=t(this.show,this),this.screenDestroyed=t(this.screenDestroyed,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.className="link",n.prototype.events={mouseover:"selectTarget",mouseout:"deselectTarget"},n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.model.on("change",this.render,this),this.model.on("destroy",this.remove,this),this.model.on("linkup",this.linkup,this),this.model.on("clone",this.clone,this),this.model.on("select",this.select,this),this.model.on("restore",this.restore,this),this.model.on("show",this.show),this.model.on("hide",this.hide),this.model.on("snapToBottom",this.snapToBottom),this.model.on("startDrawing",this.startDrawing,this),this.model.on("stopDrawing",this.stopDrawing,this),fleditor.local.vent.on("screendestroyed",this.screenDestroyed),fleditor.local.vent.on("link:disable_highlight",this.disableTargetHighlight),this.canvas=this.options.canvas,this.screen=this.options.screen},n.prototype.unbindEvents=function(){return this.undelegateEvents(),this.model.off("change",this.render,this),this.model.off("destroy",this.remove,this),this.model.off("linkup",this.linkup,this),this.model.off("clone",this.clone,this),this.model.off("select",this.select,this),this.model.off("restore",this.restore,this),this.model.off("show",this.show),this.model.off("hide",this.hide),this.model.off("startDrawing",this.startDrawing,this),this.model.off("stopDrawing",this.stopDrawing,this),fleditor.local.vent.off("screendestroyed",this.screenDestroyed),fleditor.local.vent.off("link:disable_highlight",this.disableTargetHighlight)},n.prototype.rect=function(){return Rect.fromDimensions(_.pick(this,["x","y","w","h"]))},n.prototype.area=function(){return this.w*this.h},n.prototype.coordinates=function(){var t;return t=this.$el.offset(),Rect.fromDimensions(t.left,t.top,this.w,this.h)},n.prototype.screenDestroyed=function(t){return t.get("id")===this.model.get("target_id")?this.model.set("target_id",null):void 0},n.prototype.show=function(t){return t.cid===this.screen.cid?this.$el.show():void 0},n.prototype.hide=function(t){return t.cid===this.screen.cid?this.$el.hide():void 0},n.prototype.selectTarget=function(){return fleditor.local.vent.trigger("select_link_target",this.model.get("target_id"),this.model.get("screen_id"))},n.prototype.deselectTarget=function(){return fleditor.local.vent.trigger("deselect_link_target",this.model.get("target_id"),this.model.get("screen_id"))},n.prototype.disableTargetHighlight=function(t,e){return t!==this&&this.$el.toggleClass("drawing",e),e?(this.$el.off("mouseover"),this.$el.off("mouseout")):(this.$el.on("mouseover",this.selectTarget),this.$el.on("mouseout",this.deselectTarget))},n.prototype.setTarget=function(t,e){var i;return t&&(this.$el.removeClass("back"),i=t.model.get("id"),this.model.save({target_id:i,transition:e}),this.updateLinkAppearance()),this},n.prototype.setTargetToBack=function(){return this.$el.addClass("back"),this.model.save({target_id:-1})},n.prototype.startDrawing=function(){return this.$el.addClass("new")},n.prototype.stopDrawing=function(){return this.$el.removeClass("new")},n.prototype.clone=function(t){return this.$el.flinto_draggable("select",t,!0)},n.prototype.select=function(){return this.$el.flinto_draggable("select",{},!0)},n.prototype.deselect=function(){return this.$el.flinto_draggable("deselect"),this.model.get("link_group_id")?this.screen.highlightLinkGroup(this,!1):void 0},n.prototype.isSelected=function(){return this.$el.flinto_draggable("selected")},n.prototype.linkup=function(t){return this.tooSmall?this.model.destroy():(this.$el.hasClass("selected")||this.$el.flinto_draggable("select",t),fleditor.local.vent.trigger("linkup:start",this,t),this.canvas.reorderZIndex())},n.prototype.remove=function(){return this.unbindEvents(),this.$el.transition({opacity:0},150,function(t){return function(){return n.__super__.remove.apply(t,arguments)}}(this))},n.prototype.destroy=function(){return this.deselectTarget(),this.deselect(),this.model.isNew()&&this.remove(),this.model.destroy()},n.prototype.setScale=function(t){var e,i,n,r,s;for(this.scale=null!=t?t:t,s=["x","y","w","h"],n=0,r=s.length;r>n;n++)i=s[n],this[i]=this.model.get(i)*t;return this.containLink(),this.model.startSnapAnimation&&this.model.startSnapAnimation!==this||this.snapAnimation?this.snapToBottomAnimation(new Point(this.x,this.y)):this.$el.css({left:this.x,top:this.y,width:this.w,height:this.h}),this.$el.hasClass("ui-resizable")?(e=this.screen.minimumLinkSize()*t,this.$el.flinto_resizable("option",{minWidth:e,minHeight:e})):void 0},n.prototype.containLink=function(){var t,e;return t=this.screen.imageCoordinates(),t.origin=new Point(0,0),e=Rect.fromDimensions(this.x,this.y,this.w,this.h).containment(t),this.x=e.origin.x,this.y=e.origin.y},n.prototype.render=function(){return this.$el.attr("id",this.model.cid),-1===this.model.get("target_id")&&this.$el.addClass("back"),this.model.get("screen_id")||this.$el.addClass("group"),this.updateLinkAppearance(),this.model.hasChanged("x")||this.model.hasChanged("y")||this.model.hasChanged("w")||this.model.hasChanged("h")?this.setScale(this.scale):void 0},n.prototype.isDead=function(){var t,e;return t=null==this.model.get("target_id")&&!this.model.isNew()&&!this.model.linkup,fleditor.local.screenExists&&!fleditor.local.screenExists(this.model.get("target_id"))&&(t=!0),e=this.screen.minimumLinkSize(),this.model.linkup||this.model.get("id")||!(this.model.get("w")<e||this.model.get("h")<e)?this.tooSmall=!1:(t=!0,this.tooSmall=!0),t},n.prototype.updateLinkAppearance=function(){return this.$el.toggleClass("dead",this.isDead()),this},n.prototype.initDragResize=function(){var t;return t=this.$el.parents(".screen_image_wrapper"),this.$el.flinto_draggable({groupName:"links-"+this.screen.cid,containment:t,distance:3,clone:!0,selected:function(t){return function(){return t.model.get("link_group_id")&&t.screen.highlightLinkGroup(t,!0),fleditor.local.vent.trigger("link:select",t,t.screen),fleditor.local.vent.trigger("screen:deselectAll",t),fleditor.local.vent.trigger("slicer:deselect")}}(this),clicked:function(t){return function(e){return t.linkup(e)}}(this),unselected:function(t){return function(){return fleditor.local.vent.trigger("link:deselect",t),t.model.get("link_group_id")?t.screen.highlightLinkGroup(t,!1):void 0}}(this),start:function(e){return function(i,n){var r;return r=e.$el.offset(),e.dragStartMouseOffsetInElement=n.startPosition.subtract(new Point(r.left,r.top)),e.savePosition(),e.containerRect=Rect.fromElement(t).inset(-20,-20),fleditor.local.vent.trigger("link:disable_highlight",e,!0),e.isTouchBottomOfScreen()?e.model.snapToBottom=!0:void 0}}(this),drag:function(t){return function(e,i){return t.containerRect.contains(Point.fromEvent(e))?t.setNewPosition(!1):i.cloning?void 0:(fleditor.local.vent.trigger("linkgroup:dragstart",e),t.restorePosition(),t.$el.flinto_draggable("pause",e,!0))}}(this),stop:function(t){return function(e,i){return fleditor.local.vent.trigger("link:disable_highlight",t,!1),i.paused?void 0:i.cloning?t.cloneLink(e,i):t.recordNewPosition(!1)}}(this),moveBy:function(t){return function(e){return e=t.dragStartRect.origin.add(e),t.model.set({x:e.x/t.scale,y:e.y/t.scale})}}(this)}),this.$el.flinto_resizable({containment:t,start:function(t){return function(e){return t.$el.css({cursor:$(e.target).css("cursor")}).addClass("new"),t.screen.$el.css({cursor:$(e.target).css("cursor")}),t.$el.hasClass("selected")||t.$el.flinto_draggable("select",e),fleditor.local.vent.trigger("link:disable_highlight",t,!0),t.savePosition()}}(this),resize:function(t){return function(){return t.setNewPosition(!0)}}(this),stop:function(t){return function(e,i){return i.resized&&t.recordNewPosition(!0),fleditor.local.vent.trigger("link:disable_highlight",t,!1),t.$el.css({cursor:"pointer"}).removeClass("new"),t.screen.$el.css({cursor:"default"})}}(this)})},n.prototype.cloneLink=function(t,e){var i;return i=new fleditor.models.Link,i.cloneLink(this.model),i.set({x:e.element.position().left/this.scale,y:e.element.position().top/this.scale}),this.screen.addLink(i),i.save(),i.trigger("clone",t)},n.prototype.calcNewPosition=function(t){var e,i,n,r,s;return s=this.$el.position(),t?(n=s.left-this.dragStartRect.origin.x,r=s.top-this.dragStartRect.origin.y,i=this.$el.outerWidth()-this.dragStartRect.size.width,e=this.$el.outerHeight()-this.dragStartRect.size.height,Rect.fromDimensions(this.savedPosition[0]+n/this.scale,this.savedPosition[1]+r/this.scale,this.savedPosition[2]+i/this.scale,this.savedPosition[3]+e/this.scale)):Rect.fromDimensions(s.left/this.scale,s.top/this.scale,this.$el.outerWidth()/this.scale,this.$el.outerHeight()/this.scale)},n.prototype.isTouchBottomOfScreen=function(t){var e,i;return null==t&&(t=!0),i=this.screen.imageCoordinates(),e=t?Math.floor(this.$el.position().top)+Math.floor(this.$el.outerHeight()):Math.floor(this.y)+Math.floor(this.h),i.size.height<=e},n.prototype.snapToBottom=function(){var t;return this.isTouchBottomOfScreen()&&this.model.linkGroup?(t=_.max(this.model.linkGroup.screens,function(t){return t.actualScreenHeight()}),this.model.set({y:t.actualScreenHeight()-this.model.get("h")})):void 0},n.prototype.setNewPosition=function(t){var e,i;return i=this.calcNewPosition(t),this.isTouchBottomOfScreen()&&this.model.linkGroup?(e=_.max(this.model.linkGroup.screens,function(t){return t.actualScreenHeight()}),this.model.snapToBottom?this.model.startSnapAnimation=null:(this.model.startSnapAnimation=this,this.model.snapToBottom=!0),this.model.set({x:i.origin.x,y:e.actualScreenHeight()-i.size.height,w:i.size.width,h:i.size.height})):(this.model.snapToBottom?(this.model.snapToBottom=!1,this.model.startSnapAnimation=this):this.model.startSnapAnimation=null,this.model.set({x:i.origin.x,y:i.origin.y,w:i.size.width,h:i.size.height})),this.setScale(this.scale)},n.prototype.recordNewPosition=function(t){var e,i,n,r,s,o;for(i=this.calcNewPosition(t),this.isTouchBottomOfScreen()&&this.model.linkGroup?(e=_.max(this.model.linkGroup.screens,function(t){return t.actualScreenHeight()}),this.model.save({x:i.origin.x,y:e.actualScreenHeight()-i.size.height,w:i.size.width,h:i.size.height},{silent:!0})):this.model.save({x:i.origin.x,y:i.origin.y,w:i.size.width,h:i.size.height},{silent:!0}),o=["x","y","w","h"],r=0,s=o.length;s>r;r++)n=o[r],this[n]=this.model.get(n)*this.scale;return this.canvas.reorderZIndex(),this.setScale(this.scale)},n.prototype.savePosition=function(){var t,e,i,n;for(this.savedPosition=[],n=["x","y","w","h"],e=0,i=n.length;i>e;e++)t=n[e],this.savedPosition.push(this.model.get(t));return this.dragStartRect=Rect.fromDimensions(this.x,this.y,this.w,this.h)},n.prototype.restorePosition=function(){return this.model.trigger("restore",this.savedPosition)},n.prototype.restore=function(t){return Animation.abortAnimation("snapToBottom"+this.cid),this.model.set({x:t[0],y:t[1]},{silent:!0}),this.x=t[0]*this.scale,this.y=t[1]*this.scale,this.containLink(),this.$el.transition({left:""+this.x+"px",top:""+this.y+"px"},150,function(t){return function(){return t.deselectTarget()}}(this))},n.prototype.convertPoint=function(t){var e;return e=this.screen.imageCoordinates(),t.offset(-(e.origin.x+this.dragStartMouseOffsetInElement.x),-(e.origin.y+this.dragStartMouseOffsetInElement.y))},n.prototype.resumeDrag=function(t){var e,i,n,r;return this.$el.flinto_draggable("clicked")?(n=this.convertPoint(t),r=function(t){return function(e){return n=t.convertPoint(Point.fromEvent(e))}}(this),i=function(t,e,i){var n,r;return n=e.x+(i.x-e.x)*t,r=e.y+(i.y-e.y)*t,new Point(n,r)},$("body").bind("mousemove",r),e=new Animation("linkGroup",150),e.frame=function(r){return function(){var s,o;return s=e.easeOut(0,1),t=i(s,r.dragStartRect.origin,n),r.model.set({x:t.x/r.scale,y:t.y/r.scale}),o=t.subtract(r.dragStartRect.origin),r.$el.flinto_draggable("broadcast","moveBy",o)}}(this),e.finish=function(t){return function(){return $("body").unbind("mousemove",r),t.model.set({x:n.x/t.scale,y:n.y/t.scale}),t.$el.flinto_draggable("pause",null,!1),t.animating=!1}}(this),e.startAnimation(),this.animating=!0):void 0},n.prototype.snapToBottomAnimation=function(t){var e,i;return this.snapEndPoint=t,this.$el.css({width:this.w,height:this.h}),this.snapAnimation?void 0:(e=function(t,e,i){var n,r;return n=e.x+(i.x-e.x)*t,r=e.y+(i.y-e.y)*t,new Point(n,r)},this.snapAnimation=new Animation("snapToBottom"+this.cid,150),i=Point.fromElement(this.$el,!0),this.snapAnimation.frame=function(n){return function(){var r;return r=n.snapAnimation.easeOut(0,1),t=e(r,i,n.snapEndPoint),n.$el.css({left:t.x,top:t.y})}}(this),this.snapAnimation.finish=function(t){return function(){return t.snapAnimation=null}}(this),this.snapAnimation.startAnimation())},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.TimedLink=function(e){function n(){return this.destroy=t(this.destroy,this),this.deselectTarget=t(this.deselectTarget,this),this.selectTarget=t(this.selectTarget,this),this.screenDestroyed=t(this.screenDestroyed,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.className="link",n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.model.on("change",this.render,this),this.model.on("destroy",this.remove,this),this.model.on("select",this.select,this),fleditor.local.vent.on("screendestroyed",this.screenDestroyed),this.screen=this.options.screen,this.$el=this.screen.$el.find(".js-timed-screen")},n.prototype.unbindEvents=function(){return this.undelegateEvents(),this.model.off("change",this.render,this),this.model.off("destroy",this.remove,this),this.model.off("select",this.select,this),fleditor.local.vent.off("screendestroyed",this.screenDestroyed)},n.prototype.coordinates=function(){var t,e,i;return e=this.$el.offset(),i=this.$el.width(),t=this.$el.height(),Rect.fromDimensions(e.left+7,e.top+7,2,2)},n.prototype.area=function(){return 0},n.prototype.rect=function(){return new Rect(0,0,0,0)},n.prototype.setScale=function(){},n.prototype.screenDestroyed=function(t){return t.get("id")===this.model.get("target_id")&&t.get("id")!==this.model.get("screen_id")?this.model.save("target_id",null):void 0},n.prototype.selectTarget=function(){return fleditor.local.vent.trigger("select_link_target",this.model.get("target_id"),this.model.get("screen_id"))},n.prototype.deselectTarget=function(){return fleditor.local.vent.trigger("deselect_link_target",this.model.get("target_id"),this.model.get("screen_id"))},n.prototype.setTarget=function(t,e){var i;return t&&(this.$el.removeClass("back"),i=t.model.get("id"),this.model.save({target_id:i,transition:e}),this.updateLinkAppearance()),this},n.prototype.setTargetToBack=function(){return this.model.save({target_id:-1})},n.prototype.select=function(){return this.$el.addClass("selected")},n.prototype.deselect=function(){return this.$el.removeClass("linkup selected")},n.prototype.isSelected=function(){return this.$el.flinto_draggable("selected")},n.prototype.remove=function(){return this.unbindEvents(),this.$el.removeClass("active")},n.prototype.destroy=function(){return this.deselectTarget(),this.deselect(),this.model.destroy()},n.prototype.render=function(){return this.$el.addClass(this.isDead()?"dead":"active"),this},n.prototype.isDead=function(){var t;return t=null==this.model.get("target_id")&&!this.model.isNew()&&!this.model.linkup,fleditor.local.screenExists&&!fleditor.local.screenExists(this.model.get("target_id"))&&(t=!0),this.model.get("target_id")===this.screen.model.get("id")&&(t=!0),t},n.prototype.updateLinkAppearance=function(){return this.isDead()?this.$el.addClass("dead"):this.$el.removeClass("dead"),this},n.prototype.convertPoint=function(t){var e;return e=this.screen.imageCoordinates(),t.offset(-(e.origin.x+this.dragStartMouseOffsetInElement.x),-(e.origin.y+this.dragStartMouseOffsetInElement.y))},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Backbone.ModalView=function(e){function n(e){this.options=null!=e?e:e,this.toggle=t(this.toggle,this),this.transition=t(this.transition,this),fleditor.local.vent.on("modals:hide",this.hide,this),this.duration=175,n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={"click .modal_shade, .content":"hideIfShadeClick","click .close":"hide"},n.prototype.transition=function(t,e,i){var n,r,s,o,a,l;return null==t&&(t="in"),null==e&&(e=$.noop),null==i&&(i=!1),this.transitioning=!0,a=this.$el.find(".modal_shade"),n=this.$el.find(".content"),l=this.$el.find(".modal_shade, .content"),s=this.duration,o="ease-out",r=function(t){return function(){return t.transitioning=!1,"function"==typeof e?e():void 0}}(this),i?"in"===t?(this.$el.show(),a.css({display:"block",opacity:1}),n.css({opacity:0}).transition({opacity:1,duration:s,easing:o},function(){return function(){return r()}}(this))):(a.hide(),n.transition({opacity:0,duration:s,easing:o},function(t){return function(){return t.$el.hide(),r()
}}(this))):"in"===t?(this.$el.show(),l.css({display:"block",opacity:0}).transition({opacity:1,duration:s,easing:o},function(){return function(){return r()}}(this))):"out"===t?l.transition({opacity:0,duration:s,easing:o},function(t){return function(){return t.$el.hide(),r()}}(this)):void 0},n.prototype.show=function(t){var e;return null==t&&(t=$.noop),null!=fleditor.local.modal&&fleditor.local.modal.transitioning?void 0:(this.$el.find(".content").css({top:$(window).scrollTop()+100}),$("body").addClass("modal"),fleditor.local.vent.trigger("linkup:abort"),e=null!=fleditor.local.modal,e&&fleditor.local.modal.hide($.noop,!0),this.transition("in",t,e),fleditor.local.modal=this)},n.prototype.hide=function(t,e){return null==t&&(t=$.noop),null==e&&(e=!1),!this.transitioning&&this.$el.is(":visible")?(e||$("body").removeClass("modal"),this.transition("out",t,e),fleditor.local.modal=null):void 0},n.prototype.toggle=function(){return this.$el.is(":visible")?this.hide():this.show()},n.prototype.hideIfShadeClick=function(t){return!this.options.disallowShadeClick&&$(t.target).is(".modal_shade, .content")?this.hide():void 0},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.NumberInput=function(e){function n(e,i){this.$el=null!=e?e:el,this.options=null!=i?i:i,this.save=t(this.save,this),this.handleBlur=t(this.handleBlur,this),this.handleFocus=t(this.handleFocus,this),this.handleKeydown=t(this.handleKeydown,this),this.$el.on("keydown",this.handleKeydown),this.$el.on("focus",this.handleFocus)}return i(n,e),n.prototype.handleKeydown=function(t){var e,i;switch(t.which){case fleditor.keys.ENTER:return this.$el.blur(),this.save(this.getValue());case fleditor.keys.DELETE:return t.stopPropagation();case fleditor.keys.ESC:if(t.preventDefault(),t.stopPropagation(),i=parseInt(this.$el.data("previous_value")),parseInt(this.$el.val())===i)return void this.$el.blur();if(this.$el.val(i),this.options.update)return this.options.update(i,this.$el);break;case fleditor.keys.UP:case fleditor.keys.DOWN:if(i=this.getValue(),e=this.options.step?this.options.step:1,i=t.which===fleditor.keys.UP?i+e:i-e,0>i&&(i=0),this.setValue(i),t.preventDefault(),this.options.update)return this.options.update(i,this.$el)}},n.prototype.handleFocus=function(t){return this.$el.data("previous_value",this.$el.val()),setTimeout(function(){return function(){return t.target.select()}}(this),1),this.options.select?this.options.select(this.$el):void 0},n.prototype.handleBlur=function(){return this.save(this.getValue())},n.prototype.save=function(t){return this.dirty&&(t||(t=this.getValue()),this.$el.data("previous_value")!==t)?(this.$el.data("previous_value",t),this.options.save(t,this.$el),this.dirty=!1):void 0},n.prototype.getValue=function(){var t;return t=this.$el.val(),t=parseInt(t),isNaN(t)&&(t=0),t=this.setValue(t)},n.prototype.setValue=function(t){return this.dirty=!0,this.options.maxValue&&(t=Math.min(t,this.options.maxValue(t))),this.options.minValue&&(t=Math.max(t,this.options.minValue(t))),0>t&&(t=0),this.$el.val(t),t},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.LinkStatusbar=function(e){function n(){return this.updateIgnoreHistory=t(this.updateIgnoreHistory,this),this.linkGroupDragCancel=t(this.linkGroupDragCancel,this),this.linkGroupDragStop=t(this.linkGroupDragStop,this),this.linkGroupDragMove=t(this.linkGroupDragMove,this),this.linkGroupDragStart=t(this.linkGroupDragStart,this),this.ungroup=t(this.ungroup,this),this.addToGroup=t(this.addToGroup,this),this.groupLinks=t(this.groupLinks,this),this.pasteLinks=t(this.pasteLinks,this),this.copyLinks=t(this.copyLinks,this),this.deleteLink=t(this.deleteLink,this),this.setBackLink=t(this.setBackLink,this),this.handleLinkupDeselect=t(this.handleLinkupDeselect,this),this.handleLinkupSelect=t(this.handleLinkupSelect,this),this.setTransitionMenu=t(this.setTransitionMenu,this),this.applyMultipleLinksToStatusbar=t(this.applyMultipleLinksToStatusbar,this),this.applyLinkToStatusbar=t(this.applyLinkToStatusbar,this),this.updateLinkGroupButtons=t(this.updateLinkGroupButtons,this),this.updateStatusbar=t(this.updateStatusbar,this),this.deselectLink=t(this.deselectLink,this),this.linkupEnded=t(this.linkupEnded,this),this.handleKeydown=t(this.handleKeydown,this),this.hideLinkupStatusbar=t(this.hideLinkupStatusbar,this),this.showLinkupStatusbar=t(this.showLinkupStatusbar,this),this.showLinkStatusbar=t(this.showLinkStatusbar,this),this.deselectAllLinks=t(this.deselectAllLinks,this),this.chooseTransition=t(this.chooseTransition,this),this.setTransitionFromKeyPress=t(this.setTransitionFromKeyPress,this),this.enableTransitionMenu=t(this.enableTransitionMenu,this),this.disableTransitionMenu=t(this.disableTransitionMenu,this),this.transitionMenuActive=t(this.transitionMenuActive,this),this.mouseLeaveTransition=t(this.mouseLeaveTransition,this),this.mouseEnterTransition=t(this.mouseEnterTransition,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={"click .back":"setBackLink","click .abort":"abortLinkup","click .delete":"deleteLink","click .delete_timed_link":"deleteLink","click #transitions:not(.disabled) .transition":"chooseTransition","mouseenter #transitions:not(.disabled) .transition":"mouseEnterTransition","mouseleave #transitions:not(.disabled) .transition":"mouseLeaveTransition","click .ignore_history":"updateIgnoreHistory","click .group_links":"groupLinks","click .expand_to_group":"groupLinks","click .ungroup":"ungroup","click .add_to_group":"addToGroup","mouseover .back":"hoverButton","mouseout  .back":"blurButton"},n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.copiedLinks=[],this.selectedLinks=[],this.selectedScreen=null,this.container=this.options.container,this.screens=this.options.collection,this.screenCanvas=this.options.screensView,fleditor.local.vent.on("linkup:highlight",this.handleLinkupSelect),fleditor.local.vent.on("linkup:unhighlight",this.handleLinkupDeselect),fleditor.local.vent.on("linkup:started",this.showLinkupStatusbar),fleditor.local.vent.on("linkup:ended",this.linkupEnded),fleditor.local.vent.on("link:select",this.showLinkStatusbar),fleditor.local.vent.on("link:deselect",this.deselectLink),fleditor.local.vent.on("link:deselectAll",this.hideLinkupStatusbar),fleditor.local.vent.on("linkup:setTransition",this.setTransitionFromKeyPress),fleditor.local.vent.on("linkgroup:dragstart",this.linkGroupDragStart),this.transitionMenu=this.$el.find("#transitions"),this.backButton=this.$el.find(".back"),this.transitionPreviewStatuses={},this.ignoreHistory=this.$el.find(".ignore_history"),this.timerInput=new fleditor.views.NumberInput($("#timed_link_duration"),{save:function(t){return function(e){return 0===e?(t.deleteLink(),t.abortLinkup()):t.hasTimedLink()?t.selectedLinks[0].model.save("timer",e):void 0}}(this),maxValue:function(){return function(){return 1e4}}(this),minValue:function(){return function(t){return 0===t?0:100}}(this),step:100})},n.prototype.mouseEnterTransition=function(t){var e,i,n,r,s,o,a,l,h,u;return a=$(t.target).closest(".transition"),u=a.data("value"),n=$("<div>").addClass("container"),o=a.find(".label").hide(),s=o.html(),e=$("<div>").addClass("from label").html(s),i=$("<div>").addClass("to label").html(s),n.append(e,i).appendTo(a.find(".inner")),r={$el:e,attributes:0},l={$el:i,attributes:0},h=new flviewer.Transition({viewer_width:n.width(),viewer_height:n.height()}),h.transition(u,r,l,!1,$.noop)},n.prototype.mouseLeaveTransition=function(t){var e;return e=$(t.target).closest(".transition"),e.find(".container").remove(),e.find(".label").show()},n.prototype.transitionMenuActive=function(){},n.prototype.disableTransitionMenu=function(){return this.transitionMenu.addClass("disabled")},n.prototype.enableTransitionMenu=function(){return this.transitionMenu.removeClass("disabled")},n.prototype.setTransitionFromKeyPress=function(t){return t-=49,$(this.transitionMenu.find(".transition")[t]).click()},n.prototype.chooseTransition=function(t){var e,i;return e=$(t.target).closest(".transition"),i=e.data("value"),fleditor.local.vent.trigger("linkup:setTransition",i),this.setTransitionMenu(i),this.linkup?void 0:_.each(this.selectedLinks,function(t){return t.model.save("transition",i)})},n.prototype.setSourceScreenTitleTitle=function(t){var e;return e=this.$el.find(".destination"),e.find(".value").text(t.get("title"))},n.prototype.setTargetScreenTitle=function(t){var e,i,n,r;return e=this.$el.find(".destination"),n=t.get("target_id"),r=e.find(".value"),-1===n?r.text("Back"):(i=this.screens.find(function(t){return t.get("id")===n}),r.text(i?i.get("title"):"\u22ef"))},n.prototype.deselectAllLinks=function(){return _.each(this.selectedLinks,function(t){return t.deselect()}),this.selectedLinks=[]},n.prototype.showLinkStatusbar=function(t,e){return this.linkup=null,(this.selectedScreen!==e||t.model.get("timer")||this.hasTimedLink())&&this.deselectAllLinks(),this.selectedScreen=e,this.selectedLinks.length&&this.$el.addClass("multiple").removeClass("single"),this.addLink(t),this.container.showStatusbar("link"),this.bindKeyEvent("on")},n.prototype.showLinkupStatusbar=function(t){return _.each(this.selectedLinks,function(e){return e!==t?e.deselect():void 0}),this.linkup=t,this.$el.addClass("linkup").removeClass("multiple").removeClass("single"),this.addLink(t),this.container.showStatusbar("link"),this.enableTransitionMenu(),this.bindKeyEvent("on")},n.prototype.hideLinkupStatusbar=function(){return this.timerInput.save(),this.$el.removeClass("linkup"),this.linkup=null,this.$el.find(".destination .value").removeClass("empty"),this.container.hideStatusbar("link"),this.deselectAllLinks(),this.bindKeyEvent("off")},n.prototype.bindKeyEvent=function(t){return this.eventBinded!==t?($("body")[t]("keydown",this.handleKeydown),this.eventBinded=t):void 0},n.prototype.handleKeydown=function(t){if(!fleditor.local.modal&&"INPUT"!==t.target.tagName)switch(t.which){case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:return this.setTransitionFromKeyPress(t.which);case 66:return this.setBackLink(t);case 85:return this.ungroup();case 71:if(this.groupLinks(),this.$el.find(".add_to_group").is(":visible"))return this.addToGroup();break;case 73:return this.updateIgnoreHistory();case fleditor.keys.ESC:return this.linkGroupDragCancel(),this.hideLinkupStatusbar();case fleditor.keys.DELETE:return t.preventDefault(),this.deleteLink()}},n.prototype.linkupEnded=function(){var t;return t=this.targetScreenView(this.linkup),t&&t.trigger("linkup:unhighlight"),this.linkup=null,this.$el.removeClass("linkup"),this.updateStatusbar()},n.prototype.deselectLink=function(t){return this.selectedLinks=_.without(this.selectedLinks,t),this.updateStatusbar()},n.prototype.addLink=function(t){var e;return e=_.without(this.selectedLinks,t),e.push(t),this.selectedLinks=e,this.updateStatusbar()},n.prototype.updateStatusbar=function(){var t;return 0===this.selectedLinks.length?this.hideLinkupStatusbar():1===this.selectedLinks.length?this.applyLinkToStatusbar(this.selectedLinks[0]):this.applyMultipleLinksToStatusbar(this.selectedLinks),this.updateLinkGroupButtons(),this.hasTimedLink()?(this.$el.addClass("timed_link"),t=this.selectedLinks[0].model.get("timer"),$("#timed_link_duration").val(t)):this.$el.removeClass("timed_link")},n.prototype.hasTimedLink=function(){return 1===this.selectedLinks.length&&this.selectedLinks[0].model.get("timer")},n.prototype.updateLinkGroupButtons=function(){var t,e,i;if(this.$el.find(".group").hide(),!this.hasTimedLink())if(t=_.groupBy(this.selectedLinks,function(t){return t.model.linkGroup&&t.model.linkGroup.cid||0}),1===_.size(t)){if("0"===_.keys(t)[0]&&_.size(t[0])>1)return this.$el.find(".group_links").show();if(this.selectedLinks[0].model.linkGroup){if(i=_.values(t)[0].length,e=this.selectedLinks[0].model.linkGroup.links.size(),i===e)return this.$el.find(".ungroup").show();if(e>i)return this.$el.find(".expand_to_group").show()}}else if(2===_.size(t)&&-1!==_.indexOf(_.keys(t),"0"))return this.$el.find(".add_to_group").show()},n.prototype.applyLinkToStatusbar=function(t){return this.$el.addClass("single").removeClass("multiple"),this.$el.find(".num_links").text(""),this.setSourceScreenTitleTitle(t.options.screen.model),this.setTargetScreenTitle(t.model),-1===t.model.get("target_id")?(this.ignoreHistory.hide(),this.backButton.addClass("on"),this.setTransitionMenu("__back"),this.disableTransitionMenu()):(this.ignoreHistory.show().toggleClass("on",!!t.model.get("ignore_history")),this.backButton.removeClass("on"),this.setTransitionMenu(t.model.get("transition")),this.enableTransitionMenu())},n.prototype.targetScreenView=function(t){return t?this.screens.find(function(e){return e.get("id")===t.model.get("target_id")}):null},n.prototype.applyMultipleLinksToStatusbar=function(t){var e,i,n;return this.$el.addClass("multiple").removeClass("single"),this.$el.find(".num_links").text(this.selectedLinks.length+" "),this.$el.find(".destination").find(".value").text("..."),n=_.reduce(t,function(t,e){return t&&t.model.get("transition")===e.model.get("transition")?t:null}),this.setTransitionMenu(n?n.model.get("transition"):"multiple"),e=_.reduce(t,function(t,e){return t&&-1===t.model.get("target_id")&&-1===e.model.get("target_id")?t:null}),this.backButton.toggleClass("on",!!e),e?void 0:(i=_.reduce(t,function(t,e){return t&&t.model.get("ignore_history")&&e.model.get("ignore_history")?t:null}),this.ignoreHistory.toggleClass("on",!!i))},n.prototype.setTransitionMenu=function(t){var e,i;return t||(t="none"),this.transitionMenu.find(".transition").removeClass("selected"),"__back"!==t?(e=this.transitionMenu.find(".transition[data-value="+t+"]"),i="none"===t?"Choose Transition":e.data("transition-name"),this.transitionMenu.find(".a").text(i),"multiple"!==t?e.addClass("selected")[0]:void 0):void 0},n.prototype.handleLinkupSelect=function(t){var e;return this.linkup&&(this.$el.find(".destination .value").text(t.model.get("title")),e=this.targetScreenView(this.linkup),e&&e.cid!==t.model.cid)?e.trigger("linkup:unhighlight"):void 0},n.prototype.handleLinkupDeselect=function(){var t;return this.linkup&&(this.setTargetScreenTitle(this.linkup.model),t=this.targetScreenView(this.linkup))?t.trigger("linkup:highlight"):void 0},n.prototype.setBackLink=function(t){var e;return this.linkup&&null!=(e=this.targetScreenView(this.linkup))&&e.trigger("unhighlight"),this.linkup?fleditor.local.vent.trigger("linkup:setBack"):_.each(this.selectedLinks,function(t){return t.model.save({target_id:-1,ignore_history:!1})}),this.ignoreHistory.removeClass("on").hide(),this.setTransitionMenu("__back"),this.disableTransitionMenu(),this.backButton.addClass("on"),t?(t.preventDefault(),t.stopPropagation()):void 0},n.prototype.abortLinkup=function(){return fleditor.local.vent.trigger("linkup:abort"),this.hideLinkupStatusbar()},n.prototype.deleteLink=function(){return this.copiedLinks=[],this.selectedLinks?(_.each(this.selectedLinks,function(t){return t.destroy()}),this.selectedLinks=[],this.hideLinkupStatusbar()):void 0},n.prototype.hoverButton=function(){var t;return t=$("#link_back_button"),fleditor.local.vent.trigger("snapMouseToButton",t)},n.prototype.blurButton=function(){return fleditor.local.vent.trigger("snapMouseToButton",0)},n.prototype.copyLinks=function(){return this.copiedLinks=_.clone(this.selectedLinks)},n.prototype.pasteLinks=function(t){var e,i;return 0!==_.size(this.copiedLinks)?(e=_.groupBy(this.copiedLinks,function(t){return t.model.linkGroup&&t.model.linkGroup.cid||0}),this.copiedLinks=[],i=[],_.each(e,function(e){return function(n,r){var s,o,a;return 0===parseInt(r)?(o=e.makeGroup(n),o.copyTo(t.model),_.each(n,function(t){return e.copiedLinks.push(e.selectedScreen.linksView.linkViewsForId(t.model.id))}),i.push(o)):(a=n[0].model.linkGroup,s=a.get("id")||0,t.model.linkGroups.find(function(t){return t.id===parseInt(s)})||(a.copyTo(t.model),_.each(n,function(t){return e.copiedLinks.push(e.selectedScreen.linksView.linkViewsForId(t.model.id))})),i.push(a))}}(this)),i):void 0},n.prototype.makeGroup=function(t,e){var i,n;return null==e&&(e=$.noop),n=t[0].screen.model,i=new fleditor.models.LinkGroup({links:[]},{screen:n,prototypeId:this.container.model.get("id")}),_.each(t,function(){return function(t){return n.links.remove(t.model)}}(this)),_.each(t,function(t){return i.links.add(t.model)}),n.linkGroups.add(i),i.links.each(function(){return function(t){return t.linkGroup=i,t.set({screen_id:null})}}(this)),i.save(function(){return function(){return i.links.each(function(t){return t.set({screen_id:null,link_group_id:i.get("id")})}),e(i)}}(this)),i.links.each(function(t){return t.trigger("select")}),i},n.prototype.groupLinks=function(){var t;return this.$el.find(".group_links").is(":visible")?this.makeGroup(this.selectedLinks,function(t){return function(){return t.updateLinkGroupButtons()}}(this)):(t=_.groupBy(this.selectedLinks,function(t){return t.model.get("link_group_id")||0}),1!==_.size(t)||_.has(t,"0")?void 0:this.selectedScreen.selectLinkGroup(parseInt(_.keys(t)[0])))},n.prototype.addToGroup=function(){var t,e,i;return i=_.groupBy(this.selectedLinks,function(t){return t.model.get("link_group_id")||0}),t=_.find(_.keys(i),function(t){return 0!==parseInt(t)}),e=this.selectedScreen.model.linkGroups.find(function(){return function(e){return e.id===parseInt(t)}}(this)),_.each(i[0],function(t){return function(e){return t.selectedScreen.model.links.remove(e.model)}}(this)),e.addLinks(this.selectedScreen.model.get("id"),_.map(i[0],function(t){return t.model})),this.deselectAllLinks(),e.trigger("selectAllLinks",e,this.selectedScreen.model.get("id")),this.updateLinkGroupButtons()},n.prototype.ungroup=function(){var t,e;return this.$el.find(".ungroup").is(":visible")?(t=this.selectedLinks[0].model.get("link_group_id"),e=this.selectedScreen.model.linkGroups.find(function(e){return e.id===t}),e.ungroup(this.selectedScreen.model),e.links.each(function(t){return function(e){var i;return i=new fleditor.models.Link,i.cloneLink(e),i.set({link_group_id:null,screen_id:t.selectedScreen.model.get("id")}),t.selectedScreen.model.links.add(i),i.save(),i.trigger("select")}}(this)),this.updateLinkGroupButtons()):void 0},n.prototype.linkGroupDragStart=function(t){var e,i,n,r;return this.linkGroupDragging?void 0:($("body").bind("mousemove",this.linkGroupDragMove),$("body").bind("mouseup",this.linkGroupDragStop),$("body").css({cursor:"copy"}),this.linkGroupDragging=!0,this.copyLinks(),e=[],r=_.groupBy(this.selectedLinks,function(t){return t.model.get("link_group_id")||0}),_.each(r,function(t){return function(i,n){return n=parseInt(n),e=0===n?_.union(e,i):_.union(e,t.selectedScreen.linksView.linkViewsForGroupId(n))}}(this)),this.pt=Point.fromEvent(t),this.draggingLinks=_.map(e,function(t){var e,i;return e=t.$el.clone().empty(),i=t.$el.offset(),e.appendTo($("body")).css({position:"absolute",left:i.left,top:i.top}).attr("class","dragging_link"),e.data("model",t.model),e.originalView=t,e}),n=function(t,e,i){var n,r,s,o;return s=e.origin.x+(i.origin.x-e.origin.x)*t,o=e.origin.y+(i.origin.y-e.origin.y)*t,r=e.size.width+(i.size.width-e.size.width)*t,n=e.size.height+(i.size.height-e.size.height)*t,Rect.fromDimensions(s,o,r,n)},i=new Animation("linkGroup",300),_.each(this.draggingLinks,function(t){return t.startRect=Rect.fromElement(t)}),i.frame=function(t){return function(){var e,r;return e=i.easeOut(0,1),r=0,_.each(t.draggingLinks,function(i){var s,o;return s=Rect.fromDimensions(t.pt.x-10+r,t.pt.y-10+r,20,20),o=n(e,i.startRect,s),i.css({left:o.origin.x,top:o.origin.y,width:o.size.width,height:o.size.height}),r+=3})}}(this),i.finish=function(t){return function(e){var i;return t.animating=!1,e?(i=0,_.each(t.draggingLinks,function(e){return e.css({left:t.pt.x-10+i,top:t.pt.y-10+i,width:20,height:20}),i+=3})):void 0}}(this),this.animating=!0,i.startAnimation())},n.prototype.linkGroupDragMove=function(t){var e,i,n,r,s,o,a;this.pt=Point.fromEvent(t),this.linkDropTargetScreen=null,this.animating||(n=0,_.each(this.draggingLinks,function(t){return function(e){return e.css({left:t.pt.x-10+n,top:t.pt.y-10+n}),n+=3}}(this))),o=this.screenCanvas.screenViews,a=[];for(e in o)r=o[e],r.imageCoordinates().contains(this.pt)?this.selectedScreen.model.cid!==r.model.cid?(i=_.keys(_.groupBy(this.selectedLinks,function(t){return t.model.get("link_group_id")||0})),s=_.keys(r.model.linkGroups.models),_.difference(i,s).length?(r.highlightAsLinkDropTarget(),a.push(this.linkDropTargetScreen=r)):a.push(void 0)):(this.linkGroupDragCancel(),a.push(_.each(this.selectedLinks,function(t){return function(e){return e.resumeDrag(t.pt)}}(this)))):a.push(r.unhighlightAsLinkDropTarget());return a},n.prototype.linkGroupDragStop=function(){var t,e;return Animation.abortAnimation("linkGroup"),$("body").css({cursor:""}),$("body").unbind("mousemove",this.linkGroupDragMove),$("body").unbind("mouseup",this.linkGroupDragStop),this.linkGroupDragging=!1,this.linkDropTargetScreen?(this.linkDropTargetScreen.unhighlightAsLinkDropTarget(),t=[],_.each(this.draggingLinks,function(i){return function(n){var r,s,o,a,l,h;return s=n.data("model"),l=i.linkDropTargetScreen.screenImageScaleFactor(),a=i.linkDropTargetScreen.$el.find(".screen_image").offset(),r=Rect.fromDimensions(0,0,i.linkDropTargetScreen.model.get("width"),i.linkDropTargetScreen.model.actualScreenHeight()),n.originalView.isTouchBottomOfScreen(!1)&&(h=r.size.height-s.get("h"),h>s.get("y")&&s.save({y:h},{silent:!0})),o=Rect.fromDimensions(s.get("x"),s.get("y"),s.get("w"),s.get("h")).containment(r),n.transition({left:o.origin.x*l+a.left,top:o.origin.y*l+a.top,width:o.size.width*l,height:o.size.height*l},300,function(){return t.push(n),_.size(t)===_.size(i.draggingLinks)?(_.each(e,function(t){return t.links.each(function(t){return t.trigger("show",i.linkDropTargetScreen)})}),_.each(t,function(t){return t.remove()})):void 0})}}(this)),e=this.pasteLinks(this.linkDropTargetScreen),_.each(e,function(t){return function(e){return e.links.each(function(e){return e.trigger("hide",t.linkDropTargetScreen)})}}(this))):_.each(this.draggingLinks,function(t){return t.remove()})},n.prototype.linkGroupDragCancel=function(){return Animation.abortAnimation("linkGroup"),$("body").css({cursor:""}),$("body").unbind("mousemove",this.linkGroupDragMove),$("body").unbind("mouseup",this.linkGroupDragStop),this.linkGroupDragging=!1,_.each(this.draggingLinks,function(t){return t.remove()})},n.prototype.updateIgnoreHistory=function(){var t;return t=!this.ignoreHistory.hasClass("on"),_.each(this.selectedLinks,function(e){return e.model.save("ignore_history",t)}),this.ignoreHistory.toggleClass("on",t)},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.NetworkError=function(e){function n(){return this.server_error=t(this.server_error,this),this.network_error=t(this.network_error,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={"click .button":"hide"},n.prototype.initialize=function(){return this.events=_.extend(this.events,Backbone.ModalView.prototype.events),fleditor.local.vent.on("network_error",this.network_error),fleditor.local.vent.on("server_error",this.server_error),fleditor.local.vent.on("clear_network_error",this.hide,this),n.__super__.initialize.apply(this,arguments)},n.prototype.network_error=function(){return this.msg="Your network connection seems to be offline. You may lose work if you continue before reconnecting.",this.title="Network Error",this.button="Understood",this.showDialog()},n.prototype.server_error=function(){return this.msg="There was a server error saving your changes. Please try again later.",this.title="Server Error",this.button="Dismiss",this.showDialog()},n.prototype.showDialog=function(){return fleditor.local.modal!==this?(this.$el.find(".title").text(this.title),this.$el.find(".error_message").text(this.msg),this.$el.find(".button").text(this.button),this.show()):void 0},n}(Backbone.ModalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.PrototypeOnboard=function(e){function n(){return this.createVideo=t(this.createVideo,this),this.hide=t(this.hide,this),this.show=t(this.show,this),this.post=t(this.post,this),this.loadOnboardPrototype=t(this.loadOnboardPrototype,this),this.loadImage=t(this.loadImage,this),this.iconHoverOff=t(this.iconHoverOff,this),this.iconHoverOn=t(this.iconHoverOn,this),this.initOnboardIcon=t(this.initOnboardIcon,this),this.initPlayButton=t(this.initPlayButton,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.icon=this.$el.find("#icon_draggable"),this.createVideo(),this.initPlayButton(),fleditor.local.vent.on("onboard:toggle",this.toggle),fleditor.local.vent.trigger("onboard:toggle"),this.initOnboardIcon(),this.playQueued=!1,this.videoReady=!1,this.arrow=this.$el.find(".arrow"),this.isiPhonePortrait=this.$el.data("is_iphone_portrait"),this.isiPhonePortrait&&setTimeout(function(t){return function(){return t.prepareSampleImages()}}(this),500),n.__super__.initialize.apply(this,arguments)},n.prototype.initPlayButton=function(){return null==this.playButton&&(this.playButton=this.$el.find(".js-play_button")),this.playButton.click(function(t){return function(){var e,i;return mixpanel.track("Start Video (Editor Basics)"),t.videoReady?t.post("play"):t.playQueued=!0,i=t.$el.find(".poster_frame"),e=t.playButton.add(i),e.transition({opacity:0,duration:800},function(){return e.hide()})}}(this))},n.prototype.initOnboardIcon=function(){var t,e,i,n;return this.icon.hover(this.iconHoverOn,this.iconHoverOff),e=!1,n={x:0,y:0},i={x:0,y:0},t=null,this.icon.flinto_draggable({helper:function(e){return function(){return t=e.icon.clone(),$("body").append(t),t}}(this),start:function(t){return function(){return n=t.icon.offset(),t.icon.hide()}}(this),drag:function(r){return function(){var s,o,a;return i=t.offset(),!e&&(s=100,o=Math.abs(i.left-n.left),a=Math.abs(i.top-n.top),o>s||a>s)?(e=!0,r.$el.find(".modal_shade, .content").transition({opacity:0}),$("#fleditor").addClass("initial_upload_hover")):void 0}}(this),stop:function(i){return function(){var r,s;return e?($("#fleditor").removeClass("initial_upload_hover"),r=$("#instructions_drop_target"),s=r.offset(),t.transition({easing:"ease-out",duration:125,scale:.5,opacity:0},function(){return t.remove(),i.icon.show(),i.hide(),i.loadOnboardPrototype(),e=!1})):t.transition({top:n.top,left:n.left},function(){return t.remove(),i.icon.show()})}}(this)})},n.prototype.iconHoverOn=function(){return this.$el.find(".bezel, .arrow").css({opacity:0,display:"block"}).transition({opacity:1})},n.prototype.iconHoverOff=function(){return this.$el.find(".bezel, .arrow").transition({opacity:0},function(t){return function(){return t.arrow.hide()}}(this))},n.prototype.prepareSampleImages=function(){var t,e,i,n,r,s,o,a,l;for(this.sampleImages=[],this.protoAssets={},t=["/assets/follow_along_screens/Home@2x-978b3f5e6a856cdc41c690a4cfcee053.png","/assets/follow_along_screens/Topics@2x-39ac0cbd695311fc937b4f23ae4bfe70.png","/assets/follow_along_screens/Links@2x-d6ab4aea531892c837ea50d512036da0.png","/assets/follow_along_screens/Screens@2x-83eb3c250429e89e8dc876437cc29967.png","/assets/follow_along_screens/Sharing and Installing@2x-fe5ef5c3db4c2beb728012358dce55d4.png","/assets/follow_along_screens/Back Links@2x-9c677d39f9dec5604458d807d2dd82c1.png"],n=["/assets/follow_along_screens/Icon@2x-334fb075129037eaf51f46386e3b3715.png","/assets/follow_along_screens/Startup@2x-28008b1192b80623cbd01ae47c5abf73.png"],e=function(e){return function(){return _.size(e.protoAssets)===n.length&&_.size(e.sampleImages)===t.length&&(e.loadAllImage=!0,e.dropIcon)?e.loadOnboardPrototype():void 0}}(this),r=0,o=t.length;o>r;r++)i=t[r],this.loadImage(i,function(i){return function(n){return i.sampleImages[_.indexOf(t,n.name)]=n,n.name=n.name.slice(n.name.lastIndexOf("/")+1).replace(/([\w\s]+)-\w+\.png/,"$1"),e()}}(this));for(l=[],s=0,a=n.length;a>s;s++)i=n[s],l.push(this.loadImage(i,function(t){return function(i){var n;return n=i.name.match("Icon")?"icon":"startup",t.protoAssets[n]={filename:i.name.slice(i.name.lastIndexOf("/")+1),data_url:i.dataURL,content_type:i.type,file:i.blob},e()}}(this)));return l},n.prototype.loadImage=function(t,e){var i;return i=new XMLHttpRequest,i.open("GET",t,!0),i.responseType="arraybuffer",i.name=t,i.onload=function(){return function(t){var i,n,r,s,o,a,l,h,u,c,d;if(200===t.target.status){for(i=t.target.response,o=t.target.getResponseHeader("Content-Type"),c=new Uint8Array(i),u=c.length,r=new Array(u),h=d=0;u>=0?u>=d:d>=u;h=u>=0?++d:--d)r[h]=String.fromCharCode(c[h]);return a=r.join(""),n=window.btoa(a),l="data:"+o+";base64,"+n,s=new Blob([i],{type:o}),e({dataURL:l,blob:s,name:t.target.name,type:o,size:t.target.response.byteLength})}}}(this),i.send()},n.prototype.loadOnboardPrototype=function(){return this.dropIcon=!0,this.loadAllImage?(this.options.proto.screens.bulkUploadScreens(this.sampleImages),this.options.proto.set({title:"Follow Along",statusbar_style:"black-translucent"}),this.options.proto.directUploadImages(this.protoAssets),window.mixpanel?mixpanel.track("Drop Sample Images"):void 0):void 0},n.prototype.post=function(t,e){var i;return i={method:t},e&&(i.value=e),this.video[0].contentWindow.postMessage(JSON.stringify(i),this.url)},n.prototype.show=function(){return n.__super__.show.apply(this,arguments)},n.prototype.hide=function(t){return null==t&&(t=$.noop),this.post("pause"),this.finished&&(this.post("seekTo",0),this.video.css({opacity:1,display:"block"})),n.__super__.hide.call(this,t)},n.prototype.render=function(){return this},n.prototype.createVideo=function(){var t,e,i;return i=$("#editor_basics_video"),i.find("iframe").length?void 0:(t=$("<iframe>").attr({id:"vimeoplayer",src:"https://player.vimeo.com/video/64171190?api=1&player_id=vimeoplayer",width:"100%",height:"360",frameborder:"0",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowFullScreen:"true"}),i.prepend(t),this.video=$("#editor_basics_video iframe"),this.url=this.video.attr("src").split("?")[0],e=function(t){return function(e){var i;switch(i=JSON.parse(e.originalEvent.data),i.event){case"ready":if(t.videoReady=!0,t.post("addEventListener","pause"),t.post("addEventListener","finish"),t.post("addEventListener","playProgress"),t.playQueued)return t.post("play"),t.playQueued=!1;break;case"playProgress":return t.seconds=i.seconds;case"finish":return t.finished=!0,t.isiPhonePortrait&&($("#finish_frame").show(),t.video.transition({opacity:0},function(){return t.video.hide()})),mixpanel.track("Finish Video (Editor Basics)")}}}(this),$(window).off("message"),$(window).on("message",e))},n}(Backbone.ModalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};fleditor.views.PrototypePreview=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.id="prototype_preview",i.prototype.initialize=function(){return fleditor.local.vent.on("preview:toggle",this.toggle),fleditor.local.vent.on("preview:show",this.show),i.__super__.initialize.apply(this,arguments)},i.prototype.hide=function(){var t,e;return t=arguments,e=function(e){return function(){return"function"==typeof t[0]&&t[0](),$("body").removeClass("flviewer"),e.viewer=null,e.$el.find("#flviewer").remove(),e.$el.find("#flviewer_wrap").remove()}}(this),i.__super__.hide.call(this,e,t[1])},i.prototype.show=function(){var t,e;return $("body").addClass("flviewer"),e=$('<div id="flviewer" style="overflow:hidden"></div>'),this.$el.find(".inline_preview").addClass("inner").append(e),t=this.model.toViewerJSON(),this.viewer=new flviewer.Viewer(t,this.$el.find("#flviewer"),!1,!0),$("#flviewer_wrap").width(this.viewer.attributes.viewer_width+this.viewer.menubar_width).height(this.viewer.attributes.viewer_height+this.viewer.menubar_height),i.__super__.show.apply(this,arguments)
},i.prototype.render=function(){var t;return t=$('<div class="modal_shade"></div><div class="content"><div class="inline_preview"></div></div>'),this.$el.append(t),this.$el},i}(Backbone.ModalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.PrototypeHeader=function(e){function n(){return this.enableSlider=t(this.enableSlider,this),this.disableSlider=t(this.disableSlider,this),this.handleKeydown=t(this.handleKeydown,this),this.toggleShare=t(this.toggleShare,this),this.toggleSettings=t(this.toggleSettings,this),this.togglePreview=t(this.togglePreview,this),this.hideStatusbar=t(this.hideStatusbar,this),this.initStickyElement=t(this.initStickyElement,this),this.showStatusbar=t(this.showStatusbar,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={"click .preview  a":"togglePreview","click .settings_trigger":"toggleSettings","click .share_trigger":"toggleShare","click .add_screens a":"chooseScreens"},n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.model.on("change",this.render,this),$("body").on("keydown",this.handleKeydown),this.link_statusbar=new fleditor.views.LinkStatusbar({container:this,collection:this.model.screens,screensView:this.options.screensView,el:$("#link_statusbar")}).render(),this.screen_statusbar=new fleditor.views.ScreenStatusbar({container:this,collection:this.model.screens,linkStatusbar:this.link_statusbar,el:$("#screen_statusbar")}).render(),this.transitionMenu=this.link_statusbar.transitionMenu,this.statusbars={active:null,container:$("#fleditor_statusbars_container"),elements:{link:this.link_statusbar.$el,screen:this.screen_statusbar.$el}},this.uploader=new fleditor.views.ScreenUploader({collection:this.model.screens,screensView:this.options.screensView,prototypeId:this.model.get("id")}).render(),fleditor.local.vent.on("enableZoomSlider",this.enableSlider),fleditor.local.vent.on("disableZoomSlider",this.disableSlider)},n.prototype.showStatusbar=function(t){var e,i;return this.statusbars.active!==t?(i=this.statusbars.elements[t],this.statusbars.active?(e=this.statusbars.elements[this.statusbars.active].hide(),i.show(),this.initStickyElement(i),void(this.statusbars.active=t)):(this.statusbars.active=t,i.show(),this.initStickyElement(i))):void 0},n.prototype.initStickyElement=function(t){return $("#fleditor_statusbars_container").css("position").match("sticky")?void 0:t.data("sticky")?t.data("sticky").resetStickyElement():t.data("sticky",new flinto.StickyElement(t,{offset:$("#fleditor_header .standard_header").outerHeight()}))},n.prototype.hideStatusbar=function(t){var e;return this.statusbars.active&&this.statusbars.active===t&&(e=this.statusbars.elements[this.statusbars.active],this.statusbars.active=null,e.hide()),this.$el.find("ul.controls .drop").closest(".drop").removeClass("active")},n.prototype.chooseScreens=function(t){return t.preventDefault(),flinto.browserSupported()?getFiles(function(t){return function(e){return t.options.screensView.collection.bulkUploadScreens(e)}}(this)):alert("BROWSER UNSUPPORTED\n\nThe Flinto editor uses some cutting-edge HTML5 features that your browser doesn\u2019t seem to support. Please upgrade to the latest version of Safari, Google Chrome, or Firefox.")},n.prototype.togglePreview=function(){return $("#inline_preview_button").hasClass("disabled")?!1:(fleditor.local.vent.trigger("preview:toggle"),!1)},n.prototype.toggleSettings=function(){return fleditor.local.vent.trigger("settings:toggle"),!1},n.prototype.toggleShare=function(){return this.share||(this.share=new fleditor.views.PrototypeShare({model:this.model,el:$("#prototype_share")})),fleditor.local.vent.trigger("share:toggle"),!1},n.prototype.handleKeydown=function(t){if("INPUT"!==t.target.tagName){if(t.metaKey&&65===t.which&&null==fleditor.local.modal)return _.each(this.options.screensView.screenViews,function(t){return t.selectMultipleScreen(!0)}),void t.preventDefault();if(t.metaKey||t.ctrlKey||t.altKey)return!0;switch(t.which){case 65:if(null==fleditor.local.modal)return this.chooseScreens(t);break;case 80:return this.togglePreview();case 83:return this.toggleShare();case 188:return this.toggleSettings();case 189:return this.zoomOut(t);case 187:return this.zoomIn(t);case 48:return this.defaultSize();case fleditor.keys.ESC:return fleditor.local.vent.trigger("modals:hide")}}},n.prototype.defaultSize=function(){return this.resizer.flinto_slider("value",this.model.get("device_info").zoom_size["default"]),fleditor.local.vent.trigger("resize:stopped")},n.prototype.zoomIn=function(t){return t.metaKey||t.altKey||this.resizer.hasClass("disabled")?void 0:(this.resizer.flinto_slider("addValue",50),fleditor.local.vent.trigger("resize:stopped"))},n.prototype.zoomOut=function(t){return t.metaKey||t.altKey||this.resizer.hasClass("disabled")?void 0:(this.resizer.flinto_slider("addValue",-50),fleditor.local.vent.trigger("resize:stopped"))},n.prototype.disableSlider=function(){return this.resizer.flinto_slider("disable")},n.prototype.enableSlider=function(){return this.resizer.flinto_slider("enable")},n.prototype.render=function(){var t,e;return this.model.hasChanged("title")&&(e=this.$el.find(".title .display"),e.text(this.model.get("title"))),t=this.$el.find("#prototype_icon"),this.model.hasChanged("icon_url")&&(t.attr("src",this.model.get("icon_data_url")||this.model.get("icon_url")),t.imagesLoaded(function(){return fakeCrop(t.parent())})),this.model.hasChanged("precomposed_icon")&&t.parent().toggleClass("precomposed",this.model.get("precomposed_icon")),null==this.resizer&&(this.resizer=this.$el.find("#screen_resizer"),this.resizer.flinto_slider({max:this.model.get("device_info").zoom_size.max,min:this.model.get("device_info").zoom_size.min,step:1,value:this.model.get("zoom"),slide:function(t){return function(e,i){return t.model.set({zoom:i.value},{silent:!0}),fleditor.local.vent.trigger("zoom:changed")}}(this),change:function(t){return function(e,i){return t.model.save({zoom:i.value},{silent:!0}),fleditor.local.vent.trigger("zoom:changed")}}(this),start:function(){return function(){return $(".links").hide(),$(".slicers").hide()}}(this),stop:function(){return function(){return fleditor.local.vent.trigger("resize:stopped"),$(".links").show(),$(".slicers").show()}}(this)}),this.resizer.find(".ui-slider-handle").unbind("keydown"),0===this.model.screens.length&&this.disableSlider()),this},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};flinto.PrototypeIndexFilters=function(){function e(e){var i;null==e&&(e={}),this.updateNumHidden=t(this.updateNumHidden,this),this.applyFilters=t(this.applyFilters,this),this.handleFilterChange=t(this.handleFilterChange,this),this.clearAll=t(this.clearAll,this),this.loadValues=t(this.loadValues,this),this.saveValues=t(this.saveValues,this),i={table:$("#prototype_list_table"),filterDropdowns:$("#prototype_list_filters select"),clearFiltersButton:$(".js-clear_filters")},this.options=$.extend(i,e),this.options.filterDropdowns.change(this.handleFilterChange),this.options.clearFiltersButton.click(this.clearAll),this.loadValues()}return e.prototype.saveValues=function(){var t;return t={},this.options.filterDropdowns.each(function(){return function(e,i){var n;return n=$(i),t[n.attr("id")]=n.val()}}(this)),setCookie("prototype_index_filters",JSON.stringify(t),"/")},e.prototype.loadValues=function(){var t,e,i,n;if(t=readCookie("prototype_index_filters"),null!=t&&(n=JSON.parse(t)))for(e in n)i=n[e],$("#"+e).val(i);return this.applyFilters()},e.prototype.clearAll=function(){return this.options.filterDropdowns.val(""),this.applyFilters()},e.prototype.handleFilterChange=function(){return this.applyFilters()},e.prototype.applyFilters=function(){var t;return t=this.options.table.find("tbody tr"),this.options.table.show(),t.show(),this.options.filterDropdowns.each(function(){return function(e,i){var n,r,s;return r=$(i),n=r.attr("name"),s=r.val(),s.length?t.each(function(t,e){return e=$(e),(""+e.data(n)).match(s)?void 0:e.hide()}):void 0}}(this)),this.updateNumHidden(),this.saveValues()},e.prototype.updateNumHidden=function(){var t,e,i,n;return n=this.options.table.find("tbody tr"),t=n.size()-n.filter(":visible").size(),e=$(".num_filtered"),i=$(".num_filtered_value"),t===n.size()?(i.text("All"),e.find(".plural").show(),this.options.table.hide(),e.show()):(this.options.table.show(),0===t?e.hide():(i.text(t),1===t?e.find(".plural").hide():e.find(".plural").show(),e.show()))},e}(),jQuery(function(t){var e,i,n,r,s,o,a,l,h;return e=t("body"),e.hasClass("prototypes_index")&&(window.filters=new flinto.PrototypeIndexFilters,a=t("#prototype_list_table"),a.linkTableRows({excludeClass:"no_link",hoverClass:"hover"}),a.stupidtable(),i=readCookie("prototype_index_sort"),null!=i&&(i=JSON.parse(i),r=t(a.find("thead th")[i.column]),s="asc"===i.direction?"desc":"asc",r.data("sort-dir",s),r.click()),a.on("aftertablesort",function(t,e){var i;return i=JSON.stringify({column:e.column,direction:e.direction}),setCookie("prototype_index_sort",i,"/")}),t(".popover_trigger").popover({position:function(e,i){var n,r,s;return s=t(window).width(),r=e.offset(),n=s-r.left,n>i.width()+35?i.addClass("right"):i.removeClass("right"),i.css({top:-(i.height()/2-e.height()/2)})}}),l=function(e){var i,n,r;return i=e.children().addBack().filter(".on").size(),r=i>0?i:"+",n=t("[data-target="+e.parents(".popover").attr("id")+"]"),n.find(".count").text(r)},t(".popover ul li").on("click",function(e){var i,n;return n=t(e.target),n.addClass("loading"),i=n.hasClass("on")?"DELETE":"POST",t.ajax({url:"/prototypes/"+n.data("prototype_id")+"/collaboration",cache:!1,contentType:"application/json",processData:!1,type:i,data:JSON.stringify({user_id:n.data("user_id"),collaboration_id:n.data("collaboration_id")}),success:function(){return n.removeClass("loading"),n.toggleClass("on"),l(n.parent())}})}),t(".collaborators_list").each(function(e,i){return l(t(i))})),e.hasClass("new_prototype")?(t("#collaboration_id").selectDescription(),t("#prototype_statusbar_style").selectDescription(),i=readCookie("prototype_index_filters"),null!=i&&(i=JSON.parse(i),o=t("#collaboration_id"),n=o.find("option[value="+i.filter_team+"]"),n.size()&&!n.prop("disabled")?o.val(i.filter_team):(h=o.find("option:not([disabled])").first().val(),o.val())),t("input[type=radio]").on("click",function(e){return e.target.value.match(/android/)?t("#prototype_statusbar_style").attr("disabled",!0).val("black"):t("#prototype_statusbar_style").removeAttr("disabled")}),t("#prototype_model").on("change",function(e){var i,n;return i=!e.target.value.match(/iphone/)&&!e.target.value.match(/ipad/),n=t(".status_bar_style_container"),i?(n.find("#prototype_statusbar_style").val("black"),n.hide()):n.show()})):void 0})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.ReplaceScreen=function(e){function n(){return this.replaceScreen=t(this.replaceScreen,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={"click .insert":"insert","click .replace":"replace"},n.prototype.initialize=function(){return this.events=_.extend(this.events,Backbone.ModalView.prototype.events),fleditor.local.vent.on("replace_screen_with_same_name",this.replaceScreen),n.__super__.initialize.apply(this,arguments)},n.prototype.replaceScreen=function(t,e){return this.screens=t,this.callback=e,this.showDialog()},n.prototype.showDialog=function(){var t,e,i,n,r;if(fleditor.local.modal!==this){for(e=$("<ul>"),r=this.screens,i=0,n=r.length;n>i;i++)t=r[i],e.append($("<li>").text(t.file.name));return this.$el.find(".js-file_list").html(e),1===this.screens.length?(this.$el.find(".plural").hide(),this.$el.find(".singular").show()):(this.$el.find(".plural").show(),this.$el.find(".singular").hide()),this.show()}},n.prototype.insert=function(){return this.callback(!1),setTimeout(function(t){return function(){return t.hide()}}(this),150)},n.prototype.replace=function(){return this.callback(!0),setTimeout(function(t){return function(){return t.hide()}}(this),150)},n}(Backbone.ModalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.ScreenStatusbar=function(e){function n(){return this.saveSliceValue=t(this.saveSliceValue,this),this.updateSliceValue=t(this.updateSliceValue,this),this.sliceValueChanged=t(this.sliceValueChanged,this),this.deleteScreen=t(this.deleteScreen,this),this.cancelSelection=t(this.cancelSelection,this),this.keydownTitleEdit=t(this.keydownTitleEdit,this),this.changeTitle=t(this.changeTitle,this),this.chooseFile=t(this.chooseFile,this),this.unHighlightButton=t(this.unHighlightButton,this),this.highlightButton=t(this.highlightButton,this),this.setTitle=t(this.setTitle,this),this.deselectScreen=t(this.deselectScreen,this),this.handleKeydown=t(this.handleKeydown,this),this.hideScreenStatusbar=t(this.hideScreenStatusbar,this),this.showScreenStatusbar=t(this.showScreenStatusbar,this),this.setupSlice=t(this.setupSlice,this),this.applyMultipleClass=t(this.applyMultipleClass,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={"click .title_edit_button":"changeTitle","dblclick .title":"changeTitle","submit .title form":"commitTitleEdit","keydown .title form":"keydownTitleEdit","click .upload":"chooseFile","click .screen_button.delete":"deleteScreen","click .screen_button.abort":"cancelSelection","mouseover .linkup_button":"highlightButton","mouseout .linkup_button":"unHighlightButton"},n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.selectedScreens=[],this.container=this.options.container,this.screens=this.options.collection,fleditor.local.vent.on("screen:select",this.showScreenStatusbar),fleditor.local.vent.on("screen:deselect",this.deselectScreen),fleditor.local.vent.on("screen:deselectAll",this.hideScreenStatusbar),fleditor.local.vent.on("screen:titleChanged",this.setTitle),fleditor.local.vent.on("screen:delete",this.deleteScreen),fleditor.local.vent.on("slicer:changed",this.sliceValueChanged),this.numberInputs=[],this.numberInputs.push(new fleditor.views.NumberInput($("#statusbar_top_slice_value"),{update:this.updateSliceValue,save:this.saveSliceValue,select:this.selectSliceValue,maxValue:function(t){return function(){return _.min(_.map(t.selectedScreens,function(t){return t.slicers.top.maxSliceValue()}))}}(this)})),this.numberInputs.push(new fleditor.views.NumberInput($("#statusbar_bottom_slice_value"),{update:this.updateSliceValue,save:this.saveSliceValue,select:this.selectSliceValue,maxValue:function(t){return function(){return _.min(_.map(t.selectedScreens,function(t){return t.slicers.bottom.maxSliceValue()}))}}(this)})),this.numberInputs.push(new fleditor.views.NumberInput($("#statusbar_statusbar_height_value"),{update:this.updateSliceValue,save:this.saveSliceValue,select:this.selectSliceValue,maxValue:function(){return function(){return 120}}(this)}))},n.prototype.applyMultipleClass=function(){return 1===this.selectedScreens.length?this.$el.addClass("single").removeClass("multiple"):this.$el.removeClass("single").addClass("multiple")},n.prototype.setupSlice=function(){var t,e,i,n,r,s,o;for(o=["top_slice","bottom_slice","statusbar_height"],r=0,s=o.length;s>r;r++)n=o[r],i=_.map(this.selectedScreens,function(t){return t.model.get(n)}),e=1===_.uniq(i).length?i[0]:"\u22ef",t=this.$el.find("#statusbar_"+n+"_value"),t.val(e);return null},n.prototype.showScreenStatusbar=function(t,e){var i;return null==e&&(e=!1),this.hideForm(),e||this.deselectAllScreen(),this.addScreen(t),this.container.showStatusbar("screen"),this.applyMultipleClass(),this.setupSlice(),i=this.$el.find("#screen_button_paste_links"),_.size(this.options.linkStatusbar.copiedLinks)?i.show():i.hide(),this.bindKeyEvent("on")},n.prototype.hideScreenStatusbar=function(){var t,e,i,n;for(n=this.numberInputs,e=0,i=n.length;i>e;e++)t=n[e],t.save();return this.hideForm(),this.$el.find(".title .value").removeClass("empty"),this.container.hideStatusbar("screen"),this.deselectAllScreen(),this.bindKeyEvent("off")},n.prototype.bindKeyEvent=function(t){return this.eventBinded!==t?($("body")[t]("keydown",this.handleKeydown),this.eventBinded=t):void 0},n.prototype.handleKeydown=function(t){if(!fleditor.local.modal&&"INPUT"!==t.target.tagName)switch(t.which){case fleditor.keys.ESC:return this.hideScreenStatusbar();case fleditor.keys.DELETE:return t.preventDefault(),this.deleteScreen()}},n.prototype.deselectAllScreen=function(){return _.each(this.selectedScreens,function(t){return t.deselect()}),this.selectedScreens=[]},n.prototype.deselectScreen=function(t){return this.selectedScreens=_.without(this.selectedScreens,t),t.deselect(),this.applyMultipleClass(),this.setupSlice(),0===this.selectedScreens.length?this.hideScreenStatusbar():this.setTitle()},n.prototype.addScreen=function(t){var e;return e=_.without(this.selectedScreens,t),e.push(t),this.selectedScreens=e,this.setTitle()},n.prototype.setTitle=function(){var t,e,i;return t=this.$el.find("#screen_title_label"),i=$("#screen_statusbar_title_area"),1===this.selectedScreens.length?(t.show(),i.addClass("label"),e=""+this.selectedScreens[0].model.get("title")):(t.hide(),i.removeClass("label"),e=""+this.selectedScreens.length+" Screens"),this.$el.find("#screen_statusbar_title").text(e)},n.prototype.highlightButton=function(t){return $(t.target).addClass("hover")},n.prototype.unHighlightButton=function(t){return $(t.target).removeClass("hover")},n.prototype.chooseFile=function(){return this.selectedScreens[0].replaceScreen()},n.prototype.hideForm=function(){return this.$el.find(".title").removeClass("edit")},n.prototype.changeTitle=function(){var t;return this.selectedScreens.length>1?void 0:this.$el.find(".title").hasClass("edit")?void 0:(this.$el.find(".title").addClass("edit"),t=this.$el.find(".title input.title_input").val(this.selectedScreens[0].model.get("title")).focus().select())},n.prototype.keydownTitleEdit=function(t){return t.which===fleditor.keys.ESC&&(this.cancelTitleEdit(),t.target.blur()),t.stopPropagation()},n.prototype.commitTitleEdit=function(t){var e,i;return t.preventDefault(),this.hideForm(),e=this.$el.find(".title input"),i=e.val(),null!=i&&""!==i&&this.selectedScreens[0].model.save("title",i),this.setTitle()},n.prototype.cancelTitleEdit=function(){return this.hideForm()},n.prototype.cancelSelection=function(){return this.deselectAllScreen(),this.hideScreenStatusbar(),fleditor.local.vent.trigger("slicer:deselect")},n.prototype.deleteScreen=function(){return _.each(this.selectedScreens,function(t){return t.destroy()}),this.hideScreenStatusbar()},n.prototype.sliceValueChanged=function(t,e,i){var n;return n=this.$el.find("#statusbar_"+e+"_slice_value"),n.val(i)},n.prototype.updateSliceValue=function(t,e,i){var n;return null==i&&(i=!1),n=e.data("which_slice"),_.each(this.selectedScreens,function(){return function(e){return e.model.set(n,t),"statusbar_height"===n&&e.model.trigger("update_statusbar_height"),i?e.model.save(n,t):void 0}}(this))},n.prototype.saveSliceValue=function(t,e){return this.updateSliceValue(t,e,!0)},n.prototype.selectSliceValue=function(t){var e;return e=t.data("which_slice"),"statusbar_height"===e?void fleditor.local.vent.trigger("slicer:deselect"):fleditor.local.vent.trigger("slicer:select",event,{options:{which:e.replace(/_slice/,"")}})},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.PrototypeSettings=function(e){function n(){return this.handleImage=t(this.handleImage,this),this.updateStatus=t(this.updateStatus,this),this.initStatusBarStyleSelect=t(this.initStatusBarStyleSelect,this),this.handleDuplicate=t(this.handleDuplicate,this),this.handleOSChange=t(this.handleOSChange,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={"change input#settings_precomposed_icon":"togglePrecomposedPreview","submit form":"handleSubmit","click .cancel":"hide","click #duplicate_button":"handleDuplicate"},n.prototype.initialize=function(){var t,e;return this.events=_.extend(this.events,Backbone.ModalView.prototype.events),this.iconContainer=this.$el.find("#settings_icon"),fleditor.local.vent.on("settings:toggle",this.toggle),fleditor.local.vent.on("settings:show",this.show),this.images={},this.osInput=$("#settings_ios6_mode"),this.osInput.change(this.handleOSChange),new flinto.Tabs(this.$el.find(".tabs")),e=this.$el.find("img.startup_image"),e.on("load",function(){return function(){return fakeCrop(e.parent())}}(this)),t=this.iconContainer.find("img.icon_image"),t.on("load",function(e){return function(){return fakeCrop(t.parent()),e.model.get("device").match(/ipad/)?$("#settings_icon").addClass("ipad"):void 0}}(this)),this.initStatusBarStyleSelect(),new Flile(this.iconContainer,{multiple:!1,restrictDragDrop:function(){return function(){return null==fleditor.local.modal}}(this),handleFiles:function(t){return function(e){return t.handleImage("icon",e[0])}}(this)}),new Flile(this.$el.find("#settings_startup_image .image_upload_trigger"),{multiple:!1,restrictDragDrop:function(){return function(){return null==fleditor.local.modal}}(this),handleFiles:function(t){return function(e){return t.handleImage("startup",e[0])}}(this)}),this.model.on("change:status",this.updateStatus),n.__super__.initialize.apply(this,arguments)},n.prototype.handleOSChange=function(){var t;return t=this.osInput.is(":checked"),t?(this.$el.find(".ios_6").show(),this.$el.find(".ios_7").hide()):(this.$el.find(".ios_6").hide(),this.$el.find(".ios_7").show())},n.prototype.handleSubmit=function(t){var e,i,n,r,s,o,a,l,h,u;for(t.preventDefault(),s=$(t.target),r=$(t.target).serializeArray(),n={},o=0,l=r.length;l>o;o++)e=r[o],n[e.name]=e.value;for(u=["precomposed_icon","ios6_mode","show_tap_hints","show_active_tap"],a=0,h=u.length;h>a;a++)i=u[a],n[i]=null!=n[i]?!0:!1;return n.ios7_mode=!n.ios6_mode,this.model.isAndroid()&&(n.precomposed_icon=!0),_.size(this.images)&&this.model.directUploadImages(this.images),this.model.save(n),this.hide()},n.prototype.handleDuplicate=function(){return this.$el.find(".delete_button").prop("disabled",!0).css("pointer-events","none"),this.model.set("status","cloning"),this.updateStatus()},n.prototype.show=function(){return this.images={},this.render(),n.__super__.show.apply(this,arguments)},n.prototype.hide=function(){return clearTimeout(this.timeout),n.__super__.hide.apply(this,arguments)},n.prototype.initStatusBarStyleSelect=function(){var t;return t=$("#status_bar_style"),t.val(this.model.get("statusbar_style")),t.selectDescription().change(function(e){return function(){var i;return i=t.val(),t.parents(".status_bar_style").toggleClass("changed",i!==e.model.get("statusbar_style"))}}(this))},n.prototype.updateStatus=function(){var t;return t=this.$el.find(".js-duplicate"),null==this.waiter&&(this.waiter=new SnapWait(t.find(".js-wait"),{frames:["\u25cf\u25cb\u25cb","\u25cb\u25cf\u25cb","\u25cb\u25cb\u25cf","\u25cb\u25cb\u25cb"]})),"cloning"===this.model.get("status")?(t.data("was_cloning",!0),t.addClass("in_progress"),this.waiter.wait(),clearTimeout(this.timeout),this.timeout=setInterval(function(t){return function(){return t.model.fetch()}}(this),2e3),this.$el.find(".delete_button").attr("disabled",!0).css("pointer-events","none")):(t.removeClass("in_progress"),t.data("was_cloning")===!0&&t.addClass("done"),t.data("was_cloning",!1),this.waiter.stopWaiting(),clearTimeout(this.timeout),this.$el.find(".delete_button").attr("disabled",!1).css("pointer-events",""))},n.prototype.togglePrecomposedPreview=function(t){return this.setPrecomposedIconPreview($(t.target).is(":checked"))},n.prototype.setPrecomposedIconPreview=function(t){return this.iconContainer.toggleClass("precomposed",t)},n.prototype.handleImage=function(t,e){return e.size>fleditor.constants.MAX_IMAGE_SIZE?alert("The image \u201c"+e.name+"\u201d exceeds Flinto\u2019s maximum file size of "+fleditor.constants.MAX_IMAGE_SIZE/1048576+"mb."):readFile(e,function(i){return function(n){var r,s;return s=i.$el.find("img."+t+"_image"),r=e.name,s.attr({src:n.target.result,name:r}),i.images[t]={file:e,data_url:n.target.result,filename:r,content_type:e.type}}}(this))},n.prototype.render=function(){var t,e,i,n,r,s;for(this.$el.find("#settings_title").val(this.model.get("title")),this.$el.find("#settings_device").val(this.model.get("device")),this.$el.find("#device_frame_style").val(this.model.get("device_frame_style")),t=this.iconContainer.find("img.icon_image"),this.model.get("icon_data_url")?t.attr({src:this.model.get("icon_data_url")}):t.attr("src")!==this.model.get("icon_url")&&t.attr({src:this.model.get("icon_url")}),this.setPrecomposedIconPreview(this.model.get("precomposed_icon")),i=this.$el.find("img.startup_image"),this.model.get("startup_data_url")?i.attr({src:this.model.get("startup_data_url")}):i.attr("src")!==this.model.get("startup_url")&&i.attr({src:this.model.get("startup_url")}),$("#status_bar_style").val(this.model.get("statusbar_style")),s=["precomposed_icon","show_tap_hints","show_active_tap"],n=0,r=s.length;r>n;n++)e=s[n],this.model.get(e)&&$("#settings_"+e).prop("checked",!0);return this.model.get("letterbox")?$("#settings_letterbox_true").prop("checked",!0):$("#settings_letterbox_false").prop("checked",!0),this.model.get("ios7_mode")||$("#settings_ios6_mode").prop({checked:!0}),this.handleOSChange(),this.updateStatus()},n}(Backbone.ModalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.PrototypeShare=function(e){function n(){return this.handlePasswordSubmit=t(this.handlePasswordSubmit,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={"submit #share_modal_share_form":"handleShareSubmit","submit #share_modal_password_form":"handlePasswordSubmit","click #share_modal_change_password_button":"showChangePassword","click #share_modal_remove_password_button":"removePassword","click #share_modal_cancel_change_password":"cancelChangePassword"},n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.events=_.extend(this.events,Backbone.ModalView.prototype.events),fleditor.local.vent.on("share:toggle",this.toggle),fleditor.local.vent.on("share:show",this.show),this.shareViews={},this.collection=new fleditor.collections.Shares([],{prototype:this.model}),this.collection.on("add",this.addOne,this),this.collection.on("remove",this.removeShare,this),this.collection.fetch({update:!0}),this.table=this.$el.find("#share_modal_shares_table"),this.sharesContainer=this.table.parent(),this.textField=this.$el.find("form input[type=text]"),this.passwordButton=this.$el.find("form#share_modal_password_form input[type=submit]"),this.passwordBox=this.$el.find("#share_modal_password"),new flinto.Tabs(this.$el.find(".tabs")),$("#generic_share_link").flinto_loading_indicator({startAnimating:!0}),n.__super__.initialize.apply(this,arguments)},n.prototype.show=function(){return this.togglePasswordField(),n.__super__.show.apply(this,arguments)},n.prototype.enableForm=function(){return flinto.stopSnapWait(),this.textField.val("")},n.prototype.showError=function(t,e){var i;return i=JSON.parse(t.responseText),this.$el.find("#"+e+" .error_messages").append(flinto.buildErrorMessages(i)),!0},n.prototype.hideError=function(){return this.$el.find(".error_messages").empty()},n.prototype.passwordForm=function(){return this.$el.find("#share_modal_password_form #prototype_password")},n.prototype.togglePasswordField=function(){return this.options.model.get("has_password")?(this.passwordBox.addClass("enabled").removeClass("changing"),this.$el.find("#share_modal_password_on").show()):(this.passwordBox.removeClass("enabled").removeClass("changing"),this.$el.find("#share_modal_password_on").hide())},n.prototype.cancelChangePassword=function(){return this.passwordForm().val(""),this.passwordBox.addClass("enabled").removeClass("changing")},n.prototype.showChangePassword=function(){return this.passwordForm().val(""),this.passwordBox.removeClass("enabled").addClass("changing")},n.prototype.removePassword=function(){return this.passwordForm().val(""),this.changePassword(null)},n.prototype.handlePasswordSubmit=function(t){return t.preventDefault(),this.changePassword(this.passwordForm().val())},n.prototype.changePassword=function(t){return this.hideError(),this.options.model.save("password",t,{success:function(t){return function(){return t.togglePasswordField(),t.enableForm()}}(this),error:function(t){return function(e){return t.showError(e,"share_modal_password"),t.enableForm()}}(this)})},n.prototype.handleShareSubmit=function(t){var e;return t.preventDefault(),this.hideError(),e=Backbone.sync("create",this.collection,{data:this.$el.find("#share_modal_share_form").serialize(),global:!1}),e.success(function(t){return function(e){var i,n,r,s;for(r=0,s=e.length;s>r;r++)i=e[r],n=new fleditor.models.Share(i),t.collection.add(n);return t.enableForm()}}(this)),e.error(function(t){return function(e){return t.showError(e,"share_modal_share"),t.enableForm()}}(this))},n.prototype.render=function(){return this},n.prototype.updateShareCounter=function(){var t;return t=_.size(_.reject(this.shareViews,function(t){return t.model.get("generic")})),0>t&&(t=0),$("#share_modal_share_counter").text(t),this.table.toggleClass("empty",0===t)},n.prototype.removeShare=function(t){return delete this.shareViews[t.cid],this.updateShareCounter()},n.prototype.addOne=function(t){var e,i,n;return this.sharesContainer.removeClass("loading"),_.size(this.shareViews)>=1&&this.table.show(),i=t.get("generic")?"div":"tr",n=new fleditor.views.Share({model:t,tagName:i}),e=this.shareViews.length,this.shareViews[t.cid]=n,this.updateShareCounter(),n.render(),t.get("generic")?$("#generic_share_link").flinto_loading_indicator("stopAnimating").empty().removeClass("ui-loading-indicator").append(n.$el):this.table.find("tbody").prepend(n.$el),n},n}(Backbone.ModalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.LinkSnapPreview=function(e){function n(){return this.hide=t(this.hide,this),this.show=t(this.show,this),this.clearLinkSnapPreview=t(this.clearLinkSnapPreview,this),this.handleMouseMove=t(this.handleMouseMove,this),this.handleMouseLeave=t(this.handleMouseLeave,this),this.handleKeyup=t(this.handleKeyup,this),this.handleKeydown=t(this.handleKeydown,this),this.linkSnap=t(this.linkSnap,this),this.initEdgeDetector=t(this.initEdgeDetector,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.events={click:"linkSnap"},n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.$el=this.options.el,this.screenImageWrapper=this.options.wrapper,$("body").on("keydown",this.handleKeydown),$("body").on("keyup",this.handleKeyup),this.screenImageWrapper.on("mousemove",this.handleMouseMove),this.screenImageWrapper.on("mouseleave",this.handleMouseLeave),this.screen=this.options.screen,this.previewThrottle={count:0,point:null,timestamp:0}},n.prototype.render=function(){return this},n.prototype.initEdgeDetector=function(){return!this.edgeDetector&&this.screen.screenImage?this.edgeDetector=new EdgeDetector(this.screen.screenImage[0],this.screen.options.edgeCanvas[0],this.screen.model.get("statusbar_height"),this.screen.minimumLinkSize()):void 0},n.prototype.resetEdgeDetector=function(){return delete this.edgeDetector},n.prototype.linkSnap=function(t){var e,i,n;return this.initEdgeDetector(),this.linkSnapPoint||(i=this.screenImageWrapper.offset(),this.linkSnapPoint=new Point(t.pageX-i.left,t.pageY-i.top)),n=this.detectLink(),e=new fleditor.models.Link({screen_id:this.screen.model.get("id"),x:n.origin.x,y:n.origin.y,h:n.size.height,w:n.size.width}),e.linkup=!0,e.clickEvent=t,this.screen.deselect(t),this.screen.addLink(e),this.$el.transition({left:this.linkSnapPoint.x,top:this.linkSnapPoint.y,width:0,height:0,display:"none",duration:0}),this.linkSnapPoint=null,this.previewThrottle.point=null
},n.prototype.handleKeydown=function(t){return this.isHidden?void 0:t.altKey&&this.linkSnapPoint?(this.initEdgeDetector(),this.drawLinkSnapPreview(),fleditor.local.vent.trigger("slicer:deselect")):void 0},n.prototype.handleKeyup=function(){return this.linkSnapPoint?this.clearLinkSnapPreview(this.linkSnapPoint):void 0},n.prototype.handleMouseLeave=function(){return this.linkSnapPoint?(this.clearLinkSnapPreview(this.linkSnapPoint),this.linkSnapPoint=null):void 0},n.prototype.handleMouseMove=function(t){var e;return!this.isHidden&&(this.initEdgeDetector(),e=this.screenImageWrapper.offset(),this.linkSnapPoint=new Point(t.pageX-e.left,t.pageY-e.top),t.altKey)?this.previewThrottle.count++%3!==0&&this.previewThrottle.point&&this.previewThrottle.point.distance(this.linkSnapPoint)<6&&t.timeStamp-this.previewThrottle.timestamp<500?null:(this.drawLinkSnapPreview(),this.previewThrottle.timestamp=t.timeStamp):void 0},n.prototype.clearLinkSnapPreview=function(t){return this.previewThrottle.point=null,this.$el.css({left:t.x,top:t.y,width:0,height:0,opacity:0}),setTimeout(function(t){return function(){return t.$el.hide()}}(this),150)},n.prototype.show=function(){return this.$el.css({opacity:1}),this.isHidden=!1},n.prototype.hide=function(){return this.$el.css({opacity:0}),this.isHidden=!0},n.prototype.drawLinkSnapPreview=function(){var t,e,i;return fleditor.local.vent.trigger("linksnap:preview"),this.previewThrottle.point=_.clone(this.linkSnapPoint),t=Rect.fromElement(this.screenImageWrapper,!0),e=this.detectLink(),e=e.scale(this.screen.screenImageScaleFactor()),i=function(t){return function(){return t.$el.css({left:e.origin.x,top:e.origin.y,width:e.size.width,height:e.size.height})}}(this),this.$el.is(":visible")?i():this.$el.transition({display:"block",left:this.linkSnapPoint.x,top:this.linkSnapPoint.y,width:0,height:0,opacity:1,duration:1},function(){return function(){return i()}}(this))},n.prototype.detectLink=function(){var t,e,i,n,r,s,o,a;return o=this.screen.screenImageScaleFactor(),t=this.linkSnapPoint.x/o,e=this.linkSnapPoint.y/o,s=this.edgeDetector.detect(t,e),r=fleditor.constants.REGULAR_LINK_SIZE*this.screen.model.get("width")/fleditor.local.viewer_width,i=n=5,s.size.width<r&&(i+=(r-s.size.width)/2),s.size.height<r&&(n+=(r-s.size.height)/2),s=s.inset(-i,-n),a=Rect.fromDimensions(0,0,this.screen.model.get("width"),this.screen.model.get("height")),s.intersection(a)},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.Screens=function(e){function n(){return this.handleMouseup=t(this.handleMouseup,this),this.handleMousemove=t(this.handleMousemove,this),this.handleMousedown=t(this.handleMousedown,this),this.handleKeyup=t(this.handleKeyup,this),this.handleKeydown=t(this.handleKeydown,this),this.adjacentScreenView=t(this.adjacentScreenView,this),this.setHomeScreen=t(this.setHomeScreen,this),this.screenDestroyed=t(this.screenDestroyed,this),this.resizeWindow=t(this.resizeWindow,this),this.saveScreenPositions=t(this.saveScreenPositions,this),this.havePositionsChangedMaterially=t(this.havePositionsChangedMaterially,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.screenViews={},this.draw={},this.collection.on("add",this.addOne,this),this.collection.on("remove",this.removeOne,this),this.collection.on("destroy",this.screenDestroyed,this),fleditor.local.vent.on("updateHomeScreen",this.setHomeScreen),fleditor.local.vent.on("zoom:changed",this.resize,this),fleditor.local.vent.on("screen:bulkUplaoded",this.saveScreenPositions),$("body").on("window:resize",this.resizeWindow),$("body").on("keydown",this.handleKeydown),$("body").on("keyup",this.handleKeyup),this.spacebar=this.linkup=!1,this.linkLine=new fleditor.views.LinkLine({parent:this})},n.prototype.render=function(){var t;return this.inner=this.$el.find(">.inner"),this.edgeCanvas||(this.edgeCanvas=$("<canvas>").appendTo(this.$el).hide()),this.addAll(),t="",this.inner.flinto_sortable({distance:1,scrollSensitivity:25,handle:".title h1",update:function(t){return function(){return t.saveScreenPositions()}}(this),start:function(){return function(t,e){var i;return i=$(t.target).closest(".screen"),i.addClass("dragging"),$(e.element).show()}}(this),stop:function(){return function(t,e){var i;return i=$(t.target).closest(".screen"),$(e.element).addClass("dragging"),i.removeClass("dragging"),$(e.element).removeClass("dragging")}}(this)}),this.previousScreenPositions=this.generateScreenPositionArray(),this.layoutScreens(),this.linkLine.resizeWindow(),this},n.prototype.havePositionsChangedMaterially=function(t){var e,i;for(e in t)if(i=t[e],i!==this.previousScreenPositions[e])return!0;return!1},n.prototype.generateScreenPositionArray=function(){return $.makeArray(this.inner.children().map(function(t,e){return $(e).data("id")}))},n.prototype.saveScreenPositions=function(){var t,e;e=this.generateScreenPositionArray(),t=_.size(_.filter(this.inner.children(),function(t){return"undefined"==typeof $(t).data("id")})),t||this.havePositionsChangedMaterially(e)&&(this.collection.updateScreenOrder(e),this.previousScreenPositions=e)},n.prototype.resizeWindow=function(){return this.layoutScreens()},n.prototype.layoutScreens=function(){var t,e,i,n,r,s,o,a;return a=this.$el.find(".screen"),s=a.length,o=this.options.proto.get("zoom"),this.windowWidth=$(window).width(),t=this.windowWidth-fleditor.constants.MIN_GUTTER,e=Math.floor(t/(o+fleditor.constants.MIN_GUTTER)),e>=s?(this.$el.addClass("single_row"),e=s,r=fleditor.constants.MIN_GUTTER):(this.$el.removeClass("single_row"),n=t-e*o,r=n/e),i=e*o+r*(e-1),a.css({marginLeft:""+r+"px"}),this.inner.css({marginLeft:"-"+r+"px"}),this.$el.css({width:""+i+"px"}),r},n.prototype.resize=function(){var t,e,i;i=this.screenViews;for(t in i)e=i[t],e.resizeWithoutLink(this.options.proto.get("zoom"));this.layoutScreens()},n.prototype.screenDestroyed=function(t){fleditor.local.vent.trigger("screendestroyed",t)},n.prototype.toggleInstructionsIfNecessary=function(){var t;t=$("#instructions"),0===this.collection.length?($("body").off("mousedown",this.handleMousedown),$("body").off("mousemove",this.handleMousemove),$("body").off("mouseup",this.handleMouseup),"visible"!==this.instructionsState&&(this.instructionsState="visible",$("#fleditor").removeClass("initial_upload_hover"),t.css({display:"block",opacity:0,scale:.5}).transition({opacity:1,scale:1,duration:150})),fleditor.local.vent.trigger("disableZoomSlider"),$("#inline_preview_button").addClass("disabled")):"hidden"!==this.instructionsState&&(this.instructionsState="hidden",t.transition({opacity:0,scale:.5,duration:150},function(){return function(){return t.css({opacity:1,scale:1}).hide()}}(this)),fleditor.local.vent.trigger("enableZoomSlider"),$("#inline_preview_button").removeClass("disabled"))},n.prototype.setHomeScreen=function(){var t;t=0,this.collection.each(function(e){return function(i){return 0===t?e.screenViews[i.cid].$el.addClass("home"):e.screenViews[i.cid].$el.removeClass("home"),++t}}(this))},n.prototype.adjacentScreenView=function(t,e){var i,n,r;return null==e&&(e=!1),n=this.collection.indexOf(t.model),i=e?n-1:n+1,r=this.collection.at(i),null!=r?this.screenViews[r.cid]:void 0},n.prototype.removeOne=function(t){delete this.screenViews[t.cid],this.layoutScreens(),this.toggleInstructionsIfNecessary(),this.setHomeScreen()},n.prototype.addAll=function(){return this.collection.each(this.addOneCore,this)},n.prototype.addOne=function(t){var e;return e=this.addOneCore(t),this.layoutScreens(),e},n.prototype.addOneCore=function(t){var e,i,n;return 0===_.size(this.screenViews)&&($("body").on("mousedown",this.handleMousedown),$("body").on("mousemove",this.handleMousemove),$("body").on("mouseup",this.handleMouseup)),this.toggleInstructionsIfNecessary(),i=new fleditor.views.Screen({model:t,edgeCanvas:this.edgeCanvas,screenSize:this.options.proto.get("zoom"),screenContainerRatio:this.options.proto.get("screen_container_ratio")}),i.canvas=this,this.screenViews[t.cid]=i,1===_.size(this.screenViews)&&i.$el.addClass("home"),i.render(),e=_.indexOf(this.collection.models,t),n=this.inner.children(".screen"),n.length&&e<n.length?i.$el.insertBefore(this.inner.children(".screen")[e]):i.$el.appendTo(this.inner),i},n.prototype.isLinkup=function(){return this.linkLine.isLinkup()},n.prototype.drawingLink=function(){return this.draw.downPoint},n.prototype.handleKeydown=function(t){return t.which!==fleditor.keys.SPACE?!0:this.spacebar===!0?!1:this.linkup?(this.spacebar=!0,!1):!0},n.prototype.handleKeyup=function(t){return t.which!==fleditor.keys.SPACE?!0:(this.spacebar=!1,!0)},n.prototype.handleMousedown=function(t){var e;return 0!==t.button?!0:t.altKey?!0:this.isLinkup()?!0:(this.linkup=!0,e=$(t.target),!(e.is("#fleditor_container")||e.parents("#fleditor_container").length>0)||0!==e.parents(".slicers").length||e.is(".link")||e.is(".ui-resizable-handle")||0!==e.parents(".title").length||(this.draw.downPoint=Point.fromEvent(t),e.is("img.screen_image_element, #fleditor")&&t.preventDefault(),e.is("#fleditor, #fleditor_container, html, body, .screen, .content")&&(fleditor.local.vent.trigger("link:deselectAll"),fleditor.local.vent.trigger("screen:deselectAll"),fleditor.local.vent.trigger("slicer:deselect"))),!0)},n.prototype.handleMousemove=function(t){var e,i,n,r;if(!this.isLinkup()&&(t.stopPropagation(),n=Point.fromEvent(t),r=$(t.target),null!=this.draw.downPoint&&(null!=this.draw.link||this.draw.downPoint.distance(n)>fleditor.constants.DRAG_TOLERANCE))){if(null!=this.draw.link)return fleditor.local.vent.trigger("link:deselectAll"),this.spacebar?(i=this.draw.dragPoint.subtract(n),this.draw.dragPoint=n,this.draw.offsetDragPoint=this.draw.offsetDragPoint.subtract(i),this.draw.offsetDownPoint=this.draw.offsetDownPoint.subtract(i),this.draw.downPoint=this.draw.downPoint.subtract(i),this.draw.downPoint.constraintInElement(this.draw.screenImageWrapper)):(this.draw.dragPoint=n,this.draw.offsetDragPoint=this.draw.dragPoint.offsetToElement(this.draw.screenImageWrapper),this.draw.offsetDownPoint=this.draw.downPoint.offsetToElement(this.draw.screenImageWrapper)),this.drawLink();if(r.closest(".screen_image_wrapper").length&&(fleditor.local.vent.trigger("screen:deselectAll"),fleditor.local.vent.trigger("slicer:deselect"),e=r.closest(".screen").data("cid"),this.screenViews[e].canLinkUp()))return this.draw.screenView=this.screenViews[e],this.draw.link=new fleditor.models.Link({screen_id:this.draw.screenView.model.get("id")}),this.draw.screenImageWrapper=this.draw.screenView.$el.find(".screen_image_wrapper"),this.draw.constraintRect=Rect.fromDimensions(0,0,this.draw.screenImageWrapper.width(),this.draw.screenImageWrapper.height()),this.draw.scale=this.draw.screenView.screenImageScaleFactor(),this.draw.screenView.addLink(this.draw.link),this.draw.link.trigger("startDrawing"),fleditor.local.vent.trigger("link:disable_highlight",this.draw.link,!0)}},n.prototype.handleMouseup=function(t){return this.isLinkup()?!0:(this.linkup=!1,null!=this.draw.link&&(t.preventDefault(),this.draw.link.trigger("stopDrawing"),this.draw.link.trigger("linkup",t),fleditor.local.vent.trigger("link:disable_highlight",this.draw.link,!1)),this.draw={},!0)},n.prototype.drawLink=function(){var t,e;return e=new Rect(this.draw.offsetDownPoint,new Size(this.draw.offsetDragPoint.x-this.draw.offsetDownPoint.x,this.draw.offsetDragPoint.y-this.draw.offsetDownPoint.y)),e.standardize(),t=e.intersection(this.draw.constraintRect),this.draw.link.set({x:t.origin.x/this.draw.scale,y:t.origin.y/this.draw.scale,h:t.size.height/this.draw.scale,w:t.size.width/this.draw.scale})},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.Screen=function(e){function n(){return this.imageLoadHandler=t(this.imageLoadHandler,this),this.createSlicers=t(this.createSlicers,this),this.resizeLinks=t(this.resizeLinks,this),this.resizeSlicers=t(this.resizeSlicers,this),this.resizeLinksAndSlicers=t(this.resizeLinksAndSlicers,this),this.remove=t(this.remove,this),this.addLink=t(this.addLink,this),this.unfocusTimedScreenTarget=t(this.unfocusTimedScreenTarget,this),this.focusTimedScreenTarget=t(this.focusTimedScreenTarget,this),this.handleTimedScreen=t(this.handleTimedScreen,this),this.handleClick=t(this.handleClick,this),this.isLinkup=t(this.isLinkup,this),this.canLinkUp=t(this.canLinkUp,this),this.unhighlightLinkTarget=t(this.unhighlightLinkTarget,this),this.highlightLinkTarget=t(this.highlightLinkTarget,this),this.handleTitleMouseOut=t(this.handleTitleMouseOut,this),this.handleTitleMouseOver=t(this.handleTitleMouseOver,this),this.linkup=t(this.linkup,this),this.handleKeyDownTitleEdit=t(this.handleKeyDownTitleEdit,this),this.editAdjacentScreenTitle=t(this.editAdjacentScreenTitle,this),this.handleTitleEditBlur=t(this.handleTitleEditBlur,this),this.commitTitleEdit=t(this.commitTitleEdit,this),this.abortTitleEdit=t(this.abortTitleEdit,this),this.editTitle=t(this.editTitle,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.className="screen loading empty",n.prototype.template=JST["fleditor/templates/screen"],n.prototype.PADDING=4,n.prototype.TITLE_HEIGHT=28,n.prototype.events={"click .screen_image img, .error_message, .error":"handleClick","click .title_header":"handleClick","click     .js-timed-screen":"handleTimedScreen","mouseover .js-timed-screen":"focusTimedScreenTarget","mouseout  .js-timed-screen":"unfocusTimedScreenTarget","dragover  .screen_image_wrapper":"handleDragOver","dragleave .screen_image_wrapper":"handleDragLeave","drop      .screen_image_wrapper":"handleDrop","dblclick .title_header":"editTitle","keydown .title_header input":"handleKeyDownTitleEdit","blur .title_header input":"handleTitleEditBlur","click .replace_button":"replaceScreen","click .reupload_button":"retryUpload"},n.prototype.editTitle=function(){var t,e;return this.editingTitle=!0,e=this.$el.find(".title_header"),t=$("<input>").attr({type:"text"}).val(this.model.get("title")),e.empty().append(t),t.focus().select()},n.prototype.abortTitleEdit=function(){var t,e;return this.editingTitle=!1,e=this.$el.find(".title_header"),t=e.find("input[type=text]"),e.empty().text(this.model.get("title"))},n.prototype.commitTitleEdit=function(){var t,e,i;return this.editingTitle=!1,e=this.$el.find(".title_header"),t=e.find("input[type=text]"),i=t.val(),""!==i&&null!=i&&this.model.save({title:i}),e.empty().text(this.model.get("title"))},n.prototype.handleTitleEditBlur=function(){return this.editingTitle?this.commitTitleEdit():void 0},n.prototype.editAdjacentScreenTitle=function(t){var e;return null==t&&(t=!1),e=this.canvas.adjacentScreenView(this,t),null!=e?e.editTitle():void 0},n.prototype.handleKeyDownTitleEdit=function(t){return t.which===fleditor.keys.ESC&&this.abortTitleEdit(),t.which===fleditor.keys.ENTER&&this.commitTitleEdit(),t.which===fleditor.keys.TAB&&(this.editAdjacentScreenTitle(t.shiftKey),t.preventDefault()),t.stopPropagation()},n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.$el.data("cid",this.model.cid),this.$el.data("id",this.model.get("id")),this.model.on("change:id",this.updateId,this),this.model.on("change:title",this.updateTitle,this),this.model.on("change:image_url",this.updateImage,this),this.model.on("change:width",this.changeWidth,this),this.model.on("error",this.error,this),this.model.on("destroy",this.remove,this),this.model.on("linkup:highlight",this.highlightLinkup,this),this.model.on("linkup:unhighlight",this.unhighlightLinkup,this,!1),this.model.on("update_statusbar_height",this.updateStatusbarHeight,this),this.screenSize=t.screenSize,fleditor.local.vent.on("select_link_target",this.highlightLinkTarget),fleditor.local.vent.on("deselect_link_target",this.unhighlightLinkTarget),fleditor.local.vent.on("resize:stopped",this.resizeLinksAndSlicers),this.$el.html(this.template()),this.linksView=new fleditor.views.Links({model:this.model,el:this.$el.find(".links"),screenView:this}),this.linksView.render(),this.imageIsLoaded=0,this.screenImageWrapper=this.$el.find(".screen_image"),this.linkSnapPreview=new fleditor.views.LinkSnapPreview({el:this.$el.find(".linksnap_preview"),wrapper:this.$el.find(".screen_image_wrapper"),screen:this})},n.prototype.replaceScreen=function(){return getFiles(function(t){return function(e){return t.linkSnapPreview.resetEdgeDetector(),t.model.loadScreenImageFromFile(e,!0)}}(this),!1)},n.prototype.linkup=function(){return this.model.get("id")?(this.deselect(),this.unhighlight(),!0):!1},n.prototype.handleTitleMouseOver=function(){return this.$el.addClass("select_hover")},n.prototype.handleTitleMouseOut=function(){return this.$el.removeClass("select_hover")},n.prototype.minimumLinkSize=function(){return fleditor.constants.MIN_LINK_SIZE*this.model.get("width")/fleditor.local.viewer_width},n.prototype.selectLinkup=function(){return this.model.get("id")&&this.canvas.linkLine.originateScreenId()!==this.model.get("id")?(this.highlightLinkup(),fleditor.local.vent.trigger("linkup:highlight",this)):(this.unhighlightLinkup(),fleditor.local.vent.trigger("linkup:unhighlight"))},n.prototype.select=function(){return this.$el.hasClass("selected")?void 0:this.$el.addClass("selected")},n.prototype.deselect=function(){return this.$el.hasClass("selected")?(this.$el.removeClass("selected"),this.handleTitleEditBlur()):void 0},n.prototype.isSelected=function(){return this.$el.hasClass("selected")},n.prototype.highlight=function(){return this.$el.hasClass("highlighted")?void 0:this.$el.addClass("highlighted")},n.prototype.unhighlight=function(){return this.$el.hasClass("highlighted")?this.$el.removeClass("highlighted"):void 0},n.prototype.highlightLinkTarget=function(t){return this.canvas.drawingLink()?void 0:(t===this.model.get("id")&&this.highlight(),this.linkSnapPreview?this.linkSnapPreview.hide():void 0)},n.prototype.unhighlightLinkTarget=function(t){return t===this.model.get("id")&&this.unhighlight(),this.linkSnapPreview?this.linkSnapPreview.show():void 0},n.prototype.highlightLinkup=function(){return this.$el.addClass("linkup")},n.prototype.unhighlightLinkup=function(t){return null==t&&(t=!1),t?(this.$el.addClass("finish_linkup"),this.$el.removeClass("linkup")):(this.$el.removeClass("finish_linkup"),this.$el.removeClass("linkup"))},n.prototype.highlightLinkGroup=function(t,e){return this.linksView.highlightLinkGroup(t,e)},n.prototype.highlightAsLinkDropTarget=function(){return this.$el.addClass("linkgroup_drop")},n.prototype.unhighlightAsLinkDropTarget=function(){return this.$el.removeClass("linkgroup_drop")},n.prototype.selectLinkGroup=function(t){return this.linksView.selectLinkGroup(t)},n.prototype.handleDragOver=function(t){return-1===_.indexOf(t.dataTransfer.types,"Files")?void(t.dataTransfer.dropEffect="none"):(t.dataTransfer.dropEffect="move",this.$el.addClass("dragTarget"))},n.prototype.handleDragLeave=function(){return this.$el.removeClass("dragTarget")},n.prototype.handleDrop=function(t){var e;if(this.$el.removeClass("dragTarget"),1===t.dataTransfer.files.length){e=t.dataTransfer.files[0];try{e.type.match(/photoshop/)||e.type.match(/\.psd/)?this.model.createImageFromPSD(e):this.model.loadScreenImageFromFile(e,!0),this.linkSnapPreview.resetEdgeDetector()}catch(i){}return t.preventDefault()}},n.prototype.canLinkUp=function(){return!this.$el.find(".error_message").is(":visible")&&this.screenImage&&this.model.get("id")&&this.model.get("has_image")},n.prototype.isLinkup=function(){return this.canvas.isLinkup()},n.prototype.handleClick=function(t){return this.isLinkup()?void 0:(t.shiftKey&&this.$el.hasClass("selected")?(this.deselect(t),fleditor.local.vent.trigger("screen:deselect",this)):(this.selectMultipleScreen(t.shiftKey),fleditor.local.vent.trigger("slicer:deselect")),t.preventDefault(),t.stopPropagation())},n.prototype.handleTimedScreen=function(t){var e,i;return e=$(t.target),e.hasClass("active")||(i=new fleditor.models.Link({screen_id:this.model.get("id"),timer:700,transition:"modal_cross_dissolve"}),this.addLink(i),e.addClass("selected")),fleditor.local.vent.trigger("screen:deselectAll",this),fleditor.local.vent.trigger("slicer:deselect"),e.hasClass("selected")||e.hasClass("dead")?fleditor.local.vent.trigger("linkup:start",this.linksView.timedLink,t):(e.addClass("selected"),fleditor.local.vent.trigger("link:select",this.linksView.timedLink,this))},n.prototype.focusTimedScreenTarget=function(){return this.linksView.timedLink?fleditor.local.vent.trigger("select_link_target",this.linksView.timedLink.model.get("target_id"),this.model.get("screen_id")):void 0},n.prototype.unfocusTimedScreenTarget=function(){return this.linksView.timedLink?fleditor.local.vent.trigger("deselect_link_target",this.linksView.timedLink.model.get("target_id"),this.model.get("screen_id")):void 0},n.prototype.selectMultipleScreen=function(t){return null==t&&(t=!1),this.$el.hasClass("selected")?void 0:(fleditor.local.vent.trigger("screen:select",this,t),fleditor.local.vent.trigger("link:deselectAll",this),this.select())},n.prototype.addLink=function(t){return this.model.links.add(t),this.linksView.reorderZIndex(this.model.get("id"))},n.prototype.destroy=function(){return this.model.destroy()},n.prototype.remove=function(){var t,e,i,r,s,o;s=this.linksView.linkViews;for(t in s)i=s[t],i.deselectTarget();if(this.linksView.destroy(),fleditor.local.vent.off("select_link_target",this.highlightLinkTarget),fleditor.local.vent.off("deselect_link_target",this.unhighlightLinkTarget),fleditor.local.vent.off("resize:stopped",this.resizeLinksAndSlicers),null!=this.slicers){o=this.slicers;for(e in o)r=o[e],r.remove()}return n.__super__.remove.apply(this,arguments)},n.prototype.retryUpload=function(){return this.model.trigger("error",null),this.model.unset("direct_upload_params"),this.model.saveScreen()},n.prototype.updateId=function(){return this.$el.data("id",this.model.get("id"))},n.prototype.updateTitle=function(){return this.$(".title_header").html(this.model.escape("title")),this.$el.find("header").css({opacity:1}),fleditor.local.vent.trigger("screen:titleChanged")},n.prototype.resizeWithoutLink=function(t,e){var i,n,r,s;return null==e&&(e=0),this.screenSize=t,s=parseInt(t*this.options.screenContainerRatio),this.$el.transition({width:t,height:s,duration:e}),r=this.desiredImageWidth,i=this.fitContentToContainer(this.screenSize,s,e),i!==r&&(n=this.$el.find(".screen_liner").transition({width:i+this.PADDING,duration:e})),this.setStatusBarMargin()},n.prototype.updateStatusbarHeight=function(){var t;return this.screenImage?(this.setStatusBarMargin(),t=(this.model.previous("statusbar_height")||0)-this.model.get("statusbar_height"),this.linksView.moveLinks(t),this.slicers.top.moveSlicer(t),this.linkSnapPreview.resetEdgeDetector(),this.render()):void 0},n.prototype.resize=function(t,e){return null==e&&(e=0),this.resizeWithoutLink(t,e),this.resizeLinksAndSlicers(t)},n.prototype.resizeLinksAndSlicers=function(t){return this.resizeLinks(),this.resizeSlicers(t)},n.prototype.resizeSlicers=function(){var t,e,i,n;i=this.slicers,n=[];for(t in i)e=i[t],n.push(e.setScale(this.screenImageScaleFactor(),this.screenSize));return n},n.prototype.resizeLinks=function(){return this.linksView.resize(this.screenImageScaleFactor())},n.prototype.setStatusBarMargin=function(){var t;return t=this.desiredImageWidth/this.model.get("width"),this.statusbarMargin=-1*Math.ceil(this.model.get("statusbar_height")*t),this.screenImage?this.screenImage.css("margin-top",""+this.statusbarMargin+"px"):void 0},n.prototype.error=function(t){var e,i,n,r,s,o,a,l,h,u,c;if(t){i=this.$el.find(".error_message"),i.css({display:"block",opacity:"0"}).transition({opacity:1,duration:"500ms"}),n={},l=!1;try{n=JSON.parse(t.responseText)}catch(d){e=d,"string"==typeof t&&(n=t,l=!0)}if(r=[],s=function(t,e){var i;return i=t.replace(/_/g," "),i.charAt(0).toUpperCase()+i.slice(1)+" "+e},"string"==typeof n)r.push(n);else for(o in n)for(h=n[o],"image_file_size"===o&&(l=!0),u=0,c=h.length;c>u;u++)a=h[u],r.push(s(o,a));return i.html(JST["fleditor/templates/screen_error"]({errors:r})),l?i.find(".replace_button").show():i.find(".reupload_button").show()}return this.$el.find(".error_message").hide()},n.prototype.render=function(){return this.updateTitle(),this.updateImage(),this.$el.width(this.screenSize),this.$el.height(Math.floor(this.screenSize*this.options.screenContainerRatio)),this.model.get("width")&&(this.resize(this.screenSize),this.$el.removeClass("empty")),this},n.prototype.createSlicers=function(){var t,e,i,n,r;if(null==this.slicers){this.slicers={top:new fleditor.views.Slicer({model:this.model,which:"top",parentView:this}),bottom:new fleditor.views.Slicer({model:this.model,which:"bottom",parentView:this})},n=this.slicers,r=[];for(e in n)i=n[e],t=i.render().$el,r.push(this.$el.find(".slicers").append(t));return r}},n.prototype.updateImage=function(t){var e,i,n,r;if(null==t&&(t=null),i=this.model.get("image_url"),(!i||i.match(/data:image/)||!this.previous_image_url||!this.previous_image_url.match(/data:image/))&&(this.isSelected()&&fleditor.local.vent.trigger("screen:select",this),i&&i!==this.previous_image_url)){if(null!=this.slicers){r=this.slicers;for(e in r)n=r[e],n.hideAnnotations()}return this.previous_image_url=i,this.model.image?this.imageLoadHandler($(this.model.image)):this.model.loadImage(i,this.imageLoadHandler)}},n.prototype.imageLoadHandler=function(t){var e;return this.$el.removeClass("empty"),t&&(this.screenImage=t),this.screenImage&&(this.model.image=this.screenImage[0]),this.screenImage||(t=new Image,t.src=this.model.default_image_url,this.screenImage=$(t)),this.setScreenImageAttr(this.screenImage),this.$el.find(".screen_image_element").css({position:"absolute"}).addClass("to_be_removed"),e=function(t){return function(){var e,i,n,r,s;if(t.screenImage.insertBefore(t.$el.find(".links")),++t.imageIsLoaded,t.resize(t.screenSize,200),null!=t.slicers){s=t.slicers;for(i in s)r=s[i],r.updateSlicer()}else t.createSlicers();return e=t.$el.find(".links").add(t.screenImage),e.css({display:"block",opacity:0}),e.transition({opacity:1,duration:200},function(){return t.$el.find(".to_be_removed").remove(),t.$el.removeClass("loading")}),t.$el.find(".screen_liner").transition({backgroundColor:"#fff",duration:200}),t.previousWidth?(n=t.model.get("width")/t.previousWidth,t.linksView.resizeLinks(n,t.model.get("height")),t.previousWidth=0):void 0}}(this),e(),this.screenImage.attr("src")===this.model.default_image_url?this.error("Image Missing"):void 0},n.prototype.setScreenImageAttr=function(t){return t.attr({width:"100%",alt:this.model.get("title")}).addClass("screen_image_element")},n.prototype.changeWidth=function(){return this.previousWidth=this.model.previous("width"),this.model.hasChanged("width")?(this.resize(this.screenSize,!0),this.$el.removeClass("empty")):void 0},n.prototype.screenImageScaleFactor=function(){return this.screenImage&&this.desiredImageWidth?this.desiredImageWidth/this.model.get("width"):1},n.prototype.fitContentToContainer=function(t,e,i){var n,r,s,o,a;return null==i&&(i=0),t-=this.PADDING,e-=this.PADDING+this.TITLE_HEIGHT,n=t/e,o=this.model.get("width")/(this.model.get("height")-this.model.get("statusbar_height")),r=n>o?e*o:t,this.desiredImageWidth=Math.floor(r),a=this.desiredImageWidth,s=Math.floor(this.desiredImageWidth/this.model.get("width")*(this.model.get("height")-this.model.get("statusbar_height"))),this.screenImageWrapper.transition({width:a,height:s,duration:i}),this.$el.find(".screen_image_wrapper").transition({width:a,height:s,duration:i}),this.desiredImageWidth},n.prototype.coordinates=function(t){return null==t&&(t=0),Rect.fromElement(this.$el.find(".screen_liner")).inset(t,t)},n.prototype.imageCoordinates=function(){return Rect.fromElement(this.$el.find(".screen_image_wrapper"))},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.Slicer=function(e){function n(){return this.clickToSnap=t(this.clickToSnap,this),this.setPixelsLabel=t(this.setPixelsLabel,this),this.deselect=t(this.deselect,this),this.handleSelect=t(this.handleSelect,this),this.oppositeSlicer=t(this.oppositeSlicer,this),this.save=t(this.save,this),this.hideSnapPoints=t(this.hideSnapPoints,this),this.showSnapPoints=t(this.showSnapPoints,this),this.hideAnnotations=t(this.hideAnnotations,this),this.showAnnotations=t(this.showAnnotations,this),this.updateZoom=t(this.updateZoom,this),this.setupZoom=t(this.setupZoom,this),this.sliceValueChanged=t(this.sliceValueChanged,this),this.sliceValue=t(this.sliceValue,this),this.handleKeyDown=t(this.handleKeyDown,this),this.bindEvents=t(this.bindEvents,this),this.remove=t(this.remove,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.className="slicer",n.prototype.events={"dblclick  .handle":"handleDoubleClick"},n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.$el.addClass(t.which),this.parentView=t.parentView,this.whichSlice=""+this.options.which+"_slice",this.moveDebounceTimer=null,this.autoDetectedSlice=0,fleditor.local.vent.on("slicer:select",this.handleSelect),fleditor.local.vent.on("slicer:deselect",this.deselect),this.model.on("change:"+this.whichSlice,this.sliceValueChanged)},n.prototype.remove=function(){return fleditor.local.vent.off("slicer:select",this.handleSelect),fleditor.local.vent.off("slicer:deselect",this.deselect)},n.prototype.moveSlicer=function(t){var e;return e=this.contain(this.sliceValue()+t),this.setSliceValue(e)},n.prototype.bindEvents=function(t){return null==t&&(t="on"),this.binded!==t?(this.binded=t,$("body")[t]("keydown",this.handleKeyDown)):void 0},n.prototype.handleKeyDown=function(t){var e,i;if("show"===this.zoomState)switch(i=function(t){return function(e){return t.moveSlicer(e),clearTimeout(t.moveDebounceTimer),t.moveDebounceTimer=setTimeout(function(){return t.save(!0)},1e3)}}(this),e=t.shiftKey?10:1,"bottom"===this.options.which&&(e=-e),t.keyCode){case fleditor.keys.ESC:case fleditor.keys.ENTER:return this.deselectAll();case fleditor.keys.UP:return i(-e),!1;case fleditor.keys.DOWN:return i(e),!1}},n.prototype.sliceValue=function(){return this.model.get(this.whichSlice)},n.prototype.setSliceValue=function(t){return this.model.get(this.whichSlice)!==t?(this.model.set(this.whichSlice,t),fleditor.local.vent.trigger("slicer:changed",this.model,this.options.which,t),this.handle.flinto_draggable("broadcast","update",t)):void 0},n.prototype.sliceValueChanged=function(){return this.positionSlicer(),"show"===this.zoomState?(this.updateZoom(),this.setPixelsLabel()):void 0},n.prototype.setupZoom=function(t){var e;return null==t&&(t=0),0===t&&(e=this.parentView.$el.find(".screen_image img"),t=e.width()),this.zoomSize=Math.round(t/1.5),this.zoomSize=this.zoomSize%2!==0?this.zoomSize-1:this.zoomSize,this.zoomSize>200&&(this.zoomSize=200),this.zoomPad=10,this.zoom.css({width:""+(this.zoomSize+this.zoomPad)+"px",height:""+(this.zoomSize+this.zoomPad)+"px",marginLeft:""+-(this.zoomSize+this.zoomPad)/2+"px",marginTop:""+-this.zoomSize/2+"px"}),this.zoom.find(".inner").css({height:""+this.zoomSize+"px",width:""+this.zoomSize+"px",marginTop:""+this.zoomPad/2+"px",marginLeft:""+this.zoomPad/2+"px"}),this.sliceImage||this.createSliceImage(),this.updateZoom()},n.prototype.getSlicerCanvas=function(){var t;return t=$("#slicer_canvas"),0===t.length&&(t=$('<canvas id="slicer_canvas">').css({display:"none"}).appendTo($("body"))),t[0]},n.prototype.createSliceImage=function(){var t,e,i,n,r;return t=this.getSlicerCanvas(),r=this.model.get("width"),i=this.model.get("height"),t.width=r,t.height=i,e=t.getContext("2d"),e.drawImage(this.parentView.screenImage[0],0,0,r,i,0,0,r,i),n=new Image,n.src=t.toDataURL(),n=$(n),n.css({left:-(this.model.get("width")/2-this.zoomSize/2),position:"relative",marginTop:-this.model.get("statusbar_height")}),this.sliceImage=$("<div>").addClass("zoom_image_wrap").append(n).appendTo(this.zoom.find(".inner")),this.zoom.find(".inner").append('<div class="inner_shadow">')},n.prototype.updateZoom=function(){var t,e,i;return e=this.sliceValue(),"top"===this.options.which?(i=-e+this.zoomSize/2,t=0):(i=e+this.zoomSize/2-this.model.get("height")+1+this.model.get("statusbar_height"),t=Math.floor(this.zoomSize/2-e*this.scale+this.zoomPad),t=0>t?0:t,t=t>this.zoomSize/2+this.zoomPad?this.zoomSize/2+this.zoomPad:t),this.zoom.css({height:""+(this.zoomSize-t+this.zoomPad)+"px"}),this.sliceImage.css({top:i-this.zoomPad/2}),this.sliceImage.find("img").css({left:-(this.model.get("width")/2-this.zoomSize/2),position:"relative",marginTop:-this.model.get("statusbar_height")}),this.zoom.find(".inner").css({backgroundPosition:"50% "+(i-this.zoomPad/2)+"px"})
},n.prototype.showAnnotations=function(){return"show"!==this.zoomState?(this.elements||(this.zoom=$("<div>").addClass("zoom").append($("<div>").addClass("inner")),this.rule=$("<div>").addClass("rule"),this.pixels=$("<div>").addClass("pixels"),this.elements=this.zoom.add(this.rule).add(this.pixels)),this.$el.append(this.elements),this.$el.find(".zoom, .rule, .pixels").bind("click",this.deselectAll),this.showSnapPoints(),this.showPixels(),this.setupZoom(),setTimeout(function(t){return function(){return t.showZoom()}}(this),10)):void 0},n.prototype.hideAnnotations=function(){return"hide"!==this.zoomState&&this.elements?(this.hideSnapPoints(),this.hideZoom(),this.hidePixels(function(t){return function(){return t.elements.remove(),t.$el.find(".zoom, .rule, .pixels").unbind("click",t.deselectAll)}}(this))):void 0},n.prototype.showSnapPoints=function(){var t;return 0!==this.autoDetectedSlice?(t=$("<div>").addClass("snap_point").addClass(this.options.which),t.css(this.options.which,""+this.adjustSlicePosition(this.autoDetectedSlice)+"px"),t.data("point",this.autoDetectedSlice),t.on("click",this.clickToSnap),this.$el.parent().prepend(t)):void 0},n.prototype.hideSnapPoints=function(){var t;return t=this.$el.parent().find(".snap_point"),t.transition({opacity:0},function(){return function(){return t.remove()}}(this))},n.prototype.updateSnapPoints=function(){var t;return t=this.$el.parent().find(".snap_point."+this.options.which),_.each(t,function(t){return function(e){var i;return i=$(e),i.css(t.options.which,""+t.adjustSlicePosition(i.data("point"))+"px")}}(this))},n.prototype.showZoom=function(){return this.zoomState="show",this.scale<1?this.zoom.show().find(".inner").css({display:"block",opacity:0,scale:0}).transition({opacity:1,scale:1,duration:150}):void 0},n.prototype.hideZoom=function(){return this.zoomState="hide",this.zoom.find(".inner").transition({opacity:0,scale:0,duration:220},function(t){return function(){return"hide"===t.zoomState?t.zoom.hide().find(".inner").hide():void 0}}(this))},n.prototype.showPixels=function(){return this.setPixelsLabel(),this.pixelsState="show",this.pixels.show().css({opacity:0}).transition({opacity:1})},n.prototype.hidePixels=function(t){return this.pixelsState="hide","hide"===this.pixelsState?this.pixels.transition({opacity:0},function(e){return function(){return e.pixels.hide(),t()}}(this)):void 0},n.prototype.save=function(t){return null==t&&(t=!1),this.setNewValue(!1)&&(this.oppositeSlicer().setNewValue(!0),this.model.save(null,{silent:!0}),t)?this.handle.flinto_draggable("broadcast","save",this.sliceValue()):void 0},n.prototype.oppositeSlicer=function(){return"bottom"===this.options.which?this.parentView.slicers.top:this.parentView.slicers.bottom},n.prototype.setNewValue=function(t){var e;if(null==t&&(t=!1),t||this.model.hasChanged(this.whichSlice)){clearTimeout(this.moveDebounceTimer),e="top"===this.options.which?this.sliceValue()+this.model.get("statusbar_height"):this.model.get("height")-this.sliceValue()-1;try{this.model.set(""+this.options.which+"_slice_color",this.getSliceLineColor(e)),this.model.set("transparent_"+this.options.which+"_slice",this.detectTransparencyInSlicer(e))}catch(i){}return!0}return!1},n.prototype.handleDoubleClick=function(){return this.autoDetectedSlice?(this.setSliceValue(this.autoDetectedSlice),this.save(!0)):void 0},n.prototype.handleSelect=function(t,e){return e.options.which!==this.options.which?void this.deselect():e!==this?(this.parentView.isSelected()?this.$el.hasClass("selected")||this.handle.flinto_draggable("select",t,!0):this.deselect(),this.hideAnnotations()):void 0},n.prototype.deselect=function(){return this.$el.hasClass("selected")?this.handle.flinto_draggable("deselect"):void 0},n.prototype.deselectAll=function(){return fleditor.local.vent.trigger("slicer:deselect")},n.prototype.setPixelsLabel=function(){return this.pixels.text(this.sliceValue()+"px")},n.prototype.doSnap=function(t){var e,i,n,r,s,o;return 0===this.autoDetectedSlice?t:(s=4/this.scale,e=null,i=null,r=Math.abs(t-this.autoDetectedSlice),o=s>r,n=null==e||i>r,o&&n&&(e=this.autoDetectedSlice,i=r),null!=e?e:t)},n.prototype.clickToSnap=function(t){return this.setSliceValue($(t.target).data("point")),t.stopPropagation(),this.deselect()},n.prototype.contain=function(t){var e,i;return e=this.maxSliceValue(),i=0,i>t?i:t>e?e:t},n.prototype.maxSliceValue=function(){var t,e,i;return t=50,i="bottom"===this.options.which?"top_slice":"bottom_slice",e=this.model.actualScreenHeight()-this.model.get(i)-t,e=Math.min(e,parseInt(fleditor.local.viewer_height/this.scale*.75)),e=Math.min(e,fleditor.local.proto.get("recommended_screen_height")-88)},n.prototype.positionSlicer=function(){var t;return t=this.sliceValue(),this.$el.toggleClass("zero",0===t),this.$el.css(this.options.which,""+this.adjustSlicePosition(t)+"px")},n.prototype.adjustSlicePosition=function(t){return"top"===this.options.which?Math.ceil((t+this.model.get("statusbar_height"))*this.scale)+parseInt(this.parentView.statusbarMargin):Math.floor(t*this.scale)+1},n.prototype.render=function(){return this.scale=this.parentView.screenImageScaleFactor(),this.handle=$("<div>").addClass("handle").appendTo(this.$el),this.handle.flinto_draggable({distance:0,selectOnMouseDown:!0,axis:"y",groupName:""+this.whichSlice,selected:function(t){return function(e,i){return!t.$el.hasClass("selected")&&(t.$el.addClass("selected"),i.clicked)?(t.bindEvents("on"),fleditor.local.vent.trigger("slicer:select",e,t)):void 0}}(this),unselected:function(t){return function(){return t.$el.hasClass("selected")?(t.$el.removeClass("selected"),t.bindEvents("off"),t.save(),t.hideAnnotations()):void 0}}(this),clicked:function(t){return function(e){return fleditor.local.vent.trigger("slicer:select",e,t)}}(this),start:function(t){return function(e,i){return t.startPosition=t.sliceValue(),t.parentView.selectMultipleScreen(e.shiftKey),i.clicked?(t.detectSlice(),t.showAnnotations()):t.hideAnnotations()}}(this),drag:function(t){return function(e,i){var n,r;return t.handle.css({top:"",left:""}),i.clicked?(n="top"===t.options.which?i.moved.y:-i.moved.y,r=t.doSnap(Math.round(t.startPosition+n)),r=t.contain(r),t.setSliceValue(r)):void 0}}(this),stop:function(t){return function(){return t.save()}}(this),update:function(t){return function(e){return e=t.contain(e),t.model.set(t.whichSlice,e)}}(this),save:function(t){return function(){return t.save()}}(this)}),this.positionSlicer(),this},n.prototype.setScale=function(t,e){return this.scale=t,this.positionSlicer(),"show"===this.zoomState?(this.setupZoom(e),this.updateSnapPoints()):void 0},n.prototype.getSliceLineColor=function(t){var e,i,n,r,s,o,a,l,h,u,c,d,p,f,g,m;for(r=this.getSlicerCanvas(),f=this.model.get("width"),r.width=f,r.height=1,o=r.getContext("2d"),o.drawImage(this.parentView.screenImage[0],0,t,f,1,0,0,f,1),n=o.getImageData(0,0,f,1).data,c={},l=g=0,m=f-1;m>=0?m>=g:g>=m;l=m>=0?++g:--g)d=n[4*l],a=n[4*l+1],i=n[4*l+2],e=n[4*l+3],h="rgba("+d+","+a+","+i+","+e+")",c[h]?c[h]++:c[h]=1;u=0;for(h in c)p=c[h],p>u&&(u=p,s=h);return s="rgba(0,0,0,0)"===s?"rgb(255,255,255)":s.replace(/rgba\((\d+,\d+,\d+),\d+\)/,"rgb($1)")},n.prototype.updateSlicer=function(){return this.sliceImage&&(this.sliceImage.remove(),this.sliceImage=null),this.setNewValue(!0)},n.prototype.detectTransparencyInSlicer=function(t){var e,i,n,r,s,o,a,l,h,u,c,d,p,f,g;if(0===this.sliceValue())return!1;for(i=this.getSlicerCanvas(),h=this.model.get("width"),i.width=h,i.height=t,"top"===this.options.which?(l=this.model.get("statusbar_height"),r=t):(l=t,r=this.model.get("height")),s=r-l,n=i.getContext("2d"),n.drawImage(this.parentView.screenImage[0],0,l,h,s,0,0,h,s),e=n.getImageData(0,0,h,s).data,c=d=0,f=s-1;f>=0?f>=d:d>=f;c=f>=0?++d:--d)for(a=c*h*4,u=p=0,g=h-1;g>=0?g>=p:p>=g;u=g>=0?++p:--p){if(o=e[a+3],255!==o)return!0;a+=4}return!1},n.prototype.detectSlice=function(){var t,e,i,n,r,s,o,a,l,h,u,c,d,p,f,g,m,v,y,w,b,_,k;if(this.autoDetectedSlice)return this.autoDetectedSlice;switch(f=this.model.get("width"),t=fleditor.local.header.model.get("device")){case"iphone":g=[320,640];break;case"iphone_landscape":g=[480,568,960,1136];break;case"ipad":g=[768,1536];break;case"ipad_landscape":g=[1024,2048]}e=!1,n=!1;for(i in g)if(p=g[i],Math.abs(f-p)<10){parseInt(i)>=g.length/2&&(n=!0),e=!0;break}if(!e)return 0;c=this.model.get("statusbar_height"),o="iphone_landscape"===t?{top:[[30,6,[2]]],bottom:[[40,10,[8]],[164,10,[2]]]}:{top:[[40,6,[4]],[49,11,[]],[64,2,[1]]],bottom:[[60,18,[11,16]],[218,6,[2]]]},h=n?2:1;for(r in o)for(s=o[r],m=0,y=s.length;y>m;m++){a=s[m],a[0]*=h,a[1]*=h,b=a[2];for(i in b)l=b[i],a[2][i]=l*h}_=o.bottom;for(i in _)d=_[i],d[0]=this.model.get("height")-d[0]-c;for(k=o[this.options.which],v=0,w=k.length;w>v;v++)if(s=k[v],u=this.detectSliceCore(s),0!==u){"bottom"===this.options.which&&(u=this.model.get("height")-u-c);break}return this.autoDetectedSlice=u},n.prototype.detectSliceCore=function(t){var e,i,n,r,s,o;return e=$("#slice_detector"),0===e.length&&(e=$('<canvas id="slice_detector">').hide().appendTo($("body"))),o=t[0],r=t[1],n=t[2],i=new EdgeDetector(this.parentView.$el.find(".screen_image img")[0],e[0],this.model.get("statusbar_height")+o,0,r),s=i.detectSlice(n),0!==s&&(s+=o),s},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.ScreenUploader=function(e){function n(){return this.handleDrop=t(this.handleDrop,this),this.handleDragOver=t(this.handleDragOver,this),this.handleDragLeave=t(this.handleDragLeave,this),this.handleDragEnter=t(this.handleDragEnter,this),this.uploadAllowed=t(this.uploadAllowed,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.className="screen_uploader",n.prototype.overClass="over",n.prototype.movedScreen=[],n.prototype.dragCount=0,n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.cursor=$("<div>").addClass("insert_cursor"),this.cursor.appendTo($("body")),$("body").on("dragenter",this.handleDragEnter).on("dragleave",this.handleDragLeave).on("dragover",this.handleDragOver).on("drop",this.handleDrop)},n.prototype.uploadAllowed=function(){return!$("body").is(".linkup, .modal")},n.prototype.handleDragEnter=function(t){var e,i,n,r,s,o,a,l,h,u,c;if(!fleditor.local.modal){if(0===this.dragCount)for(this.options.screensView.$el.addClass("initial_upload_hover"),this.screens=this.options.screensView.inner.children(".screen"),e=_.map(this.screens,function(t){return Rect.fromElement($(t),!1,!0).round()}),l=_.map(this.screens,function(t){return Rect.fromElement($(t).find(".screen_image_wrapper")).round()}),this.rects=[],h=$(window).outerWidth(!0),this.cursorWidth=this.cursor.outerWidth(),r=u=0,c=l.length;c>u;r=++u)a=l[r],i=e[r],this.rects.push({r:a,gap:!1}),0===r?(n=Rect.fromDimensions(0,i.origin.y,a.center().x,i.size.height),this.rects.push({r:n,cursor:a.origin.x/2,gap:!0,index:r,prev:!1,next:!0})):(o=l[r-1],o.origin.y!==a.origin.y?(n=Rect.fromDimensions(0,i.origin.y,a.center().x,i.size.height),this.rects.push({r:n,cursor:a.origin.x/2,gap:!0,index:r,prev:!1,next:!0})):(n=Rect.fromDimensions(o.center().x,i.origin.y,a.center().x-o.center().x,i.size.height),this.rects.push({r:n,cursor:o.right()+(a.origin.x-o.right())/2,gap:!0,index:r,prev:!0,next:!0}))),r===l.length-1?(n=Rect.fromDimensions(a.center().x,i.origin.y,h-a.center().x,i.size.height),this.rects.push({r:n,cursor:a.right()+(i.right()-a.right())/2,gap:!0,index:r+1,prev:!1,next:!1})):(s=l[r+1],s.origin.y!==a.origin.y&&(n=Rect.fromDimensions(a.center().x,i.origin.y,h-a.center().x,i.size.height),this.rects.push({r:n,cursor:a.right()+(i.right()-a.right())/2,gap:!0,index:r+1,prev:!0,next:!1})));return this.dragCount++,t.preventDefault()}},n.prototype.handleDragLeave=function(t){return fleditor.local.modal?void 0:(this.dragCount--,0===this.dragCount&&(this.options.screensView.$el.removeClass("initial_upload_hover"),this.hideCursor()),t.preventDefault())},n.prototype.handleDragOver=function(t){var e,i,n,r,s,o;if(!fleditor.local.modal&&(t.preventDefault(),t.stopPropagation(),0!==this.screens.length)){if(-1===_.indexOf(t.dataTransfer.types,"Files"))return void(t.dataTransfer.dropEffect="none");for(n=Point.fromEvent(t.originalEvent),o=this.rects,e=r=0,s=o.length;s>r;e=++r)if(i=o[e],i.r.contains(n)){i.gap?this.showCursor(i):this.hideCursor();break}return!0}},n.prototype.showCursor=function(t){var e,i,n,r;if(t.index!==this.insertPosition||"block"!==this.cursor.css("display")){for(this.cursor.css({left:t.cursor-Math.floor(this.cursorWidth/2),top:t.r.origin.y,height:t.r.size.height,display:"block"}),r=this.movedScreen,i=0,n=r.length;n>i;i++)e=r[i],e.transition({x:0,duration:50});return this.movedScreen=[],this.insertPosition=t.index}},n.prototype.hideCursor=function(){return"none"!==this.cursor.css("display")?this.cursor.css({display:"none"}):void 0},n.prototype.handleDrop=function(t){var e;if(!(fleditor.local.modal||(this.hideCursor(),this.dragCount=0,$(t.target).parents(".screen_image_wrapper").length>0&&1===t.dataTransfer.files.length))){try{this.uploadAllowed()&&this.collection.bulkUploadScreens(t.dataTransfer.files,this.insertPosition)}catch(i){throw e=i,t.preventDefault(),t.stopPropagation(),e}return t.preventDefault()}},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};fleditor.views.Share=function(e){function n(){return this.hideErrorMessage=t(this.hideErrorMessage,this),this.showErrorMessage=t(this.showErrorMessage,this),n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.className="share",n.prototype.template=JST["fleditor/templates/share"],n.prototype.events={"click .delete":"destroy","click .token":"openShareLink","click .resend":"resend","click .regenerate":"regenerate","click input":"selectAll","mouseover .recipient .glyph":"showErrorMessage","mouseout .recipient .glyph":"hideErrorMessage"},n.prototype.initialize=function(t){return this.options=null!=t?t:t,this.model.on("change",this.render,this),this.model.on("destroy",this.remove,this)},n.prototype.openShareLink=function(){},n.prototype.resend=function(t){var e;return e=$(t.target),e.hasClass("a")?(this.model.save(),e.removeClass("a")):void 0},n.prototype.regenerate=function(){return confirm("Are you sure you want to expire this link and generate a new one?")?this.model.save():event.stopPropagation()},n.prototype.selectAll=function(t){return t.target.select()},n.prototype.destroy=function(t){return null==t&&(t=null),this.model.get("error_message")?this.model.destroy():confirm("Are you sure you want to permanently delete this share link?")?this.model.destroy():event.stopPropagation()},n.prototype.showErrorMessage=function(){var t;return t=this.$el.find(".recipient .error_message"),t.show()},n.prototype.hideErrorMessage=function(){var t;return t=this.$el.find(".recipient .error_message"),t.hide()},n.prototype.render=function(){var t,e,i,n,r;return e=function(t){return t.replace(/(1+)?(\d{3})(\d{3})(\d{4})/,"$1 ($2) $3-$4")},n=this.model.toJSON(),t=new Date(n.created_at),n=_.extend(n,{created_at:""+(t.getMonth()+1)+"/"+t.getDate()+"/"+t.getFullYear()}),n.recipient&&(n=_.extend(n,{recipient:n.recipient.match("@")?n.recipient:e(n.recipient)})),this.$el.html(this.template(n)),n.error_message&&this.$el.addClass("error"),r=window.location.protocol+"//"+window.location.host+("/p/"+this.model.get("token")),i=this.$el.find("input"),i.length?this.$el.find("input").attr("value",r):this.$el.find("a.js-generic_a").attr("href",r).text(r),this},n}(Backbone.View)}.call(this),function(){window.flinto||(window.flinto={}),flinto.setupViewer=function(t){var e;flinto.standalone=null!=window.navigator.standalone&&window.navigator.standalone===!0||screen.height-document.documentElement.clientHeight<40,e=null!==navigator.userAgent.match(/Android.*Chrome/)||null!==window.navigator.userAgent.match(/AppleWebKit.*like Gecko\) Version.*Safari/),window.location.search.match("in_browser=[t|1]")&&(flinto.standalone=!0),flinto.isRunOnInAppBrowser=flinto.standalone===!1&&e===!1,flinto.mismatchDevice=null;try{($.os.ios&&t.device.match(/android/)||$.os.android&&!t.device.match(/android/)||$.os.ios&&$.os.iphone&&t.device.match(/ipad/))&&(flinto.mismatchDevice=t.device.replace(/_landscape/,""))}catch(i){}return t&&(flinto.isShowPhonePrototypeInTablet=!1,$.os.ios&&(flinto.isShowPhonePrototypeInTablet=$.os.ipad&&t.device.match(/iphone/))),flinto.mismatchDevice&&t.device.match(/android/)&&(flinto.isRunOnInAppBrowser=!1),$.os.android?$(document).on("webkitvisibilitychange",function(){return document.webkitHidden?(flviewer.hidden=!0,$(document.body).empty()):flviewer.hidden?window.location.reload():void 0}):void 0},flinto.showWrongBrowserMessageIfNeeded=function(){return"undefined"==typeof flinto.isRunOnInAppBrowser&&flinto.setupViewer(),$.os.android&&parseInt($.browser.version)<32&&!flinto.isShowPhonePrototypeInTablet?($(".js-correct_browser").hide(),$(".js-wrong_browser.need_chrome_32").show()):(flinto.isRunOnInAppBrowser&&($(".js-correct_browser").hide(),$(".js-wrong_browser.in_app_safari").show()),null!==flinto.mismatchDevice?($(".js-correct_browser").hide(),$(".js-wrong_device."+flinto.mismatchDevice).show()):void 0)},flinto.isWrongOrientation=function(t){var e;return e=$(window).width()>$(window).height()?"landscape":"portrait",e!==t.orientation},flinto.showScrollbarOnlyWhenNecessary=function(t){return t=$(t),t.css(t[0]&&t[0].scrollHeight>t.height()?{"overflow-y":"scroll"}:{overflow:"hidden"})},flinto.positionInstallArrow=function(t){var e,i,n,r;return i=t.edge,n=t.position,e=$("#action-arrow"),r={},r[i]="5px","number"==typeof n?n>=0?r.left=n:r.right=-n:"center"===n&&(r.left=$(window).width()/2),"top"===i&&e.css({"-webkit-transform":"rotate(180deg)"}),e.css(r).show()},flinto.setupAppIcon=function(t){var e,i,n,r,s,o;return o=t.device&&t.device.match(/android/),r=window.devicePixelRatio>1?"retina":"legacy",o&&(r="legacy"),i=$.os.ipad?"ipad":"",!o&&$.os.ios&&(parseFloat($.os.version)>=7||t.ios7_mode)?(r=$.os.ipad?window.devicePixelRatio>1?"ios7":"ios7_legacy":"ios7",s=t.icons[r],s?i+=" ios7":(r=window.devicePixelRatio>1?"retina":"legacy",s=t.icons[r])):s=t.icons[r],n=t.device_info.icon_dimensions[r].w,$("#apple-touch-icon").attr("href",s).attr("sizes",""+n+"x"+n),flinto.shouldOpenInstruction()?(e=$("<img>").addClass(i),e.on("load",function(){return function(){var i;return i=n,r.match(/legacy/)?t.device.match(/android/)&&(i=n/3):i=n/2,flinto.setAppIconStyle(t.device,e,i,$(".app_icon")),flinto.layoutInstruction()}}(this)),e.on("error",function(){return function(){return flinto.layoutInstruction(),r=window.devicePixelRatio>1?"retina":"legacy",n=flviewerPrototypeBootstrapData.device_info.icon_dimensions[r].w,s=flviewerPrototypeBootstrapData.icons[r],$("#apple-touch-icon").attr("href",s).attr("sizes",""+n+"x"+n),e.attr("src",s)}}(this)),e.attr("src",s)):void 0},flinto.setAppIconStyle=function(t,e,i,n){var r;return e.width(i).height(i).appendTo(n),r=t.match(/android/)?10/47:parseFloat($.os.version)>=7?26/120:10/57,n.css({"border-radius":r*i,width:i,height:i})},flinto.layoutInstruction=function(){var t,e,i;return $.os.ios?parseFloat($.os.version)>=7?$("p.ios7").show():$("p.ios6").show():$("p.android").show(),t=$("#install").show(),i=t.height(),e=function(){var e,n,r,s,o,a;return n={iphone:{6:{edge:"bottom",position:"center"},7:{edge:"bottom",position:"center"}},ipad:{6:{edge:"top",position:207},7:{edge:"top",position:142}},android:{edge:"top",position:-24}},$.os.ios?(o=parseInt($.os.version)>=7?7:6,s=$.os.iphone?n.iphone[o]:n.ipad[o],6===o&&$.os.iphone&&90===Math.abs(window.orientation)&&(s.position=244)):s=n.android,flinto.positionInstallArrow(s),a=window.innerWidth,e=window.innerHeight,i+100>e?t.addClass("landscape"):t.removeClass("landscape"),r=-1*(t.height()/2),r-=e/40,t.css({marginTop:r+"px"})},e(),$(window).on("resize",function(){return function(){return e(),flinto.showWrongBrowserMessageIfNeeded()}}(this)),flinto.showWrongBrowserMessageIfNeeded()},flinto.shouldOpenInstruction=function(){return!flinto.standalone&&!flinto.isShowPhonePrototypeInTablet||flinto.mismatchDevice}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.flviewer={is_mobile:!1,numScreen:0,numLoaded:0,numScreenLoading:0,easeInOut:"in-out",easeIn:"in",easeOut:"out",is_preview:!1,animation_speed:1,num_screen_cache:2,LARGE_PROTO_THRESHOLD:768,LARGE_PROTO_SCALE:.75,ANDROID_MENUBAR_HEIGHT:47,ANDROID_MENUBAR_WIDTH:42},$.fn.transition||($.fn.transition=$.fn.animate,flviewer.easeInOut="ease-in-out",flviewer.easeIn="ease-in",flviewer.easeOut="ease-out"),flviewer.Viewer=function(){function e(e,i,n,r,s){var o;this.$el=i,null==r&&(r=!1),null==s&&(s=!1),this.hideError=t(this.hideError,this),this.showError=t(this.showError,this),this.handleRotate=t(this.handleRotate,this),this.touchMove=t(this.touchMove,this),this.showMenu=t(this.showMenu,this),this.imageLoaded=t(this.imageLoaded,this),this.render=t(this.render,this),this.screenExists=t(this.screenExists,this),this.activateCore=t(this.activateCore,this),this.activate=t(this.activate,this),this.goBackCore=t(this.goBackCore,this),this.goBack=t(this.goBack,this),this.loadJSON=t(this.loadJSON,this),this.startTime=(new Date).getTime(),flviewer.is_mobile=n,flviewer.is_embed=s,flviewer.is_ios=$.os&&$.os.ios,flviewer.is_android=$.os&&$.os.android,flviewer.clickAction=n?"tap":"click",this.errorContainer=$("#viewer_error"),flviewer.is_preview=r,this.attributes=e,$(".js-menu_trigger").click(function(t){return function(e){return e.preventDefault(),t.showMenu()}}(this)),this.transition=new flviewer.Transition(this.attributes),this.screenQueue=[],this.isLetterbox()&&$("body").addClass("letterbox"),n||this.scaleViewerForDesktop(),this.attributes.original={viewer_width:this.attributes.viewer_width,viewer_height:this.attributes.viewer_height},this.render(),o=!n||"development"===window.rails_env||"test"===window.rails_env||window.location.search.match(/no_offline/),n?(o||(this.offline=new flviewer.OfflineManager(this)),$(document.body).on("touchmove",this.touchMove),$(document.body).on("longTap",this.showMenu),$(window).on("orientationchange",this.handleRotate),this.wrongOrientation()&&this.handleRotate()):this.$el.addClass("browser"),o&&this.loadJSON(e),flinto.queryParameters().embed||setTimeout(function(t){return function(){return t.recordView()}}(this),1e3),this.menu=new flviewer.Menu(this),flviewer.is_android&&(window.location.hash="",window.onpopstate=this.goBackCore),this.setupAndroidMenubar(),this.setupAutoDemo()}return e.prototype.loadJSON=function(t){var e;return null==t&&(t=null),t&&(e=this.attributes.original,this.attributes=t,this.attributes.original=e,this.render()),this.activeScreen=null,this.rendered=!1,this.homeScreen=null,window.isOldIE?(this.showError("unsupported"),void this.render()):(flviewer.numScreen=this.attributes.screens.length,0===flviewer.numScreen?(this.showError("no_screens"),this.render()):this.createScreens(this.attributes.screens))},e.prototype.goBack=function(){return this.activate(-1)},e.prototype.goBackCore=function(){return this.activeScreen&&this.activeScreen.backScreen?this.activateCore(this.activeScreen.backScreen.id,!0,this.transition.reverseTransition(this.activeScreen.transition)):void 0},e.prototype.activate=function(t,e,i){return!this.activeScreen.loaded&&-1!==t||t===this.activeScreen.id?void 0:-1===parseInt(t)?flviewer.is_android?window.history.back():this.goBackCore():this.activateCore(t,!1,e,i)},e.prototype.activateCore=function(t,e,i,n){var r,s,o,a,l,h,u;for(null==n&&(n=!1),r=this.activeScreen,a=this.screens[t],a.render(),r.saveScrollPosition(),r.hideLinks(),s=function(t){return t.preventDefault()},u=["touchstart","touchend","touchmove","touchcancel"],l=0,h=u.length;h>l;l++)o=u[l],$(document.body).on(o,s);if($("#dummy_div").show(),this.transitioning=!0,this.transition.transition(i,r,a,e,function(t){return function(){var i;return t.screenQueue=t.screenQueue.filter(function(t){return t.id!==a.id}),t.screenQueue.push(a),r.remove(),!e&&flviewer.is_android&&window.history.pushState({screen:r.id},a.title,"#"+a.id),i=flviewer.is_mobile?100:0,clearTimeout(t.touchTimer),t.touchTimer=setTimeout(function(){var e,i,n;for($("#dummy_div").hide(),a.buildLinks(),a.showLinks(),n=["touchstart","touchend","touchmove","touchcancel"],e=0,i=n.length;i>e;e++)o=n[e],$(document.body).off(o,s);return t.transitioning=!1},i),a.handleTimedScreen()}}(this)),this.activeScreen=a,!e){if(n){if(r.backScreen&&a.id===r.backScreen.id)return;return a.backScreen=r.backScreen,a.transition=r.transition}return a.backScreen=r,a.transition=i}},e.prototype.screenExists=function(t){var e,i,n;if(-1===t)return!0;n=this.screens;for(e in n)if(i=n[e],parseInt(e)===t)return!0;return!1},e.prototype.render=function(t){var e,i,n;return this.attributes.viewer_width=this.attributes.original.viewer_width,this.attributes.viewer_height=this.attributes.original.viewer_height,i=function(t){return function(){var e;return e=$(window).width(),null!=e&&0!==e?(t.viewerScaleFactor=t.attributes.viewer_width/e,t.attributes.viewer_width/=t.viewerScaleFactor,t.attributes.viewer_height/=t.viewerScaleFactor):void 0}}(this),null!=this.attributes.device&&(flviewer.is_mobile?(flviewer.is_ios&&("iphone_landscape"===this.attributes.device&&460===window.screen.availHeight&&(this.attributes.viewer_width=480),flinto.isShowPhonePrototypeInTablet||(this.attributes.viewer_height=$(window).height())),flviewer.is_android&&(this.isLetterbox()?(n=$(window).width(),e=$(window).height(),this.attributes.viewer_width>n&&i(),this.attributes.viewer_width<n&&this.$el.css({left:parseInt((n-this.attributes.viewer_width)/2)}),this.attributes.viewer_height<e?this.$el.css({top:parseInt((e-this.attributes.viewer_height)/2)}):this.attributes.viewer_height=e):(i(),this.attributes.viewer_height=$(window).height()))):flviewer.is_embed&&i(),this.$el.css({width:this.attributes.viewer_width,height:this.attributes.viewer_height}),flviewer.is_mobile||($(".inline_preview").width(this.attributes.viewer_width+this.menubar_width),$(".screen_area").width(this.attributes.viewer_width+this.menubar_width),$(".screen_area").height(this.attributes.viewer_height+this.menubar_height))),this.showStartupImage(),t&&this.activeScreen&&(this.activeScreen.remove(),this.activeScreen.render(!0).appendTo(this.$el),this.activeScreen.buildLinks(),this.activeScreen.showLinks(),this.activeScreen.$el.show()),this.$el},e.prototype.renderHomeScreen=function(){return this.activeScreen=this.homeScreen,this.homeScreen.render().appendTo(this.$el),this.homeScreen.buildLinks(),this.homeScreen.handleTimedScreen(),this.startup?this.startup.remove():void 0},e.prototype.showStartupImage=function(){var t,e;return!flviewer.is_mobile||"development"===rails_env||"test"===rails_env||flinto.isShowPhonePrototypeInTablet||this.isAndroid()||this.startup?void 0:(e=window.devicePixelRatio>1?"retina":"legacy",548===window.screen.availHeight&&(e="retina_4_inch"),t=new Image,t.src=this.attributes.startup_images[e],this.startup=$(t),this.startup.css({width:"100%",height:"100%",position:"absolute"}),this.startup.on("touchmove",function(t){return t.preventDefault()}),this.startup.on("load",function(t){return function(){return t.startup.appendTo(t.$el)}}(this)))},e.prototype.createScreens=function(t){var e,i,n,r,s,o,a,l,h,u,c,d;for(this.screens={},e={},l=0,u=t.length;u>l;l++)s=t[l],r=new flviewer.Screen(s,this),this.screens[s.id]=r,this.homeScreen?e[s.id]=r:this.homeScreen=r;for(this.bfs_tree=[[this.homeScreen.id]],o=[this.homeScreen];Object.keys(e).length>0;){for(a=[],h=0,c=o.length;c>h;h++){r=o[h],d=r.links;for(i in d)n=d[i],e[n.targetID]&&(a.push(n.targetID),delete e[n.targetID])}if(!a.length)break;this.bfs_tree.push(a),o=function(){var t,e,n;for(n=[],t=0,e=a.length;e>t;t++)i=a[t],n.push(this.screens[i]);return n}.call(this)}return this.bfs_tree.shift(),this.homeScreen.loadScreen()},e.prototype.imageLoaded=function(t){return++flviewer.numLoaded,t.id===this.homeScreen.id?this.firstImageIsLoaded(t):void 0},e.prototype.firstImageIsLoaded=function(){return this.rendered?void 0:(this.renderHomeScreen(),this.rendered=!0,setTimeout(function(t){return function(){var e,i,n,r,s,o;if(t.bfs_tree.length){for(s=t.bfs_tree,o=[],n=0,r=s.length;r>n;n++)i=s[n],o.push(function(){var t,n,r;for(r=[],t=0,n=i.length;n>t;t++)e=i[t],this.screens[e].loadScreen(),r.push(++flviewer.numScreenLoading);return r}.call(t));return o}}}(this),0))},e.prototype.showMenu=function(){return this.transitioning?void 0:(this.menu.setCurrentScreen(this.activeScreen),this.activeScreen.hideActiveLinkHighlight(),this.menu.show())},e.prototype.touchMove=function(t){return $(t.target).closest(".slice").length?t.preventDefault():!0},e.prototype.handleRotate=function(){return this.wrongOrientation()&&!flinto.isShowPhonePrototypeInTablet?($("#flviewer").css({left:(window.innerWidth-window.innerHeight-20)/2+"px"}),this.hideError(),this.showError("wrong_orientation")):(this.hideError(),$("#flviewer").css({left:"0px"}),this.$el.empty(),this.render(!0))},e.prototype.wrongOrientation=function(){return flinto.isWrongOrientation(this.attributes)},e.prototype.showError=function(t){return $("body").hasClass("fleditor")||$("body").addClass("void"),this.errorContainer.addClass(t).show(),this.errorContainer.find(".js-showable").hide(),this.errorContainer.find("."+t).show(),this.errorContainer},e.prototype.hideError=function(){return $("body").removeClass("void"),this.errorContainer.hide(),this.errorContainer.find(".js-showable").hide()},e.prototype.isAndroid=function(){return this.attributes.device.match(/android/)},e.prototype.isiOS=function(){return this.attributes.device.match(/(ipad|iphone)/)},e.prototype.isLetterbox=function(){var t;return t=localStorage.getItem("letterbox"),t="undefined"==typeof t?this.attributes.letterbox:"true"===t?!0:!1},e.prototype.recordView=function(){return flviewer.is_preview?void 0:$.post(window.location.pathname+"/record_view")},e.prototype.scaleViewerForDesktop=function(){return this.menubar_height=this.isAndroid()&&!this.attributes.menu_on_side?flviewer.ANDROID_MENUBAR_HEIGHT:0,this.menubar_width=this.attributes.menu_on_side?flviewer.ANDROID_MENUBAR_WIDTH:0,this.viewerScaleFactor=1,this.attributes.viewer_width>flviewer.LARGE_PROTO_THRESHOLD||this.attributes.viewer_height>flviewer.LARGE_PROTO_THRESHOLD?(this.attributes.viewer_width=Math.round(this.attributes.viewer_width*flviewer.LARGE_PROTO_SCALE),this.attributes.viewer_height=Math.round(this.attributes.viewer_height*flviewer.LARGE_PROTO_SCALE),this.menubar_width=parseInt(this.menubar_width*flviewer.LARGE_PROTO_SCALE),this.menubar_height=parseInt(this.menubar_height*flviewer.LARGE_PROTO_SCALE),this.viewerScaleFactor=flviewer.LARGE_PROTO_SCALE):void 0},e.prototype.setupAndroidMenubar=function(){var t,e;return this.attributes.device.match(/android/)&&!flviewer.is_mobile?($("#flviewer_wrap").size()>0||this.$el.wrap($("<div>").attr("id","flviewer_wrap")),e=$("<div>").attr("id","android_menubar").toggleClass("landscape",!!this.attributes.menu_on_side),t=this.attributes.menu_on_side?$("<div>").addClass("menu_buttons js-menu_buttons").append($("<div>").addClass("menu_button menu disabled"),$("<div>").addClass("menu_button disabled home"),$("<div>").addClass("menu_button back")):$("<div>").addClass("menu_buttons js-menu_buttons").append($("<div>").addClass("menu_button back"),$("<div>").addClass("menu_button disabled home"),$("<div>").addClass("menu_button menu disabled")),e.append(t),e.appendTo($("#flviewer_wrap")),e.find(".back").on("click",this.goBack),this.attributes.menu_on_side?(e.height(this.attributes.viewer_height),e.find(".menu_button").height(this.attributes.viewer_height/3)):e.height(this.menubar_height).width(this.attributes.viewer_width)):void 0},e.prototype.setupAutoDemo=function(){var t,e;if(!flviewer.is_mobile&&(t=flinto.queryParameters(),0!==_.size(t)&&t.embed&&t.pattern)){try{e=JSON.parse(unescape(t.pattern))}catch(i){}return new flviewer.AutoDemo(this,e)}},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};flviewer.Link=function(){function e(e,i){this.screen=i,this.touchMoveCancel=t(this.touchMoveCancel,this),this.touchEnd=t(this.touchEnd,this),this.touchStart=t(this.touchStart,this),this.handleClick=t(this.handleClick,this),this.attributes=e,this.id=this.attributes.id,this.cid=this.id,this.offset=0,this.targetID=this.attributes.target_id}return e.prototype.isDead=function(){var t;
return t=null==this.targetID,this.screen.viewer.screenExists(this.targetID)?void 0:t=!0},e.prototype.isPlayingDead=function(){return!this.isDead()&&this.$el.hasClass("dead")},e.prototype.playDead=function(){return this.$el.addClass("dead")},e.prototype.playAlive=function(){return this.$el.removeClass("dead")},e.prototype.handleClick=function(t){return this.screen.viewer.transition.animating?!0:(this.isDead()||this.isPlayingDead()?this.screen.revealLinks():setTimeout(function(t){return function(){return t.screen.viewer.activate(t.targetID,t.attributes.transition,t.attributes.ignore_history)}}(this),50),t&&(t.preventDefault(),t.stopPropagation()),!0)},e.prototype.pointsBack=function(){return-1===this.targetID},e.prototype.rect=function(){return Rect.fromDimensions(this.attributes)},e.prototype.area=function(){return this.attributes.w*this.attributes.h},e.prototype.render=function(t){var e,i;return(e=this.rect().intersection(t))?(i=this.screen.scale(),this.$el=$('<div class="link">'),this.isDead()&&this.$el.addClass("dead"),this.targetID===this.screen.attributes.id&&this.$el.addClass("dead"),this.$el.data("link_id",this.id),this.$el.data("target_id",this.targetID),this.$el.data("transition",this.attributes.transition||"none"),this.$el.attr("id","link-"+this.id),this.$el.css({left:""+e.origin.x*i+"px",top:""+(e.origin.y-t.origin.y+this.offset)*i+"px",width:""+e.size.width*i+"px",height:""+e.size.height*i+"px","z-index":0}),this.$el.on(flviewer.clickAction,this.handleClick),flviewer.is_mobile&&(this.$el.on("touchstart",this.touchStart),this.$el.on("touchend",this.touchEnd),this.$el.on("touchmove",this.touchMoveCancel),this.$el.on("touchcancel",this.touchMoveCancel)),this.pointsBack()&&this.$el.addClass("back"),this.screen.viewer.attributes.show_active_tap&&this.$el.addClass("highlighting"),this.$el):void 0},e.prototype.touchStart=function(t){return this.targetID?(this.touch={x:t.touches[0].screenX,y:t.touches[0].screenY},void this.revealActiveLink(!0,!1)):!0},e.prototype.touchEnd=function(){return this.touch?(this.revealActiveLink(!1,!0),void(this.touch=null)):!0},e.prototype.touchMoveCancel=function(){return this.touch?(this.revealActiveLink(!1,!1),void(this.touch=null)):!0},e.prototype.clearLinkHighlight=function(){this.$el&&(this.$el.removeClass("active"),this.$el.css({opacity:0}))},e.prototype.revealActiveLink=function(t,e){this.screen.viewer.attributes.show_active_tap&&this.touch&&(clearTimeout(this.revealTimer),t?this.revealTimer=setTimeout(function(t){return function(){return t.screen.hideRevealedLinks(),t.$el.addClass("active"),t.$el.css({opacity:1})}}(this),150):this.$el.hasClass("active")?(this.screen.hideRevealedLinks(),this.$el.removeClass("active"),this.$el.css({opacity:0})):e&&(this.screen.hideRevealedLinks(),this.$el.addClass("active"),this.$el.css({opacity:1})))},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};flviewer.Menu=function(){function e(e){this.isActive=t(this.isActive,this),this.hide=t(this.hide,this),this.show=t(this.show,this),this.scaleToFit=t(this.scaleToFit,this),this.letterbox=t(this.letterbox,this),this.feedback=t(this.feedback,this),this.reload=t(this.reload,this),this.back=t(this.back,this),this.dismiss=t(this.dismiss,this),this.viewer=e,this.$el=$("#menu"),this.updateLetterboxOption()}return e.prototype.bindEvent=function(t){return this.$el[t](flviewer.clickAction,this.dismiss),this.$el.find(".back")[t](flviewer.clickAction,this.back),this.$el.find(".reload")[t](flviewer.clickAction,this.reload),this.$el.find(".feedback")[t](flviewer.clickAction,this.feedback),this.$el.find(".letterbox")[t](flviewer.clickAction,this.letterbox),this.$el.find(".scale_to_fit")[t](flviewer.clickAction,this.scaleToFit),"on"===t?this.$el.on("touchmove",function(t){return 90!==Math.abs(window.orientation)?t.preventDefault():$(t.target).hasClass("frame")?t.preventDefault():void 0}):this.$el.off("touchmove")},e.prototype.setCurrentScreen=function(t){var e,i,n,r,s;this.screen=t,e=0,s=this.screen.links;for(n in s)r=s[n],++e;return i=this.$el.find(".error_message"),0===e?i.show():i.hide()},e.prototype.dismiss=function(t){var e;return e=$(t.target),e.hasClass("frame")||"menu"===e.attr("id")?this.hide():void 0},e.prototype.back=function(){return this.$el.find(".back").hasClass("disabled")?void 0:(this.hide(),this.viewer.goBack())},e.prototype.reload=function(){return this.bindEvent("off"),$.ajax({url:window.location.pathname+".json?"+parseInt(Date.now()),dataType:"json",success:function(t){return function(e){return t.hide(),$("#flviewer").empty(),t.viewer.loadJSON(e)}}(this),error:function(){return function(){return window.location.reload()}}(this)})},e.prototype.feedback=function(){var t,e,i;return i=escape(this.viewer.attributes.creators.join(", ")),e=escape("Feedback about your prototype: "+this.viewer.attributes.title),t=escape('Screen: "'+this.viewer.activeScreen.title+'"'),window.location="mailto:"+i+"?subject="+e+"&body="+t},e.prototype.letterbox=function(){return this.viewer.attributes.letterbox=!0,this.reRender()},e.prototype.scaleToFit=function(){return this.viewer.attributes.letterbox=!1,this.reRender()},e.prototype.reRender=function(){return localStorage.setItem("letterbox",this.viewer.attributes.letterbox),this.bindEvent("off"),window.location.reload()},e.prototype.show=function(){var t;return!$.os||"7.0"!==$.os.version&&"7.0.1"!==$.os.version&&"7.0.2"!==$.os.version||$(".feedback").hide(),t=this.$el.find(".back"),this.screen.backScreen?t.removeClass("disabled"):t.addClass("disabled"),this.$el.addClass("active"),$.os&&$.os.android?this.$el.css({opacity:1}):this.$el.transition({opacity:1},150,flviewer.easeOut),this.bindEvent("on"),flinto.isShowPhonePrototypeInTablet?this.$el.find(".frame").css({marginTop:""+($("body").height()-this.$el.find(".menu_content").height())/2+"px"}):90===Math.abs(window.orientation)&&this.$el.find(".menu_content").height(window.screen.availWidth-50),flinto.showScrollbarOnlyWhenNecessary(this.$el.find(".menu_content"))},e.prototype.hide=function(){return this.bindEvent("off"),$.os&&$.os.android?this.$el.removeClass("active"):this.$el.transition({opacity:0},150,flviewer.easeIn,function(t){return function(){return t.$el.removeClass("active")}}(this))},e.prototype.isActive=function(){return this.$el.hasClass("active")},e.prototype.updateLetterboxOption=function(){return flviewer.is_mobile&&this.viewer.isAndroid()?this.viewer.isLetterbox()?(this.$el.find(".scale_to_fit").show(),this.$el.find(".letterbox").hide()):(this.$el.find(".scale_to_fit").hide(),this.$el.find(".letterbox").show()):void 0},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};flviewer.Screen=function(){function e(e,i){this.viewer=i,this.findLink=t(this.findLink,this),this.handleClick=t(this.handleClick,this),this.hideLinks=t(this.hideLinks,this),this.showLinks=t(this.showLinks,this),this.imageLoadAborted=t(this.imageLoadAborted,this),this.imageLoadFailed=t(this.imageLoadFailed,this),this.imageLoaded=t(this.imageLoaded,this),this.attributes=e,this.id=this.attributes.id,this.links=this.createLinks(),this.$el=$('<div class="screen">'),this.$el.data("screen_id",this.id),this.$el.attr("id","screen-"+this.id),this.loaded=!1,this.linkRevealing=!1,this.backScreen=null,this.title=this.attributes.title}return e.prototype.setupSlices=function(){var t;return this.hasSlice=this.attributes.top_slice||this.attributes.bottom_slice,t=this.scale(),this.innerHeight=this.viewer.attributes.viewer_height,this.attributes.transparent_top_slice||(this.innerHeight-=parseInt(this.attributes.top_slice*t)),this.attributes.transparent_bottom_slice||(this.innerHeight-=parseInt(this.attributes.bottom_slice*t)),this.imgHeight=parseInt((this.attributes.height-this.attributes.statusbar_height)*t)-parseInt(this.attributes.top_slice*t)-parseInt(this.attributes.bottom_slice*t)},e.prototype.loadScreen=function(){var t;return this.image?this.image:(t=new Image,"development"===window.rails_env&&(t.crossOrigin="anonymous"),t.src=this.attributes.image_url,this.image=$(t),this.image.on("load",this.imageLoaded),this.image.on("error",this.imageLoadFailed),this.image.on("abort",this.imageLoadAborted),this.image)},e.prototype.imageLoaded=function(){return this.loaded?void 0:(this.image.off("load"),this.loaded=!0,this.$el&&this.active&&(this.render(!0),this.buildLinks()),this.viewer.imageLoaded(this))},e.prototype.imageLoadFailed=function(){return this.error=".load_failed",this.viewer.imageLoaded(this)},e.prototype.imageLoadAborted=function(){return this.error=".load_aborted",this.viewer.imageLoaded(this)},e.prototype.handleDeadBackLinks=function(){var t,e,i,n;i=this.links,n=[];for(t in i)e=i[t],n.push(e.pointsBack()?null!=this.backScreen?e.playAlive():e.playDead():void 0);return n},e.prototype.buildErrorMessage=function(){var t,e;return e=this.error?this.error:".loading",t=$("#viewer_error").clone(!0).removeAttr("id"),t.find(e).css({display:"block"}).find(".js-screen_name").text(this.title),this.screenWrap.height(this.screenWrap.height(this.viewer.attributes.viewer_height)),t.find(".js-menu_trigger").on("click",function(t){return function(e){return e.preventDefault(),t.viewer.showMenu()}}(this)),t.find(".js-back_trigger").on("click",function(t){return function(e){return e.preventDefault(),t.viewer.goBack()}}(this)),t.show(),t},e.prototype.statusbarHeight=function(){return this.attributes.statusbar_height*this.scale()},e.prototype.render=function(t){return null==t&&(t=!1),this.setupSlices(),this.active&&!t?this.$el:(this.viewer.attributes.show_tap_hints&&this.$el.on(flviewer.clickAction,this.handleClick),this.$el.find(".error").remove(),this.error||!this.loaded?(this.initScreenWrap(),this.$el.append(this.screenWrap),this.screenWrap.append(this.buildErrorMessage())):this.renderScreen(),this.active=!0,this.show(),this.$el)},e.prototype.remove=function(){return this.screenWrap.empty(),this.linksContainer=null,this.$el.remove(),this.$el.off(flviewer.clickAction,this.handleClick),this.$el.find(".error").remove(),this.active=!1,this.$el.css({display:"none"}),this.hideRevealedLinks()},e.prototype.show=function(){return this.$el.css({display:"display"})},e.prototype.hide=function(){return this.hideRevealedLinks()},e.prototype.renderScreen=function(){var t,e,i,n;return this.loaded&&"image/gif"===this.attributes.image_type&&setTimeout(function(t){return function(){return t.image.removeAttr("src").attr("src",t.attributes.image_url)}}(this),0),this.initScreenWrap(),this.top_slice=this.createSlice(this.attributes.top_slice,!0),this.top_slice&&this.top_slice.appendTo(this.screenWrap),this.bottom_slice=this.createSlice(this.attributes.bottom_slice,!1),this.bottom_slice&&this.bottom_slice.appendTo(this.screenWrap),n=$("<div class='antiscroll-wrap'>").width(this.viewer.attributes.viewer_width).height(this.innerHeight),this.innerWrap=n,this.attributes.top_slice&&!this.attributes.transparent_top_slice&&n.css({top:""+this.scale(this.attributes.top_slice)+"px"}),this.hasSlice&&($("<div class='top_background'>").css({backgroundColor:this.attributes.top_slice_color}).appendTo(n),$("<div class='bottom_background'>").css({backgroundColor:this.attributes.bottom_slice_color}).appendTo(n)),this.inner=$("<div class='antiscroll-inner'>").width(this.viewer.attributes.viewer_width).height(this.innerHeight),this.attributes.transparent_top_slice&&this.inner.css({paddingTop:""+this.scale(this.attributes.top_slice)+"px"}),this.inner.appendTo(n),i=$("<div class='img_wrap'>"),i.height(this.imgHeight),this.attributes.transparent_bottom_slice&&i.css({marginBottom:this.scale(this.attributes.bottom_slice)}),flviewer.is_mobile&&(t=this.fakeBorder(),t&&(i.css({boxSizing:"content-box",borderBottom:t}),flviewer.is_android&&this.inner.css({"overflow-y":"hidden"}))),e=this.createInnerImage(i),i.append(e),i.appendTo(this.inner),n.appendTo(this.screenWrap),flviewer.is_mobile?this.imgHeight<=this.viewer.attributes.viewer_height&&null===this.top_slice&&null===this.bottom_slice&&(this.$el.on("touchmove",function(t){return t.preventDefault()}),flinto.showScrollbarOnlyWhenNecessary(this.inner)):this.image.imagesLoaded(function(t){return function(){var e,i;return i=t.attributes.transparent_top_slice?t.scale(t.attributes.top_slice):0,e=t.attributes.transparent_bottom_slice?t.scale(t.attributes.bottom_slice):0,n.antiscroll({initialDisplay:1e3,paddingTop:i,paddingBottom:e}),t.viewer.attributes.ios7_mode?$(".antiscroll-scrollbar").addClass("ios7"):void 0}}(this)),this.$el.append(this.screenWrap)},e.prototype.createInnerImage=function(t){var e,i,n,r,s;return s=this.hasSubPixel(this.attributes.top_slice),e=this.hasSubPixel(this.attributes.bottom_slice),n=this.attributes.height-this.attributes.top_slice-this.attributes.bottom_slice-this.attributes.statusbar_height,this.hasSlice&&(this.hasSubPixel(n)||s)?(t.addClass("one_pixel_off"),s?(r=this.attributes.top_slice-Math.floor(this.attributes.top_slice*this.scale())/this.scale(),i=this.sliceImage(this.attributes.statusbar_height+this.attributes.top_slice,this.attributes.height-this.attributes.bottom_slice,r,!0)):i=this.sliceImage(this.attributes.statusbar_height+this.attributes.top_slice,this.attributes.height-this.attributes.bottom_slice,0,!0),i):(this.image.width(this.viewer.attributes.viewer_width),this.image.css({marginTop:"-"+(this.statusbarHeight()+this.scale(this.attributes.top_slice))+"px",marginBottom:""+this.scale(this.attributes.bottom_slice)+"px"}),this.image)},e.prototype.showLinks=function(){return this.$el.find(".link").css({display:"block"})},e.prototype.hideLinks=function(){return clearTimeout(this.timedTimer),this.$el.find(".link").css({display:"none",opacity:0})},e.prototype.saveScrollPosition=function(){return this.inner?this.scrollTop=this.inner.scrollTop():void 0},e.prototype.restoreScrollPosition=function(){return this.scrollTop>0?this.inner[0].scrollTop=this.scrollTop:void 0},e.prototype.buildLinks=function(){return!this.linksContainer&&this.loaded?(this.top_slice&&this.rearrangeLinks(this.top_slice,Rect.fromDimensions(0,0,this.attributes.width,this.attributes.top_slice)),this.bottom_slice&&this.rearrangeLinks(this.bottom_slice,Rect.fromDimensions(0,this.attributes.height-this.attributes.statusbar_height-this.attributes.bottom_slice,this.attributes.width,this.attributes.bottom_slice)),this.rearrangeLinks(this.inner,Rect.fromDimensions(0,this.attributes.top_slice,this.attributes.width,this.attributes.height-this.attributes.statusbar_height-this.attributes.bottom_slice-this.attributes.top_slice),this.attributes.top_slice),reorderLinkViews(this.links),this.isHome()?this.handleDeadBackLinks():void 0):void 0},e.prototype.fakeBorder=function(){var t,e,i;return i=this.scale(),e=this.imgHeight,this.attributes.transparent_top_slice&&(e+=parseInt(this.attributes.top_slice*i)),this.attributes.transparent_bottom_slice&&(e+=parseInt(this.attributes.bottom_slice*i)),this.hasSlice&&e<=this.innerHeight?(t=1,e<this.innerHeight&&(t+=this.innerHeight-e+1),""+t+"px solid "+this.attributes.bottom_slice_color):null},e.prototype.initScreenWrap=function(){return this.screenWrap||(this.screenWrap=$('<div class="screen_wrap">')),this.screenWrap.height(this.attributes.height*this.scale()<this.viewer.attributes.viewer_height&&!this.hasSlice?this.attributes.height*this.scale():this.viewer.attributes.viewer_height)},e.prototype.rearrangeLinks=function(t,e,i){var n,r,s;this.linksContainer=$('<div class="links">'),s=this.links;for(n in s)r=s[n],r.offset=0,i&&this.attributes.transparent_top_slice&&(r.offset=i),e.contains(r.rect().center())&&this.linksContainer.append(r.render(e));return t.append(this.linksContainer)},e.prototype.handleClick=function(t){return $(t.target).hasClass("link")?void 0:this.revealLinks()},e.prototype.revealLinks=function(){var t,e;if(!this.error&&this.loaded){if(e=this.$el.find(".link"),0===e.length)return void this.viewer.showMenu();if(!this.linkRevealing)return this.linkRevealing=!0,e.addClass("revealing-link"),t=function(t){return function(i){return e.off(i.type),e.removeClass("revealing-link"),t.linkRevealing=!1}}(this),e.on("webkitAnimationEnd",t),e.on("animationend",t)}},e.prototype.hideRevealedLinks=function(){return this.$el.find(".link").removeClass("revealing-link").css({opacity:""}),this.linkRevealing=!1},e.prototype.hideActiveLinkHighlight=function(){var t,e,i,n;i=this.links,n=[];for(t in i)e=i[t],n.push(e.clearLinkHighlight());return n},e.prototype.createSlice=function(t,e){var i,n,r,s,o,a;return t?(a=$("<div class='slice'>"),a.addClass(e?"top":"bottom"),o=this.scale(),i=t*o,a.width(this.viewer.attributes.viewer_width).height(Math.ceil(i)),r=this.hasSubPixel(i),this.hasSubPixel(i)?e?n=this.sliceImage(this.attributes.statusbar_height,this.attributes.statusbar_height+this.attributes.top_slice,0):(s=Math.ceil(this.attributes.bottom_slice*o)/o-this.attributes.bottom_slice,n=this.sliceImage(this.attributes.height-this.attributes.bottom_slice,this.attributes.height,s)):(n=this.image.clone(),n.css({marginBottom:"",marginTop:"",position:"",bottom:""}),n.css(e?{marginTop:"-"+this.statusbarHeight()+"px"}:{position:"absolute",bottom:0})),n.appendTo(a),a):null},e.prototype.sliceImage=function(t,e,i,n){var r,s,o,a,l,h,u,c;return null==n&&(n=!1),c=e-t,u=this.attributes.width/this.viewer.attributes.viewer_width,o=this.attributes.width,s=Math.ceil((i+c)/u)*u,h=this.viewer.attributes.viewer_width,l=Math.ceil(s/u),r=$("<canvas>").attr({width:o,height:s}).css({width:h,height:l}),a=r[0].getContext("2d"),n&&(a.fillStyle="#fff",a.fillRect(0,i,o,c)),a.drawImage(this.image[0],0,t,this.attributes.width,c,0,i,o,c),flviewer.is_mobile||"development"===window.rails_env?r:$("<img>").attr("src",r[0].toDataURL())},e.prototype.hasSubPixel=function(t){var e;return e=this.viewer.attributes.viewer_width/this.attributes.width,Math.floor(t*e)!==t*e},e.prototype.scale=function(t){var e;return e=this.viewer.attributes.viewer_width/this.attributes.width,"undefined"!=typeof t?parseInt(t*e):e},e.prototype.isHome=function(){return 0===this.attributes.position},e.prototype.createLinks=function(){var t,e,i,n,r,s,o,a,l,h,u,c,d,p;for(n={},r=this.attributes.height-this.attributes.statusbar_height,t=function(t){return function(e,i){if(null==i&&(i=!1),e.timer&&(t.timedLink=e),e.y>=r){if(!i)return;e.y=r-e.h}return e.y+e.h>r&&(e.h=r-e.y),e.w&&e.h||e.timer?n[e.id]=new flviewer.Link(e,t):void 0}}(this),c=this.attributes.links,s=0,l=c.length;l>s;s++)i=c[s],t(i);for(d=this.attributes.link_groups,o=0,h=d.length;h>o;o++)for(e=d[o],p=e.links,a=0,u=p.length;u>a;a++)i=p[a],i.target_id!==this.id&&t(i,!0);return n},e.prototype.handleTimedScreen=function(){return this.timedLink&&this.viewer.screenExists(this.timedLink.target_id)&&this.timedLink.target_id!==this.id?(this.timedLink.timer<100&&(this.timedLink.timer=100),this.timedTimer=setTimeout(function(t){return function(){return t.viewer.activate(t.timedLink.target_id,t.timedLink.transition,t.timedLink.ignore_history)}}(this),this.timedLink.timer)):void 0},e.prototype.findLink=function(t,e){var i,n,r,s,o,a,l,h,u,c,d,p;if(s=new Point(t,e),this.top_slice)for(c=this.top_slice.find(".link"),a=0,h=c.length;h>a;a++)if(i=c[a],o=Rect.fromElement($(i)),o.contains(s))return this.links[$(i).data("link_id")];if(this.bottom_slice)for(d=this.top_slice.find(".link"),l=0,u=d.length;u>l;l++)if(i=d[l],o=Rect.fromElement(i),o.contains(s))return this.links[$(i).data("link_id")];p=this.links;for(n in p)if(r=p[n],o=Rect.fromElement(r.$el),o.contains(s))return r;return null},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};flviewer.Transition=function(){function e(e){var i,n,r;this.attr=null!=e?e:e,this.finishTransition=t(this.finishTransition,this),i="",r={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},n=document.createElement("div"),void 0!==n.style.transform?this.cssTransform="transform":($.each(r,function(t){return void 0!==n.style[t+"Transform"]?(i="-"+t.toLowerCase()+"-",!1):void 0}),this.cssTransform=i+"transform")}return e.prototype.reverseTransition=function(t){switch(t){case"navigation_push":return"navigation_pop";case"navigation_pop":return"navigation_push";case"modal_cover_vertical_appear":return"modal_cover_vertical_disappear";case"modal_cover_vertical_disappear":return"modal_cover_vertical_appear";case"modal_flip_horizontal_r_to_l":return"modal_flip_horizontal_l_to_r";case"modal_flip_horizontal_l_to_r":return"modal_flip_horizontal_r_to_l";case"screen_push":return"screen_pop";case"screen_pop":return"screen_push";case"zoom_fade_in":return"zoom_fade_out";case"zoom_fade_out":return"zoom_fade_in";case"hover_left_push":return"hover_left_pop";case"hover_left_pop":return"hover_left_push";case"hover_right_push":return"hover_right_pop";case"hover_right_pop":return"hover_right_push";default:return t}},e.prototype.isReverse=function(t){switch(t){case"navigation_pop":case"modal_cover_vertical_disappear":case"modal_flip_horizontal_l_to_r":case"screen_pop":case"zoom_fade_out":case"hover_left_pop":case"hover_right_pop":return!0;default:return!1}},e.prototype.transition=function(t,e,i,n,r){var s,o,a;if(this.fromScreen=null!=e?e:from,this.toScreen=null!=i?i:to,this.isBack=null!=n?n:n,flviewer.is_android)switch(t){case"modal_cover_vertical_appear":t="zoom_fade_in";break;case"modal_cover_vertical_disappear":t="zoom_fade_out"}return this.width=this.attr.viewer_width,this.height=this.attr.viewer_height,flviewer.animation_speed=1,this.is_os7=flviewer.is_ios&&parseFloat($.os.version)>=7||this.attr.ios7_mode,this.ease=this.is_os7?"cubic-bezier(.27,.22,.265,.975)":flviewer.easeInOut,this.durationForNav=this.is_os7?330:300,this.durationForModal=this.is_os7?450:400,this.durationForNav*=flviewer.animation_speed,this.durationForModal*=flviewer.animation_speed,this.durationForModal=450*flviewer.animation_speed,this.durationForFlip=300*flviewer.animation_speed,this.durationForFade=200*flviewer.animation_speed,this.durationForTimer=400*flviewer.animation_speed,this.durationForZoom=250*flviewer.animation_speed,this.scaleForFlip=.8,this.from=this.fromScreen.$el,this.to=this.toScreen.$el,s=0,t&&this.cssTransform||(t="none"),this.animating=!0,o=function(e){return function(){return 2===++s?e[t]():void 0}}(this),this.callback=r,this.hasTopSlice=this.hasBottomSlice=!1,this[t](),this.prep(),this.isScreenTall()?(this.to.css({display:"none"}),this.savedTransform=this.to.css(this.cssTransform),a=this.hasTopSlice||this.hasBottomSlice?0:this.height-1,this.setupTransform(this.to,{x:this.width-1,y:a,z:2}),this.appendScreen(),this.flushRenderingQueue(),setTimeout(function(t){return function(){return t.to.css(t.cssTransform,t.savedTransform),t.flushRenderingQueue(),t.trans()}}(this),330)):(this.appendScreen(),flviewer.is_android||flviewer.is_embed?(this.flushRenderingQueue(),setTimeout(this.trans,0)):this.trans()),!0},e.prototype.isScreenTall=function(){return!flviewer.is_mobile||this.is_os7?!1:this.toScreen.imgHeight>=1280},e.prototype.appendScreen=function(){return 0===this.to.parent().length&&this.to.appendTo(this.from.parent()),this.to.css({display:"block"}),this.isBack?this.toScreen.restoreScrollPosition():void 0},e.prototype.finishTransition=function(){return this.callback(),this.to.css({zIndex:1}),this.from.css($.extend(this.transform(""),{zIndex:0,opacity:1})),setTimeout(function(t){return function(){return t.animating=!1}}(this),0)},e.prototype.setupTransform=function(t,e){var i;return i=this.transform("translateX("+e.x+"px) translateY("+e.y+"px)"),t.css($.extend(i,{zIndex:e.z}))},e.prototype.transform=function(t){return{transform:t,"-webkit-transform":t}},e.prototype.flushRenderingQueue=function(){return this.dummy=this.to.offset().top},e.prototype.none=function(){return this.prep=function(t){return function(){return t.from.css($.extend(t.transform(""),{zIndex:0}))}}(this),this.trans=function(t){return function(){return t.appendScreen(),t.flushRenderingQueue(),setTimeout(function(){return t.callback(),t.animating=!1},30)}}(this)},e.prototype.screen_push=function(){return this.is_os7=!1,this.navigation_core(!0)},e.prototype.screen_pop=function(){return this.is_os7=!1,this.navigation_core(!1)},e.prototype.navigation_push=function(){return this.navigation_core(!0)},e.prototype.navigation_pop=function(){return this.navigation_core(!1)},e.prototype.navigation_core=function(t,e,i){var n;return n=this.is_os7?.3*-this.width:-this.width,this.hasTopSlice=this.fromScreen.attributes.top_slice&&this.fromScreen.attributes.top_slice===this.toScreen.attributes.top_slice,this.hasBottomSlice=this.fromScreen.attributes.bottom_slice&&this.fromScreen.attributes.bottom_slice===this.toScreen.attributes.bottom_slice,e=t?this.width-1:n,i=t?n:this.width,t&&(this.hasTopSlice||this.hasBottomSlice)&&(e=this.width),this.prep=function(i){return function(){var n,r;return n=t?1:2,r=t?2:1,i.setupTransform(i.from,{z:n,x:0,y:0}),i.setupTransform(i.to,{z:r,x:e,y:0})}}(this),this.trans=function(e){return function(){var n,r,s,o,a,l,h,u;return o=function(i,n){var r,s;return e.is_os7?(s=$('<div class="navigation-overlay">'),t?s.appendTo(i):s.css({opacity:.09}).appendTo(n),r=t?.09:0,s.transition({opacity:r},e.durationForNav,e.ease),s):null},a=function(i,n){var r,s;return e.is_os7?(r=t?n:i,s=$('<div class="outer-shadow">').appendTo(r.$el),s.width(r.$el.width()).height(r.innerWrap.height()),r.top_slice&&s.css({marginTop:r.top_slice.height()}),s):null},s=o(e.from,e.to),l=a(e.fromScreen,e.toScreen),!e.toScreen.error&&e.toScreen.loaded&&(e.hasTopSlice&&(e.fromScreen.top_slice&&(r=e.fromScreen.top_slice.appendTo(e.to.parent()).css({zIndex:3})),u=e.toScreen.top_slice.appendTo(e.to.parent()).css({zIndex:4,opacity:0})),e.hasBottomSlice&&(e.fromScreen.bottom_slice&&(n=e.fromScreen.bottom_slice.appendTo(e.to.parent()).css({zIndex:3})),h=e.toScreen.bottom_slice.appendTo(e.to.parent()).css({zIndex:4,opacity:0}))),e.from.transition(e.transform("translateX("+i+"px)"),e.durationForNav,e.ease),$.fx.disableTriggerPageFlow=!0,e.hasTopSlice&&(u.transition({opacity:1},e.durationForNav,e.ease),e.fromScreen.attributes.transparent_top_slice&&r.transition({opacity:0},e.durationForNav,"cubic-bezier(0.850, 0.095, 0.925, 0.110)")),e.hasBottomSlice&&(h.transition({opacity:1},e.durationForNav,e.ease),e.fromScreen.attributes.transparent_bottom_slice&&n.transition({opacity:0},e.durationForNav,"cubic-bezier(0.850, 0.095, 0.925, 0.110)")),e.to.transition(e.transform("translateX(0px)"),e.durationForNav,e.ease,function(){return e.setupTransform(e.to,{z:1,x:0,y:0}),e.flushRenderingQueue(),setTimeout(function(){return u&&(r.appendTo(e.fromScreen.screenWrap),u.appendTo(e.toScreen.screenWrap)),h&&(n.appendTo(e.fromScreen.screenWrap),h.appendTo(e.toScreen.screenWrap)),s&&s.remove(),l&&l.remove(),e.finishTransition()},50)}),$.fx.disableTriggerPageFlow=!1}}(this)},e.prototype.modal_cover_vertical_appear=function(){return this.prep=function(t){return function(){return t.setupTransform(t.from,{z:0,x:0,y:0}),t.setupTransform(t.to,{z:1,x:0,y:t.height-1})}}(this),this.trans=function(t){return function(){return t.to.transition(t.transform("translateY(0px)"),t.durationForModal,t.ease,t.finishTransition)}}(this)},e.prototype.modal_cover_vertical_disappear=function(){return this.prep=function(t){return function(){return t.setupTransform(t.from,{z:1,x:0,y:0}),t.setupTransform(t.to,{z:0,x:0,y:0})}}(this),this.trans=function(t){return function(){return t.to.css({zIndex:0}),t.from.transition(t.transform("translateY("+t.height+"px)"),t.durationForModal,t.ease,t.finishTransition)}}(this)},e.prototype.setFlipTransform=function(t,e,i,n,r){return null==r&&(r=!0),t.css(this.transform("perspective("+e+"px) rotateY("+i+"deg) scale("+n+", "+n+")"))},e.prototype.modal_flip_horizontal_r_to_l=function(){return this.prep=function(t){return function(){return t.setFlipTransform(t.to,800,-90,t.scaleForFlip),flviewer.is_mobile?void 0:t.to.css({opacity:0})}}(this),this.trans=function(t){return function(){return t.from.transition({perspective:"800px",rotateY:"90deg",scale:t.scaleForFlip},t.durationForFlip,flviewer.easeIn,function(){return flviewer.is_mobile||(t.from.css({opacity:0}),t.to.css({opacity:1})),t.to.transition({perspective:"800px",rotateY:"0deg",scale:1},t.durationForFlip,flviewer.easeOut,t.finishTransition)})}}(this)},e.prototype.modal_flip_horizontal_l_to_r=function(){return this.prep=function(t){return function(){return t.setFlipTransform(t.to,800,90,t.scaleForFlip),flviewer.is_mobile?void 0:t.to.css({opacity:0})}}(this),this.trans=function(t){return function(){return t.from.transition({perspective:"800px",rotateY:"-90deg",scale:t.scaleForFlip},t.durationForFlip,flviewer.easeIn,function(){return flviewer.is_mobile||(t.from.css({opacity:0}),t.to.css({opacity:1})),t.to.transition({perspective:"800px",rotateY:"0deg",scale:1},t.durationForFlip,flviewer.easeOut,t.finishTransition)})}}(this)},e.prototype.modal_cross_dissolve=function(){return this.prep=function(t){return function(){return t.from.css({opacity:1,zIndex:1}),t.to.css({opacity:.01,zIndex:2})}}(this),this.trans=function(t){return function(){return t.flushRenderingQueue(),setTimeout(function(){return t.to.transition({opacity:1},t.durationForFade,flviewer.easeInOut,t.finishTransition)},0)}}(this)},e.prototype.zoom_fade_in=function(){return this.prep=function(t){return function(){return t.from.css({opacity:1,zIndex:1}),t.to.css($.extend(t.transform("scale(0.5) translateZ(0)"),{opacity:0,zIndex:2}))}}(this),this.trans=function(t){return function(){return t.to.transition({opacity:1,scale:1},t.durationForZoom,flviewer.easeInOut,t.finishTransition)}}(this)},e.prototype.zoom_fade_out=function(){return this.prep=function(t){return function(){return t.from.css($.extend(t.transform("translateZ(0)"),{opacity:1,zIndex:2})),t.to.css({opacity:1,zIndex:1})}}(this),this.trans=function(t){return function(){return t.from.transition({opacity:0,scale:.5},t.durationForZoom,flviewer.easeInOut,t.finishTransition)}}(this)},e.prototype.hover_left_push=function(){return this.prep=function(t){return function(){return t.setupTransform(t.from,{z:0,x:0,y:0}),t.setupTransform(t.to,{z:1,x:t.width-1,y:0})}}(this),this.trans=function(t){return function(){return t.to.transition(t.transform("translateX(0px)"),t.durationForZoom,flviewer.easeInOut,t.finishTransition)}}(this)},e.prototype.hover_left_pop=function(){return this.prep=function(t){return function(){return t.setupTransform(t.from,{z:1,x:0,y:0}),t.setupTransform(t.to,{z:0,x:0,y:0})}}(this),this.trans=function(t){return function(){return t.to.css({zIndex:0}),t.from.transition(t.transform("translateX("+t.width+"px)"),t.durationForZoom,flviewer.easeInOut,t.finishTransition)}}(this)},e.prototype.hover_right_push=function(){return this.prep=function(t){return function(){return t.setupTransform(t.from,{z:0,x:0,y:0}),t.setupTransform(t.to,{z:1,x:-(t.width-1),y:0})}}(this),this.trans=function(t){return function(){return t.to.transition(t.transform("translateX(0px)"),t.durationForZoom,flviewer.easeInOut,t.finishTransition)}}(this)},e.prototype.hover_right_pop=function(){return this.prep=function(t){return function(){return t.setupTransform(t.from,{z:1,x:0,y:0}),t.setupTransform(t.to,{z:0,x:0,y:0})}}(this),this.trans=function(t){return function(){return t.to.css({zIndex:0}),t.from.transition(t.transform("translateX("+-t.width+"px)"),t.durationForZoom,flviewer.easeInOut,t.finishTransition)}}(this)},e}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t){this.goNext=e(this.goNext,this),this.readingTime=e(this.readingTime,this),this.$el=$(t),this.slides=$(t).find("*:first-child"),this.currentSlide=this.slides.first(),this.$el.click(this.goNext),this.timer=setTimeout(this.goNext,this.readingTime(this.$el.find(".content").text()))}return t.prototype.readingTime=function(t){var e,i,n,r,s;return n=2500,i=6e3,e=t.length,s=70,r=e*s,r=r>i?i:r,r=n>r?n:r},t.prototype.goNext=function(){var t,e;return clearTimeout(this.timer),t=this.currentSlide,this.currentSlide=e=this.currentSlide.next().size()?this.currentSlide.next():this.slides.first(),t.transition({opacity:0,duration:700,easing:"linear"},function(i){return function(){return t.hide().css({opacity:1}),i.timer=setTimeout(i.goNext,i.readingTime(e.find(".content").text()))}}(this)),e.css({opacity:0,display:"block"}).transition({duration:700,easing:"linear",opacity:1})},t}(),jQuery(function(e){var i,n,r,s,o,a,l,h,u,c,d,p,f;if(e("body").hasClass("home")){if(l=function(){return e("body,html").scrollTop()||e("body").scrollTop()},r=e("#intro_video video"),i=0,n=!1,u=!1,e(window).on("scroll",function(){return function(){var t;return t=r.offset().top+r.height()/2,l()>t&&!n&&!u?(u=!0,mixpanel.track("Stop Watching Video",{at:i})):void 0}}(this)),h=function(){return function(){return e("#intro_end_frame").is(":visible")?void 0:(r.parent().children(".play-button").hide(),flinto.isMobileBrowser()?(e("#intro_end_frame").show().css({opacity:1}),setTimeout(function(){return r.hide()
},300)):e("#intro_end_frame").show().transition({opacity:1},1e3,function(){return r.css({opacity:0}),r.hide()}))}}(this),r.on("timeupdate",function(){return function(t){return i=t.target.currentTime,t.target.currentTime>44.5?(u||n||mixpanel.track("Finish Video (Intro)"),n=!0,h()):void 0}}(this)),r.on("play",function(){return e("#intro_video_poster").hide()}),r.on("pause",function(){return function(){return h()}}(this)),e(".replay").on("click",function(){return e("#intro_end_frame").transition({opacity:0},function(){return this.hide()}),r.show().transition({opacity:1}),r[0].currentTime=0,r[0].play()}),flinto.isMobileBrowser()){for(f=e("video"),d=0,p=f.length;p>d;d++)c=f[d],s=e("<div class='play-button'>"),s.data("video",c),e(c).parent().children(".poster").show().css({opacity:1}),s.show(),e(c).parent().append(s),e(c).on("ended",function(t){return c=t.target,"intro_video"===e(c).parent().attr("id")?void e(c).parent().children(".play-button").hide():(c.pause(),c.currentTime=0,e(c).parent().children(".play-button").show().transition({opacity:1}),e(c).parent().children(".poster").show().transition({opacity:1}))});e(".play-button").on("click",function(t){var i;return i=e(t.target),c=i.data("video"),c.paused?(i.hide().css({opacity:0}),e(c).parent().children(".poster").hide().css({opacity:0}),c.play()):void 0})}else o=function(t){var i,n;return i=e(t.target).closest("li"),n=i.find("video")[0],i.addClass("active"),e(n).parent().children(".poster").hide().css({opacity:0}),n.currentTime=0,n.play()},a=function(t){var i,n;return i=e(t.target).closest("li"),n=i.find("video")[0],i.removeClass("active"),n.pause(),e(n).parent().children(".poster").show().transition({opacity:1})},e("ul.features li").on("mouseenter",o).on("mouseleave",a),e("ul.features li video").on("ended",function(t){return o(t)});return new t("#testimonial-slideshow"),e(".js-jump-to-signup").on("click",function(){return function(t){var i,n,r;return t.preventDefault(),r=l()+1,n=e("#sign-up").offset().top-30,i=new Animation("jumpToSignUp",500),i.frame=function(){var t;return t=i.easeOut(r,n),e("body,html").scrollTop(t)},i.finish=function(){return flinto.isMobileBrowser()?void 0:e("#user_email").val()?e("#user_password").focus():e("#user_email").focus()},setTimeout(function(){return i.startAnimation()},33)}}(this))}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.IconStrike=function(){function e(){this.attachEvents=t(this.attachEvents,this),this.saveToServer=t(this.saveToServer,this),this.ajaxComplete=t(this.ajaxComplete,this),this.importFiles=t(this.importFiles,this),this.unpeek=t(this.unpeek,this),this.peek=t(this.peek,this),this.initTransitions=t(this.initTransitions,this);var e;this.$el=$(".app_bar"),this.enableBackgroundStretch(),this.attachEvents(),this.handlePrecomposed(),this.active()&&(this.flile.unbind(),e=this.$el.find(".icon_area .icon"),e.imagesLoaded(function(){return e.src?fakeCrop(e):void 0})),this.$el.find(".url").click(function(){return $(this).select()}),this.initShareTabs(),this.initTransitions(),this.sprites.makeAnother.click(function(t){return function(){return t.reset()}}(this)),this.$el.ajaxStop(function(){return window.onbeforeunload=null}),this.$el.ajaxStart(function(){return window.onbeforeunload=function(){return"Icon Strike is still saving data to the server. You may want to wait a moment before leaving the page."}})}return e.prototype.initShareTabs=function(){var t,e,i;return t=$("#strike_share"),i=t.find(".tabs li"),e=t.find(".pane"),e.hide(),i.click(function(t){var n,r;return r=$(t.target),i.removeClass("active"),r.addClass("active"),n=r.data("tab"),e.hide(),$("#"+n).show()}),i.first().click()},e.prototype.handlePrecomposed=function(){var t,e;return t=$("#strike_precomposed input"),e=this.$el.find(".icon_area .icon"),t.change(function(){return function(){var i,n;return n=!t.is(":checked"),e[""+(n?"add":"remove")+"Class"]("precomposed"),e.parent().hide().show(0),i={precomposed:n},$.ajax({url:"/icon_strikes/"+window.iconStrikeToken,data:i,type:"PUT",complete:$.noop})}}(this))},e.prototype.enableBackgroundStretch=function(){var t,e,i;return t=$("#background_stretch"),e=t.attr("width"),t.removeAttr("width"),i=function(){return t.width($(window).width()<e?e:$(window).width())},t.imagesLoaded(function(){return i(),$(window).resize(i)})},e.prototype.active=function(){return this.$el.hasClass("active")},e.prototype.initTransitions=function(){return this.sprites={strikeInstructions:$("#strike_instructions"),strikeShare:$("#strike_share"),strikeSizes:$("#strike_sizes"),makeAnother:$("#make_another"),precomposed:$("#strike_precomposed"),devicePreview:$("#device_preview"),shareHeader:$("#share_header"),icon:$(".icon_area .icon")}},e.prototype.peek=function(){return this.active()?void 0:this.sprites.devicePreview.transition({y:"+250px",duration:250,easing:"cubic-bezier(0.070, 0.410, 0.160, 1.000)"})},e.prototype.unpeek=function(){return this.transitionStarted||this.active()?void 0:this.sprites.devicePreview.transition({y:"308px",duration:250,easing:"cubic-bezier(0.070, 0.410, 0.160, 1.000)"})},e.prototype.transition=function(){var t,e,i;return this.active()?void 0:(setTimeout(function(t){return function(){return t.$el.addClass("active"),t.transitionStarted=!1}}(this),1500),t=700,e="ease-in-out",this.sprites.precomposed.find("input").removeAttr("checked"),this.sprites.icon.transition({x:"-35px",y:"-30px",scale:1.5,easing:"ease-out",duration:200}).transition({x:"-30px",y:"+37px",scale:.12,duration:t-250,easing:"ease-in"}).transition({scale:.1754385965,duration:300},function(t){return function(){return t.sprites.icon.hide().show(0)}}(this)),this.sprites.strikeInstructions.transition({opacity:0,duration:t/3,y:"+50px"},function(t){return function(){return t.sprites.strikeInstructions.hide()}}(this)),i=this.sprites.shareHeader.add(this.sprites.strikeShare).add(this.sprites.makeAnother).add(this.sprites.precomposed),i.css({opacity:0,rotate:"0deg"}).show().transition({delay:1500,scale:1,opacity:1,duration:t,easing:e}),this.sprites.devicePreview.transition({y:"0",duration:t-200,easing:e}))},e.prototype.reset=function(){var t,e,i,n,r;return n=$("#resetting_loader"),n.show(),window.iconStrikeToken="",n.hide(),this.active()?(t=700,setTimeout(function(t){return function(){return t.$el.removeClass("active")}}(this),t),$(".icon_wrap").css("overflow","visible"),this.flile.bind(),e="ease-in-out",this.sprites.icon.removeClass("precomposed").transition({x:"-35px",y:"-30px",scale:1.5,easing:"ease-out",duration:t-400}).transition({x:"5px",y:"4px",scale:.8,duration:250,easing:"ease-in"}).transition({x:"0px",y:"0px",scale:1,duration:125,easing:"ease-out"},function(t){return function(){return t.sprites.icon.hide().show(0)}}(this)),i=this.sprites.icon.find("img"),i.transition({opacity:0,duration:150},function(){return function(){return i.remove()}}(this)),this.sprites.strikeInstructions.css({opacity:0}).show().transition({opacity:1,duration:t/3,y:"0"}),r=this.sprites.shareHeader.add(this.sprites.strikeShare).add(this.sprites.makeAnother).add(this.sprites.precomposed),r.transition({scale:1,opacity:0,duration:t,easing:e}),this.sprites.devicePreview.transition({y:"+308px",duration:t-300,easing:"ease-in"})):void 0},e.prototype.handleImages=function(t){var e,i,n,r,s,o,a,l,h;s={57:null,72:null,76:null,114:null,144:null,120:null,152:null},l=_.keys(s),h=[],o=[];for(r in t)n=t[r],n.smallEdge=n.w<n.h?n.w:n.h,n.square=n.w===n.h,n.square?h.push(n):o.push(n);return i=function(){var t;for(r in s)if(t=s[r],null==t)return!1;return!0},e=function(t){var e,i,n;n=[];for(r in t)e=t[r],i=""+e.smallEdge,_.include(l,i)&&null==s[i]?(s[i]=e,s[i].scaleDirection="exact",n.push(l=_.without(l,i))):n.push(void 0);return n},a=function(){return function(t,e){var i,n,o,a,h,u,c,d,p;if("down"===e)n=function(t,e){return t>e},o=function(t,e){return e>=t};else{if("up"!==e)return!1;n=function(t,e){return e>=t},o=function(t,e){return t>e}}for(a=[],d=0,p=l.length;p>d;d++){c=l[d],u=parseInt(c,10),i=null;for(r in t)h=t[r],n(h.smallEdge,u)&&(null!=i?o(h.smallEdge,i.smallEdge)&&(i=h):i=h);null!=i&&(s[c]=_.clone(i),s[c].scaleDirection=e,a.push(c))}return l=_.without(l,a)}}(this),e(h),i()?s:(a(h,"down"),i()?s:(a(o,"down"),i()?s:(a(h,"up"),i()?s:(a(o,"up"),s))))},e.prototype.resizeImages=function(t){var e,i;for(e in t)i=t[e],(parseInt(i.w)!==parseInt(e)||parseInt(i.h)!==parseInt(e))&&(i.url=Graphics.resizeAndCrop(i.image,$("#resize_canvas")[0],e,e));return t},e.prototype.importFiles=function(t){var e,i,n,r,s,o;for(i=[],o=[],r=0,s=t.length;s>r;r++)e=t[r],n=new FileReader,n.filename=escapePlusSign(e.name),n.type=e.type,n.onload=function(e){return function(n){var r;return r=new Image,r.src=n.target.result,$(r).imagesLoaded(function(){var s;return i.push({image:r,content_type:n.target.type,file_name:n.target.filename,url:n.target.result,w:r.naturalWidth,h:r.naturalHeight}),i.length===t.length?(s=e.handleImages(i),e.resizeImages(s),e.saveToServer(s),e.displayIconImage(s)):void 0})}}(this),o.push(n.readAsDataURL(e));return o},e.prototype.ajaxComplete=function(t){var e,i,n,r,s,o,a,l,h,u;s=$.parseJSON(t.responseText),window.iconStrikeToken=s.token,r=s.id,i=$("#email_share_form, #sms_share_form"),e=i.attr("action"),a="/icon_strikes/"+r+"/share",i.attr("action",a),l=$("#strike_url"),l.val(""+window.location.origin+l.data("base")+window.iconStrikeToken),h=this.iconData,u=[];for(o in h)n=h[o],u.push(flinto.S3DirectUpload(s.direct_upload_params[o],dataURItoBlob(n.url)));return u},e.prototype.saveToServer=function(t){var e,i,n,r;n={144:"ipad_retina",72:"ipad_legacy",152:"ipad_ios7_retina",76:"ipad_ios7_legacy",120:"iphone_ios7",114:"iphone_retina",57:"iphone_legacy"},e={icon_strike:{}},this.iconData={};for(i in n)r=n[i],e.icon_strike[r]={file_name:t[i].file_name,content_type:t[i].content_type},this.iconData[r]={file_name:t[i].file_name,image:t[i].image,url:t[i].url};return $.ajax({url:"/icon_strikes/",data:e,type:"POST",complete:this.ajaxComplete})},e.prototype.displayIconImage=function(t){var e,i,n;return e=$("<img>").attr({src:t[114].url}).css({width:"100%"}),n=e.clone(),i=$(".icon_strike .icon_area .icon"),i.html(e).addClass("precomposed"),fakeCrop(i)},e.prototype.attachEvents=function(){var t,e;return e=$(".icon_area"),t=$(".app_bar"),this.flile=new Flile(e,{handleFiles:function(t){return function(e){var i,n,r,s;for(n=[],r=0,s=e.length;s>r;r++){if(i=e[r],!/image/i.test(i.type))return alert("Sorry, Icon Strike only supports JPG, PNG and GIF images."),t.imageError=!0,!1;if(i.size>5242880)return alert("Sorry, the maximum file size is 5mb."),t.imageError=!0,!1}return t.importFiles(e)}}(this),mouseOverWindow:function(t){return function(){return t.peek()}}(this),onChange:function(t){return function(e,i){return t.imageError||(t.transitionStarted=!0,i?setTimeout(function(){return t.transition()},350):t.transition(),t.flile.unbind()),t.imageError=!1}}(this),mouseOutWindow:function(t){return function(){return t.unpeek()}}(this)})},e}()}.call(this),function(){var t;t=null,$(document).on("page:fetch",function(){return t=setTimeout(function(){return $("body, a").css({cursor:"wait"})},500)}),$(document).on("page:receive",function(){return t?$("a").css({cursor:""}):void 0}),$(document).on("page:load",function(){return $("body").css({cursor:""})}),$(document).on("page:change",function(){return clearTimeout(t),$("body").css({cursor:"default"})}),$(document).on("ready",function(){return clearTimeout(t),$("body").css({cursor:"default"})})}.call(this),function(){jQuery(function(t){var e,i,n;return new flinto.HoverDropMenu("#user_menu"),flinto.setupSnapWait(),readCookie("_flinto_screen_name")?(t("#logged_in").show(),t("#marketing").hide(),t("#user_screen_name").text(readCookie("_flinto_screen_name"))):(t("#logged_in").hide(),t("#marketing").show()),e=t(".toggle_payload"),e.size()&&(e.hasClass("toggled")||e.hide(),t("#"+t(".toggle_trigger.toggled").data("target")).show(),t(".toggle_trigger").on("click",function(i){return i.preventDefault(),e=t("#"+t(this).data("target")),e.toggle(),t(this).toggleClass("toggled")})),i=getURLParameter("mp_email_ref"),i&&(i=i.replace(/_/g," "),i=i.charAt(0).toUpperCase()+i.slice(1),mixpanel.track("Email Link Clicked",{Path:window.location.pathname,Source:i})),t("body").hasClass("pricing")&&mixpanel.track_forms("#new_user","Sign Up",{"Form Position":"pricing"}),t("body").hasClass("home")&&(mixpanel.track("Page Landed",{Source:i||document.referrer}),mixpanel.track_forms("#new_user","Sign Up",{"Form Position":"bottom"}),mixpanel.track_forms("#top-signup-form","Sign Up",{"Form Position":"top"})),t("body").hasClass("icon_strike")?(new IconStrike,n=t("form#email_share_form, form#sms_share_form"),n.on("ajax:send",function(e){var i,n;return i=t(e.target).find("input[type=submit]"),n=t(e.target).find("input[type=text]"),t(e.target).attr("disabled","disabled"),n.attr("disabled","disabled"),i.attr("disabled","disabled")}),n.on("ajax:error",function(e){var i,n,r,s;return i=t(e.target).find(".check"),r=t(e.target).find("input[type=submit]"),s=t(e.target).find("input[type=text]"),i.addClass("error").css("opacity",1).html("!"),n=function(){return i.css("opacity",0),t(e.target).removeAttr("disabled"),s.removeAttr("disabled"),r.removeAttr("disabled")},setTimeout(n,2e3)}),n.on("ajax:success",function(e){var i,n,r,s;return i=t(e.target).find(".check"),r=t(e.target).find("input[type=submit]"),s=t(e.target).find("input[type=text]"),i.removeClass("error").css("opacity",1).html("&#10003;"),n=function(){return i.css("opacity",0),s.val(""),t(e.target).removeAttr("disabled"),s.removeAttr("disabled"),r.removeAttr("disabled")},setTimeout(n,2e3)})):void 0})}.call(this),function(){flinto.upload_indicator_counter=0,flinto.S3DirectUpload=function(t,e,i){var n,r,s,o,a,l,h,u,c,d;for(null==i&&(i=null),r=new FormData,d=t.formData,u=0,c=d.length;c>u;u++){a=d[u];for(o in a)h=a[o],r.append(o,h)}return r.append("file",e),l=setTimeout(function(){return function(){return fleditor.local&&0===flinto.upload_indicator_counter&&fleditor.local.vent.trigger("show_upload_indicator"),flinto.upload_indicator_counter++}}(this),2e4),s={params:t,data:r,options:i,file:e,timer:l},n=function(){return function(t){return clearTimeout(t.timer),fleditor.local&&--flinto.upload_indicator_counter<=0?fleditor.local.vent.trigger("hide_upload_indicator"):void 0}}(this),$.ajax({url:s.params.url,cache:!1,noGlobalErrorDialog:!0,contentType:!1,processData:!1,type:"POST",data:s.data,success:function(t){return s.options&&s.options.success?s.options.success(t,s.params):void 0},error:function(t){return s.options&&s.options.error?s.options.error(t,s.params):void 0},complete:function(){return n(s)}})}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};flinto.sharePage={},flinto.sharePage.ControlToggle=function(){function e(){this.toggleControls=t(this.toggleControls,this),this.showControls=t(this.showControls,this),this.hideControls=t(this.hideControls,this),this.controls=$("#controls"),this.canvas=$("#canvas"),this.device=this.canvas.find(".device"),this.deviceWidth=this.device.width(),this.toggle=this.controls.find(".js-controls_toggle"),this.shown=!0,this.controlsWidth=parseInt(this.controls.css("width"),10),this.toggleWidth=this.toggle.width(),this.animationSettings={duration:250,easing:"ease"},this.toggle.on("click",this.toggleControls)}return e.prototype.hideControls=function(){return this.shown===!1?!1:(this.shown=!1,this.controls.transition(_.extend({x:-1*this.controlsWidth},this.animationSettings)),this.canvas.transition(_.extend({marginLeft:this.toggleWidth},this.animationSettings)),this.toggle.find(".label.close").transition(_.extend({opacity:0},this.animationSettings)),this.toggle.find(".label.open").transition(_.extend({opacity:1},this.animationSettings)))},e.prototype.showControls=function(){return this.shown===!0?!1:(this.shown=!0,this.controls.transition(_.extend({x:"0"},this.animationSettings)),this.canvas.transition(_.extend({marginLeft:""+this.controlsWidth+"px"},this.animationSettings)),this.toggle.find(".label.close").transition(_.extend({opacity:1},this.animationSettings)),this.toggle.find(".label.open").transition(_.extend({opacity:0},this.animationSettings)))},e.prototype.toggleControls=function(){return this.shown?this.hideControls():this.showControls()},e}(),flinto.sharePage.StickyLogo=function(){function t(){var t,e,i,n,r;$(".made_with_flinto").size()&&(t=$("#controls .inner ul"),e=t.height()+20,i=$(".made_with_flinto"),n=i.outerHeight(),r=function(){var t;return t=$(window).height(),i.css(t-e>n?{position:"absolute"}:{position:"static"})},r(),$(window).on("resize",r),$("#controls .inner").on("scroll",r))}return t}(),jQuery(function(t){var e,i,n,r,s;return t("body").is(".flviewer.desktop")?(new flinto.sharePage.ControlToggle,new flinto.sharePage.StickyLogo,e=t("#prototype-title"),n=e.find(".js-center-me"),s=e.height()/2-n.height()/2-1,n.css({marginTop:s}),t("#prototype_menu li").on("click",function(e){return t(e.target).hasClass("previous_screen")?flinto.flviewer.menu.back():t(e.target).hasClass("home_screen")&&flinto.flviewer.menu.reload(),!0}),t("#frame_style").change(function(e){var i,n;return n=t(e.target),i=t(".js-device_frame"),n.find("option").each(function(e,n){return i.removeClass(t(n).attr("value"))}),i.addClass(n.val())}),i=t(".js-device_frame"),r=t(".js-screen"),t("#canvas").css({minWidth:""+(r.width()+75)+"px",minHeight:""+(r.height()+75)+"px"})):void 0})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};flviewer.AutoDemo=function(){function e(e,i,n){var r;null==n&&(n=2e3),this.frame=t(this.frame,this),this.viewer=e,this.pattern=i,this.wrap=$('<div class="autodemo_overlay">'),$('<div class="instruction">').text("Click to Start Interactive Demo").appendTo(this.wrap),this.wrap.width(this.viewer.$el.width()).height(this.viewer.$el.height()),this.wrap.insertAfter(this.viewer.$el),this.wrap.on("mouseenter",function(t){return function(){return t.wrap.addClass("over")}}(this)),this.wrap.on("mouseleave",function(t){return function(){return t.wrap.removeClass("over")}}(this)),this.wrap.on("click",function(t){return function(){return t.wrap.remove(),t.pointer.remove(),clearTimeout(t.interval)}}(this)),this.pointer=$('<div class="finger">').appendTo(this.viewer.$el),r=i.shift(),this.index=0,this.pointer.css({left:r[0],top:r[1],display:"block",opacity:0}),this.interval=setInterval(this.frame,n)}return e.prototype.frame=function(){var t;return t=this.pattern[this.index],++this.index>=this.pattern.length&&(this.index=0),2===t.length?this.transition(t[0],t[1]):5===t.length?this.scroll(t):void 0},e.prototype.transition=function(t,e){return t/=this.viewer.viewerScaleFactor,e/=this.viewer.viewerScaleFactor,this.moveToCursor(t,e,function(i){return function(){var n;return i.pointer.removeClass("down"),setTimeout(function(){return i.pointer.css({opacity:0})},500),n=i.viewer.activeScreen.findLink(t,e),n?n.handleClick(null):void 0}}(this))},e.prototype.scroll=function(t){var e,i,n,r,s;return r=t[0],s=t[1],e=t[2],i=t[3],n=t[4],r/=this.viewer.viewerScaleFactor,s/=this.viewer.viewerScaleFactor,e/=this.viewer.viewerScaleFactor,i/=this.viewer.viewerScaleFactor,this.moveToCursor(r,s,function(t){return function(){var r;return t.pointer.transition({left:e-t.pointer.width()/2,top:i-t.pointer.height()/2,opacity:0},n,function(){return t.pointer.removeClass("down")}),r=new Animation("scroll",3*n),r.frame=function(){var e;return e=r.easeOut(0,n),t.viewer.activeScreen.inner[0].scrollTop=e},r.finish=function(){},r.startAnimation()}}(this))},e.prototype.moveToCursor=function(t,e,i){return this.pointer.css({opacity:1}),this.pointer.transition({left:t-this.pointer.width()/2,top:e-this.pointer.height()/2},300,function(t){return function(){return t.pointer.addClass("down"),setTimeout(i,150)}}(this))},e}()}.call(this);